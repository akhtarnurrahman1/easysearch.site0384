<!DOCTYPE html>

<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>EasySearch</title>
<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Google Fonts - Inter -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<!-- Google Generative AI SDK -->
<script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>
<style>
        /* Base styles for light mode */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            line-height: 1.6;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease, font-size 0.3s ease;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            font-size: var(--base-font-size, 1rem);
        }

        /* Drawing App Styles */
        .drawing-container {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
        }
        .drawing-controls {
            padding: 20px;
            background-color: #e2e8f0;
            border-bottom: 1px solid #cbd5e1;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
        .control-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .tool-button, .action-button {
            padding: 10px 15px;
            border-radius: 8px;
            background-color: #4299e1;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-weight: 600;
        }
        .tool-button:hover, .action-button:hover {
            background-color: #3182ce;
            transform: translateY(-2px);
        }
        .tool-button.active {
            background-color: #2b6cb0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .drawing-canvas {
            background-color: #ffffff;
            display: block;
            width: 100%;
            height: 600px;
            cursor: crosshair;
            touch-action: none;
        }

        /* Dark mode styles for drawing */
        body.dark-mode .drawing-container {
            background-color: #2d3748;
        }
        body.dark-mode .drawing-controls {
            background-color: #4a5568;
        }
        body.dark-mode .drawing-canvas {
            background-color: #e2e8f0;
        }

        /* Search gradient and other existing styles */
        .search-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .result-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-left-color: #667eea;
        }
        .search-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: all 0.3s ease;
        }
        .search-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .search-engine-btn.active {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5);
            border: 2px solid #667eea;
        }

        /* Custom modal for alerts/confirms */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .custom-modal {
            background: #2d3748;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        .custom-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: #cbd5e0;
        }
        .custom-modal-message {
            margin-bottom: 24px;
            color: #a0aec0;
        }
        .custom-modal-actions button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .custom-modal-actions .confirm-btn {
            background-color: #ef4444;
            color: white;
            margin-right: 12px;
        }
        .custom-modal-actions .confirm-btn:hover {
            background-color: #dc2626;
        }
        .custom-modal-actions .cancel-btn {
            background-color: #4a5568;
            color: white;
        }
        .custom-modal-actions .cancel-btn:hover {
            background-color: #2d3748;
        }
        .custom-modal-actions .ok-btn {
            background-color: #3b82f6;
            color: white;
        }
        .custom-modal-actions .ok-btn:hover {
            background-color: #2563eb;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-800 {
            color: #e2e8f0;
        }
        body.dark-mode .border-gray-200 {
            border-color: #4a5568;
        }
        body.dark-mode .text-gray-700 {
            color: #cbd5e0;
        }
        body.dark-mode .placeholder-gray-400::placeholder {
            color: #a0aec0;
        }
        body.dark-mode .result-card {
            background-color: #2d3748;
            border-left-color: #667eea;
        }
        body.dark-mode .result-card:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        body.dark-mode .text-blue-600 {
            color: #90cdf4;
        }
        body.dark-mode .text-green-600 {
            color: #9ae6b4;
        }
        body.dark-mode .text-gray-50 {
            color: #e2e8f0;
        }
        body.dark-mode .search-engine-btn {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark-mode .search-engine-btn.active {
            box-shadow: 0 0 0 3px rgba(144, 205, 244, 0.5);
            border: 2px solid #90cdf4;
        }
        body.dark-mode .bg-blue-100 { background-color: #2b6cb0; color: #e2e8f0; }
        body.dark-mode .bg-green-100 { background-color: #2f855a; color: #e2e8f0; }
        body.dark-mode .bg-orange-100 { background-color: #b7791f; color: #e2e8f0; }
        body.dark-mode .bg-purple-100 { background-color: #6b46c1; color: #e2e8f0; }
        body.dark-mode .bg-lime-100 { background-color: #68d391; color: #1a202c; }
        body.dark-mode .bg-red-100 { background-color: #c53030; color: #e2e8f0; }
        body.dark-mode .bg-indigo-100 { background-color: #5a67d8; color: #e2e8f0; }
        body.dark-mode .bg-pink-100 { background-color: #d53f8c; color: #e2e8f0; }
        body.dark-mode .bg-yellow-100 { background-color: #d69e2e; color: #1a202c; }
        body.dark-mode .bg-gray-100 { background-color: #a0aec0; color: #1a202c; }
        body.dark-mode footer {
            background-color: #2d3748;
        }

        /* High Contrast Mode Styles */
        body.high-contrast-mode {
            background-color: black !important;
            color: white !important;
        }
        body.high-contrast-mode .text-gray-800,
        body.high-contrast-mode .text-gray-700,
        body.high-contrast-mode .text-gray-50,
        body.high-contrast-mode .text-gray-300,
        body.high-contrast-mode .text-gray-400,
        body.high-contrast-mode .text-blue-700,
        body.high-contrast-mode .text-green-700,
        body.high-contrast-mode .text-orange-700,
        body.high-contrast-mode .text-purple-700,
        body.high-contrast-mode .text-lime-700,
        body.high-contrast-mode .text-red-700,
        body.high-contrast-mode .text-indigo-700,
        body.high-contrast-mode .text-pink-700,
        body.high-contrast-mode .text-yellow-700,
        body.high-contrast-mode .text-gray-700 {
            color: white !important;
        }
        body.high-contrast-mode .search-gradient,
        body.high-contrast-mode .search-button {
            background: #00ff00 !important;
            color: black !important;
            border: 2px solid white !important;
        }
        body.high-contrast-mode .result-card,
        body.high-contrast-mode .main-content-card,
        body.high-contrast-mode .bg-white,
        body.high-contrast-mode .bg-gray-50,
        body.high-contrast-mode .sidebar,
        body.high-contrast-mode .custom-modal,
        body.high-contrast-mode .background-picker-content,
        body.high-contrast-mode #loginForm,
        body.high-contrast-mode .gemini-result-card,
        body.high-contrast-mode .learning-mode-card,
        body.high-contrast-mode .particle-picker-content,
        body.high-contrast-mode .drawing-container {
            background-color: black !important;
            border: 1px solid white !important;
            box-shadow: none !important;
        }
        body.high-contrast-mode .result-card:hover {
            background-color: #333 !important;
            border-left-color: #00ff00 !important;
        }
        body.high-contrast-mode .text-blue-600,
        body.high-contrast-mode .text-green-600 {
            color: yellow !important;
        }
        body.high-contrast-mode input,
        body.high-contrast-mode textarea,
        body.high-contrast-mode select {
            background-color: black !important;
            color: white !important;
            border-color: white !important;
        }
        body.high-contrast-mode .placeholder-gray-400::placeholder {
            color: #ccc !important;
        }
        body.high-contrast-mode .toggle-slider {
            background-color: #555 !important;
        }
        body.high-contrast-mode input:checked + .toggle-slider {
            background-color: #00ff00 !important;
        }
        body.high-contrast-mode .search-engine-btn {
            background-color: #333 !important;
            color: white !important;
            border: 1px solid white !important;
        }
        body.high-contrast-mode .search-engine-btn.active {
            box-shadow: 0 0 0 3px #00ff00 !important;
            border: 2px solid #00ff00 !important;
        }
        body.high-contrast-mode .voice-search-button {
            color: #00ff00 !important;
        }
        body.high-contrast-mode .voice-search-button.listening {
            background-color: red !important;
            color: white !important;
        }
        body.high-contrast-mode footer {
            background-color: black !important;
            border-top: 1px solid white !important;
        }
        body.high-contrast-mode .sidebar-setting span {
            color: white !important;
        }
        body.high-contrast-mode .sidebar-setting .status-text {
            color: #00ff00 !important;
        }
        body.high-contrast-mode .clear-history-btn,
        body.high-contrast-mode #loginForm button {
            background-color: #00ff00 !important;
            color: black !important;
            border: 1px solid white !important;
        }
        body.high-contrast-mode #loginMessage {
            color: yellow !important;
        }
        body.high-contrast-mode #logoutButton {
            background-color: red !important;
            color: white !important;
            border: 1px solid white !important;
        }
        body.high-contrast-mode .tool-button,
        body.high-contrast-mode .action-button {
            background-color: #00ff00 !important;
            color: black !important;
            border: 1px solid white !important;
        }
        body.high-contrast-mode .drawing-canvas {
            background-color: white !important;
            border: 2px solid #00ff00 !important;
        }

        /* Focus Mode Styles */
        body.focus-mode {
            background-image: none !important;
            background-color: #f0f2f5 !important;
        }
        body.focus-mode.dark-mode {
            background-color: #1a202c !important;
        }
        body.focus-mode .main-content-card {
            background-color: white !important;
            backdrop-filter: none !important;
        }
        body.focus-mode.dark-mode .main-content-card {
            background-color: #2d3748 !important;
        }
        body.focus-mode #quickSearchSuggestions,
        body.focus-mode #searchEngineOptions,
        body.focus-mode footer,
        body.focus-mode #searchResults,
        body.focus-mode #imageGenerationSection,
        body.focus-mode #learningModeSection {
            display: none !important;
        }
        body.focus-mode header {
            padding-bottom: 2rem !important;
        }
        body.focus-mode .container.mx-auto.px-4.-mt-6 {
            margin-top: 2rem !important;
        }

        /* Zen Mode Styles */
        body.zen-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
        }
        body.zen-mode * {
            animation: zen-breathe 4s ease-in-out infinite;
        }
        body.zen-mode .sidebar,
        body.zen-mode footer,
        body.zen-mode #quickSearchSuggestions,
        body.zen-mode #searchEngineOptions {
            display: none !important;
        }
        body.zen-mode .main-content-card {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* Zen Mode Exit Button */
        .zen-exit-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            z-index: 10001;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-weight: bold;
            display: none;
        }
        body.zen-mode .zen-exit-button {
            display: block;
        }
        .zen-exit-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        @keyframes zen-breathe {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* Premium Particle Effects */
        .particle.rainbow {
            background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080);
            background-size: 400% 400%;
            animation: rainbow-shift 2s ease infinite, particle-fade-move 1.5s forwards;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .particle.glow {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor;
            animation: glow-pulse 1s ease-in-out infinite alternate, particle-fade-move 1.5s forwards;
        }

        .particle.golden {
            color: #FFD700;
            text-shadow: 0 0 10px #FFD700, 0 0 20px #FFA500;
            animation: golden-sparkle 1s ease-in-out infinite, particle-fade-move 1.5s forwards;
        }

        @keyframes rainbow-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes glow-pulse {
            from { text-shadow: 0 0 5px currentColor; }
            to { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
        }

        @keyframes golden-sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        /* Enhanced Instant Translate Popup */
        .translate-popup {
            position: fixed;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 14px;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 320px;
            max-width: 400px;
        }
        .translate-popup.show {
            opacity: 1;
            pointer-events: auto;
        }
        .translate-popup-enhanced {
            pointer-events: auto;
        }
        .translate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px 12px 0 0;
        }
        .translate-title {
            font-weight: 600;
            font-size: 13px;
            color: #fff;
        }
        .translate-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        .translate-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .translate-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 12px;
        }
        .translate-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        .translate-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        .translate-btn:active {
            transform: translateY(0);
        }
        .translate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .translate-result {
            padding: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 0 0 12px 12px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .translate-loading {
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            text-align: center;
            font-size: 12px;
        }
        .translate-success {
            text-align: center;
            width: 100%;
        }
        .translate-flag {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .translate-text {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .copy-translation-btn {
            background: #28a745;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .copy-translation-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        .translate-error {
            color: #ff6b6b;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
        }

        /* Dark mode adjustments for translate popup */
        body.dark-mode .translate-popup {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-color: rgba(255, 255, 255, 0.3);
        }
        body.high-contrast-mode .translate-popup {
            background: black !important;
            border: 2px solid white !important;
        }
        body.high-contrast-mode .translate-btn {
            background: #333 !important;
            border-color: white !important;
        }
        body.high-contrast-mode .translate-btn:hover:not(:disabled) {
            background: #00ff00 !important;
            color: black !important;
        }

        /* Toggle switch styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #667eea;
        }
        input:focus + .toggle-slider {
            box-shadow: 0 0 1px #667eea;
        }
        input:checked + .toggle-slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Kids Mode Background Styles */
        body.kids-mode-bg {
            background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
        }
        body.dark-mode.kids-mode-bg {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }

        /* Learning Mode Background Styles */
        body.learning-mode-bg {
            background: linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%);
            color: #e2e8f0;
        }
        body.dark-mode.learning-mode-bg {
            background: linear-gradient(135deg, #4B0082 0%, #2F005F 100%);
        }
        .learning-mode-card {
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        body.dark-mode .learning-mode-card {
            background-color: rgba(45, 55, 72, 0.2);
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background-color: #2d3748;
            z-index: 1000;
            box-shadow: -5px 0 15px rgba(0,0,0,0.3);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            overflow-y: auto;
            padding: 20px;
            color: #e2e8f0;
        }
        .sidebar.active {
            transform: translateX(0);
        }
        .sidebar-close-btn {
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 2rem;
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
        .sidebar-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #4a5568;
        }
        .sidebar-setting:last-child {
            border-bottom: none;
        }
        .sidebar-setting span {
            font-weight: 500;
        }
        .sidebar-setting .status-text {
            font-weight: 600;
            margin-left: 10px;
        }

        /* Voice Search Button Styles */
        .voice-search-button {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 0.75rem;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .voice-search-button:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        .voice-search-button:active {
            transform: scale(0.95);
        }
        .voice-search-button.listening {
            background-color: #ef4444;
            color: white;
            animation: pulse-red-animation 1.5s infinite;
        }
        .voice-search-button svg {
            width: 28px;
            height: 28px;
        }
        body.dark-mode .voice-search-button {
            color: #90cdf4;
        }
        body.dark-mode .voice-search-button:hover {
            background-color: rgba(144, 205, 244, 0.1);
        }
        body.dark-mode .voice-search-button.listening {
            background-color: #dc2626;
        }

        /* Background picker modal styles */
        .background-picker-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .background-picker-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .background-picker-content {
            background: #2d3748;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            color: #e2e8f0;
            position: relative;
        }
        .background-picker-close-btn {
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 2rem;
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
        .background-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .background-item {
            border: 3px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            padding-top: 75%;
            background-size: cover;
            background-position: center;
        }
        .background-item.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.5);
        }
        .background-item:hover {
            transform: scale(1.03);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .background-item-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 8px;
            font-size: 0.85rem;
            text-align: center;
        }
        .main-content-card {
            background-color: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }
        body.dark-mode .main-content-card {
            background-color: rgba(45, 55, 72, 0.3);
        }
        .gemini-result-card {
            background-color: #e0f2f7;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            color: #2c3e50;
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 1rem;
        }
        body.dark-mode .gemini-result-card {
            background-color: #34495e;
            color: #ecf0f1;
        }

        /* Search History Styles */
        .search-history-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        .search-history-item {
            padding: 8px 0;
            border-bottom: 1px solid #4a5568;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .search-history-item:last-child {
            border-bottom: none;
        }
        .search-history-item:hover {
            background-color: #4a5568;
            border-radius: 4px;
        }
        .search-history-item span {
            font-size: 0.9rem;
            color: #cbd5e0;
        }
        .clear-history-btn {
            background-color: #ef4444;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            margin-top: 20px;
            width: 100%;
            transition: background-color 0.2s ease;
        }
        .clear-history-btn:hover {
            background-color: #dc2626;
        }

        /* Bot Test Modal Styles */
        #botTestModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            text-align: center;
            flex-direction: column;
            gap: 20px;
        }
        #botTestModal.hidden {
            display: none;
        }
        #botTestClickArea {
            background-color: #667eea;
            color: white;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            user-select: none;
        }
        #botTestClickArea:hover {
            background-color: #764ba2;
            transform: scale(1.02);
        }
        #botTestClickArea:active {
            transform: scale(0.98);
        }
        #botTestInput {
            background-color: #333;
            color: white;
            border: 2px solid #555;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1.2rem;
            text-align: center;
            width: 80%;
            max-width: 300px;
        }
        #botTestContinueBtn {
            background: linear-gradient(45deg, #28a745, #218838);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #botTestContinueBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        #botTestContinueBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #6c757d;
        }

        /* Login Modal Styles */
        #loginModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            color: white;
            text-align: center;
            flex-direction: column;
            gap: 20px;
        }
        #loginModal.hidden {
            display: none;
        }
        #loginForm {
            background: #2d3748;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            max-width: 400px;
            width: 90%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        #loginForm input {
            background-color: #4a5568;
            color: white;
            border: 1px solid #6a7a8d;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1rem;
        }
        #loginForm input::placeholder {
            color: #cbd5e0;
        }
        #loginForm button {
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }
        #loginForm .login-btn {
            background-color: #667eea;
            color: white;
        }
        #loginForm .login-btn:hover {
            background-color: #764ba2;
        }
        #loginForm .register-btn {
            background-color: #28a745;
            color: white;
        }
        #loginForm .register-btn:hover {
            background-color: #218838;
        }
        #loginMessage {
            color: #ef4444;
            font-size: 0.9rem;
            margin-top: -10px;
        }
        #logoutButton {
            background-color: #ef4444;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #logoutButton:hover {
            background-color: #dc2626;
        }

        /* Particle container */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }

        /* Individual particle styling and animation */
        .particle {
            position: absolute;
            font-size: 24px;
            opacity: 1;
            transform: translate(-50%, -50%);
            animation: particle-fade-move 1.5s forwards;
            white-space: nowrap;
        }

        @keyframes particle-fade-move {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translate(-50%, -150%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -250%) scale(0.8);
            }
        }

        /* Particle Picker Modal Styles */
        .particle-picker-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1003;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .particle-picker-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .particle-picker-content {
            background: #2d3748;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            color: #e2e8f0;
            position: relative;
        }
        .particle-picker-close-btn {
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 2rem;
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
        .particle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 20px;
            justify-items: center;
        }
        .particle-item {
            font-size: 36px;
            cursor: pointer;
            padding: 8px;
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .particle-item.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5);
            background-color: rgba(102, 126, 234, 0.3);
        }
        .particle-item:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Calculator styles */
        .calculator {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 320px;
            border: 1px solid #e0e0e0;
        }
        .display {
            background-color: #e9ecef;
            color: #343a40;
            padding: 15px;
            border-radius: 10px;
            text-align: right;
            margin-bottom: 20px;
            font-size: 2.5em;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            font-weight: 500;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        .button {
            background-color: #e2e8f0;
            color: #4a5568;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.5em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            user-select: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button:hover {
            background-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .button.operator {
            background-color: #a7d9f6;
            color: #2a6592;
            font-weight: bold;
        }
        .button.operator:hover {
            background-color: #8acbe9;
        }
        .button.equals {
            background-color: #48bb78;
            color: white;
            grid-column: span 2;
            font-weight: bold;
        }
        .button.equals:hover {
            background-color: #38a169;
        }
        .button.clear {
            background-color: #ef4444;
            color: white;
            font-weight: bold;
        }
        .button.clear:hover {
            background-color: #dc2626;
        }
        .button.zero {
            grid-column: span 2;
        }

        /* Dark mode calculator styles */
        body.dark-mode .calculator {
            background-color: #2d3748;
            border-color: #4a5568;
        }
        body.dark-mode .display {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark-mode .button {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark-mode .button:hover {
            background-color: #2d3748;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .drawing-container {
                margin: 10px;
            }
            .drawing-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            .tool-button, .action-button {
                width: 100%;
            }
            input[type="range"] {
                width: 100%;
            }
        }
    
/* === TRANSISI ANIMASI === */
.fade-in { animation: fadeIn 1s ease-in-out both; }
@keyframes fadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}
.slide-up { animation: slideUp 0.8s ease-in-out both; }
@keyframes slideUp {
  0% { transform: translateY(30px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}
.zoom-in { animation: zoomIn 0.8s ease-out both; }
@keyframes zoomIn {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
.bounce-in { animation: bounceIn 1s ease both; }
@keyframes bounceIn {
  0% { transform: scale(0.8); opacity: 0; }
  60% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); }
}
.flip-in { animation: flipIn 1s ease-out both; }
@keyframes flipIn {
  0% { transform: rotateX(-90deg); opacity: 0; }
  100% { transform: rotateX(0); opacity: 1; }
}
.rotate-in { animation: rotateIn 1s ease both; }
@keyframes rotateIn {
  0% { transform: rotate(-200deg); opacity: 0; }
  100% { transform: rotate(0); opacity: 1; }
}
</style>
</head>
<body class="min-h-screen flex flex-col"><script crossorigin="" src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script><script crossorigin="" src="https://unpkg.com/react@18/umd/react.development.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;family=Amiri:wght@400;700&amp;display=swap" rel="stylesheet"/>
<!-- Particle Container -->
<div id="particle-container"></div>
<!-- Zen Mode Exit Button -->
<button class="zen-exit-button" id="zenExitButton" onclick="exitZenMode()">
        ðŸ§˜ Keluar Zen Mode
    </button>
<!-- Login Modal -->
<div class="hidden" id="loginModal">
<div id="loginForm">
<h2 class="text-3xl font-bold mb-4">Login / Register</h2>
<input id="loginAccount" placeholder="Akun (username/email)" type="text"/>
<input id="loginAge" max="120" min="1" placeholder="Umur (tahun)" type="number"/>
<p class="hidden text-red-500" id="loginMessage"></p>
<button class="register-btn" id="registerBtn">Daftar</button>
<button class="login-btn" id="loginBtn">Login</button>
</div>
</div>
<!-- Bot Test Modal -->
<div class="flex flex-col items-center justify-center hidden" id="botTestModal">
<h2 class="text-4xl font-bold mb-6" id="botTestInstruction">Verifikasi Keamanan</h2>
<p class="text-xl mb-8" id="botTestMessage">Klik area ini 4 kali.</p>
<div class="px-8 py-4 rounded-xl shadow-lg" id="botTestClickArea">
            Klik Saya! <span id="clickCountDisplay">(0/4)</span>
</div>
<input class="mt-8 hidden" disabled="" id="botTestInput" placeholder="Ketik kata di sini..." type="text"/>
<button class="mt-8 hidden" disabled="" id="botTestContinueBtn">Lanjutkan</button>
</div>
<!-- Main Content Wrapper -->
<div class="flex-grow hidden" id="mainContentWrapper">
<!-- Header Section -->
<header class="search-gradient text-white py-12 shadow-lg relative">
<div class="container mx-auto px-4 text-center">
<h1 class="text-5xl font-bold mb-4">EasySearch</h1>
<p class="text-xl opacity-90">Mesin Pencari gampang cepat dan mudah dengan fitur menggambar</p>
</div>
<!-- Hamburger Menu Icon -->
<button class="absolute top-4 right-4 p-2 rounded-full bg-white bg-opacity-20 hover:bg-opacity-30 transition-all focus:outline-none" id="menuToggle">
<svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
</header>
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
<button class="sidebar-close-btn" id="sidebarCloseBtn">Ã—</button>
<h2 class="text-3xl font-bold mb-6 mt-10">Pengaturan Aplikasi</h2>
<div class="sidebar-setting">
<span>Mode Gelap:</span>
<label class="toggle-switch">
<input id="sidebarThemeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarThemeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Mode Kontras Tinggi:</span>
<label class="toggle-switch">
<input id="sidebarHighContrastToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarHighContrastStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Ukuran Font:</span>
<div class="flex items-center space-x-2">
<button class="px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded-md font-bold text-lg" id="decreaseFontSizeBtn">A-</button>
<span class="font-semibold" id="currentFontSize">Normal</span>
<button class="px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded-md font-bold text-lg" id="increaseFontSizeBtn">A+</button>
</div>
</div>
<div class="sidebar-setting">
<span>Mode Fokus:</span>
<label class="toggle-switch">
<input id="sidebarFocusModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarFocusModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Sensor Pencarian:</span>
<label class="toggle-switch">
<input id="sidebarSearchSensorToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-green-600 dark:text-green-400" id="sidebarSensorStatus">Aktif</span>
</div>
<div class="sidebar-setting">
<span>Mode Anak-anak:</span>
<label class="toggle-switch">
<input id="sidebarKidsModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarKidsModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Mode Belajar:</span>
<label class="toggle-switch">
<input id="sidebarLearningModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarLearningModeStatus">Nonaktif</span>
</div>
<!-- New Drawing Mode Toggle -->
<div class="sidebar-setting">
<span>Mode Menggambar:</span>
<label class="toggle-switch">
<input id="sidebarDrawingModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarDrawingModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Pilih Background:</span>
<label class="toggle-switch">
<input id="sidebarBackgroundToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarBackgroundStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Efek Partikel:</span>
<label class="toggle-switch">
<input id="sidebarParticleEffectToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarParticleEffectStatus">Nonaktif</span>
</div>
<button class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-md transition-colors w-full mt-2" disabled="" id="openParticlePickerBtn">
                Pilih Partikel
            </button>
<div class="sidebar-setting">
<span>Pencarian Gemini:</span>
<label class="toggle-switch">
<input id="sidebarGeminiSearchToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarGeminiSearchStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Mode Samaran:</span>
<label class="toggle-switch">
<input id="sidebarIncognitoModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarIncognitoModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Penghemat Pencarian:</span>
<label class="toggle-switch">
<input id="sidebarSearchSaverToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarSearchSaverStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Mode Catatan:</span>
<label class="toggle-switch">
<input id="sidebarNoteModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarNoteModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan Cuaca:</span>
<label class="toggle-switch">
<input id="sidebarWeatherToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarWeatherStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan Jadwal Sholat:</span>
<label class="toggle-switch">
<input id="sidebarPrayerTimeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarPrayerTimeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan Kalender Hijriah:</span>
<label class="toggle-switch">
<input id="sidebarHijriToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarHijriStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan Kalkulator:</span>
<label class="toggle-switch">
<input id="sidebarCalculatorToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarCalculatorStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Jam Dunia:</span>
<label class="toggle-switch">
<input id="sidebarWorldClockToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarWorldClockStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan Al-Qurâ€™an:</span>
<label class="toggle-switch">
<input id="sidebarQuranToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarQuranStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan Musik:</span>
<label class="toggle-switch">
<input id="sidebarMusicToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarMusicStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Tampilkan To-Do:</span>
<label class="toggle-switch">
<input id="sidebarTodoToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarTodoStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Animasi Transisi:</span>
<label class="toggle-switch">
<input id="sidebarTransitionToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarTransitionStatus">Nonaktif</span><select class="mt-2 w-full bg-gray-700 text-white p-2 rounded-md hidden" id="transitionTypeSelector">
<option value="fade-in">Fade In</option>
<option value="slide-up">Slide Up</option>
<option value="zoom-in">Zoom In</option>
<option value="bounce-in">Bounce In</option>
<option value="flip-in">Flip In</option>
<option value="rotate-in">Rotate In</option>
</select>
</div>
<!-- Premium Features Section -->
<div class="mt-8 pt-4 border-t border-gray-600">
<h3 class="text-2xl font-bold mb-4">ðŸŒŸ Fitur Premium</h3>
<div class="sidebar-setting">
<span>Mode Malam Otomatis:</span>
<label class="toggle-switch">
<input id="sidebarAutoNightModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarAutoNightModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Pengingat Berkala:</span>
<label class="toggle-switch">
<input id="sidebarReminderToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarReminderStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Mode Zen:</span>
<label class="toggle-switch">
<input id="sidebarZenModeToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarZenModeStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Terjemahan Instan:</span>
<label class="toggle-switch">
<input id="sidebarInstantTranslateToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarInstantTranslateStatus">Nonaktif</span>
</div>
<div class="sidebar-setting">
<span>Font Picker:</span>
<label class="toggle-switch">
<input id="sidebarFontPickerToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarFontPickerStatus">Nonaktif</span>
</div>
<select class="w-full mt-2 bg-gray-700 text-white rounded-md p-2 hidden" id="fontSelector">
<option value="Inter">Inter</option>
<option value="Roboto">Roboto</option>
<option value="Open Sans">Open Sans</option>
<option value="Poppins">Poppins</option>
<option value="Montserrat">Montserrat</option>
<option value="Playfair Display">Playfair Display</option>
<option value="Dancing Script">Dancing Script</option>
<option value="Courier New">Courier New</option>
</select>
<div class="sidebar-setting">
<span>Efek Suara Interaktif:</span>
<label class="toggle-switch">
<input id="sidebarSoundEffectsToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarSoundEffectsStatus">Nonaktif</span>
</div>
</div>
<!-- Custom Search Engine Section -->
<div class="mt-8 pt-4 border-t border-gray-600">
<div class="sidebar-setting !py-0 !border-b-0">
<h3 class="text-2xl font-bold">Mesin Pencari Kustom</h3>
<label class="toggle-switch">
<input id="sidebarCustomSearchToggle" type="checkbox"/>
<span class="toggle-slider"></span>
</label>
<span class="status-text text-red-600 dark:text-red-400" id="sidebarCustomSearchStatus">Nonaktif</span>
</div>
<div class="flex flex-col gap-3 mt-4" id="customSearchControls">
<input class="w-full px-4 py-2 text-md border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500" id="customEngineName" placeholder="Nama Mesin (e.g., MySite)" type="text"/>
<input class="w-full px-4 py-2 text-md border border-gray-600 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:border-purple-500" id="customEngineUrl" placeholder="URL Mesin (e.g., https://mysite.com/search?q=)" type="text"/>
<button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition-colors" id="addCustomEngineBtn">
                        Tambah Mesin Kustom
                    </button>
<div class="mt-4 space-y-2" id="customEnginesList">
<p class="text-gray-400 text-sm">Belum ada mesin kustom.</p>
</div>
</div>
</div>
<!-- Search History Section -->
<div class="mt-8 pt-4 border-t border-gray-600">
<h3 class="text-2xl font-bold mb-4">Riwayat Pencarian</h3>
<ul class="search-history-list" id="searchHistoryList">
<li class="text-gray-400 text-sm">Belum ada riwayat pencarian.</li>
</ul>
<button class="clear-history-btn" id="clearHistoryBtn">Hapus Riwayat</button>
</div>
</div>
<!-- Main content area -->
<div class="flex-grow">
<!-- EasySearch Section -->
<div class="container mx-auto px-4 -mt-6" id="easySearchSection">
<div class="main-content-card rounded-2xl shadow-xl p-8 max-w-4xl mx-auto">
<div class="flex flex-col md:flex-row gap-4 items-center">
<div class="flex-1 flex items-center gap-2">
<input class="w-full px-6 py-4 text-lg border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors" id="mainSearchInput" onkeypress="handleMainKeyPress(event)" placeholder="Masukkan kata kunci pencarian..." type="text"/>
<button class="voice-search-button" id="voiceSearchBtn" title="Pencarian Suara">
<svg aria-hidden="true" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 18.75V21m-7.5-1.5h15M12 12.75a3 3 0 110-6 3 3 0 010 6zM12 18a6 6 0 006-6V6a6 6 0 00-6-6 6 6 0 00-6 6v6a6 6 0 006 6z" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
</button>
</div>
<button class="search-button text-white px-8 py-4 rounded-xl font-semibold text-lg flex items-center justify-center gap-2 min-w-[140px]" id="searchButton" onclick="handleMainButtonAction()">
<span id="buttonText">Cari</span>
<div class="loading-spinner hidden" id="loadingSpinner"></div>
</button>
</div>
<!-- Visual Search Input and Button -->
<div class="flex flex-col md:flex-row gap-4 items-center mt-4 hidden" id="geminiVisualSearchControls">
<input accept="image/*" class="w-full px-4 py-2 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors dark:bg-gray-700 dark:text-white dark:border-gray-600" id="imageUploadInput" type="file"/>
<button class="search-button text-white px-8 py-4 rounded-xl font-semibold text-lg flex items-center justify-center gap-2 min-w-[140px] opacity-50 cursor-not-allowed" disabled="" id="visualSearchBtn">
<span id="visualButtonText">Pencarian Visual</span>
<div class="loading-spinner hidden" id="visualLoadingSpinner"></div>
</button>
</div>
<div class="mt-4 hidden" id="uploadedImagePreviewContainer">
<p class="text-gray-700 dark:text-gray-300 mb-2 text-center">Gambar Terunggah:</p>
<img alt="Pratinjau Gambar" class="max-w-xs max-h-48 rounded-lg shadow-md mx-auto" id="uploadedImagePreview" src=""/>
<button class="mt-2 bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-1 rounded-md block mx-auto" id="clearImageBtn">Hapus Gambar</button>
</div>
<!-- Search Engine Options -->
<div class="mt-6 flex flex-wrap gap-3 justify-center" id="searchEngineOptions">
<!-- Search engine buttons will be dynamically populated here by JavaScript -->
</div>
</div>
</div>
<!-- Drawing Mode Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="drawingModeSection">
<div class="drawing-container mx-auto">
<div class="drawing-controls">
<div class="control-group">
<label class="text-gray-700 font-semibold" for="colorPicker">Warna:</label>
<input class="rounded-lg" id="colorPicker" type="color" value="#000000"/>
</div>
<div class="control-group">
<label class="text-gray-700 font-semibold" for="lineWidth">Ukuran:</label>
<input class="rounded-lg" id="lineWidth" max="50" min="1" type="range" value="5"/>
<span class="text-gray-700 font-semibold" id="lineWidthValue">5</span>
</div>
<div class="control-group">
<button class="tool-button active" id="pencilTool">Pensil</button>
<button class="tool-button" id="eraserTool">Penghapus</button>
<button class="tool-button" id="rectangleTool">Persegi</button>
<button class="tool-button" id="circleTool">Lingkaran</button>
<button class="tool-button" id="lineTool">Garis</button>
<button class="tool-button" id="textTool">Teks</button>
</div>
<button class="action-button bg-red-500 hover:bg-red-600" id="clearCanvas">Bersihkan</button>
</div>
<canvas class="drawing-canvas" id="drawingCanvas"></canvas>
</div>
</div>
<!-- Calculator Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="calculatorSection">
<div class="main-content-card rounded-2xl shadow-xl p-6 max-w-sm mx-auto">
<h2 class="text-2xl font-bold text-center mb-4">Kalkulator</h2>
<div class="calculator">
<div class="display" id="display">0</div>
<div class="buttons">
<div class="button clear" onclick="clearDisplay()">C</div>
<div class="button operator" onclick="appendCharacter('/')">/</div>
<div class="button operator" onclick="appendCharacter('*')">*</div>
<div class="button" onclick="appendCharacter('7')">7</div>
<div class="button" onclick="appendCharacter('8')">8</div>
<div class="button" onclick="appendCharacter('9')">9</div>
<div class="button operator" onclick="appendCharacter('-')">-</div>
<div class="button" onclick="appendCharacter('4')">4</div>
<div class="button" onclick="appendCharacter('5')">5</div>
<div class="button" onclick="appendCharacter('6')">6</div>
<div class="button operator" onclick="appendCharacter('+')">+</div>
<div class="button" onclick="appendCharacter('1')">1</div>
<div class="button" onclick="appendCharacter('2')">2</div>
<div class="button" onclick="appendCharacter('3')">3</div>
<div class="button equals" onclick="calculateResult()">=</div>
<div class="button zero" onclick="appendCharacter('0')">0</div>
<div class="button" onclick="appendCharacter('.')">.</div>
</div>
</div>
</div>
</div>
<!-- Search Intent Display -->
<div class="container mx-auto px-4 max-w-4xl mx-auto hidden" id="searchIntentDisplay">
<!-- Search intent will be displayed here -->
</div>
<!-- Quick Search Suggestions -->
<div class="container mx-auto px-4 mt-8" id="quickSearchSuggestions">
<div class="max-w-4xl mx-auto">
<div class="main-content-card rounded-2xl shadow-xl p-6">
<h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center" id="quickSearchTitle">Pencarian Populer</h2>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="quickSearchButtons">
<!-- Quick search buttons will be dynamically populated here by JavaScript -->
</div>
</div>
</div>
</div>
<!-- Search Results -->
<div class="container mx-auto px-4 mt-8 hidden" id="searchResults">
<div class="max-w-4xl mx-auto">
<div class="main-content-card rounded-2xl shadow-xl p-6">
<h3 class="text-xl font-semibold text-gray-800 mb-4">Hasil Pencarian</h3>
<div class="space-y-4" id="resultsContainer">
<!-- Results will be populated here -->
</div>
</div>
</div>
</div>
<!-- AI Image Generation Section -->
<div class="container mx-auto px-4 mt-8" id="imageGenerationSection">
<div class="main-content-card rounded-2xl shadow-xl p-6">
<h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Pembuatan Gambar AI</h2>
<div class="flex flex-col md:flex-row gap-4 items-center">
<input class="w-full px-6 py-4 text-lg border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition-colors dark:bg-gray-700 dark:text-white dark:border-gray-600" id="imagePromptInput" placeholder="Deskripsikan gambar yang ingin Anda buat..." type="text"/>
<button class="search-button text-white px-8 py-4 rounded-xl font-semibold text-lg flex items-center justify-center gap-2 min-w-[180px]" id="generateImageBtn">
<span id="generateImageBtnText">Hasilkan Gambar</span>
<div class="loading-spinner hidden" id="imageGenerationSpinner"></div>
</button>
</div>
<div class="mt-6 text-center">
<img alt="Gambar yang Dihasilkan AI" class="max-w-full h-auto rounded-lg shadow-md mx-auto border border-gray-300 dark:border-gray-600" id="generatedImageDisplay" src="https://placehold.co/400x300/e0e0e0/000000?text=Gambar+AI+Akan+Muncul+Di+Sini"/>
</div>
</div>
</div>
<!-- Learning Mode Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="learningModeSection">
<div class="learning-mode-card rounded-2xl shadow-xl p-8 max-w-4xl mx-auto text-white">
<h2 class="text-3xl font-bold mb-6 text-center">Mode Belajar</h2>
<!-- History Selector -->
<div class="mb-8 p-6 rounded-lg bg-white bg-opacity-10 shadow-inner">
<h3 class="text-2xl font-semibold mb-4">Pilih Topik Sejarah</h3>
<select class="w-full sm:w-1/2 px-4 py-3 text-lg border-2 border-purple-300 rounded-xl bg-gray-700 text-white placeholder-gray-400 focus:outline-none" id="historyTopicSelect">
<option value="indonesia">Sejarah Indonesia</option>
<option value="universe">Sejarah Alam Semesta</option>
<option value="internet">Sejarah Internet</option>
</select>
<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition-colors" id="loadSelectedHistoryBtn">
                            Tampilkan Sejarah
                        </button>
</div>
<!-- History Section -->
<div class="mb-8 p-6 rounded-lg bg-white bg-opacity-10 shadow-inner" id="historySection">
<h3 class="text-2xl font-semibold mb-4">Sejarah Indonesia</h3>
<div class="text-lg leading-relaxed text-gray-100 mb-4" id="historyContent">
<!-- History content will be loaded here -->
</div>
<button class="mt-4 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-md transition-colors" id="nextHistoryBtn">
                            Baca Sejarah Selanjutnya
                        </button>
</div>
<!-- Math Section -->
<div class="mb-8 p-6 rounded-lg bg-white bg-opacity-10 shadow-inner" id="mathSection">
<h3 class="text-2xl font-semibold mb-4">Matematika Dasar</h3>
<div class="flex items-center justify-center gap-4 mb-4 text-2xl font-bold">
<span id="mathProblem"></span>
</div>
<div class="flex flex-col sm:flex-row gap-4 justify-center">
<input class="w-full sm:w-1/2 px-4 py-3 text-lg border-2 border-purple-300 rounded-xl focus:border-purple-500 focus:outline-none transition-colors bg-gray-700 text-white placeholder-gray-400" id="mathAnswerInput" placeholder="Jawaban Anda" type="number"/>
<button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors" id="checkMathAnswerBtn">
                                Periksa Jawaban
                            </button>
</div>
<p class="mt-4 text-center text-lg font-semibold" id="mathResult"></p>
<button class="mt-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md transition-colors w-full sm:w-auto mx-auto block" id="newMathProblemBtn">
                            Soal Baru
                        </button>
</div>
<!-- Indonesia History Questions Section -->
<div class="p-6 rounded-lg bg-white bg-opacity-10 shadow-inner" id="historyQuizSection">
<h3 class="text-2xl font-semibold mb-4">Kuis Sejarah Indonesia</h3>
<div class="text-lg leading-relaxed text-gray-100 mb-4" id="historyQuestionContent">
<!-- History quiz question will be loaded here -->
</div>
<div class="flex flex-col sm:flex-row gap-4 justify-center">
<input class="w-full sm:w-1/2 px-4 py-3 text-lg border-2 border-purple-300 rounded-xl focus:border-purple-500 focus:outline-none transition-colors bg-gray-700 text-white placeholder-gray-400" id="historyAnswerInput" placeholder="Jawaban Anda" type="text"/>
<button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors" id="checkHistoryQuizAnswerBtn">
                                Periksa Jawaban
                            </button>
</div>
<p class="mt-4 text-center text-lg font-semibold" id="historyQuizResult"></p>
<button class="mt-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md transition-colors w-full sm:w-auto mx-auto block" id="newHistoryQuizProblemBtn">
                            Soal Sejarah Baru
                        </button>
</div>
</div>
</div>
<!-- Note Mode Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="noteModeSection">
<div class="main-content-card rounded-2xl shadow-xl p-8 max-w-4xl mx-auto">
<h2 class="text-3xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200">Mode Catatan</h2>
<div class="bg-yellow-50 dark:bg-yellow-900 p-6 rounded-xl">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-semibold text-gray-800 dark:text-gray-200">Notepad (Maksimal 649 kata)</h3>
<span class="text-gray-600 dark:text-gray-400" id="wordCount">0/649 kata</span>
</div>
<textarea class="w-full h-96 p-4 border-2 border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:border-blue-500 focus:outline-none bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200" id="noteTextarea" placeholder="Tulis catatan Anda di sini..."></textarea>
<div class="flex gap-4 mt-4">
<button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors" id="saveNoteBtn">
                                Simpan Catatan
                            </button>
<button class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors" id="clearNoteBtn">
                                Hapus Semua
                            </button>
</div>
</div>
</div>
</div>
<!-- World Clock Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="worldClockSection">
<div class="main-content-card rounded-2xl shadow-xl p-8 max-w-4xl mx-auto">
<h2 class="text-3xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200">Jam Dunia</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<div class="bg-blue-100 dark:bg-blue-900 p-6 rounded-xl text-center">
<h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">ðŸ‡®ðŸ‡© Jakarta, Indonesia</h3>
<div class="text-2xl font-bold text-blue-600 dark:text-blue-300" id="jakartaTime"></div>
<div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="jakartaDate"></div>
</div>
<div class="bg-green-100 dark:bg-green-900 p-6 rounded-xl text-center">
<h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">ðŸ‡¬ðŸ‡§ London, UK</h3>
<div class="text-2xl font-bold text-green-600 dark:text-green-300" id="londonTime"></div>
<div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="londonDate"></div>
</div>
<div class="bg-purple-100 dark:bg-purple-900 p-6 rounded-xl text-center">
<h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">ðŸ‡ºðŸ‡¸ New York, USA</h3>
<div class="text-2xl font-bold text-purple-600 dark:text-purple-300" id="newYorkTime"></div>
<div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="newYorkDate"></div>
</div>
<div class="bg-red-100 dark:bg-red-900 p-6 rounded-xl text-center">
<h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">ðŸ‡¯ðŸ‡µ Tokyo, Japan</h3>
<div class="text-2xl font-bold text-red-600 dark:text-red-300" id="tokyoTime"></div>
<div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="tokyoDate"></div>
</div>
<div class="bg-orange-100 dark:bg-orange-900 p-6 rounded-xl text-center">
<h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">ðŸ‡¦ðŸ‡ª Dubai, UAE</h3>
<div class="text-2xl font-bold text-orange-600 dark:text-orange-300" id="dubaiTime"></div>
<div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="dubaiDate"></div>
</div>
<div class="bg-teal-100 dark:bg-teal-900 p-6 rounded-xl text-center">
<h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">ðŸ‡¦ðŸ‡º Sydney, Australia</h3>
<div class="text-2xl font-bold text-teal-600 dark:text-teal-300" id="sydneyTime"></div>
<div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="sydneyDate"></div>
</div>
</div>
</div>
</div>
<!-- Weather Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="weatherSection">
<div class="main-content-card rounded-2xl shadow-xl p-6 max-w-2xl mx-auto text-center">
<h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Prakiraan Cuaca 7 Hari</h2>
<input class="px-4 py-2 border rounded-lg w-full max-w-md mx-auto dark:bg-gray-700 dark:text-white" id="weatherCity" placeholder="Masukkan nama kota" type="text"/>
<button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg" onclick="getWeather()">
                        Tampilkan Cuaca
                    </button>
<div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-left" id="weatherResult"></div>
</div>
</div>
<!-- Prayer Time Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="prayerTimeSection">
<div class="main-content-card rounded-2xl shadow-xl p-6 max-w-2xl mx-auto text-center">
<h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Jadwal Sholat Hari Ini</h2>
<input class="px-4 py-2 border rounded-lg w-full max-w-md mx-auto dark:bg-gray-700 dark:text-white" id="prayerCity" placeholder="Masukkan nama kota" type="text"/>
<button class="mt-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg" onclick="getPrayerTimes()">
                        Tampilkan Jadwal
                    </button>
<div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-left text-gray-800 dark:text-gray-200" id="prayerTimeResult">
<!-- Jadwal akan muncul di sini -->
</div>
</div>
</div>
<!-- Hijri Calendar Section -->
<div class="container mx-auto px-4 mt-8 hidden" id="hijriSection">
<div class="main-content-card rounded-2xl shadow-xl p-6 max-w-2xl mx-auto text-center">
<h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Kalender Hari Ini</h2>
<p class="text-lg text-gray-700 dark:text-gray-300 mb-2" id="todayGregorian">Tanggal Masehi: -</p>
<p class="text-lg text-purple-600 dark:text-purple-300 font-bold" id="todayHijri">Tanggal Hijriyah: -</p>
</div>
</div>
</div>
<!-- Footer -->
<footer class="mt-16 bg-gray-800 text-white py-8">
<div class="container mx-auto px-4 text-center flex flex-col sm:flex-row justify-center items-center gap-4">
<p class="text-gray-300">Â© 2024 EasySearch</p>
<p class="text-sm text-gray-400 mt-2 sm:mt-0">Mencari informasi dengan mudah dan cepat</p>
<div class="flex items-center mt-2 sm:mt-0">
<span class="text-white font-semibold" id="loggedInUserDisplay"></span>
<button class="hidden bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold ml-4" id="logoutButton">Logout</button>
</div>
</div>
</footer>
</div>
<!-- Background Picker Modal -->
<div class="background-picker-modal" id="backgroundPickerModal">
<div class="background-picker-content">
<button class="background-picker-close-btn" id="backgroundPickerCloseBtn">Ã—</button>
<h2 class="text-2xl font-bold mb-4 text-center">Pilih Background</h2>
<div class="background-grid" id="backgroundGrid">
<!-- Background items will be populated here -->
</div>
<div class="text-center mt-6">
<button class="search-button text-white px-8 py-3 rounded-xl font-semibold text-lg" onclick="applySelectedBackground()">
                    Terapkan Background
                </button>
</div>
</div>
</div>
<!-- Particle Picker Modal -->
<div class="particle-picker-modal" id="particlePickerModal">
<div class="particle-picker-content">
<button class="particle-picker-close-btn" id="particlePickerCloseBtn">Ã—</button>
<h2 class="text-2xl font-bold mb-4 text-center">Pilih Partikel</h2>
<div class="particle-grid" id="particleGrid">
<!-- Particle items will be populated here -->
</div>
<div class="text-center mt-6">
<button class="search-button text-white px-8 py-3 rounded-xl font-semibold text-lg" id="applySelectedParticlesBtn">
                    Terapkan Partikel
                </button>
</div>
</div>
</div>
<script>
        // --- Global Variables ---
        let currentSearchEngine = 'google';
        let isSearchSensorEnabled = true;
        let isKidsModeEnabled = false;
        let lastSearchSensorState = true;
        let lastSearchSensorStateBeforeIncognito = true;
        let lastKidsModeStateBeforeIncognito = false;
        let isBackgroundSelectionMode = false;
        let selectedBackground = '';
        let recognition;
        let isGeminiSearchEnabled = false;
        let isIncognitoModeEnabled = false;
        let isCustomSearchEnabled = false;
        let isSearchSaverEnabled = false;
        let searchHistory = [];
        let isHighContrastModeEnabled = false;
        const fontSizes = ['0.9rem', '1rem', '1.1rem', '1.2rem', '1.3rem'];
        let currentFontSizeIndex = 1;
        let isFocusModeEnabled = false;
        let uploadedImageBase64 = null;
        let isLearningModeEnabled = false;
        let isParticleEffectEnabled = false;
        let selectedParticles = ['âœ¨'];
        let isNoteModeEnabled = false;
        let isWorldClockEnabled = false;
        let worldClockInterval = null;
        let isDrawingModeEnabled = false; // New: Drawing Mode state

        // Premium Features
        let isAutoNightModeEnabled = false;
        let isReminderEnabled = false;
        let isZenModeEnabled = false;
        let isInstantTranslateEnabled = false;
        let isFontPickerEnabled = false;
        let isSoundEffectsEnabled = false;
        let currentFont = 'Inter';
        let reminderInterval = null;
        let nightModeCheckInterval = null;

        // Drawing App Variables
        let drawingCanvas = null;
        let drawingCtx = null;
        let isDrawing = false;
        let currentTool = 'pencil';
        let currentColor = '#000000';
        let currentLineWidth = 5;
        let startX, startY;
        let drawingSnapshot;

        // Bot Test Variables
        let botTestClickCount = 0;
        const botTestRequiredClicks = 4;
        let botTestTypingStartTime = 0;
        const botTestRequiredWords = ["easy", "search"];
        const botTestMinTypingTime = 2000;
        const botTestMaxTypingTime = 10000;

        // Login Variables
        let isLoggedIn = false;
        let loggedInUser = null;
        let isKidsModeForcedByAge = false;

        // Inisialisasi Gemini API
        const API_KEY = "AIzaSyD_IrDX48wddrp25b9E2inNzEZpLFw95sY";
        let geminiModel;

        document.addEventListener('DOMContentLoaded', () => {
            if (window.GoogleGenerativeAI) {
                const genAI = new window.GoogleGenerativeAI(API_KEY);
                geminiModel = genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
            } else {
                console.error("GoogleGenerativeAI SDK tidak dimuat. Pastikan koneksi internet Anda stabil.");
            }
        });

        // Default search engines
        const defaultSearchEngines = {
            google: { name: 'Google', url: 'https://www.google.com/search?q=', icon: 'ðŸŒ' },
            bing: { name: 'Bing', url: 'https://www.bing.com/search?q=', icon: 'ðŸ”' },
            duckduckgo: { name: 'DuckDuckGo', url: 'https://duckduckgo.com/?q=', icon: 'ðŸ¦†' },
            yahoo: { name: 'Yahoo', url: 'https://search.yahoo.com/search?p=', icon: 'ðŸ’œ' },
            ecosia: { name: 'Ecosia', url: 'https://www.ecosia.org/search?q=', icon: 'ðŸŒ³' },
            yandex: { name: 'Yandex', url: 'https://yandex.com/search/?text=', icon: 'ðŸ‡·ðŸ‡º' },
            startpage: { name: 'Startpage', url: 'https://www.startpage.com/do/dsearch?query=', icon: 'âœ¨' },
            youcom: { name: 'You.com', url: 'https://you.com/search?q=', icon: 'ðŸ‘¤' },
            baidu: { name: 'Baidu', url: 'https://www.baidu.com/s?wd=', icon: 'ðŸ‡¨ðŸ‡³' },
            naver: { name: 'Naver', url: 'https://search.naver.com/search.naver?query=', icon: 'ðŸ‡°ðŸ‡·' }
        };

        let allSearchEngines = { ...defaultSearchEngines };

        const searchSaverEngines = {
            google: { name: 'Google', url: 'https://www.google.com/search?q=', icon: 'ðŸŒ' },
            yahoo: { name: 'Yahoo', url: 'https://search.yahoo.com/search?p=', icon: 'ðŸ’œ' },
            bing: { name: 'Bing', url: 'https://www.bing.com/search?q=', icon: 'ðŸ”' }
        };

        const forbiddenKeywords = [
            'porn', 'sex', 'hentai', 'xxx', 'bokep', 'mesum', 'nude', 'bugil', 'telanjang',
            'judi', 'gambling', 'casino', 'togel', 'slot online', 'poker online',
            'narkoba', 'drugs', 'kokain', 'ganja', 'heroin', 'sabu',
            'kekerasan', 'gore', 'sadis', 'mutilasi', 'pembunuhan',
            'terorisme', 'bom', 'radikal', 'ekstremis',
            'penipuan', 'scam', 'phishing', 'hack', 'crack', 'bajakan', 'warez',
            'child abuse', 'pedofilia', 'anak di bawah umur',
            'bunuh diri', 'suicide', 'self harm'
        ];

        const normalQuickSearches = [
            { icon: 'ðŸ“°', text: 'Berita Terkini', query: 'berita terkini' },
            { icon: 'ðŸŒ¤ï¸', text: 'Cuaca Hari Ini', query: 'cuaca hari ini' },
            { icon: 'ðŸ³', text: 'Resep Masakan', query: 'resep masakan' },
            { icon: 'ðŸ’»', text: 'Tutorial Programming', query: 'tutorial programming' },
            { icon: 'ðŸ“º', text: 'Anime Terbaru', query: 'anime terbaru' }
        ];

        const kidsQuickSearches = [
            { icon: 'ðŸ“š', text: 'Cerita Anak', query: 'cerita anak edukasi' },
            { icon: 'ðŸŽ¨', text: 'Belajar Menggambar', query: 'tutorial menggambar anak' },
            { icon: 'ðŸ”¢', text: 'Permainan Angka', query: 'permainan edukasi angka' },
            { icon: 'ðŸ§ª', text: 'Eksperimen Sains', query: 'eksperimen sains sederhana anak' },
            { icon: 'ðŸŽµ', text: 'Lagu Anak-anak', query: 'lagu anak-anak edukasi' }
        ];

        const backgrounds = [
            { id: 'bg1', name: 'Langit Biru', value: '#87CEEB' },
            { id: 'bg2', name: 'Hutan Hijau', value: '#228B22' },
            { id: 'bg3', name: 'Pegunungan Salju', value: 'linear-gradient(135deg, #B0E0E6 0%, #778899 100%)' },
            { id: 'bg4', name: 'Pantai Tropis', value: 'linear-gradient(135deg, #00CED1 0%, #4682B4 100%)' },
            { id: 'bg5', name: 'Kota Malam', value: '#2F4F4F' },
            { id: 'bg6', name: 'Ruang Angkasa', value: 'linear-gradient(135deg, #191970 0%, #483D8B 100%)' },
            { id: 'bg7', name: 'Padang Bunga', value: '#FFD700' },
            { id: 'bg8', name: 'Abstrak Geometris', value: 'linear-gradient(135deg, #8A2BE2 0%, #4B0082 100%)' },
            { id: 'bg9', name: 'Tekstur Kayu', value: '#A0522D' },
            { id: 'bg10', name: 'Awan Cerah', value: 'linear-gradient(135deg, #ADD8E6 0%, #87CEEB 100%)' },
            { id: 'bg11', name: 'Gurun Pasir', value: '#F4A460' },
            // 8 Background Premium
            { id: 'premium1', name: 'ðŸ’Ž Aurora Borealis', value: 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)', premium: true },
            { id: 'premium2', name: 'ðŸ’Ž Neon Cyberpunk', value: 'linear-gradient(135deg, #ff006e 0%, #8338ec 25%, #3a86ff 75%, #06ffa5 100%)', premium: true },
            { id: 'premium3', name: 'ðŸ’Ž Sunset Gradient', value: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 25%, #fecfef 75%, #ffecd2 100%)', premium: true },
            { id: 'premium4', name: 'ðŸ’Ž Deep Ocean', value: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #74b9ff 75%, #0984e3 100%)', premium: true },
            { id: 'premium5', name: 'ðŸ’Ž Forest Mystique', value: 'linear-gradient(135deg, #134e5e 0%, #71b280 50%, #a8e6cf 100%)', premium: true },
            { id: 'premium6', name: 'ðŸ’Ž Galaxy Dreams', value: 'linear-gradient(135deg, #2c3e50 0%, #4a69bd 25%, #8c7ae6 50%, #e056fd 75%, #f8b500 100%)', premium: true },
            { id: 'premium7', name: 'ðŸ’Ž Fire & Ice', value: 'linear-gradient(135deg, #ff4757 0%, #ff6b81 25%, #74b9ff 50%, #0984e3 75%, #00b894 100%)', premium: true },
            { id: 'premium8', name: 'ðŸ’Ž Royal Purple', value: 'linear-gradient(135deg, #2d1b69 0%, #8c7ae6 25%, #fd79a8 50%, #fdcb6e 75%, #6c5ce7 100%)', premium: true },
            { id: 'none', name: 'Tidak Ada Background', value: '' }
        ];

        // History content for learning mode
        const indonesiaHistory = [
            {
                title: "Masa Prasejarah di Indonesia",
                content: `Masa prasejarah di Indonesia dimulai sejak munculnya manusia purba hingga ditemukannya tulisan. Bukti-bukti kehidupan manusia purba ditemukan di berbagai tempat, seperti Sangiran (Jawa Tengah) dengan fosil Pithecanthropus Erectus. Mereka hidup dengan berburu dan meramu, serta mengenal alat-alat batu sederhana. Kebudayaan Megalitikum juga berkembang, ditandai dengan bangunan-bangunan batu besar seperti menhir, dolmen, dan sarkofagus.`
            },
            {
                title: "Kerajaan Hindu-Buddha",
                content: `Pengaruh Hindu-Buddha masuk ke Indonesia sekitar abad ke-4 Masehi, membawa sistem pemerintahan kerajaan, agama, dan aksara. Kerajaan Kutai di Kalimantan Timur adalah kerajaan Hindu tertua, dibuktikan dengan Yupa. Kemudian muncul kerajaan besar seperti Tarumanegara, Sriwijaya (pusat perdagangan dan agama Buddha di Sumatera), dan Mataram Kuno (pembangun Candi Borobudur dan Prambanan). Puncak kejayaan Hindu-Buddha di Nusantara adalah Majapahit, yang mempersatukan sebagian besar wilayah Indonesia di bawah Gajah Mada.`
            },
            {
                title: "Masuknya Islam dan Kerajaan Islam",
                content: `Islam masuk ke Indonesia melalui jalur perdagangan, dakwah, dan perkawinan sekitar abad ke-7 hingga ke-13 Masehi. Kerajaan Islam pertama adalah Samudera Pasai di Aceh. Kemudian muncul kerajaan-kerajaan Islam lainnya seperti Demak, Malaka, Ternate, dan Tidore. Penyebaran Islam berlangsung damai dan cepat, didukung oleh peran para ulama dan pedagang.`
            },
            {
                title: "Masa Kolonialisme dan Penjajahan",
                content: `Bangsa Eropa mulai datang ke Indonesia pada abad ke-16 dengan tujuan mencari rempah-rempah. Portugis menjadi bangsa Eropa pertama yang tiba, diikuti oleh Spanyol, Belanda, dan Inggris. Belanda melalui VOC (Vereenigde Oostindische Compagnie) berhasil mendominasi perdagangan dan kemudian menguasai wilayah Indonesia selama kurang lebih 350 tahun. Masa penjajahan ditandai dengan penderitaan rakyat akibat kebijakan tanam paksa dan kerja rodi.`
            },
            {
                title: "Pergerakan Nasional dan Kemerdekaan",
                content: `Perlawanan terhadap penjajah muncul di berbagai daerah, namun masih bersifat kedaerahan. Pada awal abad ke-20, muncul organisasi-organisasi pergerakan nasional yang bersifat modern, seperti Budi Utomo, Sarekat Islam, dan Indische Partij. Puncak perjuangan adalah Proklamasi Kemerdekaan Indonesia pada 17 Agustus 1945 oleh Soekarno dan Mohammad Hatta, setelah kekalahan Jepang dalam Perang Dunia II. Setelah proklamasi, Indonesia masih harus berjuang mempertahankan kemerdekaan dari agresi Belanda.`
            }
        ];
        let currentHistoryIndex = 0;

        // History Quiz Questions
        const indonesiaHistoryQuestions = [
            {
                question: "Kerajaan Hindu tertua di Indonesia adalah Kerajaan...",
                answer: "Kutai"
            },
            {
                question: "Siapakah tokoh yang mempersatukan sebagian besar wilayah Indonesia di bawah Majapahit?",
                answer: "Gajah Mada"
            },
            {
                question: "Kerajaan Islam pertama di Indonesia adalah...",
                answer: "Samudera Pasai"
            },
            {
                question: "Organisasi pergerakan nasional modern pertama di Indonesia adalah...",
                answer: "Budi Utomo"
            },
            {
                question: "Tanggal berapa Proklamasi Kemerdekaan Indonesia dilaksanakan?",
                answer: "17 Agustus 1945"
            },
            {
                question: "Fosil manusia purba Pithecanthropus Erectus ditemukan di daerah...",
                answer: "Sangiran"
            },
            {
                question: "Bangsa Eropa pertama yang tiba di Indonesia adalah...",
                answer: "Portugis"
            },
            {
                question: "Perusahaan dagang Belanda yang mendominasi Indonesia selama penjajahan adalah...",
                answer: "VOC"
            }
        ];
        let currentHistoryQuestionIndex = 0;

        // Particle Emojis (dengan 6 partikel premium)
        const allAvailableParticles = [
            'âœ¨', 'ðŸŒŸ', 'ðŸ’–', 'ðŸš€', 'ðŸ’¡', 'ðŸŒˆ', 'ðŸŒº', 'ðŸ’§', 'ðŸŽ‰', 'ðŸ”¥', 'ðŸ’«', 'ðŸ’¯', 'âœ…', 'âŒ',
            'ðŸ’¡', 'ðŸ“š', 'ðŸ§ ', 'ðŸ’¡', 'âœï¸', 'ðŸ“', 'ðŸ§ª', 'ðŸŽµ', 'ðŸŽ¨', 'ðŸ§©', 'ðŸ†', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰',
            'ðŸŽ', 'ðŸŠ', 'ðŸ‹', 'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸ’', 'ðŸ‘', 'ðŸ', 'ðŸ¥­', 'ðŸ¥', 'ðŸ¥¥', 'ðŸ¥‘',
            'ðŸ¶', 'ðŸ±', 'ðŸ­', 'ðŸ¹', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¼', 'ðŸ¨', 'ðŸ¯', 'ðŸ¦', 'ðŸ®', 'ðŸ·',
            'ðŸŒž', 'â˜ï¸', 'âš¡ï¸', 'â˜”ï¸', 'â˜ƒï¸', 'ðŸŒˆ', 'ðŸŒŠ', 'ðŸŒ³', 'ðŸŒ¸', 'ðŸ‚', 'ðŸ', 'ðŸŒ', 'ðŸŒ•', 'â­ï¸'
        ];

        // 6 Partikel Premium dengan efek khusus
        const premiumParticles = [
            { emoji: 'ðŸ’Ž', name: 'Diamond Sparkle', effect: 'rainbow' },
            { emoji: 'ðŸ”®', name: 'Crystal Magic', effect: 'glow' },
            { emoji: 'ðŸ‘‘', name: 'Royal Crown', effect: 'golden' },
            { emoji: 'ðŸŒ ', name: 'Shooting Star', effect: 'streak' },
            { emoji: 'ðŸ¦„', name: 'Unicorn Magic', effect: 'rainbow-trail' },
            { emoji: 'âš¡ï¸', name: 'Lightning Bolt', effect: 'electric' }
        ];
        let tempSelectedParticles = [];

        /**
         * Loads custom search engines from localStorage and merges them with default engines.
         */
        function loadCustomSearchEngines() {
            const customEngines = JSON.parse(localStorage.getItem('customSearchEngines') || '{}');
            if (isCustomSearchEnabled) {
                allSearchEngines = { ...defaultSearchEngines, ...customEngines };
            } else {
                allSearchEngines = { ...defaultSearchEngines };
            }
            renderSearchEngineButtons();
        }

        /**
         * Renders the search engine buttons based on `allSearchEngines`.
         */
        function renderSearchEngineButtons() {
            const searchEngineOptions = document.getElementById('searchEngineOptions');
            searchEngineOptions.innerHTML = '';

            let enginesToRender = {};
            if (isSearchSaverEnabled) {
                enginesToRender = { ...searchSaverEngines };
            } else {
                enginesToRender = { ...allSearchEngines };
            }

            for (const key in enginesToRender) {
                const engine = enginesToRender[key];
                const button = document.createElement('button');
                button.setAttribute('onclick', `setSearchEngine('${key}')`);
                button.className = `search-engine-btn px-4 py-2 rounded-lg hover:bg-opacity-80 transition-colors`;
                button.dataset.engine = key;

                let bgColorClass = 'bg-gray-100';
                let textColorClass = 'text-gray-700';

                if (defaultSearchEngines.hasOwnProperty(key)) {
                    switch (key) {
                        case 'google': bgColorClass = 'bg-blue-100'; textColorClass = 'text-blue-700'; break;
                        case 'bing': bgColorClass = 'bg-green-100'; textColorClass = 'text-green-700'; break;
                        case 'duckduckgo': bgColorClass = 'bg-orange-100'; textColorClass = 'text-orange-700'; break;
                        case 'yahoo': bgColorClass = 'bg-purple-100'; textColorClass = 'text-purple-700'; break;
                        case 'ecosia': bgColorClass = 'bg-lime-100'; textColorClass = 'text-lime-700'; break;
                        case 'yandex': bgColorClass = 'bg-red-100'; textColorClass = 'text-red-700'; break;
                        case 'startpage': bgColorClass = 'bg-indigo-100'; textColorClass = 'text-indigo-700'; break;
                        case 'youcom': bgColorClass = 'bg-pink-100'; textColorClass = 'text-pink-700'; break;
                        case 'baidu': bgColorClass = 'bg-yellow-100'; textColorClass = 'text-yellow-700'; break;
                        case 'naver': bgColorClass = 'bg-gray-100'; textColorClass = 'text-gray-700'; break;
                    }
                } else {
                    bgColorClass = 'bg-gray-600';
                    textColorClass = 'text-white';
                }

                button.classList.add(bgColorClass, textColorClass);

                if (currentSearchEngine === key) {
                    button.classList.add('active');
                }

                button.innerHTML = `${engine.icon || 'âš™ï¸'} ${engine.name}`;
                searchEngineOptions.appendChild(button);
            }
            renderCustomEnginesList();
        }

        /**
         * Sets the active search engine for the main search functionality.
         */
        function setSearchEngine(engineKey) {
            let targetEngineExists = false;
            if (isSearchSaverEnabled) {
                targetEngineExists = searchSaverEngines.hasOwnProperty(engineKey);
            } else {
                targetEngineExists = allSearchEngines.hasOwnProperty(engineKey);
            }

            if (!targetEngineExists) {
                currentSearchEngine = 'google';
                showAlert('Mesin pencari yang dipilih tidak tersedia lagi. Beralih ke Google.', 'Peringatan');
            } else {
                currentSearchEngine = engineKey;
            }

            document.querySelectorAll('.search-engine-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.engine === currentSearchEngine) {
                    btn.classList.add('active');
                }
            });
            renderSearchEngineButtons();
        }

        /**
         * Handles Enter key press in the main search input.
         */
        function handleMainKeyPress(event) {
            if (event.key === 'Enter') {
                handleMainButtonAction();
            }
        }

        /**
         * Handles the action of the main button.
         */
        function handleMainButtonAction() {
            if (isBackgroundSelectionMode) {
                openBackgroundPicker();
            } else if (isLearningModeEnabled || isDrawingModeEnabled || isNoteModeEnabled || isWorldClockEnabled) {
                // Do nothing, main button is not for search in these modes
            } else if (isGeminiSearchEnabled) {
                if (uploadedImageBase64) {
                    handleVisualSearch();
                } else {
                    performGeminiSearch(document.getElementById('mainSearchInput').value.trim());
                }
            } else {
                performSearch();
            }
        }

        /**
         * Toggles Drawing Mode on/off.
         */
        function toggleDrawingMode() {
            const sidebarDrawingModeToggle = document.getElementById('sidebarDrawingModeToggle');
            const sidebarDrawingModeStatus = document.getElementById('sidebarDrawingModeStatus');
            const drawingModeSection = document.getElementById('drawingModeSection');
            const easySearchSection = document.getElementById('easySearchSection');
            const imageGenerationSection = document.getElementById('imageGenerationSection');

            // Prevent Drawing Mode activation if Focus Mode is active
            if (isFocusModeEnabled && sidebarDrawingModeToggle.checked) {
                sidebarDrawingModeToggle.checked = false;
                showAlert('Mode Menggambar otomatis nonaktif saat Mode Fokus diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            isDrawingModeEnabled = sidebarDrawingModeToggle.checked;

            if (isDrawingModeEnabled) {
                sidebarDrawingModeStatus.textContent = 'Aktif';
                sidebarDrawingModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarDrawingModeStatus.classList.add('text-green-600', 'dark:text-green-400');

                // Hide other sections and show drawing mode
                easySearchSection.classList.add('hidden');
                imageGenerationSection.classList.add('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.getElementById('noteModeSection').classList.add('hidden');
                document.getElementById('worldClockSection').classList.add('hidden');
                document.getElementById('calculatorSection').classList.add('hidden');
                document.getElementById('weatherSection').classList.add('hidden');
                document.getElementById('prayerTimeSection').classList.add('hidden');
                document.getElementById('hijriSection').classList.add('hidden');
                drawingModeSection.classList.remove('hidden');

                // Initialize drawing canvas
                setTimeout(() => {
                    initializeDrawingCanvas();
                }, 100);
            } else {
                sidebarDrawingModeStatus.textContent = 'Nonaktif';
                sidebarDrawingModeStatus.classList.remove('text-green-600', 'dark:text-green-400');
                sidebarDrawingModeStatus.classList.add('text-red-600', 'dark:text-red-400');

                // Show search sections and hide drawing mode
                easySearchSection.classList.remove('hidden');
                imageGenerationSection.classList.remove('hidden');
                drawingModeSection.classList.add('hidden');
            }

            localStorage.setItem('isDrawingModeEnabled', JSON.stringify(isDrawingModeEnabled));
            updateSearchInputPlaceholder();
            showLoading(false);
        }

        /**
         * Initializes the drawing canvas functionality.
         */
        function initializeDrawingCanvas() {
            drawingCanvas = document.getElementById('drawingCanvas');
            drawingCtx = drawingCanvas.getContext('2d');

            const colorPicker = document.getElementById('colorPicker');
            const lineWidthInput = document.getElementById('lineWidth');
            const lineWidthValueSpan = document.getElementById('lineWidthValue');
            const pencilTool = document.getElementById('pencilTool');
            const eraserTool = document.getElementById('eraserTool');
            const rectangleTool = document.getElementById('rectangleTool');
            const circleTool = document.getElementById('circleTool');
            const lineTool = document.getElementById('lineTool');
            const textTool = document.getElementById('textTool');
            const clearCanvasBtn = document.getElementById('clearCanvas');

            // Set canvas size
            function resizeCanvas() {
                drawingCanvas.width = drawingCanvas.offsetWidth;
                drawingCanvas.height = drawingCanvas.offsetHeight;
                if (drawingSnapshot) {
                    drawingCtx.putImageData(drawingSnapshot, 0, 0);
                }
            }

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Initialize context settings
            drawingCtx.lineCap = 'round';
            drawingCtx.lineJoin = 'round';
            drawingCtx.strokeStyle = currentColor;
            drawingCtx.fillStyle = currentColor;
            drawingCtx.lineWidth = currentLineWidth;

            // Get mouse/touch position
            function getMousePos(event) {
                const rect = drawingCanvas.getBoundingClientRect();
                let clientX, clientY;

                if (event.touches) {
                    clientX = event.touches[0].clientX;
                    clientY = event.touches[0].clientY;
                } else {
                    clientX = event.clientX;
                    clientY = event.clientY;
                }

                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }

            // Color picker event
            colorPicker.addEventListener('input', (e) => {
                currentColor = e.target.value;
                drawingCtx.strokeStyle = currentColor;
                drawingCtx.fillStyle = currentColor;
            });

            // Line width event
            lineWidthInput.addEventListener('input', (e) => {
                currentLineWidth = e.target.value;
                lineWidthValueSpan.textContent = currentLineWidth;
                drawingCtx.lineWidth = currentLineWidth;
            });

            // Tool activation function
            function activateTool(tool) {
                currentTool = tool;
                document.querySelectorAll('.tool-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`${tool}Tool`).classList.add('active');
            }

            // Tool button events
            pencilTool.addEventListener('click', () => activateTool('pencil'));
            eraserTool.addEventListener('click', () => activateTool('eraser'));
            rectangleTool.addEventListener('click', () => activateTool('rectangle'));
            circleTool.addEventListener('click', () => activateTool('circle'));
            lineTool.addEventListener('click', () => activateTool('line'));
            textTool.addEventListener('click', () => activateTool('text'));

            // Clear canvas event
            clearCanvasBtn.addEventListener('click', () => {
                drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                drawingSnapshot = null;
            });

            // Drawing functions
            function startDrawing(e) {
                isDrawing = true;
                const pos = getMousePos(e);
                startX = pos.x;
                startY = pos.y;

                if (currentTool === 'pencil' || currentTool === 'eraser') {
                    drawingCtx.beginPath();
                    drawingCtx.moveTo(startX, startY);
                } else if (currentTool !== 'text') {
                    drawingSnapshot = drawingCtx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height);
                }
            }

            function draw(e) {
                if (!isDrawing) return;
                e.preventDefault();
                const pos = getMousePos(e);

                if (currentTool === 'pencil') {
                    drawingCtx.strokeStyle = currentColor;
                    drawingCtx.lineWidth = currentLineWidth;
                    drawingCtx.lineTo(pos.x, pos.y);
                    drawingCtx.stroke();
                } else if (currentTool === 'eraser') {
                    drawingCtx.strokeStyle = '#FFFFFF';
                    drawingCtx.lineWidth = currentLineWidth;
                    drawingCtx.lineTo(pos.x, pos.y);
                    drawingCtx.stroke();
                } else if (currentTool !== 'text') {
                    drawingCtx.putImageData(drawingSnapshot, 0, 0);
                    drawingCtx.strokeStyle = currentColor;
                    drawingCtx.lineWidth = currentLineWidth;

                    const width = pos.x - startX;
                    const height = pos.y - startY;

                    if (currentTool === 'rectangle') {
                        drawingCtx.strokeRect(startX, startY, width, height);
                    } else if (currentTool === 'circle') {
                        const radiusX = Math.abs(width / 2);
                        const radiusY = Math.abs(height / 2);
                        const centerX = startX + width / 2;
                        const centerY = startY + height / 2;
                        drawingCtx.beginPath();
                        drawingCtx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, 2 * Math.PI);
                        drawingCtx.stroke();
                    } else if (currentTool === 'line') {
                        drawingCtx.beginPath();
                        drawingCtx.moveTo(startX, startY);
                        drawingCtx.lineTo(pos.x, pos.y);
                        drawingCtx.stroke();
                    }
                }
            }

            function stopDrawing() {
                isDrawing = false;
                drawingCtx.closePath();
                drawingSnapshot = null;
            }

            function addText(e) {
                const pos = getMousePos(e);
                const textInput = prompt("Masukkan teks:");
                if (textInput !== null && textInput.trim() !== '') {
                    drawingCtx.fillStyle = currentColor;
                    drawingCtx.font = `${currentLineWidth * 2}px Inter, sans-serif`;
                    drawingCtx.fillText(textInput, pos.x, pos.y);
                }
            }

            // Mouse events
            drawingCanvas.addEventListener('mousedown', startDrawing);
            drawingCanvas.addEventListener('mousemove', draw);
            drawingCanvas.addEventListener('mouseup', stopDrawing);
            drawingCanvas.addEventListener('mouseleave', stopDrawing);

            // Touch events
            drawingCanvas.addEventListener('touchstart', startDrawing);
            drawingCanvas.addEventListener('touchmove', draw);
            drawingCanvas.addEventListener('touchend', stopDrawing);
            drawingCanvas.addEventListener('touchcancel', stopDrawing);

            // Text tool click event
            drawingCanvas.addEventListener('click', (e) => {
                if (currentTool === 'text') {
                    addText(e);
                }
            });

            // Initialize with pencil tool
            activateTool('pencil');
        }

        /**
         * Performs the main search using the selected search engine.
         */
        async function performSearch() {
            const query = document.getElementById('mainSearchInput').value.trim();
            if (!query) {
                showAlert('Silakan masukkan kata kunci pencarian!', 'Peringatan');
                return;
            }

            if (isSearchSensorEnabled && containsForbiddenKeywords(query)) {
                showAlert('Pencarian Anda mengandung kata kunci yang tidak diizinkan. Silakan coba kata kunci lain.', 'Pencarian Dibatalkan');
                return;
            }

            showLoading(true);
            clearSearchIntentDisplay();

            const intent = await detectSearchIntent(query);
            displaySearchIntent(intent);

            setTimeout(() => {
                showLoading(false);
                let engineUrl;
                if (isSearchSaverEnabled) {
                    engineUrl = searchSaverEngines[currentSearchEngine]?.url;
                } else {
                    engineUrl = allSearchEngines[currentSearchEngine]?.url;
                }

                if (engineUrl) {
                    const searchUrl = engineUrl + encodeURIComponent(query);
                    window.open(searchUrl, '_blank');
                    showDemoResults(query);
                    if (!isIncognitoModeEnabled) {
                        saveSearchQuery(query);
                    }
                } else {
                    showAlert('Mesin pencari tidak ditemukan. Silakan pilih mesin pencari yang valid.', 'Kesalahan');
                }
            }, 1000);
        }

        /**
         * Performs a text-based search using the Gemini API.
         */
        async function performGeminiSearch(query) {
            const resultsContainer = document.getElementById('resultsContainer');
            const searchResultsSection = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';

            if (!geminiModel) {
                showAlert("Gemini API tidak diinisialisasi. Periksa konsol untuk detail.", "Kesalahan Gemini");
                showLoading(false);
                return;
            }

            try {
                const prompt = `Berikan informasi yang komprehensif dan ringkas tentang "${query}". Sertakan poin-poin penting, definisi, dan fakta relevan. Format sebagai teks biasa, tanpa markdown judul atau daftar.`;

                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = API_KEY;
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const geminiText = result.candidates[0].content.parts[0].text;

                    resultsContainer.innerHTML = `
                        <div class="gemini-result-card">
                            <h4 class="text-xl font-semibold mb-3">Hasil dari Gemini AI untuk "${query}"</h4>
                            <p>${geminiText}</p>
                        </div>
                    `;
                    searchResultsSection.classList.remove('hidden');
                    searchResultsSection.scrollIntoView({ behavior: 'smooth' });

                    if (!isIncognitoModeEnabled) {
                        saveSearchQuery(query);
                    }

                } else {
                    showAlert("Tidak dapat menghasilkan respons dari Gemini. Coba lagi.", "Kesalahan Gemini");
                    console.error("Struktur respons Gemini API tidak terduga:", result);
                }
            } catch (error) {
                console.error("Kesalahan saat memanggil Gemini API:", error);
                showAlert(`Terjadi kesalahan saat menghubungi Gemini API: ${error.message}`, "Kesalahan API");
            } finally {
                showLoading(false);
            }
        }

        /**
         * Detects the search intent using Gemini API.
         */
        async function detectSearchIntent(query) {
            if (!geminiModel) {
                console.error("Gemini API tidak diinisialisasi untuk deteksi niat.");
                return 'Tidak diketahui';
            }

            const prompt = `Klasifikasikan niat pencarian dari kueri berikut ke dalam salah satu kategori ini: Informasional, Transaksional, Navigasional, Investigasi Komersial. Berikan hanya satu kata kategorinya. Jika tidak yakin, jawab 'Informasional'. Kueri: "${query}"`;

            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = API_KEY;
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    let intent = result.candidates[0].content.parts[0].text.trim();
                    if (intent.includes(':')) {
                        intent = intent.split(':').pop().trim();
                    }
                    if (intent.includes('.')) {
                        intent = intent.replace('.', '').trim();
                    }
                    return intent;
                }
            } catch (error) {
                console.error("Kesalahan saat mendeteksi niat pencarian dengan Gemini:", error);
            }
            return 'Tidak diketahui';
        }

        /**
         * Displays the detected search intent.
         */
        function displaySearchIntent(intent) {
            const intentDisplay = document.getElementById('searchIntentDisplay');
            if (intent && intent !== 'Tidak diketahui') {
                intentDisplay.textContent = `Niat Pencarian: ${intent}`;
                intentDisplay.classList.remove('hidden');
            } else {
                intentDisplay.classList.add('hidden');
            }
        }

        /**
         * Clears the search intent display.
         */
        function clearSearchIntentDisplay() {
            document.getElementById('searchIntentDisplay').classList.add('hidden');
            document.getElementById('searchIntentDisplay').textContent = '';
        }

        /**
         * Checks if the query contains any forbidden keywords.
         */
        function containsForbiddenKeywords(query) {
            const lowerCaseQuery = query.toLowerCase();
            return forbiddenKeywords.some(keyword => lowerCaseQuery.includes(keyword));
        }

        /**
         * Function for quick search suggestions.
         */
        function quickSearch(query) {
            document.getElementById('mainSearchInput').value = query;
            handleMainButtonAction();
        }

        /**
         * Shows/hides the loading spinner for the main search button.
         */
        function showLoading(isLoading) {
            const button = document.getElementById('searchButton');
            const buttonText = document.getElementById('buttonText');
            const spinner = document.getElementById('loadingSpinner');
            const mainSearchInput = document.getElementById('mainSearchInput');
            const visualSearchBtn = document.getElementById('visualSearchBtn');

            if (isLoading) {
                buttonText.textContent = 'Mencari...';
                spinner.classList.remove('hidden');
                button.disabled = true;
                mainSearchInput.disabled = true;
                visualSearchBtn.disabled = true;
            } else {
                if (isBackgroundSelectionMode) {
                    buttonText.textContent = 'Pilih Background';
                } else if (isLearningModeEnabled) {
                    buttonText.textContent = 'Mode Belajar Aktif';
                    button.disabled = true;
                } else if (isDrawingModeEnabled) {
                    buttonText.textContent = 'Mode Menggambar Aktif';
                    button.disabled = true;
                } else if (isNoteModeEnabled) {
                    buttonText.textContent = 'Mode Catatan Aktif';
                    button.disabled = true;
                } else if (isWorldClockEnabled) {
                    buttonText.textContent = 'Jam Dunia Aktif';
                    button.disabled = true;
                } else {
                    buttonText.textContent = 'Cari';
                }
                spinner.classList.add('hidden');
                button.disabled = false;
                mainSearchInput.disabled = false;
                visualSearchBtn.disabled = !(isGeminiSearchEnabled && uploadedImageBase64);
            }
        }

        /**
         * Displays demo search results.
         */
        function showDemoResults(query) {
            const resultsSection = document.getElementById('searchResults');
            const resultsContainer = document.getElementById('resultsContainer');

            let sampleResults;
            if (isKidsModeEnabled) {
                sampleResults = [
                    {
                        title: `Belajar tentang "${query}" untuk anak-anak`,
                        url: 'https://edukasi.com/anak/' + encodeURIComponent(query.replace(/\s/g, '-')),
                        description: `Video dan permainan interaktif yang menyenangkan untuk membantu anak-anak memahami ${query}.`
                    },
                    {
                        title: `Dongeng "${query}" yang mendidik`,
                        url: 'https://dongenganak.com/cerita/' + encodeURIComponent(query.replace(/\s/g, '-')),
                        description: `Kumpulan dongeng dan cerita bergambar tentang ${query} untuk meningkatkan minat baca anak.`
                    },
                    {
                        title: `Worksheet dan aktivitas "${query}"`,
                        url: 'https://belajaranak.org/aktivitas/' + encodeURIComponent(query.replace(/\s/g, '-')),
                        description: `Lembar kerja yang bisa dicetak dan ide aktivitas kreatif bertema ${query} untuk belajar di rumah.`
                    }
                ];
            } else {
                sampleResults = [
                    {
                        title: `Hasil terbaik untuk "${query}"`,
                        url: 'https://example.com/result1',
                        description: `Informasi lengkap dan terpercaya tentang ${query}. Temukan jawaban yang Anda cari dengan penjelasan detail dan mudah dipahami.`
                    },
                    {
                        title: `Panduan lengkap ${query}`,
                        url: 'https://example.com/result2',
                        description: `Tutorial step-by-step dan tips praktis mengenai ${query}. Cocok untuk pemula maupun yang sudah berpengalaman.`
                    },
                    {
                        title: `${query} - Wikipedia`,
                        url: 'https://wikipedia.org/wiki/result',
                        description: `Artikel ensiklopedia yang komprehensif tentang ${query} dengan referensi dan sumber yang dapat dipercaya.`
                    }
                ];
            }

            resultsContainer.innerHTML = sampleResults.map(result => `
                <div class="result-card bg-gray-50 p-4 rounded-lg flex flex-col">
                    <h4 class="text-lg font-semibold text-blue-600 hover:text-blue-800 cursor-pointer mb-1">
                        ${result.title}
                    </h4>
                    <p class="text-green-600 text-sm mb-2">${result.url}</p>
                    <p class="text-gray-700 text-sm leading-relaxed flex-grow">${result.description}</p>
                </div>
            `).join('');

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        /**
         * Updates the quick search suggestions.
         */
        function updateQuickSearchSuggestions() {
            const quickSearchButtonsContainer = document.getElementById('quickSearchButtons');
            const quickSearchTitle = document.getElementById('quickSearchTitle');
            const quickSearchSuggestionsSection = document.getElementById('quickSearchSuggestions');

            if (isSearchSaverEnabled || isLearningModeEnabled || isDrawingModeEnabled || isNoteModeEnabled || isWorldClockEnabled) {
                quickSearchSuggestionsSection.classList.add('hidden');
                return;
            } else {
                quickSearchSuggestionsSection.classList.remove('hidden');
            }

            let suggestionsToUse = isKidsModeEnabled ? kidsQuickSearches : normalQuickSearches;

            quickSearchTitle.textContent = isKidsModeEnabled ? 'Rekomendasi Edukasi Anak' : 'Pencarian Populer';
            quickSearchButtonsContainer.innerHTML = '';

            suggestionsToUse.forEach(item => {
                const button = document.createElement('button');
                button.className = 'bg-white p-4 rounded-xl shadow-md hover:shadow-lg transition-shadow text-center';
                if (document.body.classList.contains('dark-mode')) {
                    button.classList.add('dark:bg-gray-700', 'dark:text-gray-100');
                } else {
                    button.classList.remove('dark:bg-gray-700', 'dark:text-gray-100');
                }
                button.setAttribute('onclick', `quickSearch('${item.query}')`);
                button.innerHTML = `
                    ${item.icon} <br><span class="text-sm font-medium">${item.text}</span>
                `;
                quickSearchButtonsContainer.appendChild(button);
            });
        }

        /**
         * Shows custom alert modal.
         */
        function showAlert(message, title = 'Pemberitahuan') {
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'custom-modal-overlay';
            modalOverlay.innerHTML = `
                <div class="custom-modal">
                    <div class="custom-modal-title">${title}</div>
                    <div class="custom-modal-message">${message}</div>
                    <div class="custom-modal-actions">
                        <button class="ok-btn" onclick="this.closest('.custom-modal-overlay').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modalOverlay);
        }

        /**
         * Shows custom confirm modal.
         */
        function showConfirm(message, title = 'Konfirmasi') {
            return new Promise(resolve => {
                const modalOverlay = document.createElement('div');
                modalOverlay.className = 'custom-modal-overlay';
                modalOverlay.innerHTML = `
                    <div class="custom-modal">
                        <div class="custom-modal-title">${title}</div>
                        <div class="custom-modal-message">${message}</div>
                        <div class="custom-modal-actions">
                            <button class="confirm-btn">Ya</button>
                            <button class="cancel-btn">Batal</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modalOverlay);

                modalOverlay.querySelector('.confirm-btn').onclick = () => {
                    modalOverlay.remove();
                    resolve(true);
                };
                modalOverlay.querySelector('.cancel-btn').onclick = () => {
                    modalOverlay.remove();
                    resolve(false);
                };
            });
        }

        /**
         * Toggles between dark and light mode.
         */
        function toggleTheme() {
            const body = document.body;
            const sidebarThemeToggle = document.getElementById('sidebarThemeToggle');
            const sidebarThemeStatus = document.getElementById('sidebarThemeStatus');

            if (isSearchSaverEnabled) {
                sidebarThemeToggle.checked = true;
                body.classList.add('dark-mode');
                showAlert('Mode Gelap otomatis aktif saat Penghemat Pencarian diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            body.classList.toggle('dark-mode');

            const isDarkMode = body.classList.contains('dark-mode');
            sidebarThemeToggle.checked = isDarkMode;
            sidebarThemeStatus.textContent = isDarkMode ? 'Aktif' : 'Nonaktif';
            sidebarThemeStatus.classList.toggle('text-green-600', isDarkMode);
            sidebarThemeStatus.classList.toggle('text-red-600', !isDarkMode);
            sidebarThemeStatus.classList.toggle('dark:text-green-400', isDarkMode);
            sidebarThemeStatus.classList.toggle('dark:text-red-400', !isDarkMode);

            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

            applyBackground(selectedBackground);
            updateQuickSearchSuggestions();
            renderSearchEngineButtons();
        }

        /**
         * Applies the saved theme preference on page load.
         */
        function applySavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.body;
            const sidebarThemeToggle = document.getElementById('sidebarThemeToggle');
            const sidebarThemeStatus = document.getElementById('sidebarThemeStatus');

            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                sidebarThemeToggle.checked = true;
            } else {
                body.classList.remove('dark-mode');
                sidebarThemeToggle.checked = false;
            }
            sidebarThemeStatus.textContent = sidebarThemeToggle.checked ? 'Aktif' : 'Nonaktif';
            sidebarThemeStatus.classList.toggle('text-green-600', sidebarThemeToggle.checked);
            sidebarThemeStatus.classList.toggle('text-red-600', !sidebarThemeToggle.checked);
            sidebarThemeStatus.classList.toggle('dark:text-green-400', sidebarThemeToggle.checked);
            sidebarThemeStatus.classList.toggle('dark:text-red-400', !sidebarThemeToggle.checked);
        }

        /**
         * Toggles High Contrast Mode on/off.
         */
        function toggleHighContrastMode() {
            const body = document.body;
            const sidebarHighContrastToggle = document.getElementById('sidebarHighContrastToggle');
            const sidebarHighContrastStatus = document.getElementById('sidebarHighContrastStatus');

            isHighContrastModeEnabled = sidebarHighContrastToggle.checked;
            body.classList.toggle('high-contrast-mode', isHighContrastModeEnabled);

            sidebarHighContrastStatus.textContent = isHighContrastModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarHighContrastStatus.classList.toggle('text-green-600', isHighContrastModeEnabled);
            sidebarHighContrastStatus.classList.toggle('text-red-600', !isHighContrastModeEnabled);
            sidebarHighContrastStatus.classList.toggle('dark:text-green-400', isHighContrastModeEnabled);
            sidebarHighContrastStatus.classList.toggle('dark:text-red-400', !isHighContrastModeEnabled);

            localStorage.setItem('isHighContrastModeEnabled', JSON.stringify(isHighContrastModeEnabled));
        }

        /**
         * Adjusts the font size.
         */
        function adjustFontSize(direction) {
            const currentFontSizeElement = document.getElementById('currentFontSize');

            currentFontSizeIndex += direction;
            if (currentFontSizeIndex < 0) {
                currentFontSizeIndex = 0;
            } else if (currentFontSizeIndex >= fontSizes.length) {
                currentFontSizeIndex = fontSizes.length - 1;
            }

            document.body.style.setProperty('--base-font-size', fontSizes[currentFontSizeIndex]);

            let statusText = 'Normal';
            if (currentFontSizeIndex === 0) {
                statusText = 'Kecil';
            } else if (currentFontSizeIndex === fontSizes.length - 1) {
                statusText = 'Besar';
            } else if (currentFontSizeIndex > 1) {
                statusText = 'Lebih Besar';
            } else if (currentFontSizeIndex < 1) {
                statusText = 'Lebih Kecil';
            }
            currentFontSizeElement.textContent = statusText;

            localStorage.setItem('currentFontSizeIndex', JSON.stringify(currentFontSizeIndex));
        }

        /**
         * Toggles Focus Mode on/off.
         */
        function toggleFocusMode() {
            const body = document.body;
            const sidebarFocusModeToggle = document.getElementById('sidebarFocusModeToggle');
            const sidebarFocusModeStatus = document.getElementById('sidebarFocusModeStatus');
            const quickSearchSuggestions = document.getElementById('quickSearchSuggestions');
            const searchEngineOptions = document.getElementById('searchEngineOptions');
            const footer = document.querySelector('footer');
            const searchResults = document.getElementById('searchResults');
            const imageGenerationSection = document.getElementById('imageGenerationSection');
            const learningModeSection = document.getElementById('learningModeSection');

            isFocusModeEnabled = sidebarFocusModeToggle.checked;
            body.classList.toggle('focus-mode', isFocusModeEnabled);

            quickSearchSuggestions.style.display = isFocusModeEnabled ? 'none' : '';
            searchEngineOptions.style.display = isFocusModeEnabled ? 'none' : '';
            footer.style.display = isFocusModeEnabled ? 'none' : '';
            searchResults.style.display = isFocusModeEnabled ? 'none' : '';
            imageGenerationSection.style.display = isFocusModeEnabled ? 'none' : '';
            learningModeSection.style.display = isFocusModeEnabled ? 'none' : '';

            sidebarFocusModeStatus.textContent = isFocusModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarFocusModeStatus.classList.toggle('text-green-600', isFocusModeEnabled);
            sidebarFocusModeStatus.classList.toggle('text-red-600', !isFocusModeEnabled);
            sidebarFocusModeStatus.classList.toggle('dark:text-green-400', isFocusModeEnabled);
            sidebarFocusModeStatus.classList.toggle('dark:text-red-400', !isFocusModeEnabled);

            if (isFocusModeEnabled) {
                isBackgroundSelectionMode = false;
                document.getElementById('sidebarBackgroundToggle').checked = false;
                document.getElementById('sidebarBackgroundStatus').textContent = 'Nonaktif (Mode Fokus)';
                document.getElementById('sidebarBackgroundStatus').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('sidebarBackgroundStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarBackgroundToggle').disabled = true;
                applyBackground('');

                isLearningModeEnabled = false;
                document.getElementById('sidebarLearningModeToggle').checked = false;
                document.getElementById('sidebarLearningModeStatus').textContent = 'Nonaktif (Mode Fokus)';
                document.getElementById('sidebarLearningModeStatus').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('sidebarLearningModeStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarLearningModeToggle').disabled = true;
                document.getElementById('easySearchSection').classList.remove('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.body.classList.remove('learning-mode-bg');

                isDrawingModeEnabled = false;
                document.getElementById('sidebarDrawingModeToggle').checked = false;
                document.getElementById('sidebarDrawingModeStatus').textContent = 'Nonaktif (Mode Fokus)';
                document.getElementById('sidebarDrawingModeStatus').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('sidebarDrawingModeStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarDrawingModeToggle').disabled = true;
                document.getElementById('drawingModeSection').classList.add('hidden');
            } else {
                document.getElementById('sidebarBackgroundToggle').disabled = false;
                isBackgroundSelectionMode = localStorage.getItem('isBackgroundSelectionMode') === 'true';
                document.getElementById('sidebarBackgroundToggle').checked = isBackgroundSelectionMode;
                document.getElementById('sidebarBackgroundStatus').textContent = isBackgroundSelectionMode ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarBackgroundStatus').classList.toggle('text-green-600', isBackgroundSelectionMode);
                document.getElementById('sidebarBackgroundStatus').classList.toggle('text-red-600', !isBackgroundSelectionMode);
                document.getElementById('sidebarBackgroundStatus').classList.toggle('dark:text-green-400', isBackgroundSelectionMode);
                document.getElementById('sidebarBackgroundStatus').classList.toggle('dark:text-red-400', !isBackgroundSelectionMode);
                applyBackground(selectedBackground);

                document.getElementById('sidebarLearningModeToggle').disabled = false;
                isLearningModeEnabled = localStorage.getItem('isLearningModeEnabled') === 'true';
                document.getElementById('sidebarLearningModeToggle').checked = isLearningModeEnabled;
                document.getElementById('sidebarLearningModeStatus').textContent = isLearningModeEnabled ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarLearningModeStatus').classList.toggle('text-green-600', isLearningModeEnabled);
                document.getElementById('sidebarLearningModeStatus').classList.toggle('text-red-600', !isLearningModeEnabled);
                document.getElementById('sidebarLearningModeStatus').classList.toggle('dark:text-green-400', isLearningModeEnabled);
                document.getElementById('sidebarLearningModeStatus').classList.toggle('dark:text-red-400', !isLearningModeEnabled);
                if (isLearningModeEnabled) {
                    document.getElementById('easySearchSection').classList.add('hidden');
                    document.getElementById('imageGenerationSection').classList.add('hidden');
                    document.getElementById('learningModeSection').classList.remove('hidden');
                    document.body.classList.add('learning-mode-bg');
                    displayHistoryContent();
                    generateMathProblem();
                    displayHistoryQuestion();
                } else {
                    document.getElementById('easySearchSection').classList.remove('hidden');
                    document.getElementById('imageGenerationSection').classList.remove('hidden');
                    document.getElementById('learningModeSection').classList.add('hidden');
                    document.body.classList.remove('learning-mode-bg');
                }

                document.getElementById('sidebarDrawingModeToggle').disabled = false;
                isDrawingModeEnabled = localStorage.getItem('isDrawingModeEnabled') === 'true';
                document.getElementById('sidebarDrawingModeToggle').checked = isDrawingModeEnabled;
                document.getElementById('sidebarDrawingModeStatus').textContent = isDrawingModeEnabled ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('text-green-600', isDrawingModeEnabled);
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('text-red-600', !isDrawingModeEnabled);
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('dark:text-green-400', isDrawingModeEnabled);
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('dark:text-red-400', !isDrawingModeEnabled);
                if (isDrawingModeEnabled) {
                    document.getElementById('easySearchSection').classList.add('hidden');
                    document.getElementById('imageGenerationSection').classList.add('hidden');
                    document.getElementById('drawingModeSection').classList.remove('hidden');
                    setTimeout(() => {
                        initializeDrawingCanvas();
                    }, 100);
                } else {
                    document.getElementById('drawingModeSection').classList.add('hidden');
                }
            }

            localStorage.setItem('isFocusModeEnabled', JSON.stringify(isFocusModeEnabled));
            localStorage.setItem('isBackgroundSelectionMode', JSON.stringify(isBackgroundSelectionMode));
            localStorage.setItem('isLearningModeEnabled', JSON.stringify(isLearningModeEnabled));
            localStorage.setItem('isDrawingModeEnabled', JSON.stringify(isDrawingModeEnabled));
        }

        /**
         * Toggles Search Sensor on/off.
         */
        function toggleSearchSensor() {
            const sidebarSearchSensorToggle = document.getElementById('sidebarSearchSensorToggle');
            const sidebarSensorStatus = document.getElementById('sidebarSensorStatus');

            if (isIncognitoModeEnabled) {
                sidebarSearchSensorToggle.checked = false;
                showAlert('Sensor Pencarian otomatis nonaktif saat Mode Samaran diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            if (isKidsModeEnabled) {
                sidebarSearchSensorToggle.checked = true;
                showAlert('Sensor Pencarian otomatis aktif saat Mode Anak-anak diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            if (!sidebarSearchSensorToggle.checked) {
                sidebarSearchSensorToggle.checked = true;
                isSearchSensorEnabled = true;
                showAlert('Sensor Pencarian harus aktif kecuali dalam Mode Samaran.', 'Peringatan');
            } else {
                isSearchSensorEnabled = true;
            }

            sidebarSensorStatus.textContent = isSearchSensorEnabled ? 'Aktif' : 'Nonaktif';
            sidebarSensorStatus.classList.toggle('text-green-600', isSearchSensorEnabled);
            sidebarSensorStatus.classList.toggle('text-red-600', !isSearchSensorEnabled);
            sidebarSensorStatus.classList.toggle('dark:text-green-400', isSearchSensorEnabled);
            sidebarSensorStatus.classList.toggle('dark:text-red-400', !isSearchSensorEnabled);

            sidebarSearchSensorToggle.disabled = true;
            localStorage.setItem('searchSensorEnabled', JSON.stringify(isSearchSensorEnabled));
        }

        /**
         * Toggles Kids Mode on/off.
         */
        function toggleKidsMode() {
            const sidebarKidsModeToggle = document.getElementById('sidebarKidsModeToggle');
            const sidebarKidsModeStatus = document.getElementById('sidebarKidsModeStatus');
            const sidebarSearchSensorToggle = document.getElementById('sidebarSearchSensorToggle');
            const sidebarSensorStatus = document.getElementById('sidebarSensorStatus');
            const body = document.body;

            if (isIncognitoModeEnabled && sidebarKidsModeToggle.checked) {
                sidebarKidsModeToggle.checked = false;
                showAlert('Mode Anak-anak tidak dapat diaktifkan saat Mode Samaran aktif.', 'Peringatan');
                return;
            }
            if (isKidsModeForcedByAge && sidebarKidsModeToggle.checked) {
                sidebarKidsModeToggle.checked = true;
                showAlert('Mode Anak-anak diaktifkan secara otomatis berdasarkan umur dan tidak dapat dinonaktifkan.', 'Peringatan');
                return;
            }

            isKidsModeEnabled = sidebarKidsModeToggle.checked;

            if (isKidsModeEnabled) {
                sidebarKidsModeStatus.textContent = 'Aktif';
                sidebarKidsModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarKidsModeStatus.classList.add('text-green-600', 'dark:text-green-400');
                sidebarKidsModeToggle.disabled = isKidsModeForcedByAge;

                isSearchSensorEnabled = true;
                sidebarSearchSensorToggle.checked = true;
                sidebarSearchSensorToggle.disabled = true;
                sidebarSensorStatus.textContent = 'Aktif (Mode Anak)';
                sidebarSensorStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarSensorStatus.classList.add('text-green-600', 'dark:text-green-400');

            } else {
                sidebarKidsModeStatus.textContent = 'Nonaktif';
                sidebarKidsModeStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarKidsModeStatus.classList.add('text-red-600', 'dark:text-red-400');
                sidebarKidsModeToggle.disabled = isKidsModeForcedByAge;

                if (!isIncognitoModeEnabled) {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSensorStatus.textContent = 'Aktif';
                    sidebarSensorStatus.classList.toggle('text-green-600', true);
                    sidebarSensorStatus.classList.toggle('text-red-600', false);
                    sidebarSensorStatus.classList.toggle('dark:text-green-400', true);
                    sidebarSensorStatus.classList.toggle('dark:text-red-400', false);
                } else {
                    isSearchSensorEnabled = false;
                    sidebarSearchSensorToggle.checked = false;
                    sidebarSensorStatus.textContent = 'Nonaktif (Mode Samaran)';
                    sidebarSensorStatus.classList.toggle('text-green-600', false);
                    sidebarSensorStatus.classList.toggle('text-red-600', true);
                    sidebarSensorStatus.classList.toggle('dark:text-green-400', false);
                    sidebarSensorStatus.classList.toggle('dark:text-red-400', true);
                }
                sidebarSearchSensorToggle.disabled = true;
            }

            localStorage.setItem('isKidsModeEnabled', JSON.stringify(isKidsModeEnabled));
            localStorage.setItem('searchSensorEnabled', JSON.stringify(isSearchSensorEnabled));

            updateQuickSearchSuggestions();
            applyBackground(selectedBackground);
        }

        /**
         * Toggles the Learning Mode on/off.
         */
        function toggleLearningMode() {
            const sidebarLearningModeToggle = document.getElementById('sidebarLearningModeToggle');
            const sidebarLearningModeStatus = document.getElementById('sidebarLearningModeStatus');
            const easySearchSection = document.getElementById('easySearchSection');
            const imageGenerationSection = document.getElementById('imageGenerationSection');
            const learningModeSection = document.getElementById('learningModeSection');
            const body = document.body;

            if (isFocusModeEnabled && sidebarLearningModeToggle.checked) {
                sidebarLearningModeToggle.checked = false;
                showAlert('Mode Belajar otomatis nonaktif saat Mode Fokus diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            isLearningModeEnabled = sidebarLearningModeToggle.checked;

            if (isLearningModeEnabled) {
                sidebarLearningModeStatus.textContent = 'Aktif';
                sidebarLearningModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarLearningModeStatus.classList.add('text-green-600', 'dark:text-green-400');

                easySearchSection.classList.add('hidden');
                imageGenerationSection.classList.add('hidden');
                learningModeSection.classList.remove('hidden');
                body.classList.add('learning-mode-bg');
                applyBackground('');
                body.classList.remove('kids-mode-bg');

                displayHistoryContent();
                generateMathProblem();
                displayHistoryQuestion();
            } else {
                sidebarLearningModeStatus.textContent = 'Nonaktif';
                sidebarLearningModeStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarLearningModeStatus.classList.add('text-red-600', 'dark:text-red-400');

                easySearchSection.classList.remove('hidden');
                imageGenerationSection.classList.remove('hidden');
                learningModeSection.classList.add('hidden');
                body.classList.remove('learning-mode-bg');
                applyBackground(selectedBackground);
            }
            localStorage.setItem('isLearningModeEnabled', JSON.stringify(isLearningModeEnabled));
            updateSearchInputPlaceholder();
            updateQuickSearchSuggestions();
            showLoading(false);
        }

        /**
         * Toggles the background selection mode.
         */
        function toggleBackgroundSelectionMode() {
            const sidebarBackgroundToggle = document.getElementById('sidebarBackgroundToggle');
            const sidebarBackgroundStatus = document.getElementById('sidebarBackgroundStatus');
            const buttonText = document.getElementById('buttonText');
            const mainSearchInput = document.getElementById('mainSearchInput');
            const voiceSearchBtn = document.getElementById('voiceSearchBtn');
            const searchEngineOptions = document.getElementById('searchEngineOptions');

            if (isFocusModeEnabled && sidebarBackgroundToggle.checked) {
                sidebarBackgroundToggle.checked = false;
                showAlert('Pilihan Background otomatis nonaktif saat Mode Fokus diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            isBackgroundSelectionMode = sidebarBackgroundToggle.checked;

            if (isBackgroundSelectionMode) {
                sidebarBackgroundStatus.textContent = 'Aktif';
                sidebarBackgroundStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarBackgroundStatus.classList.add('text-green-600', 'dark:text-green-400');
                buttonText.textContent = 'Pilih Background';
                mainSearchInput.disabled = true;
                mainSearchInput.placeholder = 'Mode Pilih Background Aktif';
                voiceSearchBtn.disabled = true;
                searchEngineOptions.classList.add('hidden');
            } else {
                sidebarBackgroundStatus.textContent = 'Nonaktif';
                sidebarBackgroundStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarBackgroundStatus.classList.add('text-red-600', 'dark:text-red-400');
                buttonText.textContent = 'Cari';
                mainSearchInput.disabled = false;
                updateSearchInputPlaceholder();
                voiceSearchBtn.disabled = false;
                searchEngineOptions.classList.remove('hidden');
            }
            localStorage.setItem('isBackgroundSelectionMode', JSON.stringify(isBackgroundSelectionMode));
        }

        /**
         * Toggles Gemini Search on/off.
         */
        function toggleGeminiSearch() {
            const sidebarGeminiSearchToggle = document.getElementById('sidebarGeminiSearchToggle');
            const sidebarGeminiSearchStatus = document.getElementById('sidebarGeminiSearchStatus');
            const searchEngineOptions = document.getElementById('searchEngineOptions');
            const mainSearchInput = document.getElementById('mainSearchInput');
            const geminiVisualSearchControls = document.getElementById('geminiVisualSearchControls');
            const uploadedImagePreviewContainer = document.getElementById('uploadedImagePreviewContainer');
            const visualSearchBtn = document.getElementById('visualSearchBtn');

            isGeminiSearchEnabled = sidebarGeminiSearchToggle.checked;

            if (isGeminiSearchEnabled) {
                sidebarGeminiSearchStatus.textContent = 'Aktif';
                sidebarGeminiSearchStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarGeminiSearchStatus.classList.add('text-green-600', 'dark:text-green-400');
                searchEngineOptions.classList.add('hidden');
                geminiVisualSearchControls.classList.remove('hidden');
                visualSearchBtn.disabled = !uploadedImageBase64;
            } else {
                sidebarGeminiSearchStatus.textContent = 'Nonaktif';
                sidebarGeminiSearchStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarGeminiSearchStatus.classList.add('text-red-600', 'dark:text-red-400');
                searchEngineOptions.classList.remove('hidden');
                geminiVisualSearchControls.classList.add('hidden');
                uploadedImagePreviewContainer.classList.add('hidden');
                clearUploadedImage();
            }
            localStorage.setItem('isGeminiSearchEnabled', JSON.stringify(isGeminiSearchEnabled));
            updateSearchInputPlaceholder();
        }

        /**
         * Toggles Incognito Mode on/off.
         */
        function toggleIncognitoMode() {
            const sidebarIncognitoModeToggle = document.getElementById('sidebarIncognitoModeToggle');
            const sidebarIncognitoModeStatus = document.getElementById('sidebarIncognitoModeStatus');
            const sidebarSearchSensorToggle = document.getElementById('sidebarSearchSensorToggle');
            const sidebarSensorStatus = document.getElementById('sidebarSensorStatus');
            const sidebarKidsModeToggle = document.getElementById('sidebarKidsModeToggle');
            const sidebarKidsModeStatus = document.getElementById('sidebarKidsModeStatus');

            isIncognitoModeEnabled = sidebarIncognitoModeToggle.checked;

            if (isIncognitoModeEnabled) {
                sidebarIncognitoModeStatus.textContent = 'Aktif';
                sidebarIncognitoModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarIncognitoModeStatus.classList.add('text-green-600', 'dark:text-green-400');
                showAlert('Mode Samaran Aktif. Anda masih bisa melakukan pencarian seperti biasa, namun riwayat pencarian dan situs yang dikunjungi tidak akan disimpan. Sensor Pencarian dinonaktifkan secara otomatis.', 'Mode Samaran');

                lastKidsModeStateBeforeIncognito = isKidsModeEnabled;

                isKidsModeEnabled = false;
                sidebarKidsModeToggle.checked = false;
                sidebarKidsModeToggle.disabled = true;
                sidebarKidsModeStatus.textContent = 'Nonaktif (Mode Samaran)';
                sidebarKidsModeStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarKidsModeStatus.classList.add('text-red-600', 'dark:text-red-400');

                lastSearchSensorStateBeforeIncognito = isSearchSensorEnabled;
                isSearchSensorEnabled = false;
                sidebarSearchSensorToggle.checked = false;
                sidebarSearchSensorToggle.disabled = true;
                sidebarSensorStatus.textContent = 'Nonaktif (Mode Samaran)';
                sidebarSensorStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarSensorStatus.classList.add('text-red-600', 'dark:text-red-400');

                clearSearchHistory();
            } else {
                sidebarIncognitoModeStatus.textContent = 'Nonaktif';
                sidebarIncognitoModeStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarIncognitoModeStatus.classList.add('text-red-600', 'dark:text-red-400');
                showAlert('Mode Samaran Nonaktif. Riwayat pencarian dan situs akan disimpan kembali.', 'Mode Samaran');

                if (!isKidsModeForcedByAge) {
                    isKidsModeEnabled = lastKidsModeStateBeforeIncognito;
                    sidebarKidsModeToggle.checked = isKidsModeEnabled;
                    sidebarKidsModeToggle.disabled = false;
                    sidebarKidsModeStatus.textContent = isKidsModeEnabled ? 'Aktif' : 'Nonaktif';
                    sidebarKidsModeStatus.classList.toggle('text-green-600', isKidsModeEnabled);
                    sidebarKidsModeStatus.classList.toggle('text-red-600', !isKidsModeEnabled);
                    sidebarKidsModeStatus.classList.toggle('dark:text-green-400', isKidsModeEnabled);
                    sidebarKidsModeStatus.classList.toggle('dark:text-red-400', !isKidsModeEnabled);
                } else {
                    isKidsModeEnabled = true;
                    sidebarKidsModeToggle.checked = true;
                    sidebarKidsModeToggle.disabled = true;
                    sidebarKidsModeStatus.textContent = 'Aktif (Umur)';
                    sidebarKidsModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                    sidebarKidsModeStatus.classList.add('text-green-600', 'dark:text-green-400');
                }

                if (isKidsModeEnabled) {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSensorStatus.textContent = 'Aktif (Mode Anak)';
                    sidebarSensorStatus.classList.remove('text-red-600', 'dark:text-red-400');
                    sidebarSensorStatus.classList.add('text-green-600', 'dark:text-green-400');
                } else {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSensorStatus.textContent = 'Aktif';
                    sidebarSensorStatus.classList.toggle('text-green-600', true);
                    sidebarSensorStatus.classList.toggle('text-red-600', false);
                    sidebarSensorStatus.classList.toggle('dark:text-green-400', true);
                    sidebarSensorStatus.classList.toggle('dark:text-red-400', false);
                }
                sidebarSearchSensorToggle.disabled = true;
            }
            localStorage.setItem('isIncognitoModeEnabled', JSON.stringify(isIncognitoModeEnabled));
            localStorage.setItem('searchSensorEnabled', JSON.stringify(isSearchSensorEnabled));
            localStorage.setItem('lastSearchSensorStateBeforeIncognito', JSON.stringify(lastSearchSensorStateBeforeIncognito));
            localStorage.setItem('lastKidsModeStateBeforeIncognito', JSON.stringify(lastKidsModeStateBeforeIncognito));
            displaySearchHistory();
        }

        /**
         * Toggles Custom Search Engine feature on/off.
         */
        function toggleCustomSearch() {
            const sidebarCustomSearchToggle = document.getElementById('sidebarCustomSearchToggle');
            const sidebarCustomSearchStatus = document.getElementById('sidebarCustomSearchStatus');
            const customSearchControls = document.getElementById('customSearchControls');

            if (isSearchSaverEnabled) {
                sidebarCustomSearchToggle.checked = false;
                showAlert('Mesin Pencari Kustom otomatis nonaktif saat Penghemat Pencarian diaktifkan dan tidak dapat diubah.', 'Peringatan');
                return;
            }

            isCustomSearchEnabled = sidebarCustomSearchToggle.checked;

            if (isCustomSearchEnabled) {
                sidebarCustomSearchStatus.textContent = 'Aktif';
                sidebarCustomSearchStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarCustomSearchStatus.classList.add('text-green-600', 'dark:text-green-400');
                customSearchControls.classList.remove('hidden');
            } else {
                sidebarCustomSearchStatus.textContent = 'Nonaktif';
                sidebarCustomSearchStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarCustomSearchStatus.classList.add('text-red-600', 'dark:text-red-400');
                customSearchControls.classList.add('hidden');
                if (!defaultSearchEngines.hasOwnProperty(currentSearchEngine)) {
                    setSearchEngine('google');
                }
            }
            localStorage.setItem('isCustomSearchEnabled', JSON.stringify(isCustomSearchEnabled));
            loadCustomSearchEngines();
        }

        /**
         * Toggles Search Saver feature on/off.
         */
        function toggleSearchSaver() {
            const sidebarSearchSaverToggle = document.getElementById('sidebarSearchSaverToggle');
            const sidebarSearchSaverStatus = document.getElementById('sidebarSearchSaverStatus');
            const sidebarThemeToggle = document.getElementById('sidebarThemeToggle');
            const sidebarCustomSearchToggle = document.getElementById('sidebarCustomSearchToggle');
            const quickSearchSuggestionsSection = document.getElementById('quickSearchSuggestions');

            isSearchSaverEnabled = sidebarSearchSaverToggle.checked;

            if (isSearchSaverEnabled) {
                sidebarSearchSaverStatus.textContent = 'Aktif';
                sidebarSearchSaverStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarSearchSaverStatus.classList.add('text-green-600', 'dark:text-green-400');

                document.body.classList.add('dark-mode');
                sidebarThemeToggle.checked = true;
                sidebarThemeToggle.disabled = true;
                document.getElementById('sidebarThemeStatus').textContent = 'Aktif (Penghemat Pencarian)';
                document.getElementById('sidebarThemeStatus').classList.remove('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarThemeStatus').classList.add('text-green-600', 'dark:text-green-400');

                quickSearchSuggestionsSection.classList.add('hidden');
                updateQuickSearchSuggestions();

                isCustomSearchEnabled = false;
                sidebarCustomSearchToggle.checked = false;
                sidebarCustomSearchToggle.disabled = true;
                document.getElementById('sidebarCustomSearchStatus').textContent = 'Nonaktif (Penghemat Pencarian)';
                document.getElementById('sidebarCustomSearchStatus').classList.remove('text-green-600', 'dark:text-red-400');
                document.getElementById('sidebarCustomSearchStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('customSearchControls').classList.add('hidden');

                setSearchEngine('google');
                renderSearchEngineButtons();

            } else {
                sidebarSearchSaverStatus.textContent = 'Nonaktif';
                sidebarSearchSaverStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarSearchSaverStatus.classList.add('text-red-600', 'dark:text-red-400');

                sidebarThemeToggle.disabled = false;
                applySavedTheme();

                quickSearchSuggestionsSection.classList.remove('hidden');
                updateQuickSearchSuggestions();

                sidebarCustomSearchToggle.disabled = false;
                isCustomSearchEnabled = localStorage.getItem('isCustomSearchEnabled') === 'true';
                sidebarCustomSearchToggle.checked = isCustomSearchEnabled;
                document.getElementById('sidebarCustomSearchStatus').textContent = isCustomSearchEnabled ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarCustomSearchStatus').classList.toggle('text-green-600', isCustomSearchEnabled);
                document.getElementById('sidebarCustomSearchStatus').classList.toggle('text-red-600', !isCustomSearchEnabled);
                document.getElementById('sidebarCustomSearchStatus').classList.toggle('dark:text-green-400', isCustomSearchEnabled);
                document.getElementById('sidebarCustomSearchStatus').classList.toggle('dark:text-red-400', !isCustomSearchEnabled);
                document.getElementById('customSearchControls').classList.toggle('hidden', !isCustomSearchEnabled);
                loadCustomSearchEngines();

                renderSearchEngineButtons();
            }
            localStorage.setItem('isSearchSaverEnabled', JSON.stringify(isSearchSaverEnabled));
        }

        /**
         * Updates the placeholder text of the main search input.
         */
        function updateSearchInputPlaceholder() {
            const mainSearchInput = document.getElementById('mainSearchInput');
            if (isLearningModeEnabled) {
                mainSearchInput.placeholder = 'Mode Belajar Aktif';
            } else if (isDrawingModeEnabled) {
                mainSearchInput.placeholder = 'Mode Menggambar Aktif';
            } else if (isNoteModeEnabled) {
                mainSearchInput.placeholder = 'Mode Catatan Aktif';
            } else if (isWorldClockEnabled) {
                mainSearchInput.placeholder = 'Jam Dunia Aktif';
            } else if (isBackgroundSelectionMode) {
                mainSearchInput.placeholder = 'Mode Pilih Background Aktif';
            } else if (isGeminiSearchEnabled) {
                mainSearchInput.placeholder = 'Tanyakan sesuatu pada Gemini AI atau unggah gambar...';
            } else {
                mainSearchInput.placeholder = 'Masukkan kata kunci pencarian...';
            }
        }

        /**
         * Opens the background picker modal.
         */
        function openBackgroundPicker() {
            const modal = document.getElementById('backgroundPickerModal');
            const grid = document.getElementById('backgroundGrid');
            grid.innerHTML = '';

            backgrounds.forEach(bg => {
                const item = document.createElement('div');
                item.className = 'background-item';
                if (bg.value.includes('gradient')) {
                    item.style.backgroundImage = bg.value;
                    item.style.backgroundColor = '';
                } else {
                    item.style.backgroundColor = bg.value || '#ccc';
                    item.style.backgroundImage = '';
                }
                item.dataset.id = bg.id;
                item.dataset.value = bg.value;
                item.innerHTML = `<div class="background-item-label">${bg.name}</div>`;
                item.onclick = () => selectBackground(item);

                if (selectedBackground === bg.value) {
                    item.classList.add('selected');
                }
                grid.appendChild(item);
            });

            modal.classList.add('active');
        }

        /**
         * Selects a background in the picker modal.
         */
        function selectBackground(element) {
            document.querySelectorAll('.background-item').forEach(item => {
                item.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedBackground = element.dataset.value;
        }

        /**
         * Applies the selected background and closes the modal.
         */
        function applySelectedBackground() {
            applyBackground(selectedBackground);
            localStorage.setItem('selectedBackground', selectedBackground);
            closeBackgroundPicker();
        }

        /**
         * Applies the given background CSS value to the body.
         */
        function applyBackground(value) {
            const body = document.body;
            body.classList.remove('kids-mode-bg', 'learning-mode-bg');

            if (value) {
                if (value.includes('gradient')) {
                    body.style.backgroundImage = value;
                    body.style.backgroundColor = '';
                } else {
                    body.style.backgroundColor = value;
                    body.style.backgroundImage = '';
                }
            } else {
                body.style.backgroundImage = '';
                body.style.backgroundColor = body.classList.contains('dark-mode') ? '#1a202c' : '#f0f2f5';
            }

            if (!value && isKidsModeEnabled) {
                body.classList.add('kids-mode-bg');
            }
            if (isLearningModeEnabled) {
                body.classList.add('learning-mode-bg');
            }
        }

        /**
         * Closes the background picker modal.
         */
        function closeBackgroundPicker() {
            document.getElementById('backgroundPickerModal').classList.remove('active');
        }

        /**
         * Toggles the sidebar visibility.
         */
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        /**
         * Starts voice recognition.
         */
        function startVoiceSearch() {
            const mainSearchInput = document.getElementById('mainSearchInput');
            const voiceSearchBtn = document.getElementById('voiceSearchBtn');

            if (!('webkitSpeechRecognition' in window)) {
                showAlert('Maaf, browser Anda tidak mendukung fitur pengenalan suara. Silakan gunakan Google Chrome untuk fitur ini.', 'Browser Tidak Didukung');
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'id-ID';

            recognition.onstart = () => {
                voiceSearchBtn.classList.add('listening');
                mainSearchInput.placeholder = 'Mendengarkan...';
                mainSearchInput.value = '';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                mainSearchInput.value = transcript;
                updateSearchInputPlaceholder();
                voiceSearchBtn.classList.remove('listening');
                handleMainButtonAction();
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                updateSearchInputPlaceholder();
                voiceSearchBtn.classList.remove('listening');
                let errorMessage = 'Terjadi kesalahan pada pengenalan suara.';
                if (event.error === 'not-allowed') {
                    errorMessage = 'Akses mikrofon ditolak. Mohon izinkan akses mikrofon di pengaturan browser Anda.';
                } else if (event.error === 'no-speech') {
                    errorMessage = 'Tidak ada suara terdeteksi. Mohon coba lagi.';
                } else if (event.error === 'audio-capture') {
                    errorMessage = 'Tidak ada mikrofon ditemukan atau sedang digunakan.';
                }
                showAlert(errorMessage, 'Kesalahan Pengenalan Suara');
            };

            recognition.onend = () => {
                updateSearchInputPlaceholder();
                voiceSearchBtn.classList.remove('listening');
            };

            recognition.start();
        }

        /**
         * Saves a search query to local storage.
         */
        function saveSearchQuery(query) {
            if (query && !searchHistory.includes(query)) {
                searchHistory.unshift(query);
                if (searchHistory.length > 10) {
                    searchHistory.splice(10);
                }
                localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                displaySearchHistory();
            }
        }

        /**
         * Loads search history from local storage.
         */
        function loadSearchHistory() {
            const savedHistory = localStorage.getItem('searchHistory');
            if (savedHistory) {
                searchHistory = JSON.parse(savedHistory);
            } else {
                searchHistory = [];
            }
        }

        /**
         * Displays the search history in the sidebar.
         */
        function displaySearchHistory() {
            const historyList = document.getElementById('searchHistoryList');
            historyList.innerHTML = '';

            if (isIncognitoModeEnabled) {
                historyList.innerHTML = '<li class="text-gray-400 text-sm">Riwayat tidak tersedia dalam Mode Samaran.</li>';
                document.getElementById('clearHistoryBtn').disabled = true;
                return;
            } else {
                document.getElementById('clearHistoryBtn').disabled = false;
            }

            if (searchHistory.length === 0) {
                historyList.innerHTML = '<li class="text-gray-400 text-sm">Belum ada riwayat pencarian.</li>';
            } else {
                searchHistory.forEach(query => {
                    const listItem = document.createElement('li');
                    listItem.className = 'search-history-item';
                    listItem.innerHTML = `<span>${query}</span>`;
                    listItem.onclick = () => {
                        document.getElementById('mainSearchInput').value = query;
                        handleMainButtonAction();
                        toggleSidebar();
                    };
                    historyList.appendChild(listItem);
                });
            }
        }

        /**
         * Clears the search history.
         */
        async function clearSearchHistory() {
            const confirmed = await showConfirm('Apakah Anda yakin ingin menghapus semua riwayat pencarian?', 'Hapus Riwayat');
            if (confirmed) {
                searchHistory = [];
                localStorage.removeItem('searchHistory');
                displaySearchHistory();
                showAlert('Riwayat pencarian telah dihapus.', 'Berhasil');
            }
        }

        /**
         * Adds a custom search engine.
         */
        function addCustomSearchEngine() {
            if (!isCustomSearchEnabled) {
                showAlert('Harap aktifkan "Mesin Pencari Kustom" terlebih dahulu di pengaturan.', 'Fitur Dinonaktifkan');
                return;
            }
            if (isSearchSaverEnabled) {
                showAlert('Tidak dapat menambahkan mesin pencari kustom saat Penghemat Pencarian diaktifkan.', 'Fitur Dinonaktifkan');
                return;
            }

            const nameInput = document.getElementById('customEngineName');
            const urlInput = document.getElementById('customEngineUrl');
            const name = nameInput.value.trim();
            const url = urlInput.value.trim();

            if (!name || !url) {
                showAlert('Nama dan URL mesin pencari kustom tidak boleh kosong.', 'Peringatan');
                return;
            }

            try {
                new URL(url.replace('{query}', 'test'));
            } catch (_) {
                showAlert('Format URL tidak valid. Pastikan URL menyertakan "https://" dan "{query}" di tempat kueri pencarian akan ditempatkan (misalnya, "https://example.com/search?q={query}").', 'URL Tidak Valid');
                return;
            }

            if (!url.includes('{query}')) {
                showAlert('URL harus menyertakan "{query}" di tempat kueri pencarian akan ditempatkan (misalnya, "https://example.com/search?q={query}").', 'URL Tidak Lengkap');
                return;
            }

            const key = name.toLowerCase().replace(/\s/g, '');
            if (allSearchEngines[key]) {
                showAlert(`Mesin pencari dengan nama "${name}" sudah ada.`, 'Duplikat');
                return;
            }

            const customEngines = JSON.parse(localStorage.getItem('customSearchEngines') || '{}');
            customEngines[key] = { name: name, url: url, icon: 'âœ¨' };
            localStorage.setItem('customSearchEngines', JSON.stringify(customEngines));
            loadCustomSearchEngines();
            showAlert(`Mesin pencari "${name}" berhasil ditambahkan!`, 'Berhasil');

            nameInput.value = '';
            urlInput.value = '';
        }

        /**
         * Renders the list of custom search engines in the sidebar.
         */
        function renderCustomEnginesList() {
            const customEnginesListDiv = document.getElementById('customEnginesList');
            customEnginesListDiv.innerHTML = '';

            const storedCustomEngines = JSON.parse(localStorage.getItem('customSearchEngines') || '{}');
            const customKeys = Object.keys(storedCustomEngines);

            if (customKeys.length === 0) {
                customEnginesListDiv.innerHTML = '<p class="text-gray-400 text-sm">Belum ada mesin kustom.</p>';
                return;
            }

            customKeys.forEach(key => {
                const engine = storedCustomEngines[key];
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex items-center justify-between bg-gray-700 p-3 rounded-md';
                itemDiv.innerHTML = `
                    <span class="text-white text-sm">${engine.name}</span>
                    <button onclick="removeCustomSearchEngine('${key}')" class="text-red-400 hover:text-red-600 text-sm ml-2">Hapus</button>
                `;
                customEnginesListDiv.appendChild(itemDiv);
            });
        }

        /**
         * Removes a custom search engine.
         */
        async function removeCustomSearchEngine(key) {
            if (!isCustomSearchEnabled) {
                showAlert('Harap aktifkan "Mesin Pencari Kustom" terlebih dahulu di pengaturan.', 'Fitur Dinonaktifkan');
                return;
            }
            if (isSearchSaverEnabled) {
                showAlert('Tidak dapat menghapus mesin pencari kustom saat Penghemat Pencarian diaktifkan.', 'Fitur Dinonaktifkan');
                return;
            }

            const confirmed = await showConfirm(`Apakah Anda yakin ingin menghapus mesin pencari kustom "${allSearchEngines[key].name}"?`, 'Hapus Mesin Kustom');
            if (confirmed) {
                const customEngines = JSON.parse(localStorage.getItem('customSearchEngines') || '{}');
                delete customEngines[key];
                localStorage.setItem('customSearchEngines', JSON.stringify(customEngines));
                loadCustomSearchEngines();
                if (currentSearchEngine === key) {
                    setSearchEngine('google');
                }
                showAlert(`Mesin pencari "${allSearchEngines[key].name}" berhasil dihapus.`, 'Berhasil');
            }
        }

        /**
         * Applies Kids Mode based on user's age.
         */
        function applyKidsModeBasedOnAge() {
            const sidebarKidsModeToggle = document.getElementById('sidebarKidsModeToggle');
            const sidebarKidsModeStatus = document.getElementById('sidebarKidsModeStatus');
            const sidebarSearchSensorToggle = document.getElementById('sidebarSearchSensorToggle');
            const sidebarSensorStatus = document.getElementById('sidebarSensorStatus');

            if (loggedInUser && loggedInUser.age < 15) {
                isKidsModeForcedByAge = true;
                isKidsModeEnabled = true;
                sidebarKidsModeToggle.checked = true;
                sidebarKidsModeToggle.disabled = true;
                sidebarKidsModeStatus.textContent = 'Aktif (Umur)';
                sidebarKidsModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarKidsModeStatus.classList.add('text-green-600', 'dark:text-green-400');

                isSearchSensorEnabled = true;
                sidebarSearchSensorToggle.checked = true;
                sidebarSearchSensorToggle.disabled = true;
                sidebarSensorStatus.textContent = 'Aktif (Mode Anak)';
                sidebarSensorStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarSensorStatus.classList.add('text-green-600', 'dark:text-green-400');

            } else {
                isKidsModeForcedByAge = false;
                isKidsModeEnabled = localStorage.getItem('isKidsModeEnabled') === 'true';
                sidebarKidsModeToggle.checked = isKidsModeEnabled;
                sidebarKidsModeToggle.disabled = false;
                sidebarKidsModeStatus.textContent = isKidsModeEnabled ? 'Aktif' : 'Nonaktif';
                sidebarKidsModeStatus.classList.toggle('text-green-600', isKidsModeEnabled);
                sidebarKidsModeStatus.classList.toggle('text-red-600', !isKidsModeEnabled);
                sidebarKidsModeStatus.classList.toggle('dark:text-green-400', isKidsModeEnabled);
                sidebarKidsModeStatus.classList.toggle('dark:text-red-400', !isKidsModeEnabled);

                if (isKidsModeEnabled) {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSearchSensorToggle.disabled = true;
                    sidebarSensorStatus.textContent = 'Aktif (Mode Anak)';
                    sidebarSensorStatus.classList.remove('text-red-600', 'dark:text-red-400');
                    sidebarSensorStatus.classList.add('text-green-600', 'dark:text-green-400');
                } else {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSensorStatus.textContent = 'Aktif';
                    sidebarSensorStatus.classList.toggle('text-green-600', true);
                    sidebarSensorStatus.classList.toggle('text-red-600', false);
                    sidebarSensorStatus.classList.toggle('dark:text-green-400', true);
                    sidebarSensorStatus.classList.toggle('dark:text-red-400', false);
                }
            }
            localStorage.setItem('isKidsModeForcedByAge', JSON.stringify(isKidsModeForcedByAge));
            localStorage.setItem('isKidsModeEnabled', JSON.stringify(isKidsModeEnabled));
            localStorage.setItem('searchSensorEnabled', JSON.stringify(isSearchSensorEnabled));
        }

        /**
         * Handles image file upload.
         */
        async function handleImageUpload(event) {
            const file = event.target.files[0];
            const visualSearchBtn = document.getElementById('visualSearchBtn');
            const visualButtonText = document.getElementById('visualButtonText');
            const previewContainer = document.getElementById('uploadedImagePreviewContainer');
            const previewImage = document.getElementById('uploadedImagePreview');

            if (file) {
                if (file.size > 2 * 1024 * 1024) {
                    showAlert('Ukuran gambar terlalu besar. Maksimal 2MB.', 'Ukuran File');
                    clearUploadedImage();
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImageBase64 = e.target.result.split(',')[1];
                    previewImage.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                    visualSearchBtn.disabled = false;
                    visualSearchBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    visualButtonText.textContent = 'Pencarian Visual';
                    showAlert('Gambar berhasil diunggah. Klik "Pencarian Visual" untuk mencari.', 'Gambar Terunggah');
                };
                reader.onerror = (error) => {
                    console.error("Error reading file:", error);
                    showAlert('Gagal membaca file gambar.', 'Kesalahan File');
                    clearUploadedImage();
                };
                reader.readAsDataURL(file);
            } else {
                clearUploadedImage();
            }
        }

        /**
         * Clears the uploaded image.
         */
        function clearUploadedImage() {
            uploadedImageBase64 = null;
            document.getElementById('imageUploadInput').value = '';
            document.getElementById('uploadedImagePreviewContainer').classList.add('hidden');
            document.getElementById('uploadedImagePreview').src = '';
            const visualSearchBtn = document.getElementById('visualSearchBtn');
            visualSearchBtn.disabled = true;
            visualSearchBtn.classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('visualButtonText').textContent = 'Pencarian Visual';
        }

        /**
         * Handles the visual search.
         */
        async function handleVisualSearch() {
            if (!uploadedImageBase64) {
                showAlert('Silakan unggah gambar terlebih dahulu untuk pencarian visual.', 'Peringatan');
                return;
            }

            if (!geminiModel) {
                showAlert("Gemini API tidak diinisialisasi. Periksa konsol untuk detail.", "Kesalahan Gemini");
                return;
            }

            showLoading(true);
            clearSearchIntentDisplay();

            const resultsContainer = document.getElementById('resultsContainer');
            const searchResultsSection = document.getElementById('searchResults');
            resultsContainer.innerHTML = '';

            try {
                const prompt = "Jelaskan apa yang Anda lihat di gambar ini secara detail dan berikan informasi relevan terkait objek atau adegan yang terdeteksi. Format sebagai teks biasa, tanpa markdown judul atau daftar.";

                const payload = {
                    contents: [
                        {
                            role: "user",
                            parts: [
                                { text: prompt },
                                {
                                    inlineData: {
                                        mimeType: "image/jpeg",
                                        data: uploadedImageBase64
                                    }
                                }
                            ]
                        }
                    ],
                };
                const apiKey = API_KEY;
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const geminiText = result.candidates[0].content.parts[0].text;

                    resultsContainer.innerHTML = `
                        <div class="gemini-result-card">
                            <h4 class="text-xl font-semibold mb-3">Hasil Pencarian Visual dari Gemini AI</h4>
                            <p>${geminiText}</p>
                        </div>
                    `;
                    searchResultsSection.classList.remove('hidden');
                    searchResultsSection.scrollIntoView({ behavior: 'smooth' });

                    if (!isIncognitoModeEnabled) {
                        saveSearchQuery("Pencarian Visual: " + prompt.substring(0, 50) + "...");
                    }
                    clearUploadedImage();

                } else {
                    showAlert("Tidak dapat menghasilkan respons dari Gemini untuk gambar ini. Coba lagi.", "Kesalahan Pencarian Visual");
                    console.error("Struktur respons Gemini API tidak terduga untuk visual search:", result);
                }
            } catch (error) {
                console.error("Kesalahan saat memanggil Gemini API untuk visual search:", error);
                showAlert(`Terjadi kesalahan saat menghubungi Gemini API untuk pencarian visual: ${error.message}`, "Kesalahan API");
            } finally {
                showLoading(false);
            }
        }

        /**
         * Generates an image using the Gemini API.
         */
        async function generateImage() {
            const promptInput = document.getElementById('imagePromptInput');
            const imageDisplay = document.getElementById('generatedImageDisplay');
            const prompt = promptInput.value.trim();

            if (!prompt) {
                showAlert('Silakan masukkan deskripsi gambar yang ingin Anda buat.', 'Peringatan');
                return;
            }

            showLoadingImageGeneration(true);
            imageDisplay.src = "https://placehold.co/400x300/e0e0e0/000000?text=Membuat+Gambar...";

            try {
                const payload = { instances: { prompt: prompt }, parameters: { "sampleCount": 1} };
                const apiKey = API_KEY;
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    imageDisplay.src = imageUrl;
                } else if (result.error && result.error.code === 400 && result.error.message.includes("Imagen API is only accessible to billed users")) {
                    showAlert("Pembuatan gambar AI memerlukan akun Google Cloud yang ditagih. Silakan aktifkan penagihan di konsol Google Cloud Anda.", "Akses Ditolak");
                    imageDisplay.src = "https://placehold.co/400x300/e0e0e0/000000?text=Akses+Ditolak";
                }
                else {
                    showAlert("Tidak dapat menghasilkan gambar dari AI. Coba deskripsi lain.", "Kesalahan Pembuatan Gambar");
                    imageDisplay.src = "https://placehold.co/400x300/e0e0e0/000000?text=Gagal+Membuat+Gambar";
                    console.error("Struktur respons Imagen API tidak terduga:", result);
                }
            } catch (error) {
                console.error("Kesalahan saat memanggil Imagen API:", error);
                showAlert(`Terjadi kesalahan saat menghubungi AI untuk membuat gambar: ${error.message}`, "Kesalahan API");
                imageDisplay.src = "https://placehold.co/400x300/e0e0e0/000000?text=Gagal+Membuat+Gambar";
            } finally {
                showLoadingImageGeneration(false);
            }
        }

        /**
         * Shows/hides the loading spinner for image generation.
         */
        function showLoadingImageGeneration(isLoading) {
            const button = document.getElementById('generateImageBtn');
            const buttonText = document.getElementById('generateImageBtnText');
            const spinner = document.getElementById('imageGenerationSpinner');
            const promptInput = document.getElementById('imagePromptInput');

            if (isLoading) {
                buttonText.textContent = 'Menghasilkan...';
                spinner.classList.remove('hidden');
                button.disabled = true;
                promptInput.disabled = true;
            } else {
                buttonText.textContent = 'Hasilkan Gambar';
                spinner.classList.add('hidden');
                button.disabled = false;
                promptInput.disabled = false;
            }
        }

        /**
         * Displays the current history content.
         */
        function displayHistoryContent() {
            const historyContentDiv = document.getElementById('historyContent');
            const currentHistory = indonesiaHistory[currentHistoryIndex];
            historyContentDiv.innerHTML = `
                <h4 class="text-xl font-semibold mb-2">${currentHistory.title}</h4>
                <p>${currentHistory.content}</p>
            `;
            document.getElementById('nextHistoryBtn').textContent =
                currentHistoryIndex < indonesiaHistory.length - 1 ? 'Baca Sejarah Selanjutnya' : 'Kembali ke Awal Sejarah';
        }

        /**
         * Advances to the next history topic.
         */
        function nextHistoryTopic() {
            currentHistoryIndex = (currentHistoryIndex + 1) % indonesiaHistory.length;
            displayHistoryContent();
        }

        /**
         * Generates a new basic math problem.
         */
        function generateMathProblem() {
            const mathProblemElement = document.getElementById('mathProblem');
            const mathAnswerInput = document.getElementById('mathAnswerInput');
            const mathResultElement = document.getElementById('mathResult');

            mathAnswerInput.value = '';
            mathResultElement.textContent = '';
            mathResultElement.classList.remove('text-green-500', 'text-red-500');

            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            const operationType = Math.floor(Math.random() * 3);

            let problemText = '';
            let correctAnswer;

            switch (operationType) {
                case 0:
                    problemText = `${num1} + ${num2} = ?`;
                    correctAnswer = num1 + num2;
                    break;
                case 1:
                    problemText = `${num1} Ã— ${num2} = ?`;
                    correctAnswer = num1 * num2;
                    break;
                case 2:
                    let dividend, divisor;
                    do {
                        divisor = Math.floor(Math.random() * 9) + 2;
                        dividend = divisor * (Math.floor(Math.random() * 9) + 1);
                    } while (dividend === 0);
                    problemText = `${dividend} Ã· ${divisor} = ?`;
                    correctAnswer = dividend / divisor;
                    break;
            }

            mathProblemElement.textContent = problemText;
            mathProblemElement.dataset.correctAnswer = correctAnswer;
        }

        /**
         * Checks the user's answer to the math problem.
         */
        function checkMathAnswer() {
            const mathAnswerInput = document.getElementById('mathAnswerInput');
            const mathResultElement = document.getElementById('mathResult');
            const userAnswer = parseInt(mathAnswerInput.value);
            const correctAnswer = parseInt(document.getElementById('mathProblem').dataset.correctAnswer);

            if (isNaN(userAnswer)) {
                mathResultElement.textContent = 'Silakan masukkan jawaban angka.';
                mathResultElement.classList.remove('text-green-500');
                mathResultElement.classList.add('text-red-500');
                return;
            }

            if (userAnswer === correctAnswer) {
                mathResultElement.textContent = 'Jawaban Benar! ðŸŽ‰';
                mathResultElement.classList.remove('text-red-500');
                mathResultElement.classList.add('text-green-500');
            } else {
                mathResultElement.textContent = `Jawaban Salah. Coba lagi! Jawaban yang benar adalah ${correctAnswer}.`;
                mathResultElement.classList.remove('text-green-500');
                mathResultElement.classList.add('text-red-500');
            }
        }

        /**
         * Displays the current history quiz question.
         */
        function displayHistoryQuestion() {
            const historyQuestionContentDiv = document.getElementById('historyQuestionContent');
            const historyAnswerInput = document.getElementById('historyAnswerInput');
            const historyQuizResult = document.getElementById('historyQuizResult');

            historyAnswerInput.value = '';
            historyQuizResult.textContent = '';
            historyQuizResult.classList.remove('text-green-500', 'text-red-500');

            const currentQuestion = indonesiaHistoryQuestions[currentHistoryQuestionIndex];
            historyQuestionContentDiv.innerHTML = `<p>${currentQuestion.question}</p>`;
            historyQuestionContentDiv.dataset.correctAnswer = currentQuestion.answer.toLowerCase();
        }

        /**
         * Checks the user's answer to the history quiz question.
         */
        function checkHistoryAnswer() {
            const historyAnswerInput = document.getElementById('historyAnswerInput');
            const historyQuizResult = document.getElementById('historyQuizResult');
            const userAnswer = historyAnswerInput.value.trim().toLowerCase();
            const correctAnswer = document.getElementById('historyQuestionContent').dataset.correctAnswer;

            if (!userAnswer) {
                historyQuizResult.textContent = 'Silakan masukkan jawaban Anda.';
                historyQuizResult.classList.remove('text-green-500');
                historyQuizResult.classList.add('text-red-500');
                return;
            }

            if (userAnswer === correctAnswer) {
                historyQuizResult.textContent = 'Jawaban Benar! ðŸŽ‰';
                historyQuizResult.classList.remove('text-red-500');
                historyQuizResult.classList.add('text-green-500');
            } else {
                historyQuizResult.textContent = `Jawaban Salah. Coba lagi! Jawaban yang benar adalah "${correctAnswer}".`;
                historyQuizResult.classList.remove('text-green-500');
                historyQuizResult.classList.add('text-red-500');
            }
        }

        /**
         * Advances to the next history quiz question.
         */
        function nextHistoryQuestion() {
            currentHistoryQuestionIndex = (currentHistoryQuestionIndex + 1) % indonesiaHistoryQuestions.length;
            displayHistoryQuestion();
        }

        /**
         * Creates and animates a particle.
         */
        function createParticle(x, y) {
            if (!isParticleEffectEnabled || selectedParticles.length === 0) {
                return;
            }

            const particleContainer = document.getElementById('particle-container');
            const particle = document.createElement('span');
            particle.className = 'particle';
            const randomEmoji = selectedParticles[Math.floor(Math.random() * selectedParticles.length)];
            particle.textContent = randomEmoji;
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;

            particleContainer.appendChild(particle);

            particle.addEventListener('animationend', () => {
                particle.remove();
            });
        }

        /**
         * Handles click and touch events to create particles.
         */
        function handleParticleEffect(event) {
            let clientX, clientY;

            if (event.type === 'touchstart') {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            createParticle(clientX, clientY);
        }

        /**
         * Toggles the particle effect on/off.
         */
        function toggleParticleEffect() {
            const sidebarParticleEffectToggle = document.getElementById('sidebarParticleEffectToggle');
            const sidebarParticleEffectStatus = document.getElementById('sidebarParticleEffectStatus');
            const openParticlePickerBtn = document.getElementById('openParticlePickerBtn');

            isParticleEffectEnabled = sidebarParticleEffectToggle.checked;

            if (isParticleEffectEnabled) {
                sidebarParticleEffectStatus.textContent = 'Aktif';
                sidebarParticleEffectStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarParticleEffectStatus.classList.add('text-green-600', 'dark:text-green-400');
                openParticlePickerBtn.disabled = false;
                document.body.addEventListener('click', handleParticleEffect);
                document.body.addEventListener('touchstart', handleParticleEffect);
            } else {
                sidebarParticleEffectStatus.textContent = 'Nonaktif';
                sidebarParticleEffectStatus.classList.remove('text-green-600', 'dark:text-red-400');
                sidebarParticleEffectStatus.classList.add('text-red-600', 'dark:text-red-400');
                openParticlePickerBtn.disabled = true;
                document.body.removeEventListener('click', handleParticleEffect);
                document.body.removeEventListener('touchstart', handleParticleEffect);
            }
            localStorage.setItem('isParticleEffectEnabled', JSON.stringify(isParticleEffectEnabled));
        }

        /**
         * Opens the particle picker modal.
         */
        function openParticlePicker() {
            const modal = document.getElementById('particlePickerModal');
            const grid = document.getElementById('particleGrid');
            grid.innerHTML = '';

            tempSelectedParticles = [...selectedParticles];

            allAvailableParticles.forEach(emoji => {
                const item = document.createElement('div');
                item.className = 'particle-item';
                item.textContent = emoji;
                item.dataset.emoji = emoji;

                if (tempSelectedParticles.includes(emoji)) {
                    item.classList.add('selected');
                }
                item.onclick = () => toggleParticleSelection(emoji, item);
                grid.appendChild(item);
            });

            modal.classList.add('active');
        }

        /**
         * Toggles the selection of a particle.
         */
        function toggleParticleSelection(emoji, element) {
            const index = tempSelectedParticles.indexOf(emoji);
            if (index > -1) {
                tempSelectedParticles.splice(index, 1);
                element.classList.remove('selected');
            } else {
                tempSelectedParticles.push(emoji);
                element.classList.add('selected');
            }
        }

        /**
         * Applies the selected particles.
         */
        function applySelectedParticles() {
            if (tempSelectedParticles.length === 0) {
                showAlert('Anda harus memilih setidaknya satu partikel.', 'Peringatan');
                return;
            }
            selectedParticles = [...tempSelectedParticles];
            localStorage.setItem('selectedParticles', JSON.stringify(selectedParticles));
            closeParticlePicker();
            showAlert('Partikel berhasil diperbarui!', 'Berhasil');
        }

        /**
         * Closes the particle picker modal.
         */
        function closeParticlePicker() {
            document.getElementById('particlePickerModal').classList.remove('active');
        }

        /**
         * Toggles Note Mode on/off.
         */
        function toggleNoteMode() {
            const sidebarNoteModeToggle = document.getElementById('sidebarNoteModeToggle');
            const sidebarNoteModeStatus = document.getElementById('sidebarNoteModeStatus');
            const noteModeSection = document.getElementById('noteModeSection');
            const easySearchSection = document.getElementById('easySearchSection');
            const imageGenerationSection = document.getElementById('imageGenerationSection');

            isNoteModeEnabled = sidebarNoteModeToggle.checked;

            if (isNoteModeEnabled) {
                sidebarNoteModeStatus.textContent = 'Aktif';
                sidebarNoteModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarNoteModeStatus.classList.add('text-green-600', 'dark:text-green-400');

                easySearchSection.classList.add('hidden');
                imageGenerationSection.classList.add('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.getElementById('worldClockSection').classList.add('hidden');
                document.getElementById('drawingModeSection').classList.add('hidden');
                document.getElementById('calculatorSection').classList.add('hidden');
                document.getElementById('weatherSection').classList.add('hidden');
                document.getElementById('prayerTimeSection').classList.add('hidden');
                document.getElementById('hijriSection').classList.add('hidden');
                noteModeSection.classList.remove('hidden');

                loadSavedNote();
            } else {
                sidebarNoteModeStatus.textContent = 'Nonaktif';
                sidebarNoteModeStatus.classList.remove('text-green-600', 'dark:text-green-400');
                sidebarNoteModeStatus.classList.add('text-red-600', 'dark:text-red-400');

                easySearchSection.classList.remove('hidden');
                imageGenerationSection.classList.remove('hidden');
                noteModeSection.classList.add('hidden');
            }

            localStorage.setItem('isNoteModeEnabled', JSON.stringify(isNoteModeEnabled));
            updateSearchInputPlaceholder();
            showLoading(false);
        }

        /**
         * Toggles World Clock on/off.
         */
        function toggleWorldClock() {
            const sidebarWorldClockToggle = document.getElementById('sidebarWorldClockToggle');
            const sidebarWorldClockStatus = document.getElementById('sidebarWorldClockStatus');
            const worldClockSection = document.getElementById('worldClockSection');
            const easySearchSection = document.getElementById('easySearchSection');
            const imageGenerationSection = document.getElementById('imageGenerationSection');

            isWorldClockEnabled = sidebarWorldClockToggle.checked;

            if (isWorldClockEnabled) {
                sidebarWorldClockStatus.textContent = 'Aktif';
                sidebarWorldClockStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarWorldClockStatus.classList.add('text-green-600', 'dark:text-green-400');

                easySearchSection.classList.add('hidden');
                imageGenerationSection.classList.add('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.getElementById('noteModeSection').classList.add('hidden');
                document.getElementById('drawingModeSection').classList.add('hidden');
                document.getElementById('calculatorSection').classList.add('hidden');
                document.getElementById('weatherSection').classList.add('hidden');
                document.getElementById('prayerTimeSection').classList.add('hidden');
                document.getElementById('hijriSection').classList.add('hidden');
                worldClockSection.classList.remove('hidden');

                startWorldClock();
            } else {
                sidebarWorldClockStatus.textContent = 'Nonaktif';
                sidebarWorldClockStatus.classList.remove('text-green-600', 'dark:text-green-400');
                sidebarWorldClockStatus.classList.add('text-red-600', 'dark:text-red-400');

                easySearchSection.classList.remove('hidden');
                imageGenerationSection.classList.remove('hidden');
                worldClockSection.classList.add('hidden');

                stopWorldClock();
            }

            localStorage.setItem('isWorldClockEnabled', JSON.stringify(isWorldClockEnabled));
            updateSearchInputPlaceholder();
            showLoading(false);
        }

        /**
         * Updates word count for note textarea.
         */
        function updateWordCount() {
            const noteTextarea = document.getElementById('noteTextarea');
            const wordCountSpan = document.getElementById('wordCount');
            const text = noteTextarea.value.trim();
            const words = text === '' ? 0 : text.split(/\s+/).length;

            wordCountSpan.textContent = `${words}/649 kata`;

            if (words > 649) {
                wordCountSpan.classList.add('text-red-600');
                wordCountSpan.classList.remove('text-gray-600');
                const wordArray = text.split(/\s+/);
                const truncatedText = wordArray.slice(0, 649).join(' ');
                noteTextarea.value = truncatedText;
                showAlert('Batas maksimal 649 kata telah tercapai!', 'Batas Kata');
            } else {
                wordCountSpan.classList.remove('text-red-600');
                wordCountSpan.classList.add('text-gray-600', 'dark:text-gray-400');
            }
        }

        /**
         * Saves the note to localStorage.
         */
        function saveNote() {
            const noteTextarea = document.getElementById('noteTextarea');
            const noteText = noteTextarea.value.trim();

            localStorage.setItem('savedNote', noteText);
            showAlert('Catatan berhasil disimpan!', 'Berhasil');
        }

        /**
         * Loads saved note from localStorage.
         */
        function loadSavedNote() {
            const savedNote = localStorage.getItem('savedNote');
            const noteTextarea = document.getElementById('noteTextarea');

            if (savedNote) {
                noteTextarea.value = savedNote;
                updateWordCount();
            }
        }

        /**
         * Clears the note.
         */
        async function clearNote() {
            const confirmed = await showConfirm('Apakah Anda yakin ingin menghapus semua catatan?', 'Hapus Catatan');
            if (confirmed) {
                document.getElementById('noteTextarea').value = '';
                updateWordCount();
                localStorage.removeItem('savedNote');
                showAlert('Catatan berhasil dihapus!', 'Berhasil');
            }
        }

        /**
         * Starts the world clock updates.
         */
        function startWorldClock() {
            updateWorldClock();
            worldClockInterval = setInterval(updateWorldClock, 1000);
        }

        /**
         * Stops the world clock updates.
         */
        function stopWorldClock() {
            if (worldClockInterval) {
                clearInterval(worldClockInterval);
                worldClockInterval = null;
            }
        }

        /**
         * Updates all world clocks.
         */
        function updateWorldClock() {
            const now = new Date();

            const jakartaTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Jakarta"}));
            document.getElementById('jakartaTime').textContent = jakartaTime.toLocaleTimeString('id-ID', {hour12: false});
            document.getElementById('jakartaDate').textContent = jakartaTime.toLocaleDateString('id-ID');

            const londonTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/London"}));
            document.getElementById('londonTime').textContent = londonTime.toLocaleTimeString('en-GB', {hour12: false});
            document.getElementById('londonDate').textContent = londonTime.toLocaleDateString('en-GB');

            const newYorkTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            document.getElementById('newYorkTime').textContent = newYorkTime.toLocaleTimeString('en-US', {hour12: false});
            document.getElementById('newYorkDate').textContent = newYorkTime.toLocaleDateString('en-US');

            const tokyoTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Tokyo"}));
            document.getElementById('tokyoTime').textContent = tokyoTime.toLocaleTimeString('ja-JP', {hour12: false});
            document.getElementById('tokyoDate').textContent = tokyoTime.toLocaleDateString('ja-JP');

            const dubaiTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Dubai"}));
            document.getElementById('dubaiTime').textContent = dubaiTime.toLocaleTimeString('ar-AE', {hour12: false});
            document.getElementById('dubaiDate').textContent = dubaiTime.toLocaleDateString('ar-AE');

            const sydneyTime = new Date(now.toLocaleString("en-US", {timeZone: "Australia/Sydney"}));
            document.getElementById('sydneyTime').textContent = sydneyTime.toLocaleTimeString('en-AU', {hour12: false});
            document.getElementById('sydneyDate').textContent = sydneyTime.toLocaleDateString('en-AU');
        }

        /**
         * Calculator functions
         */
        let display = null;
        let currentInput = '0';
        let result = null;
        let operatorPressed = false;
        let equalsPressed = false;

        function updateDisplay() {
            if (display) display.textContent = currentInput;
        }

        function appendCharacter(char) {
            if (equalsPressed && !['+', '-', '*', '/'].includes(char)) {
                currentInput = '0';
                equalsPressed = false;
            }
            if (currentInput === '0' || operatorPressed) {
                currentInput = char;
                operatorPressed = false;
            } else {
                if (['+', '-', '*', '/'].includes(char) && ['+', '-', '*', '/'].includes(currentInput.slice(-1))) {
                    currentInput = currentInput.slice(0, -1) + char;
                } else {
                    currentInput += char;
                }
            }
            updateDisplay();
        }

        function calculateResult() {
            try {
                result = Function('"use strict";return (' + currentInput + ')')();
                currentInput = result.toString();
                equalsPressed = true;
                updateDisplay();
            } catch (e) {
                currentInput = 'Error';
                updateDisplay();
            }
        }

        function clearDisplay() {
            currentInput = '0';
            result = null;
            operatorPressed = false;
            equalsPressed = false;
            updateDisplay();
        }

        /**
         * Weather function
         */
        async function getWeather() {
            const city = document.getElementById('weatherCity').value;
            const resultEl = document.getElementById('weatherResult');
            resultEl.innerHTML = '';
            if (!city) return;

            try {
                const res = await fetch(`https://wttr.in/${city}?format=j1`);
                const data = await res.json();
                const forecast = data.weather.slice(0, 7);

                forecast.forEach(day => {
                    const date = day.date;
                    const avgTemp = day.avgtempC;
                    const desc = day.hourly[4].weatherDesc[0].value;
                    const icon = day.hourly[4].weatherIconUrl[0].value;

                    const card = document.createElement('div');
                    card.className = "bg-white dark:bg-gray-700 rounded-lg shadow-md p-4";
                    card.innerHTML = `
                        <h3 class="text-lg font-semibold mb-2">${date}</h3>
                        <img src="${icon}" alt="icon" class="w-12 h-12 mx-auto mb-2">
                        <p class="text-sm text-gray-600 dark:text-gray-300">${desc}</p>
                        <p class="text-xl font-bold text-blue-600 dark:text-blue-300">${avgTemp}Â°C</p>
                    `;
                    resultEl.appendChild(card);
                });
            } catch (error) {
                resultEl.innerHTML = '<p class="text-red-500">Gagal mengambil data cuaca.</p>';
            }
        }

        /**
         * Prayer times function
         */
        function getPrayerTimes() {
            const city = document.getElementById('prayerCity').value;
            if (!city) return alert("Masukkan nama kota terlebih dahulu.");
            fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Indonesia&method=2`)
                .then(response => response.json())
                .then(data => {
                    const timings = data.data.timings;
                    const container = document.getElementById("prayerTimeResult");
                    container.innerHTML = `
                        <div><strong>Subuh:</strong> ${timings.Fajr}</div>
                        <div><strong>Dzuhur:</strong> ${timings.Dhuhr}</div>
                        <div><strong>Ashar:</strong> ${timings.Asr}</div>
                        <div><strong>Maghrib:</strong> ${timings.Maghrib}</div>
                        <div><strong>Isya:</strong> ${timings.Isha}</div>
                    `;
                })
                .catch(err => {
                    console.error(err);
                    alert("Gagal mengambil data. Pastikan nama kota benar.");
                });
        }

        /**
         * Load Hijri date
         */
        async function loadHijriDate() {
            const today = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('todayGregorian').innerText = `Tanggal Masehi: ${today}`;
            const res = await fetch(`https://api.aladhan.com/v1/gToH?date=${new Date().getDate()}-${new Date().getMonth() + 1}-${new Date().getFullYear()}`);
            const data = await res.json();
            document.getElementById('todayHijri').innerText = `Tanggal Hijriyah: ${data.data.hijri.date}`;
        }

        /**
         * Toggles Auto Night Mode based on time
         */
        function toggleAutoNightMode() {
            const toggle = document.getElementById('sidebarAutoNightModeToggle');
            const status = document.getElementById('sidebarAutoNightModeStatus');

            isAutoNightModeEnabled = toggle.checked;

            if (isAutoNightModeEnabled) {
                status.textContent = 'Aktif';
                status.classList.remove('text-red-600', 'dark:text-red-400');
                status.classList.add('text-green-600', 'dark:text-green-400');

                // Check time every minute
                nightModeCheckInterval = setInterval(checkTimeForNightMode, 60000);
                checkTimeForNightMode(); // Check immediately

                if (isSoundEffectsEnabled) playSound('success');
            } else {
                status.textContent = 'Nonaktif';
                status.classList.remove('text-green-600', 'dark:text-green-400');
                status.classList.add('text-red-600', 'dark:text-red-400');

                if (nightModeCheckInterval) {
                    clearInterval(nightModeCheckInterval);
                    nightModeCheckInterval = null;
                }
            }

            localStorage.setItem('isAutoNightModeEnabled', JSON.stringify(isAutoNightModeEnabled));
        }

        function checkTimeForNightMode() {
            const hour = new Date().getHours();
            const shouldBeNight = hour >= 18 || hour <= 6; // 6 PM to 6 AM

            if (shouldBeNight && !document.body.classList.contains('dark-mode')) {
                document.getElementById('sidebarThemeToggle').checked = true;
                toggleTheme();
                showAlert('Mode malam diaktifkan secara otomatis (18:00-06:00)', 'Mode Malam Otomatis');
            } else if (!shouldBeNight && document.body.classList.contains('dark-mode') && isAutoNightModeEnabled) {
                document.getElementById('sidebarThemeToggle').checked = false;
                toggleTheme();
                showAlert('Mode terang diaktifkan secara otomatis (06:00-18:00)', 'Mode Malam Otomatis');
            }
        }

        /**
         * Toggles Reminder feature
         */
        function toggleReminder() {
            const toggle = document.getElementById('sidebarReminderToggle');
            const status = document.getElementById('sidebarReminderStatus');

            isReminderEnabled = toggle.checked;

            if (isReminderEnabled) {
                status.textContent = 'Aktif';
                status.classList.remove('text-red-600', 'dark:text-red-400');
                status.classList.add('text-green-600', 'dark:text-green-400');

                // Set reminder every 30 minutes
                reminderInterval = setInterval(() => {
                    const reminders = [
                        'ðŸ’§ Jangan lupa minum air!',
                        'ðŸ‘€ Istirahatkan mata Anda sejenak',
                        'ðŸ§˜ Ambil napas dalam-dalam',
                        'ðŸš¶ Berdiri dan bergerak sedikit',
                        'ðŸ˜Š Tetap positif dan semangat!'
                    ];
                    const randomReminder = reminders[Math.floor(Math.random() * reminders.length)];
                    showAlert(randomReminder, 'Pengingat Kesehatan');
                    if (isSoundEffectsEnabled) playSound('notification');
                }, 30 * 60 * 1000); // 30 minutes

                if (isSoundEffectsEnabled) playSound('success');
            } else {
                status.textContent = 'Nonaktif';
                status.classList.remove('text-green-600', 'dark:text-green-400');
                status.classList.add('text-red-600', 'dark:text-red-400');

                if (reminderInterval) {
                    clearInterval(reminderInterval);
                    reminderInterval = null;
                }
            }

            localStorage.setItem('isReminderEnabled', JSON.stringify(isReminderEnabled));
        }

        /**
         * Toggles Zen Mode
         */
        function toggleZenMode() {
            const toggle = document.getElementById('sidebarZenModeToggle');
            const status = document.getElementById('sidebarZenModeStatus');

            isZenModeEnabled = toggle.checked;

            if (isZenModeEnabled) {
                status.textContent = 'Aktif';
                status.classList.remove('text-red-600', 'dark:text-red-400');
                status.classList.add('text-green-600', 'dark:text-green-400');

                document.body.classList.add('zen-mode');
                showAlert('ðŸ§˜ Mode Zen aktif. Klik tombol di pojok kanan atas untuk keluar dari Mode Zen.', 'Mode Zen');
                if (isSoundEffectsEnabled) playSound('zen');
            } else {
                status.textContent = 'Nonaktif';
                status.classList.remove('text-green-600', 'dark:text-green-400');
                status.classList.add('text-red-600', 'dark:text-red-400');

                document.body.classList.remove('zen-mode');
            }

            localStorage.setItem('isZenModeEnabled', JSON.stringify(isZenModeEnabled));
        }

        /**
         * Exits Zen Mode
         */
        function exitZenMode() {
            isZenModeEnabled = false;
            const toggle = document.getElementById('sidebarZenModeToggle');
            const status = document.getElementById('sidebarZenModeStatus');

            toggle.checked = false;
            status.textContent = 'Nonaktif';
            status.classList.remove('text-green-600', 'dark:text-green-400');
            status.classList.add('text-red-600', 'dark:text-red-400');

            document.body.classList.remove('zen-mode');
            localStorage.setItem('isZenModeEnabled', JSON.stringify(isZenModeEnabled));

            showAlert('Mode Zen dinonaktifkan. Pengaturan dapat diakses kembali.', 'Mode Zen');
            if (isSoundEffectsEnabled) playSound('success');
        }

        /**
         * Toggles Instant Translate
         */
        function toggleInstantTranslate() {
            const toggle = document.getElementById('sidebarInstantTranslateToggle');
            const status = document.getElementById('sidebarInstantTranslateStatus');

            isInstantTranslateEnabled = toggle.checked;

            if (isInstantTranslateEnabled) {
                status.textContent = 'Aktif';
                status.classList.remove('text-red-600', 'dark:text-red-400');
                status.classList.add('text-green-600', 'dark:text-green-400');

                document.addEventListener('mouseup', handleTextSelection);
                showAlert('ðŸŒ Sorot teks untuk terjemahan instan!', 'Terjemahan Instan');
                if (isSoundEffectsEnabled) playSound('success');
            } else {
                status.textContent = 'Nonaktif';
                status.classList.remove('text-green-600', 'dark:text-green-400');
                status.classList.add('text-red-600', 'dark:text-red-400');

                document.removeEventListener('mouseup', handleTextSelection);
                hideTranslatePopup();
            }

            localStorage.setItem('isInstantTranslateEnabled', JSON.stringify(isInstantTranslateEnabled));
        }

        function handleTextSelection() {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();

            if (selectedText && selectedText.length > 1) {
                showTranslatePopup(selectedText, selection.getRangeAt(0).getBoundingClientRect());
                if (isSoundEffectsEnabled) playSound('click');
            }
        }

        function showTranslatePopup(text, rect) {
            hideTranslatePopup();

            const popup = document.createElement('div');
            popup.className = 'translate-popup translate-popup-enhanced';
            popup.style.left = Math.max(10, rect.left) + 'px';
            popup.style.top = Math.max(10, rect.top - 150) + 'px';
            popup.style.pointerEvents = 'auto';

            popup.innerHTML = `
                <div class="translate-header">
                    <span class="translate-title">ðŸŒ Terjemahkan "${text}"</span>
                    <button class="translate-close" onclick="hideTranslatePopup()">Ã—</button>
                </div>
                <div class="translate-buttons">
                    <button class="translate-btn" data-lang="id" onclick="translateToLanguage('${text}', 'id')">
                        ðŸ‡®ðŸ‡© Indonesia
                    </button>
                    <button class="translate-btn" data-lang="en" onclick="translateToLanguage('${text}', 'en')">
                        ðŸ‡ºðŸ‡¸ English
                    </button>
                    <button class="translate-btn" data-lang="zh" onclick="translateToLanguage('${text}', 'zh')">
                        ðŸ‡¨ðŸ‡³ ä¸­æ–‡
                    </button>
                    <button class="translate-btn" data-lang="ja" onclick="translateToLanguage('${text}', 'ja')">
                        ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž
                    </button>
                </div>
                <div class="translate-result" id="translateResult">
                    <div class="translate-loading">Pilih bahasa untuk menerjemahkan...</div>
                </div>
            `;

            popup.id = 'translatePopup';
            document.body.appendChild(popup);

            setTimeout(() => popup.classList.add('show'), 10);
        }

        async function translateToLanguage(text, targetLang) {
            const resultDiv = document.getElementById('translateResult');
            const buttons = document.querySelectorAll('.translate-btn');

            // Show loading state
            resultDiv.innerHTML = '<div class="translate-loading">ðŸ”„ Menerjemahkan...</div>';
            buttons.forEach(btn => btn.disabled = true);

            try {
                // Enhanced translation dictionary with more comprehensive translations
                const translations = {
                    'id': {
                        'hello': 'halo',
                        'good morning': 'selamat pagi',
                        'good afternoon': 'selamat siang',
                        'good evening': 'selamat malam',
                        'thank you': 'terima kasih',
                        'please': 'tolong',
                        'yes': 'ya',
                        'no': 'tidak',
                        'search': 'pencarian',
                        'application': 'aplikasi',
                        'premium': 'premium',
                        'background': 'latar belakang',
                        'particle': 'partikel',
                        'night': 'malam',
                        'mode': 'mode',
                        'translate': 'terjemahan',
                        'page': 'halaman',
                        'language': 'bahasa',
                        'instant': 'instan',
                        'settings': 'pengaturan',
                        'features': 'fitur',
                        'premium features': 'fitur premium'
                    },
                    'en': {
                        'halo': 'hello',
                        'selamat pagi': 'good morning',
                        'selamat siang': 'good afternoon',
                        'selamat malam': 'good evening',
                        'terima kasih': 'thank you',
                        'tolong': 'please',
                        'ya': 'yes',
                        'tidak': 'no',
                        'pencarian': 'search',
                        'aplikasi': 'application',
                        'latar belakang': 'background',
                        'partikel': 'particle',
                        'malam': 'night',
                        'mode': 'mode',
                        'terjemahan': 'translation',
                        'halaman': 'page',
                        'bahasa': 'language',
                        'instan': 'instant',
                        'pengaturan': 'settings',
                        'fitur': 'features',
                        'fitur premium': 'premium features'
                    },
                    'zh': {
                        'hello': 'ä½ å¥½',
                        'good morning': 'æ—©ä¸Šå¥½',
                        'good afternoon': 'ä¸‹åˆå¥½',
                        'good evening': 'æ™šä¸Šå¥½',
                        'thank you': 'è°¢è°¢',
                        'please': 'è¯·',
                        'yes': 'æ˜¯',
                        'no': 'ä¸',
                        'search': 'æœç´¢',
                        'application': 'åº”ç”¨ç¨‹åº',
                        'premium': 'é«˜çº§',
                        'background': 'èƒŒæ™¯',
                        'particle': 'ç²’å­',
                        'night': 'å¤œæ™š',
                        'mode': 'æ¨¡å¼',
                        'translate': 'ç¿»è¯‘',
                        'page': 'é¡µé¢',
                        'language': 'è¯­è¨€',
                        'instant': 'å³æ—¶',
                        'settings': 'è®¾ç½®',
                        'features': 'åŠŸèƒ½',
                        'premium features': 'é«˜çº§åŠŸèƒ½'
                    },
                    'ja': {
                        'hello': 'ã“ã‚“ã«ã¡ã¯',
                        'good morning': 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™',
                        'good afternoon': 'ã“ã‚“ã«ã¡ã¯',
                        'good evening': 'ã“ã‚“ã°ã‚“ã¯',
                        'thank you': 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™',
                        'please': 'ãŠé¡˜ã„ã—ã¾ã™',
                        'yes': 'ã¯ã„',
                        'no': 'ã„ã„ãˆ',
                        'search': 'æ¤œç´¢',
                        'application': 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³',
                        'premium': 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ',
                        'background': 'èƒŒæ™¯',
                        'particle': 'ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«',
                        'night': 'å¤œ',
                        'mode': 'ãƒ¢ãƒ¼ãƒ‰',
                        'translate': 'ç¿»è¨³',
                        'page': 'ãƒšãƒ¼ã‚¸',
                        'language': 'è¨€èªž',
                        'instant': 'ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆ',
                        'settings': 'è¨­å®š',
                        'features': 'æ©Ÿèƒ½',
                        'premium features': 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½'
                    }
                };

                const lowerText = text.toLowerCase();
                const targetTranslations = translations[targetLang];
                let translation = targetTranslations[lowerText];

                if (!translation) {
                    // Try partial matches for longer phrases
                    for (const [key, value] of Object.entries(targetTranslations)) {
                        if (lowerText.includes(key) || key.includes(lowerText)) {
                            translation = value;
                            break;
                        }
                    }
                }

                // Fallback translation based on language
                if (!translation) {
                    const languageNames = {
                        'id': 'Indonesia',
                        'en': 'English',
                        'zh': 'ä¸­æ–‡',
                        'ja': 'æ—¥æœ¬èªž'
                    };
                    translation = `[Terjemahan ke ${languageNames[targetLang]}]: ${text}`;
                }

                // Display result with language flag
                const flagMap = {
                    'id': 'ðŸ‡®ðŸ‡©',
                    'en': 'ðŸ‡ºðŸ‡¸',
                    'zh': 'ðŸ‡¨ðŸ‡³',
                    'ja': 'ðŸ‡¯ðŸ‡µ'
                };

                resultDiv.innerHTML = `
                    <div class="translate-success">
                        <div class="translate-flag">${flagMap[targetLang]}</div>
                        <div class="translate-text">${translation}</div>
                        <button class="copy-translation-btn" onclick="copyTranslation('${translation}')">
                            ðŸ“‹ Salin
                        </button>
                    </div>
                `;

                if (isSoundEffectsEnabled) playSound('success');

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="translate-error">
                        âŒ Gagal menerjemahkan. Coba lagi.
                    </div>
                `;
                if (isSoundEffectsEnabled) playSound('error');
            } finally {
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        function copyTranslation(text) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert('Terjemahan berhasil disalin!', 'Berhasil');
                if (isSoundEffectsEnabled) playSound('success');
            }).catch(() => {
                showAlert('Gagal menyalin terjemahan.', 'Kesalahan');
            });
        }

        function hideTranslatePopup() {
            const popup = document.getElementById('translatePopup');
            if (popup) popup.remove();
        }

        /**
         * Toggles Font Picker
         */
        function toggleFontPicker() {
            const toggle = document.getElementById('sidebarFontPickerToggle');
            const status = document.getElementById('sidebarFontPickerStatus');
            const fontSelector = document.getElementById('fontSelector');

            isFontPickerEnabled = toggle.checked;

            if (isFontPickerEnabled) {
                status.textContent = 'Aktif';
                status.classList.remove('text-red-600', 'dark:text-red-400');
                status.classList.add('text-green-600', 'dark:text-green-400');

                fontSelector.classList.remove('hidden');
                fontSelector.value = currentFont;
                fontSelector.addEventListener('change', changeFontFamily);
                if (isSoundEffectsEnabled) playSound('success');
            } else {
                status.textContent = 'Nonaktif';
                status.classList.remove('text-green-600', 'dark:text-green-400');
                status.classList.add('text-red-600', 'dark:text-red-400');

                fontSelector.classList.add('hidden');
                fontSelector.removeEventListener('change', changeFontFamily);
            }

            localStorage.setItem('isFontPickerEnabled', JSON.stringify(isFontPickerEnabled));
        }

        function changeFontFamily() {
            const fontSelector = document.getElementById('fontSelector');
            currentFont = fontSelector.value;

            // Load Google Font if needed
            if (!['Inter', 'Courier New'].includes(currentFont)) {
                const link = document.createElement('link');
                link.href = `https://fonts.googleapis.com/css2?family=${currentFont.replace(' ', '+')}&display=swap`;
                link.rel = 'stylesheet';
                document.head.appendChild(link);
            }

            document.body.style.fontFamily = `'${currentFont}', sans-serif`;
            localStorage.setItem('currentFont', currentFont);

            if (isSoundEffectsEnabled) playSound('click');
            showAlert(`Font berubah ke ${currentFont}`, 'Font Picker');
        }

        /**
         * Toggles Sound Effects
         */
        function toggleSoundEffects() {
            const toggle = document.getElementById('sidebarSoundEffectsToggle');
            const status = document.getElementById('sidebarSoundEffectsStatus');

            isSoundEffectsEnabled = toggle.checked;

            if (isSoundEffectsEnabled) {
                status.textContent = 'Aktif';
                status.classList.remove('text-red-600', 'dark:text-red-400');
                status.classList.add('text-green-600', 'dark:text-green-400');
                playSound('success');
            } else {
                status.textContent = 'Nonaktif';
                status.classList.remove('text-green-600', 'dark:text-green-400');
                status.classList.add('text-red-600', 'dark:text-red-400');
            }

            localStorage.setItem('isSoundEffectsEnabled', JSON.stringify(isSoundEffectsEnabled));
        }

        function playSound(type) {
            if (!isSoundEffectsEnabled) return;

            // Create audio context for sound effects
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            let frequency, duration;

            switch (type) {
                case 'click':
                    frequency = 800;
                    duration = 0.1;
                    break;
                case 'success':
                    frequency = 1000;
                    duration = 0.2;
                    break;
                case 'notification':
                    frequency = 600;
                    duration = 0.3;
                    break;
                case 'zen':
                    frequency = 432;
                    duration = 0.5;
                    break;
                default:
                    frequency = 500;
                    duration = 0.1;
            }

            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        /**
         * Enhanced particle creation with premium effects
         */
        function createPremiumParticle(x, y, particleData) {
            if (!isParticleEffectEnabled) return;

            const particleContainer = document.getElementById('particle-container');
            const particle = document.createElement('span');
            particle.className = 'particle';

            if (particleData && particleData.effect) {
                particle.classList.add(particleData.effect);
            }

            particle.textContent = particleData ? particleData.emoji : selectedParticles[Math.floor(Math.random() * selectedParticles.length)];
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;

            particleContainer.appendChild(particle);

            particle.addEventListener('animationend', () => {
                particle.remove();
            });

            if (isSoundEffectsEnabled) playSound('click');
        }

        /**
         * Applies all saved states on page load.
         */
        function applyAllSavedStates() {
            const body = document.body;

            const savedLoggedInUser = localStorage.getItem('loggedInUser');
            if (savedLoggedInUser) {
                loggedInUser = JSON.parse(savedLoggedInUser);
                isLoggedIn = true;
            } else {
                isLoggedIn = false;
                loggedInUser = null;
            }

            const savedIsKidsModeForcedByAge = localStorage.getItem('isKidsModeForcedByAge');
            if (savedIsKidsModeForcedByAge !== null) {
                isKidsModeForcedByAge = JSON.parse(savedIsKidsModeForcedByAge);
            } else {
                isKidsModeForcedByAge = false;
            }

            const savedSensorState = localStorage.getItem('searchSensorEnabled');
            if (savedSensorState !== null) {
                isSearchSensorEnabled = JSON.parse(savedSensorState);
            } else {
                isSearchSensorEnabled = true;
            }

            const savedLastSearchSensorStateBeforeIncognito = localStorage.getItem('lastSearchSensorStateBeforeIncognito');
            if (savedLastSearchSensorStateBeforeIncognito !== null) {
                lastSearchSensorStateBeforeIncognito = JSON.parse(savedLastSearchSensorStateBeforeIncognito);
            } else {
                lastSearchSensorStateBeforeIncognito = isSearchSensorEnabled;
            }

            const savedKidsModeState = localStorage.getItem('isKidsModeEnabled');
            if (savedKidsModeState !== null) {
                isKidsModeEnabled = JSON.parse(savedKidsModeState);
            } else {
                isKidsModeEnabled = false;
            }

            const savedLastKidsModeStateBeforeIncognito = localStorage.getItem('lastKidsModeStateBeforeIncognito');
            if (savedLastKidsModeStateBeforeIncognito !== null) {
                lastKidsModeStateBeforeIncognito = JSON.parse(savedLastKidsModeStateBeforeIncognito);
            } else {
                lastKidsModeStateBeforeIncognito = isKidsModeEnabled;
            }

            const savedBackgroundSelectionMode = localStorage.getItem('isBackgroundSelectionMode');
            if (savedBackgroundSelectionMode !== null) {
                isBackgroundSelectionMode = JSON.parse(savedBackgroundSelectionMode);
            }

            const savedGeminiSearchState = localStorage.getItem('isGeminiSearchEnabled');
            if (savedGeminiSearchState !== null) {
                isGeminiSearchEnabled = JSON.parse(savedGeminiSearchState);
            }

            const savedIncognitoModeState = localStorage.getItem('isIncognitoModeEnabled');
            if (savedIncognitoModeState !== null) {
                isIncognitoModeEnabled = JSON.parse(savedIncognitoModeState);
            }

            const savedCustomSearchState = localStorage.getItem('isCustomSearchEnabled');
            if (savedCustomSearchState !== null) {
                isCustomSearchEnabled = JSON.parse(savedCustomSearchState);
            } else {
                isCustomSearchEnabled = false;
            }

            const savedSearchSaverState = localStorage.getItem('isSearchSaverEnabled');
            if (savedSearchSaverState !== null) {
                isSearchSaverEnabled = JSON.parse(savedSearchSaverState);
            } else {
                isSearchSaverEnabled = false;
            }

            const savedHighContrastMode = localStorage.getItem('isHighContrastModeEnabled');
            if (savedHighContrastMode !== null) {
                isHighContrastModeEnabled = JSON.parse(savedHighContrastMode);
            } else {
                isHighContrastModeEnabled = false;
            }

            const savedFontSizeIndex = localStorage.getItem('currentFontSizeIndex');
            if (savedFontSizeIndex !== null) {
                currentFontSizeIndex = JSON.parse(savedFontSizeIndex);
            } else {
                currentFontSizeIndex = 1;
            }

            const savedFocusMode = localStorage.getItem('isFocusModeEnabled');
            if (savedFocusMode !== null) {
                isFocusModeEnabled = JSON.parse(savedFocusMode);
            } else {
                isFocusModeEnabled = false;
            }

            const savedLearningMode = localStorage.getItem('isLearningModeEnabled');
            if (savedLearningMode !== null) {
                isLearningModeEnabled = JSON.parse(savedLearningMode);
            } else {
                isLearningModeEnabled = false;
            }

            const savedDrawingMode = localStorage.getItem('isDrawingModeEnabled');
            if (savedDrawingMode !== null) {
                isDrawingModeEnabled = JSON.parse(savedDrawingMode);
            } else {
                isDrawingModeEnabled = false;
            }

            const savedParticleEffect = localStorage.getItem('isParticleEffectEnabled');
            if (savedParticleEffect !== null) {
                isParticleEffectEnabled = JSON.parse(savedParticleEffect);
            } else {
                isParticleEffectEnabled = false;
            }

            const savedSelectedParticles = localStorage.getItem('selectedParticles');
            if (savedSelectedParticles) {
                selectedParticles = JSON.parse(savedSelectedParticles);
                if (selectedParticles.length === 0) {
                    selectedParticles = ['âœ¨'];
                }
            } else {
                selectedParticles = ['âœ¨'];
            }

            const savedNoteMode = localStorage.getItem('isNoteModeEnabled');
            if (savedNoteMode !== null) {
                isNoteModeEnabled = JSON.parse(savedNoteMode);
            } else {
                isNoteModeEnabled = false;
            }

            const savedWorldClock = localStorage.getItem('isWorldClockEnabled');
            if (savedWorldClock !== null) {
                isWorldClockEnabled = JSON.parse(savedWorldClock);
            } else {
                isWorldClockEnabled = false;
            }

            // Load Premium Features
            const savedAutoNightMode = localStorage.getItem('isAutoNightModeEnabled');
            if (savedAutoNightMode !== null) {
                isAutoNightModeEnabled = JSON.parse(savedAutoNightMode);
            } else {
                isAutoNightModeEnabled = false;
            }

            const savedReminder = localStorage.getItem('isReminderEnabled');
            if (savedReminder !== null) {
                isReminderEnabled = JSON.parse(savedReminder);
            } else {
                isReminderEnabled = false;
            }

            const savedZenMode = localStorage.getItem('isZenModeEnabled');
            if (savedZenMode !== null) {
                isZenModeEnabled = JSON.parse(savedZenMode);
            } else {
                isZenModeEnabled = false;
            }

            const savedInstantTranslate = localStorage.getItem('isInstantTranslateEnabled');
            if (savedInstantTranslate !== null) {
                isInstantTranslateEnabled = JSON.parse(savedInstantTranslate);
            } else {
                isInstantTranslateEnabled = false;
            }

            const savedFontPicker = localStorage.getItem('isFontPickerEnabled');
            if (savedFontPicker !== null) {
                isFontPickerEnabled = JSON.parse(savedFontPicker);
            } else {
                isFontPickerEnabled = false;
            }

            const savedSoundEffects = localStorage.getItem('isSoundEffectsEnabled');
            if (savedSoundEffects !== null) {
                isSoundEffectsEnabled = JSON.parse(savedSoundEffects);
            } else {
                isSoundEffectsEnabled = false;
            }

            const savedCurrentFont = localStorage.getItem('currentFont');
            if (savedCurrentFont) {
                currentFont = savedCurrentFont;
            } else {
                currentFont = 'Inter';
            }

            loadSearchHistory();
            clearUploadedImage();

            // Get all UI elements
            const sidebarSearchSensorToggle = document.getElementById('sidebarSearchSensorToggle');
            const sidebarSensorStatus = document.getElementById('sidebarSensorStatus');
            const sidebarKidsModeToggle = document.getElementById('sidebarKidsModeToggle');
            const sidebarKidsModeStatus = document.getElementById('sidebarKidsModeStatus');
            const sidebarIncognitoModeToggle = document.getElementById('sidebarIncognitoModeToggle');
            const sidebarIncognitoModeStatus = document.getElementById('sidebarIncognitoModeStatus');
            const sidebarBackgroundToggle = document.getElementById('sidebarBackgroundToggle');
            const sidebarBackgroundStatus = document.getElementById('sidebarBackgroundStatus');
            const sidebarGeminiSearchToggle = document.getElementById('sidebarGeminiSearchToggle');
            const sidebarGeminiSearchStatus = document.getElementById('sidebarGeminiSearchStatus');
            const loggedInUserDisplay = document.getElementById('loggedInUserDisplay');
            const logoutButton = document.getElementById('logoutButton');
            const sidebarHighContrastToggle = document.getElementById('sidebarHighContrastToggle');
            const sidebarHighContrastStatus = document.getElementById('sidebarHighContrastStatus');
            const sidebarFocusModeToggle = document.getElementById('sidebarFocusModeToggle');
            const sidebarFocusModeStatus = document.getElementById('sidebarFocusModeStatus');
            const quickSearchSuggestions = document.getElementById('quickSearchSuggestions');
            const searchEngineOptions = document.getElementById('searchEngineOptions');
            const footer = document.querySelector('footer');
            const searchResults = document.getElementById('searchResults');
            const sidebarCustomSearchToggle = document.getElementById('sidebarCustomSearchToggle');
            const sidebarCustomSearchStatus = document.getElementById('sidebarCustomSearchStatus');
            const customSearchControls = document.getElementById('customSearchControls');
            const sidebarSearchSaverToggle = document.getElementById('sidebarSearchSaverToggle');
            const sidebarSearchSaverStatus = document.getElementById('sidebarSearchSaverStatus');
            const geminiVisualSearchControls = document.getElementById('geminiVisualSearchControls');
            const easySearchSection = document.getElementById('easySearchSection');
            const imageGenerationSection = document.getElementById('imageGenerationSection');
            const learningModeSection = document.getElementById('learningModeSection');
            const sidebarLearningModeToggle = document.getElementById('sidebarLearningModeToggle');
            const sidebarLearningModeStatus = document.getElementById('sidebarLearningModeStatus');
            const sidebarDrawingModeToggle = document.getElementById('sidebarDrawingModeToggle');
            const sidebarDrawingModeStatus = document.getElementById('sidebarDrawingModeStatus');
            const sidebarParticleEffectToggle = document.getElementById('sidebarParticleEffectToggle');
            const sidebarParticleEffectStatus = document.getElementById('sidebarParticleEffectStatus');
            const openParticlePickerBtn = document.getElementById('openParticlePickerBtn');
            const sidebarNoteModeToggle = document.getElementById('sidebarNoteModeToggle');
            const sidebarNoteModeStatus = document.getElementById('sidebarNoteModeStatus');
            const sidebarWorldClockToggle = document.getElementById('sidebarWorldClockToggle');
            const sidebarWorldClockStatus = document.getElementById('sidebarWorldClockStatus');

            // Update login UI
            if (isLoggedIn) {
                loggedInUserDisplay.textContent = `Selamat datang, ${loggedInUser.account}!`;
                logoutButton.classList.remove('hidden');
            } else {
                loggedInUserDisplay.textContent = '';
                logoutButton.classList.add('hidden');
            }

            // Apply Kids Mode based on age
            if (loggedInUser && loggedInUser.age < 15) {
                isKidsModeForcedByAge = true;
                isKidsModeEnabled = true;
                sidebarKidsModeToggle.checked = true;
                sidebarKidsModeToggle.disabled = true;
                sidebarKidsModeStatus.textContent = 'Aktif (Umur)';
                sidebarKidsModeStatus.classList.remove('text-red-600', 'dark:text-red-400');
                sidebarKidsModeStatus.classList.add('text-green-600', 'dark:text-green-400');
            } else {
                isKidsModeForcedByAge = false;
                sidebarKidsModeToggle.checked = isKidsModeEnabled;
                sidebarKidsModeToggle.disabled = false;
                sidebarKidsModeStatus.textContent = isKidsModeEnabled ? 'Aktif' : 'Nonaktif';
                sidebarKidsModeStatus.classList.toggle('text-green-600', isKidsModeEnabled);
                sidebarKidsModeStatus.classList.toggle('text-red-600', !isKidsModeEnabled);
                sidebarKidsModeStatus.classList.toggle('dark:text-green-400', isKidsModeEnabled);
                sidebarKidsModeStatus.classList.toggle('dark:text-red-400', !isKidsModeEnabled);
            }
            localStorage.setItem('isKidsModeForcedByAge', JSON.stringify(isKidsModeForcedByAge));
            localStorage.setItem('isKidsModeEnabled', JSON.stringify(isKidsModeEnabled));

            // Apply Incognito Mode effects
            sidebarIncognitoModeToggle.checked = isIncognitoModeEnabled;
            sidebarIncognitoModeStatus.textContent = isIncognitoModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarIncognitoModeStatus.classList.toggle('text-green-600', isIncognitoModeEnabled);
            sidebarIncognitoModeStatus.classList.toggle('text-red-600', !isIncognitoModeEnabled);
            sidebarIncognitoModeStatus.classList.toggle('dark:text-green-400', isIncognitoModeEnabled);
            sidebarIncognitoModeStatus.classList.toggle('dark:text-red-400', !isIncognitoModeEnabled);

            if (isIncognitoModeEnabled) {
                isSearchSensorEnabled = false;
                sidebarSearchSensorToggle.checked = false;
                sidebarSearchSensorToggle.disabled = true;
                sidebarSensorStatus.textContent = 'Nonaktif (Mode Samaran)';
                sidebarSensorStatus.classList.remove('text-green-600', 'dark:text-green-400');
                sidebarSensorStatus.classList.add('text-red-600', 'dark:text-red-400');
            } else {
                if (isKidsModeEnabled) {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSensorStatus.textContent = 'Aktif (Mode Anak)';
                    sidebarSensorStatus.classList.remove('text-red-600', 'dark:text-red-400');
                    sidebarSensorStatus.classList.add('text-green-600', 'dark:text-green-400');
                } else {
                    isSearchSensorEnabled = true;
                    sidebarSearchSensorToggle.checked = true;
                    sidebarSensorStatus.textContent = 'Aktif';
                    sidebarSensorStatus.classList.toggle('text-green-600', true);
                    sidebarSensorStatus.classList.toggle('text-red-600', false);
                    sidebarSensorStatus.classList.toggle('dark:text-green-400', true);
                    sidebarSensorStatus.classList.toggle('dark:text-red-400', false);
                }
                sidebarSearchSensorToggle.disabled = true;
            }
            localStorage.setItem('searchSensorEnabled', JSON.stringify(isSearchSensorEnabled));

            // Apply Focus Mode
            sidebarFocusModeToggle.checked = isFocusModeEnabled;
            body.classList.toggle('focus-mode', isFocusModeEnabled);
            sidebarFocusModeStatus.textContent = isFocusModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarFocusModeStatus.classList.toggle('text-green-600', isFocusModeEnabled);
            sidebarFocusModeStatus.classList.toggle('text-red-600', !isFocusModeEnabled);
            sidebarFocusModeStatus.classList.toggle('dark:text-green-400', isFocusModeEnabled);
            sidebarFocusModeStatus.classList.toggle('dark:text-red-400', !isFocusModeEnabled);

            quickSearchSuggestions.style.display = isFocusModeEnabled ? 'none' : '';
            searchEngineOptions.style.display = isFocusModeEnabled ? 'none' : '';
            footer.style.display = isFocusModeEnabled ? 'none' : '';
            searchResults.style.display = isFocusModeEnabled ? 'none' : '';
            imageGenerationSection.style.display = isFocusModeEnabled ? 'none' : '';
            learningModeSection.style.display = isFocusModeEnabled ? 'none' : '';

            if (isFocusModeEnabled) {
                isBackgroundSelectionMode = false;
                document.getElementById('sidebarBackgroundToggle').checked = false;
                document.getElementById('sidebarBackgroundStatus').textContent = 'Nonaktif (Mode Fokus)';
                document.getElementById('sidebarBackgroundStatus').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('sidebarBackgroundStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarBackgroundToggle').disabled = true;
                applyBackground('');

                isLearningModeEnabled = false;
                document.getElementById('sidebarLearningModeToggle').checked = false;
                document.getElementById('sidebarLearningModeStatus').textContent = 'Nonaktif (Mode Fokus)';
                document.getElementById('sidebarLearningModeStatus').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('sidebarLearningModeStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarLearningModeToggle').disabled = true;
                document.getElementById('easySearchSection').classList.remove('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.body.classList.remove('learning-mode-bg');

                isDrawingModeEnabled = false;
                document.getElementById('sidebarDrawingModeToggle').checked = false;
                document.getElementById('sidebarDrawingModeStatus').textContent = 'Nonaktif (Mode Fokus)';
                document.getElementById('sidebarDrawingModeStatus').classList.remove('text-green-600', 'dark:text-green-400');
                document.getElementById('sidebarDrawingModeStatus').classList.add('text-red-600', 'dark:text-red-400');
                document.getElementById('sidebarDrawingModeToggle').disabled = true;
                document.getElementById('drawingModeSection').classList.add('hidden');
            } else {
                document.getElementById('sidebarBackgroundToggle').disabled = false;
                isBackgroundSelectionMode = localStorage.getItem('isBackgroundSelectionMode') === 'true';
                document.getElementById('sidebarBackgroundToggle').checked = isBackgroundSelectionMode;
                document.getElementById('sidebarBackgroundStatus').textContent = isBackgroundSelectionMode ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarBackgroundStatus').classList.toggle('text-green-600', isBackgroundSelectionMode);
                document.getElementById('sidebarBackgroundStatus').classList.toggle('text-red-600', !isBackgroundSelectionMode);
                document.getElementById('sidebarBackgroundStatus').classList.toggle('dark:text-green-400', isBackgroundSelectionMode);
                document.getElementById('sidebarBackgroundStatus').classList.toggle('dark:text-red-400', !isBackgroundSelectionMode);
                applyBackground(selectedBackground);

                document.getElementById('sidebarLearningModeToggle').disabled = false;
                isLearningModeEnabled = localStorage.getItem('isLearningModeEnabled') === 'true';
                document.getElementById('sidebarLearningModeToggle').checked = isLearningModeEnabled;
                document.getElementById('sidebarLearningModeStatus').textContent = isLearningModeEnabled ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarLearningModeStatus').classList.toggle('text-green-600', isLearningModeEnabled);
                document.getElementById('sidebarLearningModeStatus').classList.toggle('text-red-600', !isLearningModeEnabled);
                document.getElementById('sidebarLearningModeStatus').classList.toggle('dark:text-green-400', isLearningModeEnabled);
                document.getElementById('sidebarLearningModeStatus').classList.toggle('dark:text-red-400', !isLearningModeEnabled);
                if (isLearningModeEnabled) {
                    document.getElementById('easySearchSection').classList.add('hidden');
                    document.getElementById('imageGenerationSection').classList.add('hidden');
                    document.getElementById('learningModeSection').classList.remove('hidden');
                    document.body.classList.add('learning-mode-bg');
                    displayHistoryContent();
                    generateMathProblem();
                    displayHistoryQuestion();
                } else {
                    document.getElementById('easySearchSection').classList.remove('hidden');
                    document.getElementById('imageGenerationSection').classList.remove('hidden');
                    document.getElementById('learningModeSection').classList.add('hidden');
                    document.body.classList.remove('learning-mode-bg');
                }

                document.getElementById('sidebarDrawingModeToggle').disabled = false;
                isDrawingModeEnabled = localStorage.getItem('isDrawingModeEnabled') === 'true';
                document.getElementById('sidebarDrawingModeToggle').checked = isDrawingModeEnabled;
                document.getElementById('sidebarDrawingModeStatus').textContent = isDrawingModeEnabled ? 'Aktif' : 'Nonaktif';
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('text-green-600', isDrawingModeEnabled);
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('text-red-600', !isDrawingModeEnabled);
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('dark:text-green-400', isDrawingModeEnabled);
                document.getElementById('sidebarDrawingModeStatus').classList.toggle('dark:text-red-400', !isDrawingModeEnabled);
                if (isDrawingModeEnabled) {
                    document.getElementById('easySearchSection').classList.add('hidden');
                    document.getElementById('imageGenerationSection').classList.add('hidden');
                    document.getElementById('drawingModeSection').classList.remove('hidden');

                    setTimeout(() => {
                        initializeDrawingCanvas();
                    }, 100);
                } else {
                    document.getElementById('drawingModeSection').classList.add('hidden');
                }
            }

            // Apply other states
            sidebarBackgroundToggle.checked = isBackgroundSelectionMode;
            sidebarBackgroundStatus.textContent = isBackgroundSelectionMode ? 'Aktif' : 'Nonaktif';
            sidebarBackgroundStatus.classList.toggle('text-green-600', isBackgroundSelectionMode);
            sidebarBackgroundStatus.classList.toggle('text-red-600', !isBackgroundSelectionMode);
            sidebarBackgroundStatus.classList.toggle('dark:text-green-400', isBackgroundSelectionMode);
            sidebarBackgroundStatus.classList.toggle('dark:text-red-400', !isBackgroundSelectionMode);

            sidebarGeminiSearchToggle.checked = isGeminiSearchEnabled;
            sidebarGeminiSearchStatus.textContent = isGeminiSearchEnabled ? 'Aktif' : 'Nonaktif';
            sidebarGeminiSearchStatus.classList.toggle('text-green-600', isGeminiSearchEnabled);
            sidebarGeminiSearchStatus.classList.toggle('text-red-600', !isGeminiSearchEnabled);
            sidebarGeminiSearchStatus.classList.toggle('dark:text-green-400', isGeminiSearchEnabled);
            sidebarGeminiSearchStatus.classList.toggle('dark:text-red-400', !isGeminiSearchEnabled);
            toggleGeminiSearch();

            // Apply Search Saver state
            sidebarSearchSaverToggle.checked = isSearchSaverEnabled;
            sidebarSearchSaverStatus.textContent = isSearchSaverEnabled ? 'Aktif' : 'Nonaktif';
            sidebarSearchSaverStatus.classList.toggle('text-green-600', isSearchSaverEnabled);
            sidebarSearchSaverStatus.classList.toggle('text-red-600', !isSearchSaverEnabled);
            sidebarSearchSaverStatus.classList.toggle('dark:text-green-400', isSearchSaverEnabled);
            sidebarSearchSaverStatus.classList.toggle('dark:text-red-400', !isSearchSaverEnabled);
            toggleSearchSaver();

            // Apply Custom Search state
            sidebarCustomSearchToggle.checked = isCustomSearchEnabled;
            sidebarCustomSearchStatus.textContent = isCustomSearchEnabled ? 'Aktif' : 'Nonaktif';
            sidebarCustomSearchStatus.classList.toggle('text-green-600', isCustomSearchEnabled);
            sidebarCustomSearchStatus.classList.toggle('text-red-600', !isCustomSearchEnabled);
            sidebarCustomSearchStatus.classList.toggle('dark:text-green-400', isCustomSearchEnabled);
            sidebarCustomSearchStatus.classList.toggle('dark:text-red-400', !isCustomSearchEnabled);
            customSearchControls.classList.toggle('hidden', !isCustomSearchEnabled);
            loadCustomSearchEngines();

            // Apply High Contrast Mode
            sidebarHighContrastToggle.checked = isHighContrastModeEnabled;
            body.classList.toggle('high-contrast-mode', isHighContrastModeEnabled);
            sidebarHighContrastStatus.textContent = isHighContrastModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarHighContrastStatus.classList.toggle('text-green-600', isHighContrastModeEnabled);
            sidebarHighContrastStatus.classList.toggle('text-red-600', !isHighContrastModeEnabled);
            sidebarHighContrastStatus.classList.toggle('dark:text-green-400', isHighContrastModeEnabled);
            sidebarHighContrastStatus.classList.toggle('dark:text-red-400', !isHighContrastModeEnabled);

            // Apply Font Size
            document.body.style.setProperty('--base-font-size', fontSizes[currentFontSizeIndex]);
            const currentFontSizeElement = document.getElementById('currentFontSize');
            let statusText = 'Normal';
            if (currentFontSizeIndex === 0) {
                statusText = 'Kecil';
            } else if (currentFontSizeIndex === fontSizes.length - 1) {
                statusText = 'Besar';
            } else if (currentFontSizeIndex > 1) {
                statusText = 'Lebih Besar';
            } else if (currentFontSizeIndex < 1) {
                statusText = 'Lebih Kecil';
            }
            currentFontSizeElement.textContent = statusText;

            // Apply Learning Mode state
            sidebarLearningModeToggle.checked = isLearningModeEnabled;
            sidebarLearningModeStatus.textContent = isLearningModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarLearningModeStatus.classList.toggle('text-green-600', isLearningModeEnabled);
            sidebarLearningModeStatus.classList.toggle('text-red-600', !isLearningModeEnabled);
            sidebarLearningModeStatus.classList.toggle('dark:text-green-400', isLearningModeEnabled);
            sidebarLearningModeStatus.classList.toggle('dark:text-red-400', !isLearningModeEnabled);
            if (isLearningModeEnabled) {
                easySearchSection.classList.add('hidden');
                imageGenerationSection.classList.add('hidden');
                learningModeSection.classList.remove('hidden');
                body.classList.add('learning-mode-bg');
                displayHistoryContent();
                generateMathProblem();
                displayHistoryQuestion();
            } else {
                easySearchSection.classList.remove('hidden');
                imageGenerationSection.classList.remove('hidden');
                learningModeSection.classList.add('hidden');
                body.classList.remove('learning-mode-bg');
            }

            // Apply Drawing Mode state
            sidebarDrawingModeToggle.checked = isDrawingModeEnabled;
            sidebarDrawingModeStatus.textContent = isDrawingModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarDrawingModeStatus.classList.toggle('text-green-600', isDrawingModeEnabled);
            sidebarDrawingModeStatus.classList.toggle('text-red-600', !isDrawingModeEnabled);
            sidebarDrawingModeStatus.classList.toggle('dark:text-green-400', isDrawingModeEnabled);
            sidebarDrawingModeStatus.classList.toggle('dark:text-red-400', !isDrawingModeEnabled);
            if (isDrawingModeEnabled) {
                easySearchSection.classList.add('hidden');
                imageGenerationSection.classList.add('hidden');
                document.getElementById('drawingModeSection').classList.remove('hidden');
                setTimeout(() => {
                    initializeDrawingCanvas();
                }, 100);
            } else {
                document.getElementById('drawingModeSection').classList.add('hidden');
            }

            // Apply Particle Effect state
            sidebarParticleEffectToggle.checked = isParticleEffectEnabled;
            sidebarParticleEffectStatus.textContent = isParticleEffectEnabled ? 'Aktif' : 'Nonaktif';
            sidebarParticleEffectStatus.classList.toggle('text-green-600', isParticleEffectEnabled);
            sidebarParticleEffectStatus.classList.toggle('text-red-600', !isParticleEffectEnabled);
            sidebarParticleEffectStatus.classList.toggle('dark:text-green-400', isParticleEffectEnabled);
            sidebarParticleEffectStatus.classList.toggle('dark:text-red-400', !isParticleEffectEnabled);
            openParticlePickerBtn.disabled = !isParticleEffectEnabled;
            if (isParticleEffectEnabled) {
                document.body.addEventListener('click', handleParticleEffect);
                document.body.addEventListener('touchstart', handleParticleEffect);
            } else {
                document.body.removeEventListener('click', handleParticleEffect);
                document.body.removeEventListener('touchstart', handleParticleEffect);
            }

            // Apply Note Mode state
            sidebarNoteModeToggle.checked = isNoteModeEnabled;
            sidebarNoteModeStatus.textContent = isNoteModeEnabled ? 'Aktif' : 'Nonaktif';
            sidebarNoteModeStatus.classList.toggle('text-green-600', isNoteModeEnabled);
            sidebarNoteModeStatus.classList.toggle('text-red-600', !isNoteModeEnabled);
            sidebarNoteModeStatus.classList.toggle('dark:text-green-400', isNoteModeEnabled);
            sidebarNoteModeStatus.classList.toggle('dark:text-red-400', !isNoteModeEnabled);
            if (isNoteModeEnabled) {
                document.getElementById('easySearchSection').classList.add('hidden');
                document.getElementById('imageGenerationSection').classList.add('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.getElementById('worldClockSection').classList.add('hidden');
                document.getElementById('drawingModeSection').classList.add('hidden');
                document.getElementById('calculatorSection').classList.add('hidden');
                document.getElementById('weatherSection').classList.add('hidden');
                document.getElementById('prayerTimeSection').classList.add('hidden');
                document.getElementById('hijriSection').classList.add('hidden');
                document.getElementById('noteModeSection').classList.remove('hidden');
                loadSavedNote();
            } else {
                document.getElementById('noteModeSection').classList.add('hidden');
            }

            // Apply World Clock state
            sidebarWorldClockToggle.checked = isWorldClockEnabled;
            sidebarWorldClockStatus.textContent = isWorldClockEnabled ? 'Aktif' : 'Nonaktif';
            sidebarWorldClockStatus.classList.toggle('text-green-600', isWorldClockEnabled);
            sidebarWorldClockStatus.classList.toggle('text-red-600', !isWorldClockEnabled);
            sidebarWorldClockStatus.classList.toggle('dark:text-green-400', isWorldClockEnabled);
            sidebarWorldClockStatus.classList.toggle('dark:text-red-400', !isWorldClockEnabled);
            if (isWorldClockEnabled) {
                document.getElementById('easySearchSection').classList.add('hidden');
                document.getElementById('imageGenerationSection').classList.add('hidden');
                document.getElementById('learningModeSection').classList.add('hidden');
                document.getElementById('noteModeSection').classList.add('hidden');
                document.getElementById('drawingModeSection').classList.add('hidden');
                document.getElementById('calculatorSection').classList.add('hidden');
                document.getElementById('weatherSection').classList.add('hidden');
                document.getElementById('prayerTimeSection').classList.add('hidden');
                document.getElementById('hijriSection').classList.add('hidden');
                document.getElementById('worldClockSection').classList.remove('hidden');
                startWorldClock();
            } else {
                document.getElementById('worldClockSection').classList.add('hidden');
                stopWorldClock();
            }

            // Apply Premium Features
            document.getElementById('sidebarAutoNightModeToggle').checked = isAutoNightModeEnabled;
            document.getElementById('sidebarAutoNightModeStatus').textContent = isAutoNightModeEnabled ? 'Aktif' : 'Nonaktif';
            document.getElementById('sidebarAutoNightModeStatus').classList.toggle('text-green-600', isAutoNightModeEnabled);
            document.getElementById('sidebarAutoNightModeStatus').classList.toggle('text-red-600', !isAutoNightModeEnabled);
            document.getElementById('sidebarAutoNightModeStatus').classList.toggle('dark:text-green-400', isAutoNightModeEnabled);
            document.getElementById('sidebarAutoNightModeStatus').classList.toggle('dark:text-red-400', !isAutoNightModeEnabled);

            document.getElementById('sidebarReminderToggle').checked = isReminderEnabled;
            document.getElementById('sidebarReminderStatus').textContent = isReminderEnabled ? 'Aktif' : 'Nonaktif';
            document.getElementById('sidebarReminderStatus').classList.toggle('text-green-600', isReminderEnabled);
            document.getElementById('sidebarReminderStatus').classList.toggle('text-red-600', !isReminderEnabled);

            document.getElementById('sidebarZenModeToggle').checked = isZenModeEnabled;
            document.getElementById('sidebarZenModeStatus').textContent = isZenModeEnabled ? 'Aktif' : 'Nonaktif';
            document.getElementById('sidebarZenModeStatus').classList.toggle('text-green-600', isZenModeEnabled);
            document.getElementById('sidebarZenModeStatus').classList.toggle('text-red-600', !isZenModeEnabled);
            document.getElementById('sidebarZenModeStatus').classList.toggle('dark:text-green-400', isZenModeEnabled);
            document.getElementById('sidebarZenModeStatus').classList.toggle('dark:text-red-400', !isZenModeEnabled);
            if (isZenModeEnabled) document.body.classList.add('zen-mode');

            document.getElementById('sidebarInstantTranslateToggle').checked = isInstantTranslateEnabled;
            document.getElementById('sidebarInstantTranslateStatus').textContent = isInstantTranslateEnabled ? 'Aktif' : 'Nonaktif';
            document.getElementById('sidebarInstantTranslateStatus').classList.toggle('text-green-600', isInstantTranslateEnabled);
            document.getElementById('sidebarInstantTranslateStatus').classList.toggle('text-red-600', !isInstantTranslateEnabled);
            if (isInstantTranslateEnabled) document.addEventListener('mouseup', handleTextSelection);

            document.getElementById('sidebarFontPickerToggle').checked = isFontPickerEnabled;
            document.getElementById('sidebarFontPickerStatus').textContent = isFontPickerEnabled ? 'Aktif' : 'Nonaktif';
            document.getElementById('sidebarFontPickerStatus').classList.toggle('text-green-600', isFontPickerEnabled);
            document.getElementById('sidebarFontPickerStatus').classList.toggle('text-red-600', !isFontPickerEnabled);
            document.getElementById('fontSelector').classList.toggle('hidden', !isFontPickerEnabled);
            document.getElementById('fontSelector').value = currentFont;
            document.body.style.fontFamily = `'${currentFont}', sans-serif`;

            document.getElementById('sidebarSoundEffectsToggle').checked = isSoundEffectsEnabled;
            document.getElementById('sidebarSoundEffectsStatus').textContent = isSoundEffectsEnabled ? 'Aktif' : 'Nonaktif';
            document.getElementById('sidebarSoundEffectsStatus').classList.toggle('text-green-600', isSoundEffectsEnabled);
            document.getElementById('sidebarSoundEffectsStatus').classList.toggle('text-red-600', !isSoundEffectsEnabled);

            // Start premium features that need intervals
            if (isAutoNightModeEnabled) {
                nightModeCheckInterval = setInterval(checkTimeForNightMode, 60000);
                checkTimeForNightMode();
            }

            if (isReminderEnabled) {
                reminderInterval = setInterval(() => {
                    const reminders = [
                        'ðŸ’§ Jangan lupa minum air!',
                        'ðŸ‘€ Istirahatkan mata Anda sejenak',
                        'ðŸ§˜ Ambil napas dalam-dalam',
                        'ðŸš¶ Berdiri dan bergerak sedikit',
                        'ðŸ˜Š Tetap positif dan semangat!'
                    ];
                    const randomReminder = reminders[Math.floor(Math.random() * reminders.length)];
                    showAlert(randomReminder, 'Pengingat Kesehatan');
                    if (isSoundEffectsEnabled) playSound('notification');
                }, 30 * 60 * 1000);
            }

            updateQuickSearchSuggestions();
            updateSearchInputPlaceholder();
            displaySearchHistory();
            renderSearchEngineButtons();
        }

        // Bot Test Functions
        function initBotTest() {
            const botTestModal = document.getElementById('botTestModal');
            const mainContentWrapper = document.getElementById('mainContentWrapper');
            const botTestClickArea = document.getElementById('botTestClickArea');
            const botTestInput = document.getElementById('botTestInput');
            const botTestContinueBtn = document.getElementById('botTestContinueBtn');
            const botTestMessage = document.getElementById('botTestMessage');
            const clickCountDisplay = document.getElementById('clickCountDisplay');

            botTestClickCount = 0;
            botTestTypingStartTime = 0;
            botTestInput.value = '';
            botTestInput.classList.add('hidden');
            botTestInput.disabled = true;
            botTestContinueBtn.classList.add('hidden');
            botTestContinueBtn.disabled = true;
            botTestClickArea.disabled = false;
            botTestMessage.textContent = `Klik area ini ${botTestRequiredClicks} kali.`;
            clickCountDisplay.textContent = `(0/${botTestRequiredClicks})`;

            botTestModal.classList.remove('hidden');
            mainContentWrapper.classList.add('hidden');

            botTestClickArea.addEventListener('click', handleBotTestClick);
            botTestInput.addEventListener('input', handleBotTestTyping);
            botTestContinueBtn.addEventListener('click', hideBotTestModal);
        }

        function handleBotTestClick() {
            const botTestClickArea = document.getElementById('botTestClickArea');
            const clickCountDisplay = document.getElementById('clickCountDisplay');
            const botTestMessage = document.getElementById('botTestMessage');
            const botTestInput = document.getElementById('botTestInput');

            botTestClickCount++;
            clickCountDisplay.textContent = `(${botTestClickCount}/${botTestRequiredClicks})`;

            if (botTestClickCount >= botTestRequiredClicks) {
                botTestClickArea.disabled = true;
                botTestClickArea.removeEventListener('click', handleBotTestClick);
                botTestMessage.textContent = `Hebat! Sekarang ketik 2 kata berikut: "${botTestRequiredWords.join(' ')}"`;
                botTestInput.classList.remove('hidden');
                botTestInput.disabled = false;
                botTestInput.focus();
                botTestTypingStartTime = Date.now();
            }
        }

        function handleBotTestTyping() {
            const botTestInput = document.getElementById('botTestInput');
            const botTestMessage = document.getElementById('botTestMessage');
            const botTestContinueBtn = document.getElementById('botTestContinueBtn');

            const typedWords = botTestInput.value.toLowerCase().trim();
            const expectedWords = botTestRequiredWords.join(' ').toLowerCase();

            if (typedWords === expectedWords) {
                const typingDuration = Date.now() - botTestTypingStartTime;

                if (typingDuration >= botTestMinTypingTime && typingDuration <= botTestMaxTypingTime) {
                    botTestMessage.textContent = 'Verifikasi berhasil! Selamat datang.';
                    botTestInput.disabled = true;
                    botTestContinueBtn.classList.remove('hidden');
                    botTestContinueBtn.disabled = false;
                } else {
                    let reason = '';
                    if (typingDuration < botTestMinTypingTime) {
                        reason = 'terlalu cepat';
                    } else {
                        reason = 'terlalu lambat';
                    }
                    botTestMessage.textContent = `Verifikasi gagal. Kecepatan penulisan Anda ${reason}. Silakan coba lagi.`;
                    setTimeout(initBotTest, 2000);
                }
            } else if (typedWords.length >= expectedWords.length && typedWords !== expectedWords) {
                botTestMessage.textContent = 'Verifikasi gagal. Kata tidak sesuai. Silakan coba lagi.';
                setTimeout(initBotTest, 2000);
            }
        }

        function hideBotTestModal() {
            document.getElementById('botTestModal').classList.add('hidden');
            document.getElementById('mainContentWrapper').classList.remove('hidden');
            document.getElementById('botTestClickArea').removeEventListener('click', handleBotTestClick);
            document.getElementById('botTestInput').removeEventListener('input', handleBotTestTyping);
            document.getElementById('botTestContinueBtn').removeEventListener('click', hideBotTestModal);
        }

        // Login/Registration Functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('botTestModal').classList.add('hidden');
            document.getElementById('mainContentWrapper').classList.add('hidden');
            document.getElementById('loginMessage').classList.add('hidden');
            document.getElementById('loginAccount').value = '';
            document.getElementById('loginAge').value = '';
        }

        function registerUser() {
            const account = document.getElementById('loginAccount').value.trim();
            const age = parseInt(document.getElementById('loginAge').value.trim());
            const loginMessage = document.getElementById('loginMessage');

            if (!account || isNaN(age) || age < 1) {
                loginMessage.textContent = 'Harap isi semua bidang dengan benar (Akun dan Umur).';
                loginMessage.classList.remove('hidden');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');

            if (users[account]) {
                loginMessage.textContent = 'Akun sudah terdaftar. Silakan login.';
                loginMessage.classList.remove('hidden');
                return;
            }

            users[account] = { age: age };
            localStorage.setItem('users', JSON.stringify(users));
            loginMessage.textContent = 'Pendaftaran berhasil! Silakan login.';
            loginMessage.classList.remove('hidden');
            showAlert('Pendaftaran berhasil! Silakan login.', 'Berhasil');
        }

        function loginUser() {
            const account = document.getElementById('loginAccount').value.trim();
            const age = parseInt(document.getElementById('loginAge').value.trim());
            const loginMessage = document.getElementById('loginMessage');

            const users = JSON.parse(localStorage.getItem('users') || '{}');

            if (!users[account] || users[account].age !== age) {
                loginMessage.textContent = 'Akun atau umur salah.';
                loginMessage.classList.remove('hidden');
                return;
            }

            loggedInUser = { account: account, age: users[account].age };
            isLoggedIn = true;
            localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
            localStorage.setItem('isLoggedIn', 'true');

            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loggedInUserDisplay').textContent = `Selamat datang, ${loggedInUser.account}!`;
            document.getElementById('logoutButton').classList.remove('hidden');

            applyKidsModeBasedOnAge();
            applyAllSavedStates();
            initBotTest();
        }

        function logoutUser() {
            showConfirm('Apakah Anda yakin ingin logout?', 'Konfirmasi Logout').then(confirmed => {
                if (confirmed) {
                    isLoggedIn = false;
                    loggedInUser = null;
                    isKidsModeForcedByAge = false;
                    localStorage.removeItem('loggedInUser');
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('isKidsModeForcedByAge');

                    isKidsModeEnabled = false;
                    isSearchSensorEnabled = true;
                    localStorage.setItem('isKidsModeEnabled', 'false');
                    localStorage.setItem('searchSensorEnabled', 'true');

                    showAlert('Anda telah logout.', 'Logout Berhasil');
                    applyAllSavedStates();
                    showLoginModal();
                }
            });
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', async () => {
            applyAllSavedStates();

            if (!isLoggedIn) {
                showLoginModal();
            } else {
                initBotTest();
            }

            setSearchEngine('google');

            // Event listeners
            document.getElementById('menuToggle').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarCloseBtn').addEventListener('click', toggleSidebar);

            document.getElementById('sidebarThemeToggle').addEventListener('change', toggleTheme);
            document.getElementById('sidebarSearchSensorToggle').addEventListener('change', toggleSearchSensor);
            document.getElementById('sidebarKidsModeToggle').addEventListener('change', toggleKidsMode);
            document.getElementById('sidebarBackgroundToggle').addEventListener('change', toggleBackgroundSelectionMode);
            document.getElementById('sidebarGeminiSearchToggle').addEventListener('change', toggleGeminiSearch);
            document.getElementById('sidebarIncognitoModeToggle').addEventListener('change', toggleIncognitoMode);
            document.getElementById('sidebarCustomSearchToggle').addEventListener('change', toggleCustomSearch);
            document.getElementById('sidebarSearchSaverToggle').addEventListener('change', toggleSearchSaver);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearSearchHistory);

            document.getElementById('sidebarHighContrastToggle').addEventListener('change', toggleHighContrastMode);
            document.getElementById('decreaseFontSizeBtn').addEventListener('click', () => adjustFontSize(-1));
            document.getElementById('increaseFontSizeBtn').addEventListener('click', () => adjustFontSize(1));
            document.getElementById('sidebarFocusModeToggle').addEventListener('change', toggleFocusMode);

            document.getElementById('imageUploadInput').addEventListener('change', handleImageUpload);
            document.getElementById('clearImageBtn').addEventListener('click', clearUploadedImage);

            document.getElementById('registerBtn').addEventListener('click', registerUser);
            document.getElementById('loginBtn').addEventListener('click', loginUser);
            document.getElementById('logoutButton').addEventListener('click', logoutUser);

            document.getElementById('addCustomEngineBtn').addEventListener('click', addCustomSearchEngine);

            document.getElementById('generateImageBtn').addEventListener('click', generateImage);

            document.getElementById('voiceSearchBtn').addEventListener('click', startVoiceSearch);

            document.getElementById('backgroundPickerCloseBtn').addEventListener('click', closeBackgroundPicker);

            document.getElementById('sidebarLearningModeToggle').addEventListener('change', toggleLearningMode);
            document.getElementById('nextHistoryBtn').addEventListener('click', nextHistoryTopic);
            document.getElementById('checkMathAnswerBtn').addEventListener('click', checkMathAnswer);
            document.getElementById('newMathProblemBtn').addEventListener('click', generateMathProblem);
            document.getElementById('checkHistoryQuizAnswerBtn').addEventListener('click', checkHistoryAnswer);
            document.getElementById('newHistoryQuizProblemBtn').addEventListener('click', nextHistoryQuestion);

            document.getElementById('sidebarDrawingModeToggle').addEventListener('change', toggleDrawingMode);

            document.getElementById('sidebarParticleEffectToggle').addEventListener('change', toggleParticleEffect);
            document.getElementById('openParticlePickerBtn').addEventListener('click', openParticlePicker);
            document.getElementById('particlePickerCloseBtn').addEventListener('click', closeParticlePicker);
            document.getElementById('applySelectedParticlesBtn').addEventListener('click', applySelectedParticles);

            document.getElementById('sidebarNoteModeToggle').addEventListener('change', toggleNoteMode);
            document.getElementById('sidebarWorldClockToggle').addEventListener('change', toggleWorldClock);
            document.getElementById('noteTextarea').addEventListener('input', updateWordCount);
            document.getElementById('saveNoteBtn').addEventListener('click', saveNote);
            document.getElementById('clearNoteBtn').addEventListener('click', clearNote);

            // Premium feature event listeners
            document.getElementById('sidebarAutoNightModeToggle').addEventListener('change', toggleAutoNightMode);
            document.getElementById('sidebarReminderToggle').addEventListener('change', toggleReminder);
            document.getElementById('sidebarZenModeToggle').addEventListener('change', toggleZenMode);
            document.getElementById('sidebarInstantTranslateToggle').addEventListener('change', toggleInstantTranslate);
            document.getElementById('sidebarFontPickerToggle').addEventListener('change', toggleFontPicker);
            document.getElementById('sidebarSoundEffectsToggle').addEventListener('change', toggleSoundEffects);

            // Add sound effects to existing buttons
            document.getElementById('searchButton').addEventListener('click', () => {
                if (isSoundEffectsEnabled) playSound('click');
            });
            document.getElementById('menuToggle').addEventListener('click', () => {
                if (isSoundEffectsEnabled) playSound('click');
            });

            // Calculator toggle
            const calcToggle = document.getElementById('sidebarCalculatorToggle');
            const calcSection = document.getElementById('calculatorSection');
            const calcStatus = document.getElementById('sidebarCalculatorStatus');

            if (calcToggle) {
                calcToggle.addEventListener('change', () => {
                    if (calcToggle.checked) {
                        calcSection.classList.remove('hidden');
                        calcStatus.textContent = "Aktif";
                        calcStatus.classList.remove('text-red-600');
                        calcStatus.classList.add('text-green-600');
                    } else {
                        calcSection.classList.add('hidden');
                        calcStatus.textContent = "Nonaktif";
                        calcStatus.classList.remove('text-green-600');
                        calcStatus.classList.add('text-red-600');
                    }
                });
            }

            // Weather and other toggles
            const weatherToggle = document.getElementById('sidebarWeatherToggle');
            const hijriToggle = document.getElementById('sidebarHijriToggle');
            const prayerToggle = document.getElementById('sidebarPrayerTimeToggle');

            const weatherSection = document.getElementById('weatherSection');
            const hijriSection = document.getElementById('hijriSection');
            const prayerSection = document.getElementById('prayerTimeSection');

            const updateVisibility = () => {
                if (weatherSection) {
                    weatherSection.style.display = weatherToggle.checked ? 'block' : 'none';
                    document.getElementById('sidebarWeatherStatus').textContent = weatherToggle.checked ? 'Aktif' : 'Nonaktif';
                }
                if (hijriSection) {
                    hijriSection.style.display = hijriToggle.checked ? 'block' : 'none';
                    document.getElementById('sidebarHijriStatus').textContent = hijriToggle.checked ? 'Aktif' : 'Nonaktif';
                }
                if (prayerSection) {
                    prayerSection.style.display = prayerToggle.checked ? 'block' : 'none';
                    document.getElementById('sidebarPrayerTimeStatus').textContent = prayerToggle.checked ? 'Aktif' : 'Nonaktif';
                }
            };

            weatherToggle.addEventListener('change', updateVisibility);
            hijriToggle.addEventListener('change', updateVisibility);
            prayerToggle.addEventListener('change', updateVisibility);

            updateVisibility();

            // Initialize calculator display
            display = document.getElementById('display');
            updateDisplay();

            // Load Hijri date
            loadHijriDate();

            // Initialize particle effect based on loaded state
            if (isParticleEffectEnabled) {
                document.body.addEventListener('click', handleParticleEffect);
                document.body.addEventListener('touchstart', handleParticleEffect);
            }
        });
    </script>
<!-- Game Mode Container (hidden by default) -->
<div id="game-mode-container" style="display: none;">
game arcade by Akhtar

<!DOCTYPE html>

<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Arcade Game Lengkap</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
        /* General body styling */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        /* Animations for Gems Broot */
        @keyframes gemPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        @keyframes gemFall {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes comboEffect {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        @keyframes levelComplete {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .gem-pop { animation: gemPop 0.3s ease-out; }
        .gem-fall { animation: gemFall 0.5s ease-out; }
        .combo-effect { animation: comboEffect 0.8s ease-out; }
        .level-complete { animation: levelComplete 0.6s ease-out; }
        .kitchen-bg {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ffd700 100%);
        }
        .gem-shadow {
            box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.3);
        }

        /* Snake Game specific styling */
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        /* Game screen base styling */
        .game-screen {
            display: none; /* Hidden by default, managed by JS */
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 800px; /* Increased max-width for games */
            margin: 0 auto;
            color: #333;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .back-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .back-btn:hover {
            background: #da190b;
        }

        .game-area {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Specific game styling for 2048 */
        .game-2048 .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            background: #bbada0;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .game-2048 .cell {
            background: #cdc1b4;
            width: 60px;
            height: 60px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #776e65; /* Default text color for empty cells */
        }

        .game-2048 .cell.filled {
            color: #f9f6f2; /* Text color for filled cells */
        }

        /* Flappy Bird Canvas */
        .flappy-canvas {
            border: 2px solid #333;
            background: linear-gradient(to bottom, #87CEEB, #98FB98);
        }

        /* Control Buttons for all games */
        .control-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .control-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: #1976D2;
        }

        .score-display {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        /* Simon Says styling */
        .simon-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 250px;
            margin: 20px auto;
        }

        .simon-btn {
            width: 100px;
            height: 100px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .simon-btn.red { background: #ff4444; }
        .simon-btn.blue { background: #4444ff; }
        .simon-btn.green { background: #44ff44; }
        .simon-btn.yellow { background: #ffff44; }

        .simon-btn.active {
            transform: scale(0.95);
            filter: brightness(1.5);
        }

        /* Connect Four styling */
        .connect4-board {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            background: #1976D2;
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 350px;
        }

        .connect4-cell {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .connect4-cell.red { background: #f44336; }
        .connect4-cell.yellow { background: #ffeb3b; }

        /* Minesweeper styling */
        .minesweeper-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 2px;
            background: #999;
            padding: 10px;
            border-radius: 5px;
            margin: 20px auto;
            max-width: 300px;
        }

        .mine-cell {
            width: 25px;
            height: 25px;
            background: #ccc;
            border: 1px solid #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
        }

        .mine-cell.revealed {
            background: #eee;
        }

        .mine-cell.flagged {
            background: #ff9800;
        }

        /* Wordle styling */
        .wordle-grid {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            gap: 5px;
            margin: 20px auto;
            max-width: 300px;
        }

        .wordle-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }

        .wordle-cell {
            width: 50px;
            height: 50px;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            text-transform: uppercase;
        }

        .wordle-cell.correct { background: #4CAF50; color: white; }
        .wordle-cell.present { background: #FF9800; color: white; }
        .wordle-cell.absent { background: #9E9E9E; color: white; }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            max-width: 500px;
            margin: 20px auto;
        }

        .key {
            padding: 10px 5px;
            background: #eee;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
        }

        .key:hover {
            background: #ddd;
        }

        /* Tetris styling */
        .tetris-board {
            width: 200px;
            height: 400px;
            border: 2px solid #333;
            background: #000;
            margin: 20px auto;
            position: relative;
        }

        /* Breakout styling */
        .breakout-canvas {
            border: 2px solid #333;
            background: #000;
            margin: 20px auto;
        }

        /* Bubble Shooter styling */
        .bubble-canvas {
            border: 2px solid #333;
            background: linear-gradient(to bottom, #87CEEB, #FFB6C1);
            margin: 20px auto;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 2rem;
            }
            .game-screen {
                margin: 10px;
                padding: 15px;
            }
        }
    
/* === TRANSISI ANIMASI === */
.fade-in { animation: fadeIn 1s ease-in-out both; }
@keyframes fadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}
.slide-up { animation: slideUp 0.8s ease-in-out both; }
@keyframes slideUp {
  0% { transform: translateY(30px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}
.zoom-in { animation: zoomIn 0.8s ease-out both; }
@keyframes zoomIn {
  0% { transform: scale(0.8); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
.bounce-in { animation: bounceIn 1s ease both; }
@keyframes bounceIn {
  0% { transform: scale(0.8); opacity: 0; }
  60% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); }
}
.flip-in { animation: flipIn 1s ease-out both; }
@keyframes flipIn {
  0% { transform: rotateX(-90deg); opacity: 0; }
  100% { transform: rotateX(0); opacity: 1; }
}
.rotate-in { animation: rotateIn 1s ease both; }
@keyframes rotateIn {
  0% { transform: rotate(-200deg); opacity: 0; }
  100% { transform: rotate(0); opacity: 1; }
}
</style>
</head>
<body>
<div id="root"></div>
<script>
document.getElementById('sidebarQuranToggle').addEventListener('change', function() {
    document.getElementById('alquran-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarQuranStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarMusicToggle').addEventListener('change', function() {
    document.getElementById('songs-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarMusicStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarTodoToggle').addEventListener('change', function() {
    document.getElementById('todo-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarTodoStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const transitionToggle = document.getElementById("sidebarTransitionToggle");
  const transitionStatus = document.getElementById("sidebarTransitionStatus");
  const transitionSelector = document.getElementById("transitionTypeSelector");
  const animatedElements = [
    "#easySearchSection",
    "#calculatorSection",
    "#drawingModeSection",
    "#imageGenerationSection",
    "#learningModeSection",
    "#searchResults",
    "#searchIntentDisplay"
  ];

  function applyAnimation(animClass) {
    animatedElements.forEach(selector => {
      const el = document.querySelector(selector);
      if (el) {
        el.classList.remove("fade-in", "slide-up", "zoom-in", "bounce-in", "flip-in", "rotate-in");
        if (animClass) {
          el.classList.add(animClass);
        }
      }
    });
  }

  function updateUI(enabled) {
    transitionStatus.textContent = enabled ? "Aktif" : "Nonaktif";
    transitionStatus.classList.toggle("text-green-600", enabled);
    transitionStatus.classList.toggle("text-red-600", !enabled);
    // Show or hide selector
    if (enabled) {
      transitionSelector.classList.remove("hidden");
    } else {
      transitionSelector.classList.add("hidden");
    }
  }

  function updateTransition() {
    if (transitionToggle.checked) {
      applyAnimation(transitionSelector.value);
    } else {
      applyAnimation(null);
    }
  }

  // Event listeners
  transitionToggle.addEventListener("change", () => {
    updateUI(transitionToggle.checked);
    updateTransition();
  });
  transitionSelector.addEventListener("change", updateTransition);

  // Initial state
  updateUI(transitionToggle.checked);
  updateTransition();
});
</script>
<script>
  let geminiUsageCount = 0;
  function useGeminiFeature() {
    if (geminiUsageCount >= 6) {
      alert("Batas interaksi Gemini (6x) telah tercapai.");
      return;
    }
    geminiUsageCount++;
    // Panggil fungsi Gemini kamu di sini, misalnya: runGeminiQuery();
  }
</script>
</body>
</html>
</div>
<script>
        // Toggle display of game mode container
        document.addEventListener('DOMContentLoaded', function() {
            var toggle = document.getElementById('toggleGameMode');
            var container = document.getElementById('game-mode-container');
            toggle.addEventListener('change', function() {
                container.style.display = this.checked ? 'block' : 'none';
            });
        });
    </script>
<div id="alquran-app" style="display: none;"><body class="bg-gray-50 text-gray-800">
<script>
document.getElementById('sidebarQuranToggle').addEventListener('change', function() {
    document.getElementById('alquran-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarQuranStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarMusicToggle').addEventListener('change', function() {
    document.getElementById('songs-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarMusicStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarTodoToggle').addEventListener('change', function() {
    document.getElementById('todo-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarTodoStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
</script>
<script>
  let geminiUsageCount = 0;
  function useGeminiFeature() {
    if (geminiUsageCount >= 6) {
      alert("Batas interaksi Gemini (6x) telah tercapai.");
      return;
    }
    geminiUsageCount++;
    // Panggil fungsi Gemini kamu di sini, misalnya: runGeminiQuery();
  }
</script>
</body>
</div><div id="songs-app" style="display: none;"><body class="bg-gradient-to-br from-indigo-600 to-purple-800 min-h-screen flex flex-col items-center justify-center p-4">
<div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full transform transition-all duration-300 hover:scale-105 mb-8">
<h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Pemutar Musik</h1>
<!-- Album Art / Placeholder -->
<div class="w-48 h-48 mx-auto mb-6 rounded-2xl overflow-hidden shadow-lg border-4 border-indigo-200">
<img alt="Album Art" class="w-full h-full object-cover" id="album-art" src="https://placehold.co/192x192/a78bfa/ffffff?text=Musik"/>
</div>
<!-- Song Info -->
<div class="text-center mb-6">
<h2 class="text-2xl font-semibold text-gray-900 truncate" id="song-title">Tidak Ada Lagu Diputar</h2>
<p class="text-lg text-gray-600" id="song-artist">Silakan tambahkan lagu</p>
</div>
<!-- Progress Bar -->
<div class="progress-bar-container mb-6" id="progress-container">
<div class="progress-bar-fill" id="progress-fill"></div>
</div>
<div class="flex justify-between text-sm text-gray-600 mb-8">
<span id="current-time">0:00</span>
<span id="total-duration">0:00</span>
</div>
<!-- Controls -->
<div class="flex justify-center items-center space-x-6">
<button class="p-3 bg-indigo-100 text-indigo-700 rounded-full shadow-md hover:bg-indigo-200 transition-colors duration-200 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50" disabled="" id="prev-btn">
<!-- Previous Icon (SVG) -->
<svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M11 19l-7-7 7-7m8 14l-7-7 7-7" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
</button>
<button class="p-4 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors duration-200 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50" disabled="" id="play-pause-btn">
<!-- Play Icon (SVG) -->
<svg class="h-8 w-8" fill="none" id="play-icon" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" stroke-linecap="round" stroke-linejoin="round"></path>
<path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
<!-- Pause Icon (SVG) - hidden by default -->
<svg class="h-8 w-8 hidden" fill="none" id="pause-icon" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
</button>
<button class="p-3 bg-indigo-100 text-indigo-700 rounded-full shadow-md hover:bg-indigo-200 transition-colors duration-200 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50" disabled="" id="next-btn">
<!-- Next Icon (SVG) -->
<svg class="h-6 w-6" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M13 5l7 7-7 7M5 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
</button>
</div>
<!-- Add Song Button -->
<div class="mt-8 text-center">
<input accept="audio/*" class="hidden" id="add-song-input" multiple="" type="file"/>
<button class="px-6 py-3 bg-purple-600 text-white rounded-full shadow-lg hover:bg-purple-700 transition-colors duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50" id="add-song-btn">
                Tambah Lagu
            </button>
</div>
</div>
<!-- Song List Display -->
<div class="bg-white rounded-3xl shadow-2xl p-6 max-w-md w-full mt-4">
<h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Daftar Lagu</h3>
<ul class="space-y-2" id="song-list">
<li class="text-center text-gray-500 py-4" id="no-songs-message">Belum ada lagu. Silakan tambahkan!</li>
</ul>
</div>
<audio id="audio-player"></audio>
<script>
        // Get DOM elements
        const audioPlayer = document.getElementById('audio-player');
        const albumArt = document.getElementById('album-art');
        const songTitle = document.getElementById('song-title');
        const songArtist = document.getElementById('song-artist');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const currentTimeSpan = document.getElementById('current-time');
        const totalDurationSpan = document.getElementById('total-duration');
        const addSongInput = document.getElementById('add-song-input');
        const addSongBtn = document.getElementById('add-song-btn');
        const songListElement = document.getElementById('song-list');
        const noSongsMessage = document.getElementById('no-songs-message');

        // Song data (initially empty)
        const songs = [];

        let currentSongIndex = -1; // -1 indicates no song is loaded
        let isPlaying = false;

        // Function to update control button states (enabled/disabled)
        function updateControlsState() {
            const hasSongs = songs.length > 0;
            playPauseBtn.disabled = !hasSongs;
            prevBtn.disabled = !hasSongs;
            nextBtn.disabled = !hasSongs;
            if (!hasSongs) {
                // If no songs, ensure play icon is visible and pause is hidden
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                isPlaying = false;
                audioPlayer.pause(); // Ensure audio is paused if no songs
            }
        }

        // Function to load a song
        function loadSong(song) {
            if (!song) {
                audioPlayer.src = ''; // Clear current audio source
                songTitle.textContent = 'Tidak Ada Lagu Diputar';
                songArtist.textContent = 'Silakan tambahkan lagu';
                albumArt.src = "https://placehold.co/192x192/a78bfa/ffffff?text=Musik";
                progressFill.style.width = '0%';
                currentTimeSpan.textContent = '0:00';
                totalDurationSpan.textContent = '0:00';
                updateControlsState(); // Update button states
                return;
            }

            audioPlayer.src = song.src;
            songTitle.textContent = song.title;
            songArtist.textContent = song.artist;
            albumArt.src = song.albumArt || "https://placehold.co/192x192/cccccc/333333?text=Lagu+Saya"; // Fallback for custom songs
            // Reset progress bar when new song loads
            progressFill.style.width = '0%';
            currentTimeSpan.textContent = '0:00';
            totalDurationSpan.textContent = '0:00';
            // Highlight current song in the list
            updateSongListHighlight();
            updateControlsState(); // Update button states
        }

        // Function to play song
        function playSong() {
            if (songs.length === 0 || currentSongIndex === -1) {
                return; // Cannot play if no songs or no song selected
            }
            isPlaying = true;
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            audioPlayer.play();
        }

        // Function to pause song
        function pauseSong() {
            isPlaying = false;
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioPlayer.pause();
        }

        // Event listener for play/pause button
        playPauseBtn.addEventListener('click', () => {
            if (isPlaying) {
                pauseSong();
            } else {
                playSong();
            }
        });

        // Function to play next song
        function nextSong() {
            if (songs.length === 0) return;
            currentSongIndex = (currentSongIndex + 1) % songs.length; // Loop back to the first song
            loadSong(songs[currentSongIndex]);
            playSong();
        }

        // Function to play previous song
        function prevSong() {
            if (songs.length === 0) return;
            currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length; // Loop to the last song
            loadSong(songs[currentSongIndex]);
            playSong();
        }

        // Event listeners for next/previous buttons
        nextBtn.addEventListener('click', nextSong);
        prevBtn.addEventListener('click', prevSong);

        // Update progress bar and time
        audioPlayer.addEventListener('timeupdate', (e) => {
            const { duration, currentTime } = e.target;
            if (isNaN(duration)) return; // Avoid NaN issues before metadata is loaded
            const progressPercent = (currentTime / duration) * 100;
            progressFill.style.width = `${progressPercent}%`;

            // Update current time
            const minutes = Math.floor(currentTime / 60);
            const seconds = Math.floor(currentTime % 60);
            currentTimeSpan.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        });

        // Set total duration when song metadata is loaded
        audioPlayer.addEventListener('loadedmetadata', () => {
            const duration = audioPlayer.duration;
            if (isNaN(duration)) {
                totalDurationSpan.textContent = '0:00';
                return;
            }
            const minutes = Math.floor(duration / 60);
            const seconds = Math.floor(duration % 60);
            totalDurationSpan.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        });

        // Go to next song when current song ends
        audioPlayer.addEventListener('ended', nextSong);

        // Seek functionality for progress bar
        progressContainer.addEventListener('click', (e) => {
            if (songs.length === 0 || currentSongIndex === -1) return;
            const width = progressContainer.clientWidth; // Total width of the progress bar
            const clickX = e.offsetX; // X position of the click relative to the element
            const duration = audioPlayer.duration;
            if (isNaN(duration)) return; // Prevent seeking before duration is known

            audioPlayer.currentTime = (clickX / width) * duration;
        });

        // --- New functionality for adding songs ---

        // Trigger file input when "Tambah Lagu" button is clicked
        addSongBtn.addEventListener('click', () => {
            addSongInput.click();
        });

        // Handle file selection
        addSongInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (files.length === 0) {
                return;
            }

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type.startsWith('audio/')) {
                    const songUrl = URL.createObjectURL(file);
                    const newSong = {
                        title: file.name.replace(/\.[^/.]+$/, ""), // Remove file extension
                        artist: "Lagu Saya", // Default artist for added songs
                        src: songUrl,
                        albumArt: "https://placehold.co/192x192/cccccc/333333?text=Lagu+Saya" // Generic placeholder
                    };
                    songs.push(newSong);
                } else {
                    console.warn(`File non-audio diabaikan: ${file.name}`);
                }
            }
            renderSongList(); // Re-render the song list to include new songs

            // If no song was playing, or if it's the first song added, load and play it
            if (currentSongIndex === -1 && songs.length > 0) {
                currentSongIndex = 0;
                loadSong(songs[currentSongIndex]);
                playSong();
            } else if (songs.length > 0) {
                // If songs were already present, just ensure controls are enabled
                updateControlsState();
            }
        });

        // Function to render the song list
        function renderSongList() {
            songListElement.innerHTML = ''; // Clear existing list
            if (songs.length === 0) {
                noSongsMessage.classList.remove('hidden'); // Show "No songs" message
                songListElement.appendChild(noSongsMessage);
            } else {
                noSongsMessage.classList.add('hidden'); // Hide "No songs" message
                songs.forEach((song, index) => {
                    const li = document.createElement('li');
                    li.classList.add('flex', 'items-center', 'p-3', 'rounded-lg', 'cursor-pointer', 'hover:bg-indigo-50', 'transition-colors', 'duration-150');
                    li.dataset.index = index; // Store index for easy access

                    // Add active class if it's the current song
                    if (index === currentSongIndex) {
                        li.classList.add('bg-indigo-100', 'text-indigo-800', 'font-semibold');
                    } else {
                        li.classList.add('text-gray-700');
                    }

                    li.innerHTML = `
                        <img src="${song.albumArt || 'https://placehold.co/40x40/cccccc/333333?text=Lagu'}" alt="Album Art" class="w-10 h-10 rounded-md mr-3 object-cover">
                        <div>
                            <div class="text-base truncate">${song.title}</div>
                            <div class="text-sm text-gray-500">${song.artist}</div>
                        </div>
                    `;
                    li.addEventListener('click', () => {
                        currentSongIndex = parseInt(li.dataset.index);
                        loadSong(songs[currentSongIndex]);
                        playSong();
                    });
                    songListElement.appendChild(li);
                });
            }
        }

        // Function to update highlight on the song list
        function updateSongListHighlight() {
            document.querySelectorAll('#song-list li').forEach((item, index) => {
                if (index === currentSongIndex) {
                    item.classList.add('bg-indigo-100', 'text-indigo-800', 'font-semibold');
                    item.classList.remove('text-gray-700');
                } else {
                    item.classList.remove('bg-indigo-100', 'text-indigo-800', 'font-semibold');
                    item.classList.add('text-gray-700');
                }
            });
        }

        // Initial load (no song will be loaded initially) and render the list
        loadSong(null); // Load with null to show "No song playing" message
        renderSongList();
        updateControlsState(); // Ensure controls are disabled initially
    </script>
<script>
document.getElementById('sidebarQuranToggle').addEventListener('change', function() {
    document.getElementById('alquran-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarQuranStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarMusicToggle').addEventListener('change', function() {
    document.getElementById('songs-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarMusicStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarTodoToggle').addEventListener('change', function() {
    document.getElementById('todo-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarTodoStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
</script>
<script>
  let geminiUsageCount = 0;
  function useGeminiFeature() {
    if (geminiUsageCount >= 6) {
      alert("Batas interaksi Gemini (6x) telah tercapai.");
      return;
    }
    geminiUsageCount++;
    // Panggil fungsi Gemini kamu di sini, misalnya: runGeminiQuery();
  }
</script>
</body>
</div><div id="todo-app" style="display: none;"><body>
<div class="container">
<h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Aplikasi To-Do List</h1>
<p class="text-sm text-gray-600 text-center mb-4" id="user-id-display">ID Pengguna: Memuat...</p>
<form class="flex flex-col sm:flex-row gap-4 mb-6" id="todo-form">
<input class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" id="task-input" placeholder="Tambahkan tugas baru..." required="" type="text"/>
<button class="btn btn-primary px-5 py-3" type="submit">Tambahkan</button>
</form>
<div class="space-y-2" id="task-list">
<!-- Tugas akan dimuat di sini -->
<p class="text-center text-gray-500" id="loading-message">Memuat tugas...</p>
</div>
</div>
<!-- Firebase SDK -->
<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for Firebase config and app ID
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let userId = null;

        const taskForm = document.getElementById('todo-form');
        const taskInput = document.getElementById('task-input');
        const taskList = document.getElementById('task-list');
        const userIdDisplay = document.getElementById('user-id-display');
        const loadingMessage = document.getElementById('loading-message');

        // Initialize Firebase
        function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase initialized.");

                // Listen for auth state changes
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdDisplay.textContent = `ID Pengguna: ${userId}`;
                        console.log("User authenticated:", userId);
                        // Start listening to tasks after authentication
                        setupRealtimeListener();
                    } else {
                        // Sign in anonymously if no user is found and no custom token is provided
                        if (!initialAuthToken) {
                            await signInAnonymously(auth);
                            console.log("Signed in anonymously.");
                        }
                    }
                });

                // Sign in with custom token if available
                if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken)
                        .then(() => console.log("Signed in with custom token."))
                        .catch(error => {
                            console.error("Error signing in with custom token:", error);
                            // Fallback to anonymous if custom token fails
                            signInAnonymously(auth)
                                .then(() => console.log("Signed in anonymously after custom token failure."))
                                .catch(anonError => console.error("Error signing in anonymously:", anonError));
                        });
                } else {
                    // If no initial token, sign in anonymously immediately
                    signInAnonymously(auth)
                        .then(() => console.log("Signed in anonymously."))
                        .catch(error => console.error("Error signing in anonymously:", error));
                }

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                userIdDisplay.textContent = "Gagal memuat ID Pengguna. Coba lagi.";
                loadingMessage.textContent = "Gagal memuat tugas.";
            }
        }

        // Setup real-time listener for tasks
        function setupRealtimeListener() {
            if (!db || !userId) {
                console.warn("Firestore atau User ID belum siap.");
                return;
            }

            const todosCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/todos`);
            // Note: orderBy is commented out to avoid potential index issues.
            // Data will be sorted in memory if needed.
            const q = query(todosCollectionRef); // , orderBy('createdAt', 'desc')

            onSnapshot(q, (snapshot) => {
                taskList.innerHTML = ''; // Clear current tasks
                loadingMessage.style.display = 'none'; // Hide loading message

                if (snapshot.empty) {
                    taskList.innerHTML = '<p class="text-center text-gray-500">Belum ada tugas. Tambahkan satu!</p>';
                    return;
                }

                snapshot.docs.forEach(doc => {
                    const task = doc.data();
                    const taskId = doc.id;
                    displayTask(taskId, task.text, task.completed);
                });
            }, (error) => {
                console.error("Error fetching tasks:", error);
                taskList.innerHTML = '<p class="text-center text-red-500">Gagal memuat tugas.</p>';
            });
        }

        // Display a single task in the UI
        function displayTask(id, text, completed) {
            const taskItem = document.createElement('div');
            taskItem.id = `task-${id}`;
            taskItem.className = 'task-item';

            taskItem.innerHTML = `
                <label class="checkbox-label flex items-center flex-grow cursor-pointer">
                    <input type="checkbox" data-id="${id}" ${completed ? 'checked' : ''} class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                    <span class="task-text ml-3 text-lg ${completed ? 'completed' : 'text-gray-800'}">${text}</span>
                </label>
                <button data-id="${id}" class="btn btn-danger text-sm px-3 py-1 ml-4">Hapus</button>
            `;
            taskList.prepend(taskItem); // Add new tasks to the top

            // Add event listeners for the new elements
            taskItem.querySelector('input[type="checkbox"]').addEventListener('change', toggleTaskStatus);
            taskItem.querySelector('.btn-danger').addEventListener('click', deleteTask);
        }

        // Add a new task
        taskForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const taskText = taskInput.value.trim();

            if (taskText === "") return;
            if (!db || !userId) {
                console.error("Firestore atau User ID belum siap. Tidak dapat menambahkan tugas.");
                return;
            }

            try {
                const docRef = await addDoc(collection(db, `artifacts/${appId}/users/${userId}/todos`), {
                    text: taskText,
                    completed: false,
                    createdAt: Date.now() // Timestamp for sorting (if orderBy was used)
                });
                console.log("Tugas ditambahkan dengan ID:", docRef.id);
                taskInput.value = ''; // Clear input
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        });

        // Toggle task completion status
        async function toggleTaskStatus(e) {
            const taskId = e.target.dataset.id;
            const isCompleted = e.target.checked;

            if (!db || !userId) {
                console.error("Firestore atau User ID belum siap. Tidak dapat memperbarui tugas.");
                return;
            }

            try {
                const taskRef = doc(db, `artifacts/${appId}/users/${userId}/todos`, taskId);
                await updateDoc(taskRef, {
                    completed: isCompleted
                });
                console.log("Status tugas diperbarui:", taskId, isCompleted);
            } catch (e) {
                console.error("Error updating document: ", e);
            }
        }

        // Delete a task
        async function deleteTask(e) {
            const taskId = e.target.dataset.id;

            if (!db || !userId) {
                console.error("Firestore atau User ID belum siap. Tidak dapat menghapus tugas.");
                return;
            }

            try {
                const taskRef = doc(db, `artifacts/${appId}/users/${userId}/todos`, taskId);
                await deleteDoc(taskRef);
                console.log("Tugas dihapus:", taskId);
            } catch (e) {
                console.error("Error deleting document: ", e);
            }
        }

        // Initialize Firebase when the window loads
        window.onload = initializeFirebase;
    </script>
<script>
document.getElementById('sidebarQuranToggle').addEventListener('change', function() {
    document.getElementById('alquran-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarQuranStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarMusicToggle').addEventListener('change', function() {
    document.getElementById('songs-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarMusicStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarTodoToggle').addEventListener('change', function() {
    document.getElementById('todo-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarTodoStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
</script>
<script>
  let geminiUsageCount = 0;
  function useGeminiFeature() {
    if (geminiUsageCount >= 6) {
      alert("Batas interaksi Gemini (6x) telah tercapai.");
      return;
    }
    geminiUsageCount++;
    // Panggil fungsi Gemini kamu di sini, misalnya: runGeminiQuery();
  }
</script>
</body>
</div>
<script>
document.getElementById('sidebarQuranToggle').addEventListener('change', function() {
    document.getElementById('alquran-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarQuranStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarMusicToggle').addEventListener('change', function() {
    document.getElementById('songs-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarMusicStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
document.getElementById('sidebarTodoToggle').addEventListener('change', function() {
    document.getElementById('todo-app').style.display = this.checked ? 'block' : 'none';
    document.getElementById('sidebarTodoStatus').textContent = this.checked ? 'Aktif' : 'Nonaktif';
});
</script>
<script>
  let geminiUsageCount = 0;
  function useGeminiFeature() {
    if (geminiUsageCount >= 6) {
      alert("Batas interaksi Gemini (6x) telah tercapai.");
      return;
    }
    geminiUsageCount++;
    // Panggil fungsi Gemini kamu di sini, misalnya: runGeminiQuery();
  }
</script>
<div class="alquran-wrapper" id="alQuranContainer" style="display: none;"><div id="react-app"></div></div><script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Data for Prophets
        const prophetsData = [
            {
                id: 1,
                name: "Adam",
                arabicName: "Ø¢Ø¯Ù…",
                title: "Bapak Manusia Pertama",
                period: "Awal Penciptaan",
                location: "Surga, kemudian Bumi",
                story: "Nabi Adam AS adalah manusia pertama yang diciptakan Allah SWT. Beliau diciptakan dari tanah liat yang dibentuk dengan sempurna. Allah SWT meniupkan ruh-Nya ke dalam diri Adam, kemudian mengajarkannya nama-nama segala sesuatu. Para malaikat diperintahkan untuk bersujud kepada Adam sebagai penghormatan atas keistimewaannya sebagai khalifah di bumi.",
                miracles: ["Diajari nama-nama segala sesuatu oleh Allah", "Mampu mengajarkan ilmu kepada malaikat", "Diciptakan langsung oleh Allah tanpa ayah dan ibu"],
                lessons: ["Manusia adalah makhluk mulia yang dipilih Allah sebagai khalifah", "Pentingnya meminta ampun ketika berbuat salah", "Ilmu adalah karunia Allah yang harus digunakan dengan baik"],
                family: "Istri: Hawa, Anak: Qabil, Habil, Syits, dan lainnya"
            },
            {
                id: 2,
                name: "Idris",
                arabicName: "Ø¥Ø¯Ø±ÙŠØ³",
                title: "Nabi yang Diangkat ke Langit",
                period: "Setelah Adam",
                location: "Babylon, Iraq",
                story: "Nabi Idris AS adalah nabi ketiga setelah Adam dan Syits. Beliau dikenal sebagai orang pertama yang menulis dengan pena dan menjahit pakaian. Allah SWT mengangkat derajatnya ke tempat yang tinggi. Nabi Idris sangat rajin beribadah dan selalu mengajak kaumnya untuk bertauhid kepada Allah.",
                miracles: ["Diangkat ke langit dalam keadaan hidup", "Diajarkan ilmu menulis dan menjahit", "Diberi umur yang panjang untuk berdakwah"],
                lessons: ["Pentingnya ilmu pengetahuan dalam kehidupan", "Ketekunan dalam beribadah", "Mengajak kebaikan dengan hikmah"],
                family: "Keturunan dari Nabi Adam AS"
            },
            {
                id: 3,
                name: "Nuh",
                arabicName: "Ù†ÙˆØ­",
                title: "Bapak Kedua Umat Manusia",
                period: "950 tahun berdakwah",
                location: "Mesopotamia",
                story: "Nabi Nuh AS berdakwah selama 950 tahun kepada kaumnya yang telah menyekutukan Allah. Meskipun berdakwah dengan sabar dan hikmah, hanya sedikit yang beriman. Allah kemudian memerintahkan Nuh untuk membuat bahtera besar. Datanglah banjir besar yang menenggelamkan seluruh kaum yang kafir, sementara Nuh dan pengikutnya selamat di dalam bahtera.",
                miracles: ["Bahtera besar yang dapat menampung semua makhluk", "Air bah yang menutupi seluruh bumi", "Diberikan umur yang sangat panjang"],
                lessons: ["Kesabaran dalam berdakwah", "Ketaatan kepada perintah Allah", "Akibat dari kedurhakaan kepada Allah"],
                family: "Istri yang tidak beriman, anak: Sam, Ham, Yafits (beriman), Kan'an (tidak beriman)"
            },
            {
                id: 4,
                name: "Hud",
                arabicName: "Ù‡ÙˆØ¯",
                title: "Rasul untuk Kaum 'Ad",
                period: "Setelah Nuh",
                location: "Semenanjung Arab (Ahqaf)",
                story: "Nabi Hud AS diutus kepada kaum 'Ad yang terkenal dengan kekuatan fisik dan bangunan megah mereka. Kaum 'Ad menyombongkan diri dan menyekutukan Allah. Nabi Hud mengajak mereka bertauhid, namun mereka menolak. Allah menghukum mereka dengan angin topan yang sangat dahsyat selama delapan hari tujuh malam.",
                miracles: ["Selamat dari azab angin topan", "Diberi kekuatan untuk menghadapi kaum yang sombong"],
                lessons: ["Bahaya kesombongan dan keangkuhan", "Kekuatan fisik bukan jaminan keselamatan", "Pentingnya tunduk kepada Allah"],
                family: "Dari keturunan Sam bin Nuh"
            },
            {
                id: 5,
                name: "Saleh",
                arabicName: "ØµØ§Ù„Ø­",
                title: "Rasul untuk Kaum Tsamud",
                period: "Setelah Hud",
                location: "Hijr (Arab Saudi utara)",
                story: "Nabi Saleh AS diutus kepada kaum Tsamud yang mahir memahat gunung menjadi rumah. Mereka meminta mukjizat berupa unta betina yang keluar dari batu gunung. Allah mengabulkan, namun mereka diberi syarat tidak boleh mengganggu unta tersebut. Akhirnya mereka membunuh unta itu, sehingga Allah mengazab mereka dengan suara keras yang membelah dada.",
                miracles: ["Unta betina yang keluar dari batu gunung", "Unta tersebut dapat menghasilkan susu untuk semua orang"],
                lessons: ["Jangan melanggar perjanjian dengan Allah", "Keajaiban Allah dapat terjadi kapan saja", "Akibat dari pembangkangan terhadap perintah Allah"],
                family: "Dari keturunan Sam bin Nuh"
            },
            {
                id: 6,
                name: "Ibrahim",
                arabicName: "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…",
                title: "Khalilullah (Kekasih Allah)",
                period: "2150-1975 SM",
                location: "Ur, Babel, Palestina, Mesir",
                story: "Nabi Ibrahim AS adalah bapak para nabi. Beliau lahir di tengah masyarakat penyembah berhala. Sejak kecil, Ibrahim sudah merenungkan keesaan Allah. Beliau menghancurkan berhala-berhala kaumnya dan mengajak mereka bertauhid. Raja Namrud melemparkannya ke api, namun Allah menjadikan api itu dingin dan sejuk bagi Ibrahim.",
                miracles: ["Api yang menjadi dingin dan sejuk", "Dikaruniai anak di usia tua", "Dapat berkomunikasi dengan Allah secara langsung"],
                lessons: ["Keberanian dalam menegakkan tauhid", "Tawakal dan kepasrahan kepada Allah", "Pentingnya mendidik keluarga dalam keimanan"],
                family: "Istri: Sarah, Hajar. Anak: Ishaq, Ismail"
            },
            {
                id: 7,
                name: "Luth",
                arabicName: "Ù„ÙˆØ·",
                title: "Nabi yang Selamat dari Azab",
                period: "Sezaman dengan Ibrahim",
                location: "Sodom dan Gomora",
                story: "Nabi Luth AS diutus kepada kaum Sodom dan Gomora yang melakukan perbuatan keji (homoseksual). Nabi Luth mengajak mereka bertaubat, namun mereka malah mengancam akan mengusirnya. Allah menghancurkan kota mereka dengan membalikkannya dan menurunkan hujan batu.",
                miracles: ["Selamat dari kehancuran kota bersama keluarganya", "Malaikat yang menyamar sebagai tamu"],
                lessons: ["Akibat dari perbuatan maksiat yang melanggar fitrah", "Allah selalu menyelamatkan hamba-Nya yang beriman", "Pentingnya amar ma'ruf nahi munkar"],
                family: "Keponakan Ibrahim, istri yang tidak beriman (menjadi tiang garam)"
            },
            {
                id: 8,
                name: "Ismail",
                arabicName: "Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„",
                title: "Bapak Bangsa Arab",
                period: "Anak Ibrahim",
                location: "Mekah",
                story: "Nabi Ismail AS adalah putra Nabi Ibrahim dari Hajar. Ketika masih bayi, Ibrahim meninggalkan Ismail dan ibunya di lembah Mekah yang tandus atas perintah Allah. Air zamzam memancar untuk menyelamatkan mereka. Ketika dewasa, Ismail membantu ayahnya membangun Ka'bah dan rela dikorbankan demi ketaatan kepada Allah.",
                miracles: ["Air zamzam yang memancar", "Rela dikorbankan namun diganti dengan kambing", "Membangun Ka'bah bersama Ibrahim"],
                lessons: ["Ketaatan kepada orang tua dan Allah", "Kesabaran dalam menghadapi ujian", "Keikhlasan dalam beribadah"],
                family: "Ayah: Ibrahim, Ibu: Hajar, Saudara: Ishaq"
            },
            {
                id: 9,
                name: "Ishaq",
                arabicName: "Ø¥Ø³Ø­Ø§Ù‚",
                title: "Putra yang Dijanjikan",
                period: "Anak Ibrahim",
                location: "Palestina",
                story: "Nabi Ishaq AS adalah putra Nabi Ibrahim dari Sarah yang lahir ketika ibunya sudah sangat tua. Kelahirannya merupakan mukjizat dan pemenuhan janji Allah. Ishaq menjadi nenek moyang Bani Israel dan melanjutkan dakwah tauhid ayahnya. Beliau dikenal sebagai sosok yang saleh dan taat kepada Allah.",
                miracles: ["Lahir dari ibu yang sudah tua", "Menjadi nenek moyang para nabi", "Diberkahi dengan keturunan yang saleh"],
                lessons: ["Janji Allah pasti terpenuhi", "Pentingnya memelihara warisan iman", "Keberkahan dalam ketaatan"],
                family: "Ayah: Ibrahim, Ibu: Sarah, Saudara: Ismail, Anak: Ya'qub, 'Esau"
            },
            {
                id: 10,
                name: "Ya'qub",
                arabicName: "ÙŠØ¹Ù‚ÙˆØ¨",
                title: "Israel (Hamba Allah)",
                period: "Cucu Ibrahim",
                location: "Palestina",
                story: "Nabi Ya'qub AS adalah putra Nabi Ishaq. Beliau juga disebut Israel yang artinya 'hamba Allah'. Ya'qub memiliki 12 anak laki-laki yang kemudian menjadi nenek moyang 12 suku Israel. Beliau mengalami ujian berat ketika putra kesayangannya, Yusuf, hilang selama bertahun-tahun.",
                miracles: ["Diberi nama Israel oleh Allah", "Mata yang memutih karena menangis dapat kembali normal", "Keturunan yang menjadi para nabi"],
                lessons: ["Kesabaran dalam menghadapi ujian keluarga", "Cinta kepada anak harus seimbang", "Tawakal kepada Allah dalam segala hal"],
                family: "Ayah: Ishaq, Istri: Lia, Rahel. Anak: Yusuf, Bunyamin, dan 10 lainnya"
            },
            {
                id: 11,
                name: "Yusuf",
                arabicName: "ÙŠÙˆØ³Ù",
                title: "Yang Tercantik",
                period: "Putra Ya'qub",
                location: "Palestina, Mesir",
                story: "Nabi Yusuf AS adalah putra kesayangan Ya'qub. Karena kecemburuan, saudara-saudaranya memasukkannya ke sumur. Yusuf kemudian dijual sebagai budak di Mesir. Dengan ketaqwaan dan kemampuannya menafsirkan mimpi, Yusuf akhirnya menjadi menteri di Mesir dan dapat bertemu kembali dengan keluarganya.",
                miracles: ["Dapat menafsirkan mimpi dengan benar", "Selamat dari rayuan istri Al-Aziz", "Menjadi penguasa Mesir dari seorang budak"],
                lessons: ["Ketaqwaan akan mengangkat derajat seseorang", "Kesabaran dalam menghadapi fitnah", "Memaafkan adalah akhlak mulia"],
                family: "Ayah: Ya'qub, Ibu: Rahel, Saudara: 11 orang, Istri: Zulaikha"
            },
            {
                id: 12,
                name: "Ayyub",
                arabicName: "Ø£ÙŠÙˆØ¨",
                title: "Hamba yang Sabar",
                period: "Sezaman dengan Ya'qub",
                location: "Hauran (Suriah)",
                story: "Nabi Ayyub AS adalah contoh kesabaran terbaik. Beliau diuji Allah dengan kehilangan harta, anak-anak, dan kesehatan. Tubuhnya penuh penyakit kulit yang parah selama bertahun-tahun. Meskipun demikian, Ayyub tidak pernah mengeluh dan tetap bersyukur kepada Allah. Akhirnya Allah mengembalikan kesehatannya dan memberikan yang lebih baik.",
                miracles: ["Kesabaran luar biasa dalam menghadapi ujian", "Disembuhkan dari penyakit dengan mata air", "Dikembalikan harta dan keluarga berlipat ganda"],
                lessons: ["Ujian adalah bentuk kasih sayang Allah", "Kesabaran akan membuahkan hasil yang manis", "Selalu bersyukur dalam segala kondisi"],
                family: "Istri: Rahma (yang setia menemaninya), anak-anak yang dikembalikan Allah"
            },
            {
                id: 13,
                name: "Syu'aib",
                arabicName: "Ø´Ø¹ÙŠØ¨",
                title: "Khatib Para Nabi",
                period: "Setelah Yusuf",
                location: "Madyan (Arab Saudi)",
                story: "Nabi Syu'aib AS diutus kepada penduduk Madyan yang suka curang dalam timbangan dan takaran. Beliau mengajak mereka untuk jujur dalam berdagang dan bertauhid kepada Allah. Karena penolakan mereka, Allah mengazab dengan gempa dan suara keras yang memekakkan telinga.",
                miracles: ["Selamat dari azab yang menimpa kaumnya", "Diberi kemampuan berpidato yang sangat baik"],
                lessons: ["Pentingnya kejujuran dalam berbisnis", "Keadilan dalam muamalah", "Dakwah harus disampaikan dengan cara yang baik"],
                family: "Salah satu putrinya menikah dengan Nabi Musa"
            },
            {
                id: 14,
                name: "Musa",
                arabicName: "Ù…ÙˆØ³Ù‰",
                title: "Kalimullah (Yang Berbicara dengan Allah)",
                period: "1391-1271 SM",
                location: "Mesir, Sinai",
                story: "Nabi Musa AS lahir ketika Fir'aun membunuh bayi laki-laki Bani Israel. Ibunya memasukkannya ke peti dan dihanyutkan di sungai Nil. Musa dipungut dan dibesarkan di istana Fir'aun. Setelah dewasa, Allah mengutusnya untuk membebaskan Bani Israel dari perbudakan dan membawa mereka keluar dari Mesir.",
                miracles: ["Tongkat yang berubah menjadi ular", "Tangan yang bercahaya putih", "Membelah laut Merah", "Menurunkan manna dan salwa", "Memancarkan air dari batu"],
                lessons: ["Allah melindungi hamba-Nya yang dipilih", "Keberanian menghadapi kezaliman", "Pentingnya membebaskan yang tertindas"],
                family: "Saudara: Harun, Maryam. Istri: putri Syu'aib"
            },
            {
                id: 15,
                name: "Harun",
                arabicName: "Ù‡Ø§Ø±ÙˆÙ†",
                title: "Pendamping Musa",
                period: "Saudara Musa",
                location: "Mesir, Sinai",
                story: "Nabi Harun AS adalah saudara Nabi Musa yang pandai berbicara. Allah menjadikannya sebagai pendamping Musa dalam berdakwah kepada Fir'aun dan Bani Israel. Ketika Musa pergi ke Bukit Tursina, Harun memimpin Bani Israel. Sayangnya, sebagian Bani Israel menyembah patung anak sapi emas dalam ketidakhadirannya.",
                miracles: ["Tongkat yang berbunga dan berbuah", "Dapat berbicara dengan fasih", "Menjadi imam bagi Bani Israel"],
                lessons: ["Pentingnya kerjasama dalam dakwah", "Tanggung jawab kepemimpinan", "Ujian bagi para pemimpin"],
                family: "Saudara: Musa, Maryam"
            },
            {
                id: 16,
                name: "Dzulkifli",
                arabicName: "Ø°Ùˆ Ø§Ù„ÙƒÙÙ„",
                title: "Yang Berkecukupan",
                period: "Setelah Musa",
                location: "Damaskus/Babylon",
                story: "Nabi Dzulkifli AS adalah nabi yang dikenal dengan kesabarannya. Beliau memikul tanggung jawab berat dalam memimpin kaumnya dan selalu memenuhi janjinya. Nama Dzulkifli berarti 'yang memikul tanggung jawab' atau 'yang berkecukupan'. Beliau terkenal adil dalam memutuskan perkara dan sabar dalam menghadapi ujian.",
                miracles: ["Kesabaran luar biasa dalam memikul tanggung jawab", "Keadilan dalam memutuskan perkara"],
                lessons: ["Amanah harus ditunaikan dengan baik", "Pemimpin harus adil dan sabar", "Menepati janji adalah sifat mulia"],
                family: "Kemungkinan dari keturunan Ibrahim atau Ishaq"
            },
            {
                id: 17,
                name: "Daud",
                arabicName: "Ø¯Ø§ÙˆØ¯",
                title: "Khalifah di Bumi",
                period: "1040-970 SM",
                location: "Palestina",
                story: "Nabi Daud AS adalah raja sekaligus nabi. Beliau mengalahkan Jalut (Goliath) dengan ketapel ketika masih muda. Allah memberikan Daud suara yang merdu dan kitab Zabur. Gunung-gunung dan burung-burung ikut bertasbih bersamanya. Beliau juga pandai membuat baju besi dan selalu berlaku adil sebagai raja.",
                miracles: ["Suara yang dapat membuat gunung dan burung bertasbih", "Pandai membuat baju besi", "Mengalahkan Jalut dengan batu ketapel", "Diberi kitab Zabur"],
                lessons: ["Kekuatan sejati datang dari Allah", "Pemimpin harus adil dan bijaksana", "Seni dan ibadah dapat disatukan"],
                family: "Anak: Sulaiman dan lainnya"
            },
            {
                id: 18,
                name: "Sulaiman",
                arabicName: "Ø³Ù„ÙŠÙ…Ø§Ù†",
                title: "Raja yang Bijaksana",
                period: "970-931 SM",
                location: "Palestina",
                story: "Nabi Sulaiman AS mewarisi kerajaan ayahnya, Daud. Allah memberikan kemampuan luar biasa: dapat berbicara dengan hewan, mengendalikan jin, dan menguasai angin. Kerajaannya sangat luas dan makmur. Kisah terkenalnya adalah dengan Ratu Bilqis dari Saba yang akhirnya masuk Islam berkat dakwah Sulaiman.",
                miracles: ["Dapat berbicara dengan hewan dan jin", "Mengendalikan angin untuk transportasi", "Istana dari kaca yang transparan", "Tahta Ratu Bilqis dipindahkan dalam sekejap"],
                lessons: ["Kekuasaan adalah amanah dari Allah", "Bijaksana dalam memutuskan perkara", "Menggunakan kekuatan untuk kebaikan"],
                family: "Ayah: Daud, Istri: Ratu Bilqis dan lainnya"
            },
            {
                id: 19,
                name: "Ilyas",
                arabicName: "Ø¥Ù„ÙŠØ§Ø³",
                title: "Penentang Ba'al",
                period: "Abad ke-9 SM",
                location: "Israel Utara",
                story: "Nabi Ilyas AS diutus kepada Bani Israel yang menyembah berhala Ba'al. Raja Ahab dan istrinya Izebel menyebarkan penyembahan berhala. Ilyas menantang 450 nabi Ba'al dalam adu mukjizat di Gunung Karmel. Api dari langit membakar korban persembahan Ilyas, membuktikan kebenaran tauhid.",
                miracles: ["Api dari langit yang membakar korban persembahan", "Menghidupkan anak yang telah mati", "Mengangkat ke langit tanpa mati"],
                lessons: ["Kebenaran akan selalu menang", "Berani melawan kebatilan", "Mukjizat membuktikan kebenaran dakwah"],
                family: "Dari keturunan Harun"
            },
            {
                id: 20,
                name: "Ilyasa'",
                arabicName: "Ø§Ù„ÙŠØ³Ø¹",
                title: "Penerus Ilyas",
                period: "Setelah Ilyas",
                location: "Israel",
                story: "Nabi Ilyasa' AS adalah murid dan penerus Nabi Ilyas. Beliau melanjutkan dakwah Ilyas dalam mengajak Bani Israel kembali kepada tauhid. Ilyasa' melakukan banyak mukjizat untuk menguatkan dakwahnya, termasuk menyembuhkan orang sakit dan menghidupkan orang mati dengan izin Allah.",
                miracles: ["Menyembuhkan berbagai penyakit", "Menghidupkan orang mati", "Melipatgandakan makanan", "Membuat kapak terapung di air"],
                lessons: ["Melanjutkan perjuangan dakwah", "Mukjizat untuk menguatkan iman", "Kesabaran dalam menghadapi kemunkaran"],
                family: "Murid dan penerus Nabi Ilyas"
            },
            {
                id: 21,
                name: "Yunus",
                arabicName: "ÙŠÙˆÙ†Ø³",
                title: "Dzun Nun (Orang yang Memiliki Ikan)",
                period: "Abad ke-8 SM",
                location: "Ninawa (Iraq)",
                story: "Nabi Yunus AS diutus kepada penduduk Ninawa. Ketika kaumnya tidak mau beriman, Yunus meninggalkan mereka dalam keadaan marah. Di tengah perjalanan laut, kapal yang ditumpanginya hampir tenggelam. Yunus dilempar ke laut dan ditelan ikan besar. Di dalam perut ikan, beliau bertaubat, dan Allah menyelamatkannya.",
                miracles: ["Hidup di dalam perut ikan paus", "Kaumnya beriman setelah melihat azab", "Pohon labu yang tumbuh untuk menaunginya"],
                lessons: ["Pentingnya sabar dalam berdakwah", "Taubat diterima Allah kapan saja", "Jangan meninggalkan tugas sebelum selesai"],
                family: "Diutus kepada 100.000 orang di Ninawa"
            },
            {
                id: 22,
                name: "Zakaria",
                arabicName: "Ø²ÙƒØ±ÙŠØ§",
                title: "Pemelihara Maryam",
                period: "Abad ke-1 SM",
                location: "Palestina",
                story: "Nabi Zakaria AS adalah pemelihara Siti Maryam di Baitul Maqdis. Meskipun sudah tua dan istrinya mandul, Zakaria memohon kepada Allah untuk dikaruniai anak. Allah mengabulkan doanya dan memberikan putra bernama Yahya. Zakaria menerima kabar gembira ini melalui malaikat saat sedang shalat di mihrab.",
                miracles: ["Dikaruniai anak di usia tua", "Istri yang mandul dapat hamil", "Komunikasi dengan malaikat"],
                lessons: ["Doa yang ikhlas akan dikabulkan Allah", "Umur tidak menghalangi rahmat Allah", "Pentingnya mendidik generasi penerus"],
                family: "Istri: Isyaba, Anak: Yahya"
            },
            {
                id: 23,
                name: "Yahya",
                arabicName: "ÙŠØ­ÙŠÙ‰",
                title: "Sayyid dan Hasur",
                period: "Anak Zakaria",
                location: "Palestina",
                story: "Nabi Yahya AS lahir dari pasangan tua Zakaria dan Isyaba. Sejak kecil, Yahya sudah menunjukkan kecerdasan dan ketaqwaan yang luar biasa. Beliau diberi gelar 'sayyid' (pemimpin) dan 'hasur' (yang menjauhkan diri dari wanita). Yahya menjadi saksi kebenaran risalah Nabi Isa dan dibunuh oleh penguasa zalim.",
                miracles: ["Cerdas dan saleh sejak kecil", "Dapat berbicara ketika masih bayi", "Menjadi pemimpin Bani Israel di usia muda"],
                lessons: ["Kesalehan sejak dini", "Keberanian menegakkan kebenaran", "Menjadi saksi kebenaran"],
                family: "Ayah: Zakaria, Ibu: Isyaba"
            },
            {
                id: 24,
                name: "Isa",
                arabicName: "Ø¹ÙŠØ³Ù‰",
                title: "Al-Masih (Yang Diurapi)",
                period: "Abad ke-1 M",
                location: "Palestina",
                story: "Nabi Isa AS lahir dari Siti Maryam tanpa ayah sebagai mukjizat Allah. Beliau dapat berbicara sejak bayi untuk membela ibunya dari tuduhan. Isa diberi mukjizat menyembuhkan orang sakit, menghidupkan orang mati, dan menurunkan hidangan dari langit. Ketika hendak dibunuh, Allah mengangkatnya ke langit.",
                miracles: ["Lahir tanpa ayah", "Berbicara sejak bayi", "Menyembuhkan orang buta dan lepra", "Menghidupkan orang mati", "Menurunkan hidangan dari langit", "Diangkat ke langit"],
                lessons: ["Mukjizat Allah tidak terbatas", "Kasih sayang kepada sesama", "Kebenaran akan selalu dilindungi Allah"],
                family: "Ibu: Maryam binti Imran"
            },
            {
                id: 25,
                name: "Muhammad",
                arabicName: "Ù…Ø­Ù…Ø¯",
                title: "Khatamun Nabiyyin (Penutup Para Nabi)",
                period: "571-632 M",
                location: "Mekah, Madinah",
                story: "Nabi Muhammad SAW adalah nabi terakhir yang diutus Allah untuk seluruh umat manusia. Beliau lahir yatim dan dibesarkan oleh kakeknya kemudian pamannya. Pada usia 40 tahun, beliau menerima wahyu pertama di Gua Hira. Muhammad berdakwah selama 23 tahun, mengajak manusia kepada tauhid dan akhlak mulia.",
                miracles: ["Al-Quran sebagai mukjizat abadi", "Isra Mi'raj", "Membelah bulan", "Memancarkan air dari sela jari", "Pohon yang bergerak mendatanginya"],
                lessons: ["Islam adalah agama universal", "Akhlak mulia adalah inti ajaran Islam", "Perjuangan dakwah memerlukan kesabaran"],
                family: "Istri: Khadijah, Aisyah, dan lainnya. Anak: Fatimah, Zainab, Ruqayyah, Ummu Kultsum, Qasim, Abdullah, Ibrahim"
            }
        ];

        // Data for Tajwid
        const tajwidData = [
            {
                id: 1,
                title: "Makhraj Huruf",
                category: "makhraj",
                difficulty: "mudah",
                description: "Tempat keluarnya huruf hijaiyyah ketika diucapkan",
                explanation: "Makhraj adalah tempat keluarnya huruf-huruf hijaiyyah. Setiap huruf memiliki tempat keluar yang spesifik dalam mulut, tenggorokan, atau hidung. Pengetahuan tentang makhraj sangat penting agar pengucapan huruf-huruf Al-Quran menjadi benar dan sesuai dengan kaidah yang diajarkan Rasulullah SAW.",
                examples: [
                    {
                        arabic: "Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙŽ Ø§Ù„Ù„ÙŽÙ‘Ù‡Ù Ø£ÙŽØ­ÙŽØ¯ÙŒ",
                        transliteration: "Qul huwallaahu ahad",
                        surah: "Al-Ikhlas",
                        ayah: 1
                    }
                ],
                rules: [
                    "Huruf halqi (tenggorokan): Ø¡ØŒ Ù‡ØŒ Ø¹ØŒ Ø­ØŒ ØºØŒ Ø®",
                    "Huruf lisani (lidah): Ù‚ØŒ ÙƒØŒ Ø¬ØŒ Ø´ØŒ ÙŠØŒ Ø¶ØŒ Ù„ØŒ Ù†ØŒ Ø±ØŒ Ø·ØŒ Ø¯ØŒ ØªØŒ ØµØŒ Ø²ØŒ Ø³ØŒ Ø¸ØŒ Ø°ØŒ Ø«",
                    "Huruf syafawi (bibir): ÙØŒ Ø¨ØŒ Ù…ØŒ Ùˆ"
                ]
            },
            {
                id: 2,
                title: "Sifat Huruf",
                category: "sifat",
                difficulty: "menengah",
                description: "Karakteristik dan sifat-sifat huruf hijaiyyah",
                explanation: "Sifat huruf adalah karakteristik yang melekat pada setiap huruf hijaiyyah. Sifat-sifat ini menentukan cara pengucapan huruf tersebut. Ada 17 sifat huruf yang terbagi menjadi sifat yang memiliki lawan (mutadhadah) dan sifat yang tidak memiliki lawan (ghair mutadhadah).",
                examples: [
                    {
                        arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø­Ù’Ù…ÙŽÙ°Ù†Ù Ø§Ù„Ø±ÙŽÙ‘Ø­ÙÙŠÙ…Ù",
                        transliteration: "Ar-Rahmaanir-Rahiim",
                        surah: "Al-Fatihah",
                        ayah: 3
                    }
                ],
                rules: [
                    "Sifat mutadhadah (berlawanan): jahr-hams, syiddah-rikhwah, isti'la-istifal, itbaq-infitah, idzlaq-ishmat",
                    "Sifat ghair mutadhadah: shafir, qalqalah, lin, inhiraf, takrir, tafasysyi, istithalah"
                ]
            },
            {
                id: 3,
                title: "Ahkam Nun Sakinah dan Tanwin",
                category: "ahkam",
                difficulty: "mudah",
                description: "Hukum bacaan nun mati dan tanwin",
                explanation: "Nun sakinah adalah huruf nun yang tidak berharakat (sukun), sedangkan tanwin adalah dua harakat yang menunjukkan nun sakinah. Keduanya memiliki 4 hukum bacaan: idzhar, idghom, iqlab, dan ikhfa yang bergantung pada huruf yang datang setelahnya.",
                examples: [
                    {
                        arabic: "Ù…ÙÙ†Ù’ Ø®ÙŽÙŠÙ’Ø±Ù",
                        transliteration: "min khair",
                        surah: "Al-Baqarah",
                        ayah: 215
                    }
                ],
                rules: [
                    "Idzhar: jika bertemu huruf halqi (Ø¡ØŒ Ù‡ØŒ Ø¹ØŒ Ø­ØŒ ØºØŒ Ø®)",
                    "Idghom: jika bertemu huruf yarmalun (ÙŠØŒ Ø±ØŒ Ù…ØŒ Ù„ØŒ ÙˆØŒ Ù†)",
                    "Iqlab: jika bertemu huruf ba (Ø¨)",
                    "Ikhfa: jika bertemu 15 huruf sisanya"
                ]
            },
            {
                id: 4,
                title: "Ahkam Mim Sakinah",
                category: "ahkam",
                difficulty: "mudah",
                description: "Hukum bacaan mim mati",
                explanation: "Mim sakinah adalah huruf mim yang tidak berharakat (sukun). Mim sakinah memiliki 3 hukum bacaan yang bergantung pada huruf yang datang setelahnya: idzhar syafawi, idghom mimi, dan ikhfa syafawi.",
                examples: [
                    {
                        arabic: "Ù„ÙŽÙ‡ÙÙ…Ù’ Ø¨ÙŽÙŠÙ’ØªÙ‹Ø§",
                        transliteration: "lahum baitan",
                        surah: "Al-Ankabut",
                        ayah: 41
                    }
                ],
                rules: [
                    "Idzhar syafawi: jika bertemu semua huruf kecuali mim dan ba",
                    "Idghom mimi: jika bertemu huruf mim",
                    "Ikhfa syafawi: jika bertemu huruf ba"
                ]
            },
            {
                id: 5,
                title: "Mad Asli (Thobi'i)",
                category: "mad",
                difficulty: "mudah",
                description: "Bacaan panjang alami",
                explanation: "Mad asli atau thobi'i adalah bacaan panjang yang alami, tidak bergantung pada sebab tertentu. Panjangnya adalah 2 harakat (1 alif). Mad ini terjadi ketika huruf mad (alif, waw sukun, ya sukun) tidak bertemu dengan hamzah atau sukun.",
                examples: [
                    {
                        arabic: "Ù‚ÙŽØ§Ù„ÙŽ",
                        transliteration: "qaala",
                        surah: "Al-Baqarah",
                        ayah: 30
                    }
                ],
                rules: [
                    "Huruf mad: alif (setelah fathah), waw sukun (setelah dhammah), ya sukun (setelah kasrah)",
                    "Panjang: 2 harakat (1 alif)",
                    "Tidak boleh lebih atau kurang dari 2 harakat"
                ]
            },
            {
                id: 6,
                title: "Mad Wajib Muttashil",
                category: "mad",
                difficulty: "menengah",
                description: "Mad yang wajib dipanjangkan karena bertemu hamzah dalam satu kata",
                explanation: "Mad wajib muttashil terjadi ketika huruf mad bertemu dengan hamzah dalam satu kata. Dinamakan wajib karena semua qari sepakat untuk memanjangkannya, dan muttashil karena mad dan hamzah berada dalam satu kata yang bersambung.",
                examples: [
                    {
                        arabic: "Ø¬ÙŽØ§Ø¡ÙŽ",
                        transliteration: "jaa'a",
                        surah: "Al-Baqarah",
                        ayah: 87
                    }
                ],
                rules: [
                    "Mad dan hamzah dalam satu kata",
                    "Panjang: 4-5 harakat (2-2.5 alif)",
                    "Wajib dipanjangkan oleh semua qari"
                ]
            },
            {
                id: 7,
                title: "Mad Jaiz Munfashil",
                category: "mad",
                difficulty: "menengah",
                description: "Mad yang boleh dipanjangkan karena bertemu hamzah dalam kata berbeda",
                explanation: "Mad jaiz munfashil terjadi ketika huruf mad di akhir kata bertemu dengan hamzah di awal kata berikutnya. Dinamakan jaiz karena boleh dipanjangkan atau tidak, dan munfashil karena mad dan hamzah terpisah dalam dua kata yang berbeda.",
                examples: [
                    {
                        arabic: "ÙŠÙŽØ§ Ø£ÙŽÙŠÙÙ‘Ù‡ÙŽØ§",
                        transliteration: "yaa ayyuhaa",
                        surah: "Al-Baqarah",
                        ayah: 21
                    }
                ],
                rules: [
                    "Mad di akhir kata, hamzah di awal kata berikutnya",
                    "Panjang: 2-5 harakat (1-2.5 alif)",
                    "Boleh dipanjangkan atau tidak (ikhtiar)"
                ]
            },
            {
                id: 8,
                title: "Mad Lazim",
                category: "mad",
                difficulty: "sulit",
                description: "Mad yang lazim dipanjangkan 6 harakat",
                explanation: "Mad lazim adalah mad yang wajib dipanjangkan 6 harakat (3 alif). Terjadi ketika setelah huruf mad terdapat huruf yang bertasydid atau sukun asli. Mad lazim terbagi menjadi kalimi (dalam kata) dan harfi (dalam huruf muqatha'ah).",
                examples: [
                    {
                        arabic: "Ø§Ù„Ø¶ÙŽÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†ÙŽ",
                        transliteration: "adh-dhaaaaliin",
                        surah: "Al-Fatihah",
                        ayah: 7
                    }
                ],
                rules: [
                    "Setelah huruf mad ada sukun asli atau tasydid",
                    "Panjang: 6 harakat (3 alif)",
                    "Tidak boleh kurang dari 6 harakat"
                ]
            },
            {
                id: 9,
                title: "Qalqalah",
                category: "sifat",
                difficulty: "mudah",
                description: "Bunyi pantulan pada huruf-huruf tertentu",
                explanation: "Qalqalah adalah bunyi pantulan atau gema yang terjadi pada huruf-huruf qalqalah ketika sukun. Huruf qalqalah ada 5: Ù‚ØŒ Ø·ØŒ Ø¨ØŒ Ø¬ØŒ Ø¯ yang terkumpul dalam kalimat 'quthub jad'. Qalqalah terbagi menjadi sughra (kecil) dan kubra (besar).",
                examples: [
                    {
                        arabic: "ÙˆÙŽÙ„ÙŽØ§ Ø§Ù„Ø¶ÙŽÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†ÙŽ",
                        transliteration: "wa laa adh-dhaaaaaalliin",
                        surah: "Al-Fatihah",
                        ayah: 7
                    }
                ],
                rules: [
                    "Huruf qalqalah: Ù‚ØŒ Ø·ØŒ Ø¨ØŒ Ø¬ØŒ Ø¯",
                    "Qalqalah sughra: di tengah kata",
                    "Qalqalah kubra: di akhir ayat atau waqaf"
                ]
            },
            {
                id: 10,
                title: "Ahkam Lam Ta'rif",
                category: "ahkam",
                difficulty: "mudah",
                description: "Hukum bacaan lam pada alif lam ta'rif (Ø§Ù„)",
                explanation: "Lam ta'rif adalah lam yang terdapat pada kata sandang 'al' (Ø§Ù„). Lam ini memiliki dua hukum: idzhar qamariyyah (dibaca jelas) dan idghom syamsiyyah (dilebur). Pembagian ini berdasarkan huruf yang datang setelah lam ta'rif.",
                examples: [
                    {
                        arabic: "Ø§Ù„Ù’Ø­ÙŽÙ…Ù’Ø¯Ù",
                        transliteration: "al-hamdu",
                        surah: "Al-Fatihah",
                        ayah: 2
                    }
                ],
                rules: [
                    "Idzhar qamariyyah: jika bertemu huruf qamariyyah (14 huruf)",
                    "Idghom syamsiyyah: jika bertemu huruf syamsiyyah (14 huruf)",
                    "Huruf qamariyyah: Ø§ØŒ Ø¨ØŒ ØºØŒ Ø­ØŒ Ø¬ØŒ ÙƒØŒ ÙˆØŒ Ø®ØŒ ÙØŒ Ø¹ØŒ Ù‚ØŒ ÙŠØŒ Ù…ØŒ Ù‡"
                ]
            },
            {
                id: 11,
                title: "Waqaf dan Ibtida",
                category: "waqf",
                difficulty: "menengah",
                description: "Aturan berhenti dan memulai bacaan",
                explanation: "Waqaf adalah berhenti pada akhir kata dengan memutus suara sejenak untuk bernapas. Ibtida adalah memulai bacaan setelah waqaf. Ada beberapa jenis waqaf: tam (sempurna), kafi (cukup), hasan (baik), dan qabih (jelek). Setiap jenis memiliki aturan tersendiri.",
                examples: [
                    {
                        arabic: "Ù…ÙŽØ§Ù„ÙÙƒÙ ÙŠÙŽÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù",
                        transliteration: "maaliki yaumiddiin",
                        surah: "Al-Fatihah",
                        ayah: 4
                    }
                ],
                rules: [
                    "Waqaf tam: boleh waqaf dan tidak boleh washal",
                    "Waqaf kafi: boleh waqaf dan boleh washal, tapi waqaf lebih baik",
                    "Waqaf hasan: boleh waqaf jika terpaksa",
                    "Waqaf qabih: tidak boleh waqaf"
                ]
            },
            {
                id: 12,
                title: "Ghunnah",
                category: "ghunnah",
                difficulty: "mudah",
                description: "Suara sengau pada huruf mim dan nun",
                explanation: "Ghunnah adalah suara sengau yang keluar dari hidung ketika mengucapkan huruf nun dan mim. Ghunnah memiliki tingkatan yang berbeda-beda tergantung pada kondisi huruf tersebut. Panjang ghunnah adalah 2 harakat.",
                examples: [
                    {
                        arabic: "Ù…ÙÙ†Ù’ Ù…ÙŽÙ‘Ø§",
                        transliteration: "mim maa",
                        surah: "Al-Baqarah",
                        ayah: 22
                    }
                ],
                rules: [
                    "Ghunnah kamil (sempurna): nun dan mim bertasydid",
                    "Ghunnah aqall (kurang): nun dan mim dalam idghom",
                    "Ghunnah naqis (kurang): nun dan mim dalam ikhfa",
                    "Panjang ghunnah: 2 harakat"
                ]
            },
            {
                id: 13,
                title: "Tafkhim dan Tarqiq",
                category: "sifat",
                difficulty: "menengah",
                description: "Tebal dan tipis dalam pengucapan huruf",
                explanation: "Tafkhim adalah mengucapkan huruf dengan tebal, sedangkan tarqiq adalah mengucapkan huruf dengan tipis. Huruf-huruf tertentu memiliki sifat tafkhim yang tetap, sementara beberapa huruf bisa tafkhim atau tarqiq tergantung kondisi.",
                examples: [
                    {
                        arabic: "ØµÙØ±ÙŽØ§Ø·ÙŽ",
                        transliteration: "shirooth",
                        surah: "Al-Fatihah",
                        ayah: 6
                    }
                ],
                rules: [
                    "Huruf tafkhim tetap: Ø®ØŒ ØµØŒ Ø¶ØŒ ØºØŒ Ø·ØŒ Ù‚ØŒ Ø¸",
                    "Huruf yang bisa tafkhim atau tarqiq: Ø±ØŒ Ù„ØŒ Ø§Ù„Ù„Ù‡",
                    "Tafkhim ra: jika berharakat fathah, dhammah, atau sukun setelah fathah/dhammah",
                    "Tarqiq ra: jika berharakat kasrah atau sukun setelah kasrah"
                ]
            },
            {
                id: 14,
                title: "Huruf Muqatha'ah",
                category: "others",
                difficulty: "sulit",
                description: "Huruf-huruf di awal surah",
                explanation: "Huruf muqatha'ah adalah huruf-huruf yang terdapat di awal beberapa surah dalam Al-Quran. Huruf-huruf ini dibaca terpisah-pisah sesuai dengan nama hurufnya. Beberapa mengandung mad lazim harfi yang harus dipanjangkan 6 harakat.",
                examples: [
                    {
                        arabic: "Ø§Ù„Ù…",
                        transliteration: "Alif Laam Miim",
                        surah: "Al-Baqarah",
                        ayah: 1
                    }
                ],
                rules: [
                    "Dibaca sesuai nama huruf hijaiyyah",
                    "Yang mengandung mad: dibaca 6 harakat",
                    "Yang tidak mengandung mad: dibaca 2 harakat",
                    "Contoh yang mengandung mad: Ø§ØŒ Ø­ØŒ Ø±ØŒ Ø³ØŒ ØµØŒ Ø·ØŒ ÙƒØŒ Ù„ØŒ Ù…ØŒ Ù†ØŒ ÙŠ"
                ]
            },
            {
                id: 15,
                title: "Bacaan Musykilat",
                category: "others",
                difficulty: "sulit",
                description: "Bacaan-bacaan yang sulit dan memerlukan perhatian khusus",
                explanation: "Bacaan musykilat adalah bacaan-bacaan dalam Al-Quran yang memerlukan perhatian khusus karena memiliki keunikan tersendiri. Bacaan ini sering menjadi kesalahan umum dalam membaca Al-Quran dan memerlukan latihan khusus untuk menguasainya.",
                examples: [
                    {
                        arabic: "Ø£ÙŽØ±Ù’Ø¬ÙÙ‡Ù’ ÙˆÙŽØ£ÙŽØ®ÙŽØ§Ù‡Ù",
                        transliteration: "arjihi wa akhaahu",
                        surah: "Al-A'raf",
                        ayah: 111
                    }
                ],
                rules: [
                    "Perhatikan bacaan yang berbeda dari kaidah umum",
                    "Hafalkan bacaan-bacaan khusus",
                    "Latihan dengan guru yang kompeten",
                    "Contoh: Ø£Ø±Ø¬Ù‡ØŒ ÙŠØ§ Ø§ÙŠÙ‡Ø§ØŒ Ù…Ø§ Ù„ÙŠÙ‡ØŒ Ø³Ù„Ø§Ø³Ù„Ø§"
                ]
            }
        ];

        const tajwidCategories = [
            { id: 'all', name: 'Semua', icon: 'ðŸ“š' },
            { id: 'makhraj', name: 'Makhraj', icon: 'ðŸ‘„' },
            { id: 'sifat', name: 'Sifat', icon: 'ðŸ”¤' },
            { id: 'ahkam', name: 'Ahkam', icon: 'ðŸ“‹' },
            { id: 'mad', name: 'Mad', icon: 'â†”ï¸' },
            { id: 'waqf', name: 'Waqf', icon: 'â¸ï¸' },
            { id: 'ghunnah', name: 'Ghunnah', icon: 'ðŸ‘ƒ' },
            { id: 'others', name: 'Lainnya', icon: 'ðŸ“–' }
        ];

        // Data for Islamic War Stories
        const warStoriesData = [
            {
                id: 1,
                title: "Perang Badar",
                subtitle: "Saat Langit Turun Menolong",
                story: `Di tengah terik gurun Badar, pada tahun kedua Hijriah, berdiri tegak 313 Muslim. Mereka bukanlah pasukan perang terlatih, melainkan para petani, pedagang, dan pemuda pemberani yang hatinya berdebar dengan keyakinan yang mendalam. Di hadapan mereka, tersusun rapi 1.000 pasukan Quraisy, lengkap dengan senjata tajam yang berkilauan dan kuda-kuda tangguh yang siap menerjang. Jumlah yang tidak seimbang ini bisa saja membuat gentar, namun di hati kaum Muslimin, hanya ada satu keyakinan: "Cukuplah Allah sebagai penolong kami!"

Rasulullah ï·º, dengan penuh kerendahan hati, menengadah ke langit, air mata mengalir di pipinya. Beliau berdoa, "Ya Allah, jika pasukan kecil ini binasa hari ini, tak akan ada lagi yang menyembah-Mu di muka bumi ini." Doa yang tulus itu diijabah. Lalu datanglah kabar gembira dari langit, sebuah janji ilahi: "Aku akan menurunkan seribu malaikat untuk menolong kalian." (QS Al-Anfal:9)

Seketika, gemuruh takbir mengguncang padang pasir. Pedang-pedang iman menyala dengan semangat juang. Dan hari itu, langit benar-benar turun. Malaikat-malaikat membantu menguatkan barisan Muslim.`,
                lessons: [
                    "Kemenangan sejati bukanlah milik yang kuat dalam jumlah atau senjata, tapi milik mereka yang kokoh dalam keyakinan dan tawakal kepada Allah."
                ]
            },
            {
                id: 2,
                title: "Perang Uhud",
                subtitle: "Saat Ujian Menjadi Pelajaran",
                story: `Setahun setelah kemenangan gemilang di Badar, dendam kesumat membara di hati kaum Quraisy. Dengan 3.000 pasukan lengkap, mereka bergerak menuju Gunung Uhud, siap menuntut balas atas kekalahan mereka. Rasulullah ï·º bersama 700 sahabat bersiap menghadapi mereka, dengan menempatkan 50 pemanah di atas bukit yang strategis. "Jangan tinggalkan pos ini apapun yang terjadi!" pesan Nabi dengan tegas.

Awalnya, kemenangan berpihak pada kaum Muslimin. Pasukan Quraisy mundur, dan seolah-olah, kemenangan telah di tangan. Kaum Muslimin bersukacita... namun terlalu cepat. Para pemanah, tergiur oleh harta rampasan yang terhampar di bawah, mengabaikan perintah Nabi dan meninggalkan pos penting mereka.

Saat itulah, pasukan Quraisy, yang dipimpin oleh Khalid bin Walid (yang saat itu masih kafir), melihat celah. Mereka berbalik menyerang dari belakang! Kekacauan pun tak terhindarkan. Darah tertumpah. Rasulullah ï·º sendiri terluka parahâ€”gigi beliau patah, dan wajah mulia beliau berdarah.`,
                lessons: [
                    "Jangan pernah mengabaikan perintah pemimpin, bahkan ketika kemenangan tampaknya sudah di tangan.",
                    "Uhud bukanlah kekalahan total, melainkan pengingat yang menyakitkan: iman harus selalu disertai dengan disiplin, kesabaran, dan ketaatan yang mutlak."
                ]
            },
            {
                id: 3,
                title: "Perang Khandaq",
                subtitle: "Parit dan Doa yang Menyelamatkan",
                story: `Musim dingin menyelimuti Madinah, namun ancaman yang jauh lebih besar mengguncang dari luar. 10.000 pasukan gabungan Quraisy dan suku-suku Arab bersatu, bergerak menuju kota Nabi ï·º. Kaum Muslimin hanya berjumlah 3.000 orangâ€”angka yang tidak sebanding, namun mereka kuat dalam iman dan persatuan.

Di tengah situasi genting ini, Salman Al-Farisi, seorang sahabat dari Persia, mengajukan ide brilian: â€œGali parit di sisi utara Madinah!â€ Tanpa ragu, siang dan malam, para sahabat menggali parit besar ini sambil menahan lapar yang luar biasaâ€”bahkan tidak ada api yang menyala di rumah Nabi selama tiga hari. Ketika ada batu besar yang menghalangi, Rasulullah ï·º sendiri turun untuk memecahkannya. Tiap pukulan beliau memancarkan cahaya, dan Nabi berkata, "Aku melihat kunci negeri Persia... Romawi... Yaman!"

Pasukan musuh tiba di Madinah, terkejut melihat parit raksasa yang tidak mereka duga. Mereka tidak bisa masuk! Mereka mengepung Madinah selama sebulan, namun pengepungan itu sia-sia. Angin dingin yang menerjang, ketakutan yang merayap di hati mereka, dan doa tulus Nabi yang tak henti-hentinya akhirnya menghancurkan barisan mereka. Allah berfirman: "Dan Allah mengirim angin dan pasukan yang tidak kamu lihat..." (QS Al-Ahzab:9).`,
                lessons: [
                    "Kemenangan besar tanpa pertumpahan darah, bukti nyata kekuatan iman dan strategi yang cerdik."
                ]
            },
            {
                id: 4,
                title: "Fathu Makkah",
                subtitle: "Ketika Ampunan Lebih Tajam dari Pedang",
                story: `Delapan tahun setelah peristiwa hijrah yang penuh duka, kaum Quraisy melanggar perjanjian Hudaibiyah yang telah disepakati. Sebagai respons, Rasulullah ï·º mengumpulkan 10.000 pasukan, dan secara diam-diam, mereka bergerak menuju Makkah. Dalam hati Nabi, tiada dendam sedikit pun, meskipun kaum Quraisy dahulu dahulu telah mengusir, menyiksa, dan bahkan membunuh para pengikutnya.

Namun hari itu bukanlah hari balas dendamâ€”hari itu adalah hari kemenangan yang lembut dan penuh rahmat. Pasukan Islam memasuki Makkah dengan tenang, tanpa ada satu pun pedang yang terhunus. Kaum Quraisy gemetar dalam ketakutan, menanti nasib mereka di tangan orang-orang yang pernah mereka aniaya.

Lalu Nabi ï·º berdiri di hadapan mereka, dengan suara yang penuh wibawa namun juga kelembutan, beliau bertanya: "Menurut kalian, apa yang akan aku lakukan terhadap kalian?" Mereka, dengan suara bergetar dan penuh harap, menjawab, "Engkau adalah saudara yang mulia, anak dari orang mulia." Dan Rasulullah ï·º, dengan rahmat yang luas, menjawab: "Pergilah kalian, karena kalian semua telah aku bebaskan."

Pada hari yang agung itu, Ka'bah dibersihkan dari segala bentuk berhala yang mengotorinya. Lembah Makkah bersinar terang dengan cahaya tauhid yang murni.`,
                lessons: [
                    "Ampunan telah menaklukkan Makkah, bukan pedang, dan membawa kedamaian abadi bagi seluruh kota."
                ]
            }
        ];

        // Data for Asmaul Husna
        const asmaulHusnaData = [
            { id: 1, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø­Ù’Ù…ÙŽÙ†Ù", latin: "Ar-Rahman", meaning: "Maha Pengasih" },
            { id: 2, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø­ÙÙŠÙ…Ù", latin: "Ar-Rahim", meaning: "Maha Penyayang" },
            { id: 3, arabic: "Ø§Ù„Ù’Ù…ÙŽÙ„ÙÙƒÙ", latin: "Al-Malik", meaning: "Maha Merajai/Memerintah" },
            { id: 4, arabic: "Ø§Ù„Ù’Ù‚ÙØ¯ÙÙ‘ÙˆØ³Ù", latin: "Al-Quddus", meaning: "Maha Suci" },
            { id: 5, arabic: "Ø§Ù„Ø³ÙŽÙ‘Ù„Ø§ÙŽÙ…Ù", latin: "As-Salam", meaning: "Maha Pemberi Kesejahteraan" },
            { id: 6, arabic: "Ø§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†Ù", latin: "Al-Mu'min", meaning: "Maha Pemberi Keamanan" },
            { id: 7, arabic: "Ø§Ù„Ù’Ù…ÙÙ‡ÙŽÙŠÙ’Ù…ÙÙ†Ù", latin: "Al-Muhaimin", meaning: "Maha Pemelihara" },
            { id: 8, arabic: "Ø§Ù„Ù’Ø¹ÙŽØ²ÙÙŠØ²Ù", latin: "Al-Aziz", meaning: "Maha Perkasa" },
            { id: 9, arabic: "Ø§Ù„Ù’Ø¬ÙŽØ¨ÙŽÙ‘Ø§Ø±Ù", latin: "Al-Jabbar", meaning: "Maha Berkuasa" },
            { id: 10, arabic: "Ø§Ù„Ù’Ù…ÙØªÙŽÙƒÙŽØ¨ÙÙ‘Ø±Ù", latin: "Al-Mutakabbir", meaning: "Maha Megah" },
            { id: 11, arabic: "Ø§Ù„Ù’Ø®ÙŽØ§Ù„ÙÙ‚Ù", latin: "Al-Khaliq", meaning: "Maha Pencipta" },
            { id: 12, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ§Ø±ÙØ¦Ù", latin: "Al-Bari'", meaning: "Maha Perancang" },
            { id: 13, arabic: "Ø§Ù„Ù’Ù…ÙØµÙŽÙˆÙÙ‘Ø±Ù", latin: "Al-Mushawwir", meaning: "Maha Pembentuk" },
            { id: 14, arabic: "Ø§Ù„Ù’ØºÙŽÙÙŽÙ‘Ø§Ø±Ù", latin: "Al-Ghaffar", meaning: "Maha Pengampun" },
            { id: 15, arabic: "Ø§Ù„Ù’Ù‚ÙŽÙ‡ÙŽÙ‘Ø§Ø±Ù", latin: "Al-Qahhar", meaning: "Maha Pemaksa" },
            { id: 16, arabic: "Ø§Ù„Ù’ÙˆÙŽÙ‡ÙŽÙ‘Ø§Ø¨Ù", latin: "Al-Wahhab", meaning: "Maha Pemberi Karunia" },
            { id: 17, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø²ÙŽÙ‘Ø§Ù‚Ù", latin: "Ar-Razzaq", meaning: "Maha Pemberi Rezeki" },
            { id: 18, arabic: "Ø§Ù„Ù’ÙÙŽØªÙŽÙ‘Ø§Ø­Ù", latin: "Al-Fattah", meaning: "Maha Pembuka" },
            { id: 19, arabic: "Ø§Ù„Ù’Ø¹ÙŽÙ„ÙÙŠÙ…Ù", latin: "Al-Alim", meaning: "Maha Mengetahui" },
            { id: 20, arabic: "Ø§Ù„Ù’Ù‚ÙŽØ§Ø¨ÙØ¶Ù", latin: "Al-Qabidh", meaning: "Maha Menyempitkan" },
            { id: 21, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ§Ø³ÙØ·Ù", latin: "Al-Basith", meaning: "Maha Melapangkan" },
            { id: 22, arabic: "Ø§Ù„Ù’Ø®ÙŽØ§ÙÙØ¶Ù", latin: "Al-Khafidz", meaning: "Maha Merendahkan" },
            { id: 23, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø§ÙÙØ¹Ù", latin: "Ar-Rafi'", meaning: "Maha Meninggikan" },
            { id: 24, arabic: "Ø§Ù„Ù’Ù…ÙØ¹ÙØ²ÙÙ‘", latin: "Al-Mu'izz", meaning: "Maha Memuliakan" },
            { id: 25, arabic: "Ø§Ù„Ù’Ù…ÙØ°ÙÙ„ÙÙ‘", latin: "Al-Muzill", meaning: "Maha Menghinakan" },
            { id: 26, arabic: "Ø§Ù„Ø³ÙŽÙ‘Ù…ÙÙŠØ¹Ù", latin: "As-Sami'", meaning: "Maha Mendengar" },
            { id: 27, arabic: "Ø§Ù„Ù’Ø¨ÙŽØµÙÙŠØ±Ù", latin: "Al-Bashir", meaning: "Maha Melihat" },
            { id: 28, arabic: "Ø§Ù„Ù’Ø­ÙŽÙƒÙŽÙ…Ù", latin: "Al-Hakam", meaning: "Maha Menetapkan Hukum" },
            { id: 29, arabic: "Ø§Ù„Ù’Ø¹ÙŽØ¯Ù’Ù„Ù", latin: "Al-Adl", meaning: "Maha Adil" },
            { id: 30, arabic: "Ø§Ù„Ù„ÙŽÙ‘Ø·ÙÙŠÙÙ", latin: "Al-Lathif", meaning: "Maha Lembut" },
            { id: 31, arabic: "Ø§Ù„Ù’Ø®ÙŽØ¨ÙÙŠØ±Ù", latin: "Al-Khabir", meaning: "Maha Mengenal" },
            { id: 32, arabic: "Ø§Ù„Ù’Ø­ÙŽÙ„ÙÙŠÙ…Ù", latin: "Al-Halim", meaning: "Maha Penyantun" },
            { id: 33, arabic: "Ø§Ù„Ù’Ø¹ÙŽØ¸ÙÙŠÙ…Ù", latin: "Al-Azhim", meaning: "Maha Agung" },
            { id: 34, arabic: "Ø§Ù„Ù’ØºÙŽÙÙÙˆØ±Ù", latin: "Al-Ghafur", meaning: "Maha Pengampun" },
            { id: 35, arabic: "Ø§Ù„Ø´ÙŽÙ‘ÙƒÙÙˆØ±Ù", latin: "Asy-Syakur", meaning: "Maha Pembalas Budi" },
            { id: 36, arabic: "Ø§Ù„Ù’Ø¹ÙŽÙ„ÙÙŠÙÙ‘", latin: "Al-Aliy", meaning: "Maha Tinggi" },
            { id: 37, arabic: "Ø§Ù„Ù’ÙƒÙŽØ¨ÙÙŠØ±Ù", latin: "Al-Kabir", meaning: "Maha Besar" },
            { id: 38, arabic: "Ø§Ù„Ù’Ø­ÙŽÙÙÙŠØ¸Ù", latin: "Al-Hafizh", meaning: "Maha Pemelihara" },
            { id: 39, arabic: "Ø§Ù„Ù’Ù…ÙÙ‚ÙÙŠØªÙ", latin: "Al-Muqit", meaning: "Maha Pemberi Kekuatan" },
            { id: 40, arabic: "Ø§Ù„Ù’Ø­ÙŽØ³ÙÙŠØ¨Ù", latin: "Al-Hasib", meaning: "Maha Penghitung" },
            { id: 41, arabic: "Ø§Ù„Ù’Ø¬ÙŽÙ„ÙÙŠÙ„Ù", latin: "Al-Jalil", meaning: "Maha Luhur" },
            { id: 42, arabic: "Ø§Ù„Ù’ÙƒÙŽØ±ÙÙŠÙ…Ù", latin: "Al-Karim", meaning: "Maha Mulia" },
            { id: 43, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ù‚ÙÙŠØ¨Ù", latin: "Ar-Raqib", meaning: "Maha Mengawasi" },
            { id: 44, arabic: "Ø§Ù„Ù’Ù…ÙØ¬ÙÙŠØ¨Ù", latin: "Al-Mujib", meaning: "Maha Mengabulkan" },
            { id: 45, arabic: "Ø§Ù„Ù’ÙˆÙŽØ§Ø³ÙØ¹Ù", latin: "Al-Wasi'", meaning: "Maha Luas" },
            { id: 46, arabic: "Ø§Ù„Ù’Ø­ÙŽÙƒÙÙŠÙ…Ù", latin: "Al-Hakim", meaning: "Maha Bijaksana" },
            { id: 47, arabic: "Ø§Ù„Ù’ÙˆÙŽØ¯ÙÙˆØ¯Ù", latin: "Al-Wadud", meaning: "Maha Mengasihi" },
            { id: 48, arabic: "Ø§Ù„Ù’Ù…ÙŽØ¬ÙÙŠØ¯Ù", latin: "Al-Majid", meaning: "Maha Mulia" },
            { id: 49, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ§Ø¹ÙØ«Ù", latin: "Al-Ba'its", meaning: "Maha Membangkitkan" },
            { id: 50, arabic: "Ø§Ù„Ø´ÙŽÙ‘Ù‡ÙÙŠØ¯Ù", latin: "Asy-Syahid", meaning: "Maha Menyaksikan" },
            { id: 51, arabic: "Ø§Ù„Ù’Ø­ÙŽÙ‚ÙÙ‘", latin: "Al-Haqq", meaning: "Maha Benar" },
            { id: 52, arabic: "Ø§Ù„Ù’ÙˆÙŽÙƒÙÙŠÙ„Ù", latin: "Al-Wakil", meaning: "Maha Pemelihara" },
            { id: 53, arabic: "Ø§Ù„Ù’Ù‚ÙŽÙˆÙÙŠÙÙ‘", latin: "Al-Qawiy", meaning: "Maha Kuat" },
            { id: 54, arabic: "Ø§Ù„Ù’Ù…ÙŽØªÙÙŠÙ†Ù", latin: "Al-Matin", meaning: "Maha Kokoh" },
            { id: 55, arabic: "Ø§Ù„Ù’ÙˆÙŽÙ„ÙÙŠÙÙ‘", latin: "Al-Waliy", meaning: "Maha Pelindung" },
            { id: 56, arabic: "Ø§Ù„Ù’Ø­ÙŽÙ…ÙÙŠØ¯Ù", latin: "Al-Hamid", meaning: "Maha Terpuji" },
            { id: 57, arabic: "Ø§Ù„Ù’Ù…ÙØ­Ù’ØµÙÙŠ", latin: "Al-Muhshi", meaning: "Maha Menghitung" },
            { id: 58, arabic: "Ø§Ù„Ù’Ù…ÙØ¨Ù’Ø¯ÙØ¦Ù", latin: "Al-Mubdi'", meaning: "Maha Memulai" },
            { id: 59, arabic: "Ø§Ù„Ù’Ù…ÙØ¹ÙÙŠØ¯Ù", latin: "Al-Mu'id", meaning: "Maha Mengembalikan" },
            { id: 60, arabic: "Ø§Ù„Ù’Ù…ÙØ­Ù’ÙŠÙÙŠ", latin: "Al-Muhyi", meaning: "Maha Menghidupkan" },
            { id: 61, arabic: "Ø§Ù„Ù’Ù…ÙÙ…ÙÙŠØªÙ", latin: "Al-Mumit", meaning: "Maha Mematikan" },
            { id: 62, arabic: "Ø§Ù„Ù’Ø­ÙŽÙŠÙÙ‘", latin: "Al-Hayy", meaning: "Maha Hidup" },
            { id: 63, arabic: "Ø§Ù„Ù’Ù‚ÙŽÙŠÙÙ‘ÙˆÙ…Ù", latin: "Al-Qayyum", meaning: "Maha Berdiri Sendiri" },
            { id: 64, arabic: "Ø§Ù„Ù’ÙˆÙŽØ§Ø¬ÙØ¯Ù", latin: "Al-Wajid", meaning: "Maha Menemukan" },
            { id: 65, arabic: "Ø§Ù„Ù’Ù…ÙŽØ§Ø¬ÙØ¯Ù", latin: "Al-Majid", meaning: "Maha Mulia" },
            { id: 66, arabic: "Ø§Ù„Ù’ÙˆÙŽØ§Ø­ÙØ¯Ù", latin: "Al-Wahid", meaning: "Maha Tunggal" },
            { id: 67, arabic: "Ø§Ù’Ù„Ø£ÙŽØ­ÙŽØ¯Ù", latin: "Al-Ahad", meaning: "Maha Esa" },
            { id: 68, arabic: "Ø§Ù„ØµÙŽÙ‘Ù…ÙŽØ¯Ù", latin: "Ash-Shamad", meaning: "Maha Dibutuhkan" },
            { id: 69, arabic: "Ø§Ù„Ù’Ù‚ÙŽØ§Ø¯ÙØ±Ù", latin: "Al-Qadir", meaning: "Maha Kuasa" },
            { id: 70, arabic: "Ø§Ù„Ù’Ù…ÙÙ‚Ù’ØªÙŽØ¯ÙØ±Ù", latin: "Al-Muqtadir", meaning: "Maha Penentu" },
            { id: 71, arabic: "Ø§Ù„Ù’Ù…ÙÙ‚ÙŽØ¯ÙÙ‘Ù…Ù", latin: "Al-Muqaddim", meaning: "Maha Mendahulukan" },
            { id: 72, arabic: "Ø§Ù„Ù’Ù…ÙØ¤ÙŽØ®ÙÙ‘Ø±Ù", latin: "Al-Muâ€™akkhir", meaning: "Maha Mengakhirkan" },
            { id: 73, arabic: "Ø§Ù’Ù„Ø£ÙŽÙˆÙŽÙ‘Ù„Ù", latin: "Al-Awwal", meaning: "Maha Awal" },
            { id: 74, arabic: "Ø§Ù’Ù„Ø¢Ø®ÙØ±Ù", latin: "Al-Akhir", meaning: "Maha Akhir" },
            { id: 75, arabic: "Ø§Ù„Ø¸ÙŽÙ‘Ø§Ù‡ÙØ±Ù", latin: "Az-Zhahir", meaning: "Maha Nyata" },
            { id: 76, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ§Ø·ÙÙ†Ù", latin: "Al-Bathin", meaning: "Maha Gaib" },
            { id: 77, arabic: "Ø§Ù„Ù’ÙˆÙŽØ§Ù„ÙÙŠ", latin: "Al-Waliy", meaning: "Maha Memerintah" },
            { id: 78, arabic: "Ø§Ù„Ù’Ù…ÙØªÙŽØ¹ÙŽØ§Ù„ÙÙŠ", latin: "Al-Mutaâ€™ali", meaning: "Maha Tinggi" },
            { id: 79, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ±ÙÙ‘", latin: "Al-Barr", meaning: "Maha Dermawan" },
            { id: 80, arabic: "Ø§Ù„ØªÙŽÙ‘ÙˆÙŽÙ‘Ø§Ø¨Ù", latin: "At-Tawwab", meaning: "Maha Penerima Tobat" },
            { id: 81, arabic: "Ø§Ù„Ù’Ù…ÙÙ†Ù’ØªÙŽÙ‚ÙÙ…Ù", latin: "Al-Muntaqim", meaning: "Maha Pembalas" },
            { id: 82, arabic: "Ø§Ù„Ù’Ø¹ÙŽÙÙÙˆÙÙ‘", latin: "Al-Afuww", meaning: "Maha Pemaaf" },
            { id: 83, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø¤ÙÙˆÙÙ", latin: "Ar-Ra'uf", meaning: "Maha Pengasih" },
            { id: 84, arabic: "Ù…ÙŽØ§Ù„ÙÙƒÙ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ", latin: "Malikul Mulk", meaning: "Maha Penguasa Kerajaan" },
            { id: 85, arabic: "Ø°ÙÙˆ Ø§Ù„Ù’Ø¬ÙŽÙ„Ø§ÙŽÙ„Ù ÙˆÙŽØ§Ù’Ù„Ø¥ÙÙƒÙ’Ø±ÙŽØ§Ù…Ù", latin: "Dzul Jalali wal Ikram", meaning: "Maha Pemilik Keagungan dan Kemuliaan" },
            { id: 86, arabic: "Ø§Ù„Ù’Ù…ÙÙ‚Ù’Ø³ÙØ·Ù", latin: "Al-Muqsith", meaning: "Maha Adil" },
            { id: 87, arabic: "Ø§Ù„Ù’Ø¬ÙŽØ§Ù…ÙØ¹Ù", latin: "Al-Jami'", meaning: "Maha Mengumpulkan" },
            { id: 88, arabic: "Ø§Ù„Ù’ØºÙŽÙ†ÙÙŠÙÙ‘", latin: "Al-Ghaniy", meaning: "Maha Kaya" },
            { id: 89, arabic: "Ø§Ù„Ù’Ù…ÙØºÙ’Ù†ÙÙŠ", latin: "Al-Mughni", meaning: "Maha Pemberi Kekayaan" },
            { id: 90, arabic: "Ø§Ù„Ù’Ù…ÙŽØ§Ù†ÙØ¹Ù", latin: "Al-Mani'", meaning: "Maha Mencegah" },
            { id: 91, arabic: "Ø§Ù„Ø¶ÙŽÙ‘Ø§Ø±ÙÙ‘", latin: "Adh-Dhaar", meaning: "Maha Pemberi Bahaya" },
            { id: 92, arabic: "Ø§Ù„Ù†ÙŽÙ‘Ø§ÙÙØ¹Ù", latin: "An-Nafi'", meaning: "Maha Pemberi Manfaat" },
            { id: 93, arabic: "Ø§Ù„Ù†ÙÙ‘ÙˆØ±Ù", latin: "An-Nur", meaning: "Maha Bercahaya" },
            { id: 94, arabic: "Ø§Ù„Ù’Ù‡ÙŽØ§Ø¯ÙÙŠ", latin: "Al-Hadi", meaning: "Maha Pemberi Petunjuk" },
            { id: 95, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ¯ÙÙŠØ¹Ù", latin: "Al-Badi'", meaning: "Maha Pencipta Tanpa Contoh" },
            { id: 96, arabic: "Ø§Ù„Ù’Ø¨ÙŽØ§Ù‚ÙÙŠ", latin: "Al-Baqi", meaning: "Maha Kekal" },
            { id: 97, arabic: "Ø§Ù„Ù’ÙˆÙŽØ§Ø±ÙØ«Ù", latin: "Al-Warits", meaning: "Maha Pewaris" },
            { id: 98, arabic: "Ø§Ù„Ø±ÙŽÙ‘Ø´ÙÙŠØ¯Ù", latin: "Ar-Rasyid", meaning: "Maha Pandai" },
            { id: 99, arabic: "Ø§Ù„ØµÙŽÙ‘Ø¨ÙÙˆØ±Ù", latin: "As-Shabur", meaning: "Maha Sabar" }
        ];

        // Data for Surga (Heaven)
        const surgaData = [
            {
                id: 1,
                name: "Jannah Adn",
                arabic: "Ø¬Ù†Ø§Øª Ø¹Ø¯Ù†",
                generalDescription: "Seringkali disebut sebagai 'Surga Eden' atau 'Surga Keabadian.' Kata 'Adn berarti menetap atau abadi. Ini adalah salah satu nama umum yang merujuk pada surga tempat tinggal yang kekal.",
                occupantsAndDeeds: [
                    "Orang-orang yang beriman dan beramal shalih secara umum, terutama yang menepati janji dengan Allah dan Rasul-Nya, serta bertaubat dari dosa.",
                    "Mereka yang mendirikan shalat, menafkahkan sebagian rezeki, dan membalas kejahatan dengan kebaikan (QS. Ar-Ra'd: 22-23)."
                ]
            },
            {
                id: 2,
                name: "Darussalam",
                arabic: "Ø¯Ø§Ø± Ø§Ù„Ø³Ù„Ø§Ù…",
                generalDescription: "Berarti 'Negeri Keselamatan' atau 'Tempat Kedamaian.' Ini adalah surga yang di dalamnya tidak ada ketakutan, kesedihan, atau bahaya.",
                occupantsAndDeeds: [
                    "Orang-orang yang taat kepada Allah dan Rasul-Nya, serta berpegang teguh pada Islam.",
                    "Disebutkan dalam QS. Yunus: 25, bahwa Allah menyeru manusia ke Darussalam."
                ]
            },
            {
                id: 3,
                name: "Darul Khuld",
                arabic: "Ø¯Ø§Ø± Ø§Ù„Ø®Ù„Ø¯",
                generalDescription: "Berarti 'Negeri Kekekalan.' Ini menekankan sifat kekal penghuni surga di dalamnya.",
                occupantsAndDeeds: [
                    "Sama seperti Jannah Adn, ini merujuk pada keabadian bagi mereka yang beriman dan beramal shalih."
                ]
            },
            {
                id: 4,
                name: "Jannah Ma'wa",
                arabic: "Ø¬Ù†Ø© Ø§Ù„Ù…Ø£ÙˆÙ‰",
                generalDescription: "Berarti 'Surga Tempat Kembali' atau 'Surga Tempat Berlindung.'",
                occupantsAndDeeds: [
                    "Disebutkan dalam Al-Quran (QS. An-Najm: 15) dekat dengan Sidratul Muntaha.",
                    "Terutama bagi mereka yang beramal shalih dan bertakwa, serta bagi para syuhada dan orang-orang yang berjihad di jalan Allah."
                ]
            },
            {
                id: 5,
                name: "Jannah Na'im",
                arabic: "Ø¬Ù†Ø© Ø§Ù„Ù†Ø¹ÙŠÙ…",
                generalDescription: "Berarti 'Surga Penuh Kenikmatan.' Nama ini menekankan kenikmatan yang melimpah ruah di dalamnya.",
                occupantsAndDeeds: [
                    "Orang-orang yang beriman dan mengerjakan amal shalih.",
                    "Mereka yang mensyukuri nikmat Allah dan menggunakan karunia-Nya di jalan kebaikan."
                ]
            },
            {
                id: 6,
                name: "Jannah Firdaus",
                arabic: "Ø¬Ù†Ù‘Ø© Ø§Ù„ÙØ±Ø¯ÙˆØ³",
                generalDescription: "Ini adalah tingkatan surga yang paling tinggi dan mulia. Kata Firdaus berarti 'taman yang luas dan indah.'",
                occupantsAndDeeds: [
                    "Para Nabi dan Rasul.",
                    "Para Shiddiqin (orang-orang yang sangat jujur dan membenarkan kebenaran, seperti Abu Bakar Ash-Shiddiq).",
                    "Para Syuhada (orang-orang yang gugur di jalan Allah).",
                    "Para Shalihin (orang-orang shalih yang beramal saleh secara konsisten dan ikhlas).",
                    "Disebutkan dalam hadits bahwa Nabi Muhammad SAW bersabda: 'Apabila kamu memohon kepada Allah, mohonlah surga Firdaus, karena ia adalah surga yang paling tengah dan paling tinggi. Di atasnya adalah Arsy Ar-Rahman, dan daripadanya terpancar sungai-sungai surga.' (HR. Bukhari).",
                    "Secara umum, mereka yang memiliki iman yang kuat, menjalankan shalat dengan khusyuk, menjauhi perbuatan sia-sia, menunaikan zakat, menjaga kemaluan, menjaga amanah, dan menepati janji (QS. Al-Mukminun: 1-11)."
                ]
            },
            {
                id: 7,
                name: "Darul Maqamah",
                arabic: "Ø¯Ø§Ø± Ø§Ù„Ù…Ù‚Ø§Ù…Ø©",
                generalDescription: "Berarti 'Tempat Kedudukan yang Kekal.' Ini adalah surga yang bersifat abadi dan tidak ada lagi perpindahan.",
                occupantsAndDeeds: [
                    "Sama seperti surga-surga lainnya, ini untuk orang-orang yang beriman dan beramal shalih yang akan kekal di dalamnya."
                ]
            }
        ];

        // Data for Neraka (Hell)
        const nerakaData = [
            {
                id: 1,
                name: "Neraka Jahannam",
                arabic: "Ø¬Ù‡Ù†Ù…",
                generalDescription: "Ini adalah nama umum neraka yang paling sering disebut dalam Al-Quran. Biasanya diartikan sebagai 'jurang yang dalam' atau 'tempat yang sangat panas'. Siksa di dalamnya sangat pedih.",
                occupantsAndDeeds: [
                    "Orang-orang Munafik: Mereka yang menampakkan keimanan namun hatinya kafir, atau orang yang mendustakan Allah dan Rasul-Nya. Disebutkan dalam QS. An-Nisa: 145 bahwa mereka berada di kerak neraka yang paling bawah.",
                    "Orang Musyrik dan Kafir: Mereka yang menyekutukan Allah atau mengingkari keesaan dan risalah-Nya.",
                    "Pelaku Dosa Besar: Muslim yang melakukan dosa besar tanpa bertaubat, namun masih memiliki tauhid di hatinya. Mereka mungkin akan disiksa di Jahannam untuk membersihkan dosa-dosa mereka sebelum akhirnya dikeluarkan atas rahmat Allah.",
                    "Pembunuh tanpa Hak: Mereka yang sengaja membunuh jiwa yang diharamkan Allah."
                ]
            },
            {
                id: 2,
                name: "Neraka Lazha",
                arabic: "Ù„Ø¸Ù‰",
                generalDescription: "Berarti 'api yang bergejolak' atau 'menyala-nyala.' Nama ini disebutkan dalam QS. Al-Ma'arij ayat 15.",
                occupantsAndDeeds: [
                    "Orang yang Membelakangi Kebenaran dan Berpaling: Mereka yang menolak kebenaran, berpaling dari dakwah, serta tidak mau menunaikan shalat dan zakat.",
                    "Orang yang Mengumpulkan Harta dan Menyembunyikannya: Mereka yang rakus mengumpulkan harta, tidak mau menginfakkan di jalan Allah, dan menghitung-hitungnya dengan sombong."
                ]
            },
            {
                id: 3,
                name: "Neraka Saqar",
                arabic: "Ø³Ù‚Ø±",
                generalDescription: "Berarti 'panas yang membakar kulit' atau 'menghanguskan.' Disebutkan dalam QS. Al-Mudatstsir ayat 26-27.",
                occupantsAndDeeds: [
                    "Orang yang Tidak Melaksanakan Shalat: Mereka yang meninggalkan shalat fardhu dengan sengaja.",
                    "Orang yang Tidak Memberi Makan Orang Miskin: Mereka yang tidak peduli terhadap nasib fakir miskin dan tidak bersedekah.",
                    "Orang yang Memperbincangkan Hal Batil (Kesyirikan): Mereka yang suka berbicara tentang kesyirikan atau hal-hal yang menyesatkan dan tidak percaya Hari Pembalasan.",
                    "Pendusta Hari Kiamat: Orang-orang yang mendustakan adanya Hari Kiamat dan Hari Pembalasan."
                ]
            },
            {
                id: 4,
                name: "Neraka Hutamah",
                arabic: "Ø§Ù„Ø­Ø·Ù…Ø©",
                generalDescription: "Berarti 'api yang menghancurkan' atau 'meremukkan.' Dinamakan demikian karena api neraka ini membakar hingga ke ulu hati. Disebutkan dalam QS. Al-Humazah ayat 4-7.",
                occupantsAndDeeds: [
                    "Pengumpat dan Pencela: Orang-orang yang suka mencela, mengumpat, atau mengejek orang lain baik dengan perkataan maupun isyarat.",
                    "Pengumpul Harta yang Bakhil: Mereka yang gemar mengumpulkan harta dan menyangka hartanya akan mengekalkannya, serta tidak mau menginfakkannya di jalan Allah."
                ]
            },
            {
                id: 5,
                name: "Neraka Jahim",
                arabic: "Ø§Ù„Ø¬Ø­ÙŠÙ…",
                generalDescription: "Berarti 'api yang berkobar-kobar hebat' atau 'tempat yang membakar.' Nama ini sering disebutkan dalam Al-Quran.",
                occupantsAndDeeds: [
                    "Orang Kafir dan Musyrik: Terutama mereka yang menolak ayat-ayat Allah.",
                    "Pendusta Ayat-ayat Allah: Orang-orang yang mendustakan wahyu dan tanda-tanda kebesaran Allah.",
                    "Pelaku Kejahatan Besar: Mereka yang melakukan perbuatan dosa besar dan melampaui batas."
                ]
            },
            {
                id: 6,
                name: "Neraka Sa'ir",
                arabic: "Ø§Ù„Ø³Ø¹ÙŠØ±",
                generalDescription: "Berarti 'api yang menyala-nyala.' Disebutkan dalam QS. An-Nisa: 10, QS. Al-Mulk: 5, dan lainnya.",
                occupantsAndDeeds: [
                    "Pemakan Harta Anak Yatim secara Zalim: Mereka yang memakan harta anak yatim tanpa hak.",
                    "Orang yang Mendustakan Hari Kiamat: Mirip dengan Saqar, yaitu orang-orang yang mengingkari adanya Hari Pembalasan.",
                    "Penduduk Neraka secara Umum: Seringkali Sa'ir digunakan sebagai salah satu nama umum neraka."
                ]
            },
            {
                id: 7,
                name: "Neraka Hawiyah",
                arabic: "Ø§Ù„Ù‡Ø§ÙˆÙŠØ©",
                generalDescription: "Berarti 'jurang yang dalam,' 'kehancuran,' atau 'tempat kembali yang paling rendah.' Ini adalah tingkatan neraka yang paling bawah dan paling dahsyat siksanya. Disebutkan dalam QS. Al-Qari'ah ayat 9-11.",
                occupantsAndDeeds: [
                    "Orang-orang Kafir Murni: Mereka yang benar-benar tidak memiliki keimanan sama sekali dan menolak Allah serta Rasul-Nya secara total.",
                    "Orang Munafik Sejati: Terutama mereka yang berada di tingkatan munafik paling parah, yang disebutkan dalam Al-Quran akan berada di dasar neraka.",
                    "Musuh-musuh Allah dan Rasul-Nya: Mereka yang secara terang-terangan memusuhi dan memerangi agama Allah."
                ]
            }
        ];


        // Icons as simple strings (using Font Awesome class names for better visual consistency)
        const Icons = {
            BookOpen: 'fas fa-book-open',
            Search: 'fas fa-search',
            Users: 'fas fa-users',
            GraduationCap: 'fas fa-graduation-cap',
            ArrowLeft: 'fas fa-arrow-left',
            Heart: 'fas fa-heart',
            Star: 'fas fa-star',
            AlertTriangle: 'fas fa-exclamation-triangle',
            Lightbulb: 'fas fa-lightbulb',
            Volume2: 'fas fa-volume-up',
            CheckCircle: 'fas fa-check-circle',
            Quran: 'fas fa-quran',
            List: 'fas fa-list',
            Play: 'fas fa-play',
            Pause: 'fas fa-pause',
            StepBackward: 'fas fa-step-backward',
            StepForward: 'fas fa-step-forward',
            Bookmark: 'fas fa-bookmark',
            ShieldHalved: 'fas fa-shield-halved', // Icon for war stories
            Palette: 'fas fa-palette', // Icon for Asmaul Husna
            CloudSun: 'fas fa-cloud-sun', // Icon for Heaven/Surga
            Fire: 'fas fa-fire', // Icon for Hell/Neraka
            CommentDots: 'fas fa-comment-dots', // Icon for Tafsir
            SpellCheck: 'fas fa-spell-check', // Icon for Latin transliteration
            Calculator: 'fas fa-calculator', // Icon for Zakat Calculator
            CalendarAlt: 'fas fa-calendar-alt', // Icon for Hijri Calendar
            Clock: 'fas fa-clock', // New icon for Prayer Times
            Book: 'fas fa-book-quran', // Combined Islamic Knowledge icon
            Tools: 'fas fa-tools', // New icon for combined Islamic Tools
            Scroll: 'fas fa-scroll' // New icon for Hadith
        };

        // --- Quran Reader Page Component ---
        const QuranReaderPage = ({ setCurrentPage }) => {
            const [surahData, setSurahData] = useState([]);
            const [filteredSurahs, setFilteredSurahs] = useState([]);
            const [loadingSurahs, setLoadingSurahs] = useState(true);
            const [loadingAyahs, setLoadingAyahs] = useState(false);
            const [selectedSurah, setSelectedSurah] = useState(null);
            const [currentAyahNumber, setCurrentAyahNumber] = useState(1);
            const [searchTerm, setSearchTerm] = useState('');
            const [juzFilter, setJuzFilter] = useState('');
            const [revelationFilter, setRevelationFilter] = useState('');
            const [showTafsir, setShowTafsir] = useState(false); // State for tafsir toggle
            const [showLatin, setShowLatin] = useState(false);   // New state for Latin transliteration toggle

            const audioRef = useRef(new Audio());
            const [isPlaying, setIsPlaying] = useState(false);
            const [volume, setVolume] = useState(50);
            const [reciter, setReciter] = useState('AbdulBaset'); // Default reciter

            // Fetch surah list on component mount
            useEffect(() => {
                setLoadingSurahs(true);
                fetch('https://api.alquran.cloud/v1/surah')
                    .then(response => response.json())
                    .then(data => {
                        setSurahData(data.data);
                        setFilteredSurahs(data.data);
                        setLoadingSurahs(false);
                    })
                    .catch(error => {
                        console.error('Error fetching surah list:', error);
                        setLoadingSurahs(false);
                        // Implement a user-friendly error message
                    });
            }, []);

            // Filter surahs based on search term and filters
            useEffect(() => {
                const filtered = surahData.filter(surah => {
                    const matchesSearch = surah.englishName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                         surah.englishNameTranslation.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                         surah.name.toLowerCase().includes(searchTerm.toLowerCase());

                    const matchesJuz = !juzFilter || (surah.juz && surah.juz.toString() === juzFilter);
                    const matchesRevelation = !revelationFilter || surah.revelationType === revelationFilter;

                    return matchesSearch && matchesJuz && matchesRevelation;
                });
                setFilteredSurahs(filtered);
            }, [searchTerm, juzFilter, revelationFilter, surahData]);

            // Load selected surah's ayahs, tafsir, and transliteration
            const loadSurah = (surahNumber) => {
                setLoadingAyahs(true);
                setSelectedSurah(null); // Clear previous surah details
                audioRef.current.pause(); // Stop any currently playing audio
                setIsPlaying(false);

                // Fetch multiple editions: Uthmani script, Indonesian translation, Indonesian Tafsir Jalalayn, and English transliteration
                fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/editions/quran-uthmani,id.indonesian,id.jalalayn,en.transliteration`)
                    .then(response => response.json())
                    .then(data => {
                        const surah = data.data[0];
                        const translation = data.data[1];
                        const tafsir = data.data[2];
                        const latinTransliteration = data.data[3]; // Get the Latin transliteration edition

                        setSelectedSurah({
                            ...surah,
                            translationAyahs: translation.ayahs,
                            tafsirAyahs: tafsir.ayahs,
                            latinTransliterationAyahs: latinTransliteration.ayahs // Store Latin transliteration data
                        });
                        setCurrentAyahNumber(1); // Reset to first ayah when new surah is loaded
                        setLoadingAyahs(false);
                    })
                    .catch(error => {
                        console.error('Error loading surah:', error);
                        setLoadingAyahs(false);
                        // Implement a user-friendly error message
                    });
            };

            // Play a specific ayah
            const playAyah = (ayahNumber) => {
                if (!selectedSurah) return;

                audioRef.current.pause();
                setIsPlaying(false);

                setCurrentAyahNumber(ayahNumber);
                const paddedAyahNumber = String(ayahNumber).padStart(3, '0');
                audioRef.current.src = `https://verses.quran.com/${reciter}/mp3/${selectedSurah.number}${paddedAyahNumber}.mp3`;
                audioRef.current.volume = volume / 100;

                audioRef.current.play()
                    .then(() => {
                        setIsPlaying(true);
                    })
                    .catch(error => {
                        console.error('Error playing audio:', error);
                        // Display message on UI
                    });
            };

            // Handle audio end: play next ayah
            useEffect(() => {
                const audio = audioRef.current;
                const handleEnded = () => {
                    setIsPlaying(false);
                    if (selectedSurah && currentAyahNumber < selectedSurah.numberOfAyahs) {
                        setTimeout(() => {
                            playAyah(currentAyahNumber + 1);
                        }, 1000); // 1 second delay before playing next ayah
                    }
                };
                audio.addEventListener('ended', handleEnded);
                return () => {
                    audio.removeEventListener('ended', handleEnded);
                };
            }, [selectedSurah, currentAyahNumber, playAyah]);

            // Handle play/pause button
            const togglePlayPause = () => {
                if (!audioRef.current.src) {
                    // If no surah is loaded or no ayah played yet, try playing the first ayah of selected surah
                    if (selectedSurah) {
                        playAyah(currentAyahNumber);
                    }
                    return;
                }

                if (isPlaying) {
                    audioRef.current.pause();
                } else {
                    audioRef.current.play();
                }
                setIsPlaying(!isPlaying);
            };

            // Handle volume change
            const handleVolumeChange = (e) => {
                const newVolume = e.target.value;
                setVolume(newVolume);
                if (audioRef.current) {
                    audioRef.current.volume = newVolume / 100;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
                    {/* Header */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-green-100 sticky top-0 z-50">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-green-600 hover:text-green-700 font-medium px-4 py-2 rounded-md bg-green-50 hover:bg-green-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-green-600 to-emerald-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.Quran}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                                            Pembaca Al-Quran
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Baca dan dengarkan lantunan ayat suci Al-Quran
                            </p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        {/* Search & Filter */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-8 border border-gray-100">
                            <div className="flex flex-col md:flex-row gap-4">
                                <div className="relative flex-grow">
                                    <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                    <input
                                        type="text"
                                        placeholder="Cari surah..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 text-base"
                                    />
                                </div>
                                <select
                                    value={juzFilter}
                                    onChange={(e) => setJuzFilter(e.target.value)}
                                    className="border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-green-400 text-base"
                                >
                                    <option value="">Semua Juz</option>
                                    {Array.from({ length: 30 }, (_, i) => (
                                        <option key={i + 1} value={i + 1}>Juz {i + 1}</option>
                                    ))}
                                </select>
                                <select
                                    value={revelationFilter}
                                    onChange={(e) => setRevelationFilter(e.target.value)}
                                    className="border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-green-400 text-base"
                                >
                                    <option value="">Semua Turun</option>
                                    <option value="Meccan">Mekah</option>
                                    <option value="Medinan">Madinah</option>
                                </select>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Surah List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-lg border border-gray-100 h-[80vh] overflow-hidden">
                                    <div className="bg-gradient-to-r from-green-50 to-emerald-50 p-4 border-b border-gray-100">
                                        <h2 className="font-semibold text-green-700 flex items-center text-lg">
                                            <i className={`${Icons.List} mr-2`}></i> Daftar Surah ({filteredSurahs.length})
                                        </h2>
                                    </div>
                                    <div className="p-0 overflow-y-auto h-[calc(80vh-80px)]">
                                        {loadingSurahs ? (
                                            <div className="text-center py-8">
                                                <div className="loading mx-auto"></div>
                                                <p className="mt-2 text-gray-600">Memuat daftar surah...</p>
                                            </div>
                                        ) : (
                                            <div className="p-4 space-y-3">
                                                {filteredSurahs.length > 0 ? (
                                                    filteredSurahs.map((surah) => (
                                                        <div
                                                            key={surah.number}
                                                            onClick={() => loadSurah(surah.number)}
                                                            className={`surah-card bg-white border border-gray-200 rounded-lg p-4 cursor-pointer transition-all duration-300 hover:bg-green-50 hover:shadow-md ${
                                                                selectedSurah?.number === surah.number ? 'bg-green-100 border-green-300 shadow-md' : ''
                                                            }`}
                                                        >
                                                            <div className="flex items-center justify-between">
                                                                <div className="flex items-center">
                                                                    <div className="w-8 h-8 rounded-full bg-green-100 text-green-800 flex items-center justify-center font-bold text-sm mr-3">
                                                                        {surah.number}
                                                                    </div>
                                                                    <div>
                                                                        <h3 className="font-semibold text-gray-800 text-base">{surah.englishName}</h3>
                                                                        <p className="text-xs text-gray-500">{surah.englishNameTranslation}</p>
                                                                    </div>
                                                                </div>
                                                                <div className="text-right">
                                                                    <p className="arabic-text text-xl text-green-700">{surah.name}</p>
                                                                    <p className="text-xs text-gray-500">{surah.revelationType} â€¢ {surah.numberOfAyahs} ayat</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                ) : (
                                                    <div className="text-center py-8 text-gray-600">
                                                        <p>Tidak ada surah yang ditemukan.</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Ayat Display */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-lg shadow-lg border border-gray-100 p-6 min-h-[60vh]">
                                    {loadingAyahs ? (
                                        <div className="text-center py-20">
                                            <div className="loading mx-auto"></div>
                                            <p className="mt-4 text-gray-600">Memuat surah...</p>
                                        </div>
                                    ) : selectedSurah ? (
                                        <div>
                                            <div className="mb-6 text-center border-b border-gray-200 pb-4">
                                                <h2 className="text-2xl font-bold text-gray-800 mb-1">{selectedSurah.englishName} (<span className="arabic-text text-3xl font-normal">{selectedSurah.name}</span>)</h2>
                                                <p className="text-gray-600">{selectedSurah.englishNameTranslation} â€¢ {selectedSurah.numberOfAyahs} ayat</p>
                                                <p className="mt-2 text-sm text-gray-500">Mulai dengan membaca basmalah...</p>
                                                <div className="flex justify-center space-x-4 mt-4">
                                                    <button
                                                        onClick={() => setShowTafsir(!showTafsir)}
                                                        className={`px-4 py-2 rounded-md transition-colors flex items-center justify-center text-sm font-medium ${
                                                            showTafsir ? 'bg-emerald-600 text-white hover:bg-emerald-700' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                        }`}
                                                    >
                                                        <i className={`${Icons.CommentDots} mr-2`}></i>
                                                        {showTafsir ? 'Sembunyikan Tafsir' : 'Tampilkan Tafsir'}
                                                    </button>
                                                    <button
                                                        onClick={() => setShowLatin(!showLatin)}
                                                        className={`px-4 py-2 rounded-md transition-colors flex items-center justify-center text-sm font-medium ${
                                                            showLatin ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                        }`}
                                                    >
                                                        <i className={`${Icons.SpellCheck} mr-2`}></i>
                                                        {showLatin ? 'Sembunyikan Latin' : 'Tampilkan Latin'}
                                                    </button>
                                                </div>
                                            </div>
                                            {selectedSurah.ayahs.map((ayah, index) => (
                                                <div
                                                    key={ayah.numberInSurah}
                                                    className={`ayah-container mb-6 pb-6 border-b border-gray-100 rounded-md transition-colors ${
                                                        currentAyahNumber === ayah.numberInSurah ? 'bg-green-50 shadow-sm' : ''
                                                    }`}
                                                >
                                                    <div className="flex justify-between items-center mb-3">
                                                        <div className="w-8 h-8 rounded-full bg-green-100 text-green-800 flex items-center justify-center font-bold text-sm">
                                                            {ayah.numberInSurah}
                                                        </div>
                                                        <div className="flex space-x-2">
                                                            <button
                                                                onClick={() => playAyah(ayah.numberInSurah)}
                                                                className="play-ayah p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                                            >
                                                                <i className={`${Icons.Play} text-green-600 text-xs`}></i>
                                                            </button>
                                                            <button className="bookmark-ayah p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors">
                                                                <i className={`${Icons.Bookmark} text-gray-400 hover:text-yellow-500`}></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="arabic-text text-right mb-4 leading-loose text-gray-800">{ayah.text}</div>
                                                    {showLatin && selectedSurah.latinTransliterationAyahs && selectedSurah.latinTransliterationAyahs[index] && (
                                                        <div className="mt-2 text-blue-700 text-sm italic leading-relaxed text-left">
                                                            {selectedSurah.latinTransliterationAyahs[index].text}
                                                        </div>
                                                    )}
                                                    <div className="text-gray-700 text-sm leading-relaxed">{selectedSurah.translationAyahs[index].text}</div>
                                                    {showTafsir && selectedSurah.tafsirAyahs && selectedSurah.tafsirAyahs[index] && (
                                                        <div className="mt-4 pt-4 border-t border-dashed border-gray-200">
                                                            <h4 className="text-xs font-semibold text-gray-500 mb-2 flex items-center">
                                                                <i className={`${Icons.CommentDots} text-emerald-500 mr-2`}></i>
                                                                Tafsir Jalalayn:
                                                            </h4>
                                                            <p className="text-gray-600 text-sm italic">{selectedSurah.tafsirAyahs[index].text}</p>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center py-20">
                                            <i className={`${Icons.Quran} text-5xl text-gray-300 mb-4`}></i>
                                            <h3 className="text-xl text-gray-500">Pilih surah untuk mulai membaca</h3>
                                        </div>
                                    )}
                                </div>

                                {/* Player Controls */}
                                {selectedSurah && (
                                    <div className="bg-white rounded-lg shadow-lg p-4 mt-4 border border-gray-100">
                                        <div className="flex flex-col sm:flex-row items-center justify-between gap-4">
                                            <div className="flex items-center space-x-2">
                                                <button
                                                    onClick={() => currentAyahNumber > 1 && playAyah(currentAyahNumber - 1)}
                                                    className="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                    disabled={currentAyahNumber <= 1}
                                                >
                                                    <i className={`${Icons.StepBackward} text-gray-700`}></i>
                                                </button>
                                                <button
                                                    onClick={togglePlayPause}
                                                    className="p-3 rounded-full bg-green-600 hover:bg-green-700 text-white shadow-md transition-colors"
                                                >
                                                    <i className={isPlaying ? Icons.Pause : Icons.Play}></i>
                                                </button>
                                                <button
                                                    onClick={() => currentAyahNumber < selectedSurah.numberOfAyahs && playAyah(currentAyahNumber + 1)}
                                                    className="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                                    disabled={currentAyahNumber >= selectedSurah.numberOfAyahs}
                                                >
                                                    <i className={`${Icons.StepForward} text-gray-700`}></i>
                                                </button>
                                            </div>
                                            <div className="text-sm text-gray-600 font-medium">
                                                Ayat <span className="font-bold">{currentAyahNumber}</span> / <span className="font-bold">{selectedSurah.numberOfAyahs}</span>
                                            </div>
                                            <div className="flex items-center space-x-2 w-full sm:w-auto">
                                                <i className={`${Icons.Volume2} text-gray-600`}></i>
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="100"
                                                    value={volume}
                                                    onChange={handleVolumeChange}
                                                    className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600"
                                                />
                                                <select
                                                    value={reciter}
                                                    onChange={(e) => { setReciter(e.target.value); playAyah(currentAyahNumber); }} // Re-play current ayah with new reciter
                                                    className="border border-gray-300 rounded-lg px-2 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-green-400"
                                                >
                                                    <option value="AbdulBaset">Abdul Baset</option>
                                                    <option value="MisharyRashid">Mishary Rashid</option>
                                                    <option value="SaoodShuraym">Saood Shuraym</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="mt-12 text-center text-gray-600 text-sm py-4 border-t border-gray-200">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Al-Quran Digital by Akhtar</p>
                        <p className="mt-1 text-xs">
                            Sumber data: <a href="https://api.alquran.cloud/" target="_blank" rel="noopener noreferrer" className="text-green-600 hover:underline">Alquran.cloud API</a>
                        </p>
                    </footer>
                </div>
            );
        };

        // --- Hadith Page Component ---
        const HadithPage = ({ setCurrentPage }) => {
            const [books, setBooks] = useState([]);
            const [selectedBook, setSelectedBook] = useState('');
            const [hadiths, setHadiths] = useState([]);
            const [currentPage, setCurrentPageNum] = useState(1);
            const [totalPages, setTotalPages] = useState(1);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const hadithsPerPage = 10; // Number of hadiths to display per page

            // Fetch list of Hadith books
            useEffect(() => {
                const fetchBooks = async () => {
                    setLoading(true);
                    setError('');
                    try {
                        const response = await fetch('https://api.hadith.gading.dev/books');
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const data = await response.json();
                        if (data && data.data && data.data.length > 0) {
                            setBooks(data.data);
                            // Set the first book as selected by default, if there is data
                            if (data.data.length > 0) {
                                setSelectedBook(data.data[0].id);
                                // Set initial totalPages based on the first selected book's available count
                                setTotalPages(Math.ceil(data.data[0].available / hadithsPerPage));
                            }
                        } else {
                            setError('Tidak dapat memuat daftar kitab Hadits.');
                        }
                    } catch (err) {
                        console.error('Error fetching Hadith books:', err);
                        setError('Gagal memuat kitab Hadits. Coba lagi nanti.');
                    } finally {
                        setLoading(false);
                    }
                };
                fetchBooks();
            }, []); // Run once on component mount

            // Fetch Hadiths when selectedBook or currentPage changes
            useEffect(() => {
                const fetchHadiths = async () => {
                    if (!selectedBook) return;

                    setLoading(true);
                    setError('');
                    setHadiths([]); // Clear previous hadiths

                    try {
                        // Calculate start and end range for the API
                        const startRange = (currentPage - 1) * hadithsPerPage + 1;
                        const endRange = currentPage * hadithsPerPage;

                        // Corrected API endpoint for fetching hadiths by book with range
                        const response = await fetch(`https://api.hadith.gading.dev/books/${selectedBook}?range=${startRange}-${endRange}`);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        const data = await response.json();

                        if (data && data.data) {
                            setHadiths(data.data.hadiths || []);
                            // The totalPages from the API response for this endpoint is not directly available,
                            // it needs to be calculated based on the total 'available' hadiths from the book list.
                            // This calculation is now done in handleBookChange and initial fetchBooks.
                        } else {
                            setError('Tidak dapat memuat Hadits untuk kitab ini.');
                        }
                    } catch (err) {
                        console.error(`Error fetching Hadiths for ${selectedBook}:`, err);
                        setError('Gagal memuat Hadits. Coba lagi nanti.');
                    } finally {
                        setLoading(false);
                    }
                };
                fetchHadiths();
            }, [selectedBook, currentPage]); // Re-fetch when book or page changes

            const handleBookChange = (e) => {
                const newSelectedBookId = e.target.value;
                setSelectedBook(newSelectedBookId);
                setCurrentPageNum(1); // Reset to first page when book changes
                // Find the selected book from the 'books' state to get its total available hadiths
                const bookInfo = books.find(book => book.id === newSelectedBookId);
                if (bookInfo) {
                    setTotalPages(Math.ceil(bookInfo.available / hadithsPerPage));
                } else {
                    setTotalPages(1); // Fallback if bookInfo somehow not found
                }
            };

            const handlePrevPage = () => {
                if (currentPage > 1) {
                    setCurrentPageNum(currentPage - 1);
                }
            };

            const handleNextPage = () => {
                if (currentPage < totalPages) {
                    setCurrentPageNum(currentPage + 1);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 via-white to-amber-50">
                    {/* The header is now handled by IslamicKnowledgePage */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-orange-100 sticky top-0 z-50 hidden">
                        <div className="container mx-auto px-4 py-6">
                            <h1 className="text-3xl font-bold bg-gradient-to-r from-orange-600 to-amber-600 bg-clip-text text-transparent text-center">
                                Koleksi Hadits
                            </h1>
                            <p className="text-sm text-gray-600 text-center">by Akhtar</p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        {/* Book Selection & Pagination Controls */}
                        <div className="bg-white rounded-lg shadow-lg border border-orange-100 p-6 mb-8">
                            <div className="mb-4">
                                <label htmlFor="bookSelect" className="block text-gray-700 font-medium mb-2">Pilih Kitab Hadits:</label>
                                <select
                                    id="bookSelect"
                                    value={selectedBook}
                                    onChange={handleBookChange}
                                    className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-400 text-base"
                                    disabled={loading && books.length === 0}
                                >
                                    {loading && books.length === 0 ? (
                                        <option value="">Memuat kitab...</option>
                                    ) : (
                                        <>
                                            <option value="">-- Pilih Kitab --</option>
                                            {books.map(book => (
                                                <option key={book.id} value={book.id}>
                                                    {book.name} ({book.available})
                                                </option>
                                            ))}
                                        </>
                                    )}
                                </select>
                            </div>

                            <div className="flex items-center justify-between gap-4">
                                <button
                                    onClick={handlePrevPage}
                                    disabled={currentPage <= 1 || loading}
                                    className="flex items-center px-4 py-2 rounded-md bg-orange-600 text-white font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-md"
                                >
                                    <i className={`${Icons.StepBackward} mr-2`}></i>
                                    Sebelumnya
                                </button>
                                <span className="text-gray-700 font-semibold text-lg">
                                    Halaman {currentPage} / {totalPages}
                                </span>
                                <button
                                    onClick={handleNextPage}
                                    disabled={currentPage >= totalPages || loading}
                                    className="flex items-center px-4 py-2 rounded-md bg-orange-600 text-white font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-md"
                                >
                                    Selanjutnya
                                    <i className={`${Icons.StepForward} ml-2`}></i>
                                </button>
                            </div>
                        </div>

                        {error && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-8" role="alert">
                                <strong className="font-bold">Error!</strong>
                                <span className="block sm:inline"> {error}</span>
                            </div>
                        )}

                        {loading && hadiths.length === 0 ? (
                            <div className="text-center py-20">
                                <div className="loading mx-auto"></div>
                                <p className="mt-4 text-gray-600">Memuat Hadits...</p>
                            </div>
                        ) : hadiths.length > 0 ? (
                            <div className="space-y-8">
                                {hadiths.map((hadith, index) => (
                                    <div key={index} className="bg-white rounded-lg shadow-lg border border-orange-100 p-6">
                                        <div className="flex items-center justify-between mb-4 pb-4 border-b border-gray-100">
                                            <h3 className="text-xl font-bold text-orange-700">Hadits Nomor: {hadith.number}</h3>
                                            <span className="text-sm text-gray-500">Kitab: {selectedBook}</span>
                                        </div>
                                        <div className="arabic-text text-right text-2xl leading-loose mb-4 text-gray-800">
                                            {hadith.arab}
                                        </div>
                                        <div className="text-gray-700 text-base leading-relaxed mb-4 text-justify">
                                            <p className="font-semibold text-orange-600 mb-2">Terjemahan:</p>
                                            <p>{hadith.id}</p>
                                        </div>
                                        <p className="text-gray-500 text-sm italic">
                                            <i className="fas fa-user-circle mr-2"></i>
                                            Diriwayatkan oleh: {hadith.available === 1 ? 'Tidak Diketahui' : hadith.number}
                                        </p>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="bg-white rounded-lg shadow-lg border border-orange-100 min-h-[40vh] flex items-center justify-center">
                                <div className="text-center p-6">
                                    <i className={`${Icons.Scroll} text-4xl text-gray-300 mb-4`}></i>
                                    <h3 className="text-xl text-gray-700 mb-2">Pilih Kitab Hadits</h3>
                                    <p className="text-gray-500">Silakan pilih kitab Hadits dari daftar di atas untuk mulai membaca.</p>
                                </div>
                            </div>
                        )}

                        {hadiths.length > 0 && (
                            <div className="flex items-center justify-between mt-8">
                                <button
                                    onClick={handlePrevPage}
                                    disabled={currentPage <= 1 || loading}
                                    className="flex items-center px-4 py-2 rounded-md bg-orange-600 text-white font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-md"
                                >
                                    <i className={`${Icons.StepBackward} mr-2`}></i>
                                    Sebelumnya
                                </button>
                                <span className="text-gray-700 font-semibold text-lg">
                                    Halaman {currentPage} / {totalPages}
                                </span>
                                <button
                                    onClick={handleNextPage}
                                    disabled={currentPage >= totalPages || loading}
                                    className="flex items-center px-4 py-2 rounded-md bg-orange-600 text-white font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-md"
                                >
                                    Selanjutnya
                                    <i className={`${Icons.StepForward} ml-2`}></i>
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Footer is now handled by IslamicKnowledgePage */}
                    <footer className="mt-auto text-center text-gray-600 text-sm py-8 border-t border-gray-100 bg-white/80 backdrop-blur-sm hidden">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Koleksi Hadits by Akhtar</p>
                        <p className="mt-1 text-xs">
                            Sumber data: <a href="https://api.hadith.gading.dev/" target="_blank" rel="noopener noreferrer" className="text-orange-600 hover:underline">Hadith API by Gading</a>
                        </p>
                    </footer>
                </div>
            );
        };


        // --- Islamic Knowledge Page Component (Gabungan Kisah Nabi, Tajwid, Perang Islam, Surga, Neraka, Hadits) ---
        const IslamicKnowledgePage = ({ setCurrentPage }) => {
            const [activeTab, setActiveTab] = useState('prophets'); // Default active main tab
            const [activeSubTabHeavenHell, setActiveSubTabHeavenHell] = useState('surga'); // Default active sub-tab for Heaven/Hell

            // --- Prophets Sub-Component ---
            const ProphetsContent = () => {
                const [selectedProphet, setSelectedProphet] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');

                const filteredProphets = prophetsData.filter(prophet =>
                    prophet.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    prophet.arabicName.includes(searchTerm) ||
                    prophet.story.toLowerCase().includes(searchTerm.toLowerCase())
                );

                return (
                    <div className="py-8">
                        {/* Search */}
                        <div className="bg-white p-6 rounded-lg shadow-lg border border-blue-100 mb-8">
                            <div className="relative">
                                <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                <input
                                    type="text"
                                    placeholder="Cari nama nabi atau kisah..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2.5 border border-blue-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-base"
                                />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Prophets List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-lg border border-blue-100 h-[80vh] overflow-hidden">
                                    <div className="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 border-b border-gray-100">
                                        <h2 className="font-semibold text-blue-700 flex items-center text-lg">
                                            <i className={`${Icons.Users} mr-2`}></i>
                                            Para Nabi & Rasul ({filteredProphets.length})
                                        </h2>
                                    </div>
                                    <div className="p-0 overflow-y-auto h-[calc(80vh-80px)]">
                                        <div className="p-4 space-y-3">
                                            {filteredProphets.length > 0 ? (
                                                filteredProphets.map((prophet) => (
                                                    <div
                                                        key={prophet.id}
                                                        onClick={() => setSelectedProphet(prophet)}
                                                        className={`p-4 rounded-lg border cursor-pointer transition-all duration-300 hover:shadow-md ${
                                                            selectedProphet?.id === prophet.id
                                                                ? 'bg-blue-50 border-blue-300 shadow-md'
                                                                : 'bg-white border-gray-200 hover:bg-blue-25 hover:border-blue-200'
                                                        }`}
                                                    >
                                                        <div className="space-y-2">
                                                            <div className="flex items-center justify-between">
                                                                <h3 className="font-semibold text-gray-800 text-base">Nabi {prophet.name}</h3>
                                                                <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full">{prophet.id}</span>
                                                            </div>
                                                            <p className="arabic-text text-lg text-blue-600">{prophet.arabicName}</p>
                                                            <p className="text-sm text-gray-600">{prophet.title}</p>
                                                            <p className="text-xs text-gray-500">{prophet.period} â€¢ {prophet.location}</p>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-600">
                                                    <p>Tidak ada nabi yang ditemukan.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Prophet Detail */}
                            <div className="lg:col-span-2">
                                {selectedProphet ? (
                                    <div className="space-y-6">
                                        <div className="bg-white rounded-lg shadow-lg border border-blue-100">
                                            <div className="bg-gradient-to-r from-blue-600 to-cyan-600 text-white p-6 rounded-t-lg">
                                                <h1 className="text-3xl font-bold">Nabi {selectedProphet.name} AS</h1>
                                                <p className="arabic-text text-2xl mt-2">{selectedProphet.arabicName}</p>
                                                <p className="text-blue-100 mt-2 text-lg">{selectedProphet.title}</p>
                                                <div className="mt-4 space-y-1 text-sm">
                                                    <p><strong>Periode:</strong> {selectedProphet.period}</p>
                                                    <p><strong>Tempat:</strong> {selectedProphet.location}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-lg border border-blue-100 p-6">
                                            <div className="space-y-6">
                                                {/* Story */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-blue-600 mb-3 flex items-center">
                                                        <i className={`${Icons.BookOpen} mr-2`}></i>
                                                        Kisah
                                                    </h3>
                                                    <p className="text-gray-700 leading-relaxed text-justify">{selectedProphet.story}</p>
                                                </div>

                                                {/* Miracles */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-blue-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Star} mr-2`}></i>
                                                        Mukjizat
                                                    </h3>
                                                    <ul className="space-y-2">
                                                        {selectedProphet.miracles.map((miracle, index) => (
                                                            <li key={index} className="flex items-start">
                                                                <span className="text-blue-600 mr-2">â€¢</span>
                                                                <span className="text-gray-700">{miracle}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>

                                                {/* Lessons */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-blue-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Lightbulb} mr-2`}></i>
                                                        Hikmah & Pelajaran
                                                    </h3>
                                                    <ul className="space-y-2">
                                                        {selectedProphet.lessons.map((lesson, index) => (
                                                            <li key={index} className="flex items-start">
                                                                <span className="text-green-600 mr-2">â€¢</span>
                                                                <span className="text-gray-700">{lesson}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>

                                                {/* Family */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-blue-600 mb-3">Keluarga</h3>
                                                    <p className="text-gray-700">{selectedProphet.family}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-lg border border-blue-100 min-h-[60vh] flex items-center justify-center">
                                        <div className="text-center p-6">
                                            <i className={`${Icons.Users} text-4xl text-gray-300 mb-4`}></i>
                                            <h3 className="text-xl text-gray-700 mb-2">Pilih Kisah Nabi</h3>
                                            <p className="text-gray-500">Silakan pilih nama nabi dari daftar di sebelah kiri untuk membaca kisahnya</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // --- Tajwid Sub-Component ---
            const TajwidContent = () => {
                const [selectedTajwid, setSelectedTajwid] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');
                const [selectedCategory, setSelectedCategory] = useState('all');

                const filteredTajwid = tajwidData.filter(tajwid => {
                    const matchesSearch = tajwid.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                         tajwid.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                         tajwid.explanation.toLowerCase().includes(searchTerm.toLowerCase());

                    const matchesCategory = selectedCategory === 'all' || tajwid.category === selectedCategory;

                    return matchesSearch && matchesCategory;
                });

                return (
                    <div className="py-8">
                        {/* Category Filter */}
                        <div className="bg-white p-6 rounded-lg shadow-lg border border-purple-100 mb-8">
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3 mb-4">
                                {tajwidCategories.map((category) => (
                                    <button
                                        key={category.id}
                                        onClick={() => setSelectedCategory(category.id)}
                                        className={`text-xs flex flex-col items-center p-3 h-auto rounded-md transition-colors ${
                                            selectedCategory === category.id
                                                ? 'bg-purple-600 text-white shadow-md'
                                                : 'border border-purple-200 text-purple-700 hover:bg-purple-50'
                                        }`}
                                    >
                                        <span className="text-lg mb-1">{category.icon}</span>
                                        <span className="text-center leading-tight">{category.name}</span>
                                    </button>
                                ))}
                            </div>

                            {/* Search */}
                            <div className="relative">
                                <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                <input
                                    type="text"
                                    placeholder="Cari materi tajwid..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2.5 border border-purple-200 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400 text-base"
                                />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Tajwid List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-lg border border-purple-100 h-[80vh] overflow-hidden">
                                    <div className="bg-gradient-to-r from-purple-50 to-indigo-50 p-4 border-b border-gray-100">
                                        <h2 className="font-semibold text-purple-700 flex items-center text-lg">
                                            <i className={`${Icons.GraduationCap} mr-2`}></i>
                                            Materi Tajwid ({filteredTajwid.length})
                                        </h2>
                                    </div>
                                    <div className="p-0 overflow-y-auto h-[calc(80vh-80px)]">
                                        <div className="p-4 space-y-3">
                                            {filteredTajwid.length > 0 ? (
                                                filteredTajwid.map((tajwid) => (
                                                    <div
                                                        key={tajwid.id}
                                                        onClick={() => setSelectedTajwid(tajwid)}
                                                        className={`p-4 rounded-lg border cursor-pointer transition-all duration-300 hover:shadow-md ${
                                                            selectedTajwid?.id === tajwid.id
                                                                ? 'bg-purple-50 border-purple-300 shadow-md'
                                                                : 'bg-white border-gray-200 hover:bg-purple-25 hover:border-purple-200'
                                                        }`}
                                                    >
                                                        <div className="space-y-3">
                                                            <div className="flex items-start justify-between">
                                                                <h3 className="font-semibold text-gray-800 text-sm leading-tight flex-1 mr-2">
                                                                    {tajwid.title}
                                                                </h3>
                                                                <div className="flex items-center space-x-1">
                                                                    {tajwid.difficulty === 'mudah' && <i className={`${Icons.Star} text-green-500`}></i>}
                                                                    {tajwid.difficulty === 'menengah' && <i className={`${Icons.Star} text-yellow-500`}></i>}
                                                                    {tajwid.difficulty === 'sulit' && <i className={`${Icons.AlertTriangle} text-red-500`}></i>}
                                                                </div>
                                                            </div>
                                                            <p className="text-xs text-gray-600 leading-relaxed">{tajwid.description}</p>
                                                            <div className="flex items-center justify-between">
                                                                <span className={`text-xs px-2 py-1 rounded-full font-medium ${
                                                                    tajwid.category === 'makhraj' ? 'bg-blue-100 text-blue-800' :
                                                                    tajwid.category === 'sifat' ? 'bg-purple-100 text-purple-800' :
                                                                    tajwid.category === 'ahkam' ? 'bg-green-100 text-green-800' :
                                                                    tajwid.category === 'mad' ? 'bg-orange-100 text-orange-800' :
                                                                    tajwid.category === 'waqf' ? 'bg-indigo-100 text-indigo-800' :
                                                                    tajwid.category === 'ghunnah' ? 'bg-pink-100 text-pink-800' :
                                                                    'bg-gray-100 text-gray-800'
                                                                }`}>
                                                                    {tajwidCategories.find(cat => cat.id === tajwid.category)?.name || tajwid.category}
                                                                </span>
                                                                <span className={`text-xs px-2 py-1 rounded-full border font-medium ${
                                                                    tajwid.difficulty === 'mudah' ? 'bg-green-100 text-green-800 border-green-200' :
                                                                    tajwid.difficulty === 'menengah' ? 'bg-yellow-100 text-yellow-800 border-yellow-200' :
                                                                    'bg-red-100 text-red-800 border-red-200'
                                                                }`}>
                                                                    Level: {tajwid.difficulty.charAt(0).toUpperCase() + tajwid.difficulty.slice(1)}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-600">
                                                    <p>Tidak ada materi tajwid yang ditemukan.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Tajwid Detail */}
                            <div className="lg:col-span-2">
                                {selectedTajwid ? (
                                    <div className="space-y-6">
                                        <div className="bg-white rounded-lg shadow-lg border border-purple-100">
                                            <div className="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-t-lg">
                                                <div className="space-y-3">
                                                    <div className="flex items-center justify-between">
                                                        <h1 className="text-2xl font-bold">{selectedTajwid.title}</h1>
                                                        <div className="flex items-center space-x-1">
                                                            {selectedTajwid.difficulty === 'mudah' && <i className={`${Icons.Star} text-white`}></i>}
                                                            {selectedTajwid.difficulty === 'menengah' && <i className={`${Icons.Star} text-white`}></i>}
                                                            {selectedTajwid.difficulty === 'sulit' && <i className={`${Icons.AlertTriangle} text-white`}></i>}
                                                        </div>
                                                    </div>
                                                    <p className="text-purple-100 text-lg">{selectedTajwid.description}</p>
                                                    <div className="flex items-center space-x-3">
                                                        <span className="bg-white/20 text-white border border-white/30 px-3 py-1 rounded-full text-sm font-medium">
                                                            {tajwidCategories.find(cat => cat.id === tajwid.category)?.name || selectedTajwid.category}
                                                        </span>
                                                        <span className="bg-white/20 text-white border border-white/30 px-3 py-1 rounded-full text-sm font-medium">
                                                            Level: {selectedTajwid.difficulty.charAt(0).toUpperCase() + selectedTajwid.difficulty.slice(1)}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-lg border border-purple-100 p-6">
                                            <div className="space-y-6">
                                                {/* Explanation */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-purple-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Lightbulb} mr-2`}></i>
                                                        Penjelasan Detail
                                                    </h3>
                                                    <p className="text-gray-700 leading-relaxed text-justify">{selectedTajwid.explanation}</p>
                                                </div>

                                                {/* Examples */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-purple-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Volume2} mr-2`}></i>
                                                        Contoh dalam Al-Quran
                                                    </h3>
                                                    {selectedTajwid.examples.map((example, index) => (
                                                        <div key={index} className="bg-gray-50 rounded-lg p-6 space-y-4 border border-gray-100">
                                                            <div className="text-center">
                                                                <div className="arabic-text text-2xl text-gray-800 mb-3 leading-loose">
                                                                    {example.arabic}
                                                                </div>
                                                                <div className="text-sm text-gray-600 italic">
                                                                    {example.transliteration}
                                                                </div>
                                                            </div>
                                                            <hr className="border-gray-200" />
                                                            <div className="text-center">
                                                                <span className="bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-xs font-medium">
                                                                    QS. {example.surah} : {example.ayah}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>

                                                {/* Rules */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-purple-600 mb-3 flex items-center">
                                                        <i className={`${Icons.CheckCircle} mr-2`}></i>
                                                        Kaidah dan Aturan
                                                    </h3>
                                                    <div className="space-y-3">
                                                        {selectedTajwid.rules.map((rule, index) => (
                                                            <div key={index} className="flex items-start space-x-3 p-4 bg-purple-50 rounded-lg border border-purple-100">
                                                                <div className="w-6 h-6 bg-purple-600 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 mt-0.5">
                                                                    {index + 1}
                                                                </div>
                                                                <p className="text-gray-700 leading-relaxed flex-1">{rule}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-lg border border-purple-100 min-h-[60vh] flex items-center justify-center">
                                        <div className="text-center p-6">
                                            <i className={`${Icons.GraduationCap} text-4xl text-gray-300 mb-4`}></i>
                                            <h3 className="text-xl text-gray-700 mb-2">Pilih Materi Tajwid</h3>
                                            <p className="text-gray-500">Silakan pilih materi dari daftar di sebelah kiri untuk mempelajari kaidah tajwid</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // --- War Stories Sub-Component ---
            const PerangIslamContent = () => {
                const [selectedStory, setSelectedStory] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');

                const filteredStories = warStoriesData.filter(story =>
                    story.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    story.subtitle.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    story.story.toLowerCase().includes(searchTerm.toLowerCase())
                );

                return (
                    <div className="py-8">
                        {/* Search */}
                        <div className="bg-white p-6 rounded-lg shadow-lg border border-red-100 mb-8">
                            <div className="relative">
                                <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                <input
                                    type="text"
                                    placeholder="Cari kisah perang..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2.5 border border-red-200 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400 text-base"
                                />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Stories List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-lg border border-red-100 h-[80vh] overflow-hidden">
                                    <div className="bg-gradient-to-r from-red-50 to-rose-50 p-4 border-b border-gray-100">
                                        <h2 className="font-semibold text-red-700 flex items-center text-lg">
                                            <i className={`${Icons.List} mr-2`}></i>
                                            Daftar Perang ({filteredStories.length})
                                        </h2>
                                    </div>
                                    <div className="p-0 overflow-y-auto h-[calc(80vh-80px)]">
                                        <div className="p-4 space-y-3">
                                            {filteredStories.length > 0 ? (
                                                filteredStories.map((story) => (
                                                    <div
                                                        key={story.id}
                                                        onClick={() => setSelectedStory(story)}
                                                        className={`p-4 rounded-lg border cursor-pointer transition-all duration-300 hover:shadow-md ${
                                                            selectedStory?.id === story.id
                                                                ? 'bg-red-50 border-red-300 shadow-md'
                                                                : 'bg-white border-gray-200 hover:bg-red-25 hover:border-red-200'
                                                        }`}
                                                    >
                                                        <div className="space-y-2">
                                                            <h3 className="font-semibold text-gray-800 text-base">{story.title}</h3>
                                                            <p className="text-sm text-gray-600 leading-relaxed line-clamp-2">{story.subtitle}</p>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-600">
                                                    <p>Tidak ada kisah perang yang ditemukan.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Story Detail */}
                            <div className="lg:col-span-2">
                                {selectedStory ? (
                                    <div className="space-y-6">
                                        <div className="bg-white rounded-lg shadow-lg border border-red-100">
                                            <div className="bg-gradient-to-r from-red-600 to-rose-600 text-white p-6 rounded-t-lg">
                                                <h1 className="text-2xl font-bold">{selectedStory.title}</h1>
                                                <p className="text-red-100 mt-2 text-lg">{selectedStory.subtitle}</p>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-lg border border-red-100 p-6">
                                            <div className="space-y-6">
                                                {/* Story Content */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-red-600 mb-3 flex items-center">
                                                        <i className={`${Icons.BookOpen} mr-2`}></i>
                                                        Kisah Lengkap
                                                    </h3>
                                                    {/* Using pre-wrap to preserve newlines from the story text */}
                                                    <p className="text-gray-700 leading-relaxed text-justify whitespace-pre-wrap">{selectedStory.story}</p>
                                                </div>

                                                {/* Lessons */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-red-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Lightbulb} mr-2`}></i>
                                                        Pelajaran
                                                    </h3>
                                                    <ul className="space-y-2">
                                                        {selectedStory.lessons.map((lesson, index) => (
                                                            <li key={index} className="flex items-start">
                                                                <span className="text-green-600 mr-2">â€¢</span>
                                                                <span className="text-gray-700">{lesson}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-lg border border-red-100 min-h-[60vh] flex items-center justify-center">
                                        <div className="text-center p-6">
                                            <i className={`${Icons.ShieldHalved} text-4xl text-gray-300 mb-4`}></i>
                                            <h3 className="text-xl text-gray-700 mb-2">Pilih Kisah Perang</h3>
                                            <p className="text-gray-500">Silakan pilih kisah perang dari daftar di sebelah kiri untuk membacanya</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Surga Sub-Component
            const SurgaContent = () => {
                const [selectedSurga, setSelectedSurga] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');

                const filteredSurga = surgaData.filter(surga =>
                    surga.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    surga.arabic.includes(searchTerm) ||
                    surga.generalDescription.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    surga.occupantsAndDeeds.some(text => text.toLowerCase().includes(searchTerm.toLowerCase()))
                );

                return (
                    <div className="py-8">
                        {/* Search */}
                        <div className="bg-white p-6 rounded-lg shadow-lg border border-blue-100 mb-8">
                            <div className="relative">
                                <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                <input
                                    type="text"
                                    placeholder="Cari nama surga atau deskripsi..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2.5 border border-blue-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-base"
                                />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Surga List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-lg border border-blue-100 h-[80vh] overflow-hidden">
                                    <div className="bg-gradient-to-r from-blue-50 to-sky-50 p-4 border-b border-gray-100">
                                        <h2 className="font-semibold text-blue-700 flex items-center text-lg">
                                            <i className={`${Icons.List} mr-2`}></i>
                                            Daftar Tingkatan Surga ({filteredSurga.length})
                                        </h2>
                                    </div>
                                    <div className="p-0 overflow-y-auto h-[calc(80vh-80px)]">
                                        <div className="p-4 space-y-3">
                                            {filteredSurga.length > 0 ? (
                                                filteredSurga.map((surga) => (
                                                    <div
                                                        key={surga.id}
                                                        onClick={() => setSelectedSurga(surga)}
                                                        className={`p-4 rounded-lg border cursor-pointer transition-all duration-300 hover:shadow-md ${
                                                            selectedSurga?.id === surga.id
                                                                ? 'bg-blue-50 border-blue-300 shadow-md'
                                                                : 'bg-white border-gray-200 hover:bg-blue-25 hover:border-blue-200'
                                                        }`}
                                                    >
                                                        <div className="space-y-2">
                                                            <div className="flex items-center justify-between">
                                                                <h3 className="font-semibold text-gray-800 text-base">{surga.name}</h3>
                                                                <span className="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full">{surga.id}</span>
                                                            </div>
                                                            <p className="arabic-text text-lg text-blue-600">{surga.arabic}</p>
                                                            <p className="text-sm text-gray-600 line-clamp-2">{surga.generalDescription}</p>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-600">
                                                    <p>Tidak ada tingkatan surga yang ditemukan.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Surga Detail */}
                            <div className="lg:col-span-2">
                                {selectedSurga ? (
                                    <div className="space-y-6">
                                        <div className="bg-white rounded-lg shadow-lg border border-blue-100">
                                            <div className="bg-gradient-to-r from-blue-600 to-sky-600 text-white p-6 rounded-t-lg">
                                                <h1 className="text-3xl font-bold">{selectedSurga.name}</h1>
                                                <p className="arabic-text text-2xl mt-2">{selectedSurga.arabic}</p>
                                                <p className="text-blue-100 mt-2 text-lg">{selectedSurga.generalDescription}</p>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-lg border border-blue-100 p-6">
                                            <div className="space-y-6">
                                                {/* Occupants and Deeds */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-blue-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Users} mr-2`}></i>
                                                        Penghuni dan Amal Perbuatan
                                                    </h3>
                                                    <ul className="space-y-2">
                                                        {selectedSurga.occupantsAndDeeds.map((item, index) => (
                                                            <li key={index} className="flex items-start">
                                                                <span className="text-green-600 mr-2">â€¢</span>
                                                                <span className="text-gray-700">{item}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-lg border border-blue-100 min-h-[60vh] flex items-center justify-center">
                                        <div className="text-center p-6">
                                            <i className={`${Icons.CloudSun} text-4xl text-gray-300 mb-4`}></i>
                                            <h3 className="text-xl text-gray-700 mb-2">Pilih Tingkatan Surga</h3>
                                            <p className="text-gray-500">Silakan pilih nama surga dari daftar di sebelah kiri untuk melihat detailnya</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Neraka Sub-Component
            const NerakaContent = () => {
                const [selectedNeraka, setSelectedNeraka] = useState(null);
                const [searchTerm, setSearchTerm] = useState('');

                const filteredNeraka = nerakaData.filter(neraka =>
                    neraka.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    neraka.arabic.includes(searchTerm) ||
                    neraka.generalDescription.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    neraka.occupantsAndDeeds.some(text => text.toLowerCase().includes(searchTerm.toLowerCase()))
                );

                return (
                    <div className="py-8">
                        {/* Search */}
                        <div className="bg-white p-6 rounded-lg shadow-lg border border-red-200 mb-8">
                            <div className="relative">
                                <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                <input
                                    type="text"
                                    placeholder="Cari nama neraka atau deskripsi..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2.5 border border-red-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400 text-base"
                                />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Neraka List */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-lg shadow-lg border border-red-200 h-[80vh] overflow-hidden">
                                    <div className="bg-gradient-to-r from-red-100 to-rose-100 p-4 border-b border-gray-100">
                                        <h2 className="font-semibold text-red-700 flex items-center text-lg">
                                            <i className={`${Icons.List} mr-2`}></i>
                                            Daftar Tingkatan Neraka ({filteredNeraka.length})
                                        </h2>
                                    </div>
                                    <div className="p-0 overflow-y-auto h-[calc(80vh-80px)]">
                                        <div className="p-4 space-y-3">
                                            {filteredNeraka.length > 0 ? (
                                                filteredNeraka.map((neraka) => (
                                                    <div
                                                        key={neraka.id}
                                                        onClick={() => setSelectedNeraka(neraka)}
                                                        className={`p-4 rounded-lg border cursor-pointer transition-all duration-300 hover:shadow-md ${
                                                            selectedNeraka?.id === neraka.id
                                                                ? 'bg-red-50 border-red-300 shadow-md'
                                                                : 'bg-white border-gray-200 hover:bg-red-25 hover:border-red-200'
                                                        }`}
                                                    >
                                                        <div className="space-y-2">
                                                            <div className="flex items-center justify-between">
                                                                <h3 className="font-semibold text-gray-800 text-base">{neraka.name}</h3>
                                                                <span className="text-sm bg-red-100 text-red-800 px-2 py-1 rounded-full">{neraka.id}</span>
                                                            </div>
                                                            <p className="arabic-text text-lg text-red-600">{neraka.arabic}</p>
                                                            <p className="text-sm text-gray-600 line-clamp-2">{neraka.generalDescription}</p>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-600">
                                                    <p>Tidak ada tingkatan neraka yang ditemukan.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Neraka Detail */}
                            <div className="lg:col-span-2">
                                {selectedNeraka ? (
                                    <div className="space-y-6">
                                        <div className="bg-white rounded-lg shadow-lg border border-red-200">
                                            <div className="bg-gradient-to-r from-red-600 to-rose-600 text-white p-6 rounded-t-lg">
                                                <h1 className="text-3xl font-bold">{selectedNeraka.name}</h1>
                                                <p className="arabic-text text-2xl mt-2">{selectedNeraka.arabic}</p>
                                                <p className="text-red-100 mt-2 text-lg">{selectedNeraka.generalDescription}</p>
                                            </div>
                                        </div>

                                        <div className="bg-white rounded-lg shadow-lg border border-red-200 p-6">
                                            <div className="space-y-6">
                                                {/* Occupants and Deeds */}
                                                <div>
                                                    <h3 className="text-xl font-semibold text-red-600 mb-3 flex items-center">
                                                        <i className={`${Icons.Users} mr-2`}></i>
                                                        Penghuni dan Perbuatan
                                                    </h3>
                                                    <ul className="space-y-2">
                                                        {selectedNeraka.occupantsAndDeeds.map((item, index) => (
                                                            <li key={index} className="flex items-start">
                                                                <span className="text-red-600 mr-2">â€¢</span>
                                                                <span className="text-gray-700">{item}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-lg border border-red-200 min-h-[60vh] flex items-center justify-center">
                                        <div className="text-center p-6">
                                            <i className={`${Icons.Fire} text-4xl text-gray-300 mb-4`}></i>
                                            <h3 className="text-xl text-gray-700 mb-2">Pilih Tingkatan Neraka</h3>
                                            <p className="text-gray-500">Silakan pilih nama neraka dari daftar di sebelah kiri untuk melihat detailnya</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50">
                    {/* Header */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-green-100 sticky top-0 z-50">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-green-600 hover:text-green-700 font-medium px-4 py-2 rounded-md bg-green-50 hover:bg-green-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-green-600 to-emerald-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.Book}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                                            Pengetahuan Islam
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Jelajahi kisah-kisah inspiratif, ilmu tajwid, sejarah Islam, Surga dan Neraka
                            </p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        {/* Tabs for content selection */}
                        <div className="bg-white rounded-lg shadow-lg border border-gray-100 p-4 mb-8">
                            <div className="flex justify-center space-x-4 flex-wrap gap-2">
                                <button
                                    onClick={() => setActiveTab('prophets')}
                                    className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'prophets' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.Users} mr-2`}></i> Kisah Nabi
                                </button>
                                <button
                                    onClick={() => setActiveTab('tajwid')}
                                    className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'tajwid' ? 'bg-purple-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.GraduationCap} mr-2`}></i> Ilmu Tajwid
                                </button>
                                <button
                                    onClick={() => setActiveTab('warStories')}
                                    className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'warStories' ? 'bg-red-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.ShieldHalved} mr-2`}></i> Kisah Perang Islam
                                </button>
                                <button
                                    onClick={() => setActiveTab('heavenHell')}
                                    className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'heavenHell' ? 'bg-sky-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.CloudSun} mr-2`}></i> Surga & Neraka
                                </button>
                                <button
                                    onClick={() => setActiveTab('hadith')}
                                    className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'hadith' ? 'bg-orange-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.Scroll} mr-2`}></i> Koleksi Hadits
                                </button>
                            </div>
                        </div>

                        {/* Render content based on activeTab */}
                        {activeTab === 'prophets' && <ProphetsContent />}
                        {activeTab === 'tajwid' && <TajwidContent />}
                        {activeTab === 'warStories' && <PerangIslamContent />}
                        {activeTab === 'heavenHell' && (
                            <div>
                                <div className="bg-white rounded-lg shadow-lg border border-gray-100 p-4 mb-8">
                                    <div className="flex justify-center space-x-4">
                                        <button
                                            onClick={() => setActiveSubTabHeavenHell('surga')}
                                            className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                                activeSubTabHeavenHell === 'surga' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`}
                                        >
                                            <i className={`${Icons.CloudSun} mr-2`}></i> Surga
                                        </button>
                                        <button
                                            onClick={() => setActiveSubTabHeavenHell('neraka')}
                                            className={`px-6 py-3 rounded-lg font-medium transition-colors flex items-center ${
                                                activeSubTabHeavenHell === 'neraka' ? 'bg-red-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`}
                                        >
                                            <i className={`${Icons.Fire} mr-2`}></i> Neraka
                                        </button>
                                    </div>
                                </div>
                                {activeSubTabHeavenHell === 'surga' && <SurgaContent />}
                                {activeSubTabHeavenHell === 'neraka' && <NerakaContent />}
                            </div>
                        )}
                        {activeTab === 'hadith' && <HadithPage setCurrentPage={setCurrentPage} />}
                    </div>

                    {/* Footer */}
                    <footer className="mt-auto text-center text-gray-600 text-sm py-8 border-t border-gray-100 bg-white/80 backdrop-blur-sm">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Pengetahuan Islam by Akhtar</p>
                    </footer>
                </div>
            );
        };


        // --- Asmaul Husna Page Component ---
        const AsmaulHusnaPage = ({ setCurrentPage }) => {
            const [searchTerm, setSearchTerm] = useState('');

            const filteredAsmaulHusna = asmaulHusnaData.filter(name =>
                name.latin.toLowerCase().includes(searchTerm.toLowerCase()) ||
                name.arabic.includes(searchTerm) ||
                name.meaning.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-green-50">
                    {/* Header will be integrated into IslamicToolsPage, so this one can be removed or made conditional */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-teal-100 sticky top-0 z-50 hidden">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-teal-600 hover:text-teal-700 font-medium px-4 py-2 rounded-md bg-teal-50 hover:bg-teal-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-teal-600 to-green-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.Palette}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-teal-600 to-green-600 bg-clip-text text-transparent">
                                            Asmaul Husna
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Pelajari 99 Nama Allah yang Indah dan Maknanya
                            </p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        {/* Search */}
                        <div className="bg-white p-6 rounded-lg shadow-lg border border-teal-100 mb-8">
                            <div className="relative">
                                <i className={`${Icons.Search} absolute left-3 top-3.5 text-gray-400`}></i>
                                <input
                                    type="text"
                                    placeholder="Cari nama atau makna..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2.5 border border-teal-200 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-400 text-base"
                                />
                            </div>
                        </div>

                        {/* Asmaul Husna List */}
                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                            {filteredAsmaulHusna.length > 0 ? (
                                filteredAsmaulHusna.map((name) => (
                                    <div
                                        key={name.id}
                                        className="bg-white p-6 rounded-lg shadow-md border border-teal-100 flex flex-col items-center text-center transform transition-transform duration-200 hover:scale-105 hover:shadow-lg"
                                    >
                                        <div className="w-12 h-12 rounded-full bg-teal-100 text-teal-800 flex items-center justify-center font-bold text-lg mb-3">
                                            {name.id}
                                        </div>
                                        <p className="arabic-text text-3xl text-teal-700 font-bold mb-2">{name.arabic}</p>
                                        <h3 className="text-xl font-semibold text-gray-800 mb-1">{name.latin}</h3>
                                        <p className="text-gray-600 text-sm">{name.meaning}</p>
                                    </div>
                                ))
                            ) : (
                                <div className="lg:col-span-4 text-center py-8 text-gray-600">
                                    <p>Tidak ada Asmaul Husna yang ditemukan.</p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Footer will be integrated into IslamicToolsPage */}
                    <footer className="mt-16 text-center text-gray-600 text-sm py-8 border-t border-teal-100 hidden">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Asmaul Husna by Akhtar</p>
                        <p className="mt-1 text-xs">
                            "Hanya milik Allah asmaul husna, maka bermohonlah kepada-Nya dengan (menyebut) asmaul husna itu..." (QS. Al-A'raf: 180)
                        </p>
                    </footer>
                </div>
            );
        };

        // --- Zakat Calculator Page Component ---
        const ZakatCalculatorPage = ({ setCurrentPage }) => {
            // Zakat Fitrah States
            const [jumlahOrang, setJumlahOrang] = useState(1);
            const [hargaBerasPerKg, setHargaBerasPerKg] = useState(12000); // Default price in IDR
            const zakatFitrahPerOrang = 2.5; // kg of rice
            const [zakatFitrahResult, setZakatFitrahResult] = useState(0);

            // Zakat Mal States
            const [nilaiEmas, setNilaiEmas] = useState(0); // in grams
            // Removed nilaiPerak for simplicity, as it requires separate price input or complex ratio.
            const [uangSimpanan, setUangSimpanan] = useState(0); // in IDR
            const [nilaiPerdagangan, setNilaiPerdagangan] = useState(0); // in IDR
            const [penghasilanProfesi, setPenghasilanProfesi] = useState(0); // in IDR per month
            const [hargaEmasPerGram, setHargaEmasPerGram] = useState(1000000); // Default gold price per gram in IDR

            const nisabEmasGram = 85; // grams

            const [totalHartaMal, setTotalHartaMal] = useState(0);
            const [nisabTerpenuhi, setNisabTerpenuhi] = useState(false);
            const [zakatMalResult, setZakatMalResult] = useState(0);

            // Calculate Zakat Fitrah
            useEffect(() => {
                const total = jumlahOrang * zakatFitrahPerOrang * hargaBerasPerKg;
                setZakatFitrahResult(total);
            }, [jumlahOrang, hargaBerasPerKg]);

            // Calculate Zakat Mal
            useEffect(() => {
                const emasInIdr = nilaiEmas * hargaEmasPerGram;
                const totalAssets = emasInIdr + uangSimpanan + nilaiPerdagangan + (penghasilanProfesi * 12); // Annual professional income

                const nisabValue = nisabEmasGram * hargaEmasPerGram; // Nisab based on gold value

                setTotalHartaMal(totalAssets);
                const meetsNisab = totalAssets >= nisabValue;
                setNisabTerpenuhi(meetsNisab);

                if (meetsNisab) {
                    setZakatMalResult(totalAssets * 0.025); // 2.5% zakat
                } else {
                    setZakatMalResult(0);
                }
            }, [nilaiEmas, uangSimpanan, nilaiPerdagangan, penghasilanProfesi, hargaEmasPerGram]);


            const formatCurrency = (value) => {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(value);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
                    {/* Header will be integrated into IslamicToolsPage */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-indigo-100 sticky top-0 z-50 hidden">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-indigo-600 hover:text-indigo-700 font-medium px-4 py-2 rounded-md bg-indigo-50 hover:bg-indigo-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.Calculator}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                            Kalkulator Zakat
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Hitung kewajiban zakat Anda dengan mudah
                            </p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Zakat Fitrah Section */}
                            <div className="bg-white rounded-lg shadow-lg border border-indigo-100 p-6">
                                <h2 className="text-2xl font-bold text-indigo-700 mb-6 flex items-center">
                                    <i className={`${Icons.Calculator} mr-3 text-indigo-500`}></i>
                                    Zakat Fitrah
                                </h2>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="jumlahOrang" className="block text-gray-700 font-medium mb-2">Jumlah Orang:</label>
                                        <input
                                            type="number"
                                            id="jumlahOrang"
                                            value={jumlahOrang}
                                            onChange={(e) => setJumlahOrang(Math.max(1, parseInt(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-400"
                                            min="1"
                                        />
                                    </div>
                                    <div>
                                        <label htmlFor="hargaBeras" className="block text-gray-700 font-medium mb-2">Harga Beras per Kg (Rp):</label>
                                        <input
                                            type="number"
                                            id="hargaBeras"
                                            value={hargaBerasPerKg}
                                            onChange={(e) => setHargaBerasPerKg(Math.max(0, parseInt(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-400"
                                            min="0"
                                        />
                                    </div>
                                    <div className="bg-indigo-50 border border-indigo-200 rounded-lg p-4 text-center">
                                        <p className="text-indigo-800 text-sm mb-2">Nisab Zakat Fitrah per orang: {zakatFitrahPerOrang} Kg beras</p>
                                        <p className="text-lg font-semibold text-indigo-900">Total Zakat Fitrah:</p>
                                        <p className="text-3xl font-bold text-indigo-900 mt-2">{formatCurrency(zakatFitrahResult)}</p>
                                    </div>
                                </div>
                            </div>

                            {/* Zakat Mal Section */}
                            <div className="bg-white rounded-lg shadow-lg border border-purple-100 p-6">
                                <h2 className="text-2xl font-bold text-purple-700 mb-6 flex items-center">
                                    <i className={`${Icons.Calculator} mr-3 text-purple-500`}></i>
                                    Zakat Mal
                                </h2>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="hargaEmas" className="block text-gray-700 font-medium mb-2">Harga Emas per Gram (Rp):</label>
                                        <input
                                            type="number"
                                            id="hargaEmas"
                                            value={hargaEmasPerGram}
                                            onChange={(e) => setHargaEmasPerGram(Math.max(0, parseInt(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                            min="0"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">Nisab Emas: {nisabEmasGram} gram. Setara: {formatCurrency(nisabEmasGram * hargaEmasPerGram)}</p>
                                    </div>
                                    <div>
                                        <label htmlFor="nilaiEmas" className="block text-gray-700 font-medium mb-2">Nilai Emas (gram):</label>
                                        <input
                                            type="number"
                                            id="nilaiEmas"
                                            value={nilaiEmas}
                                            onChange={(e) => setNilaiEmas(Math.max(0, parseFloat(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                            min="0"
                                        />
                                    </div>
                                    <div>
                                        <label htmlFor="uangSimpanan" className="block text-gray-700 font-medium mb-2">Uang Tunai/Tabungan (Rp):</label>
                                        <input
                                            type="number"
                                            id="uangSimpanan"
                                            value={uangSimpanan}
                                            onChange={(e) => setUangSimpanan(Math.max(0, parseInt(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                            min="0"
                                        />
                                    </div>
                                    <div>
                                        <label htmlFor="nilaiPerdagangan" className="block text-gray-700 font-medium mb-2">Nilai Aset Perdagangan (Rp):</label>
                                        <input
                                            type="number"
                                            id="nilaiPerdagangan"
                                            value={nilaiPerdagangan}
                                            onChange={(e) => setNilaiPerdagangan(Math.max(0, parseInt(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                            min="0"
                                        />
                                    </div>
                                    <div>
                                        <label htmlFor="penghasilanProfesi" className="block text-gray-700 font-medium mb-2">Penghasilan Profesi Bulanan (Rp):</label>
                                        <input
                                            type="number"
                                            id="penghasilanProfesi"
                                            value={penghasilanProfesi}
                                            onChange={(e) => setPenghasilanProfesi(Math.max(0, parseInt(e.target.value) || 0))}
                                            className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                            min="0"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">Dihitung per tahun untuk zakat mal.</p>
                                    </div>

                                    <div className="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                                        <p className="text-purple-800 text-sm mb-2">Total Harta (setara emas): {formatCurrency(totalHartaMal)}</p>
                                        <p className={`text-lg font-semibold ${nisabTerpenuhi ? 'text-green-800' : 'text-red-800'}`}>
                                            Nisab {nisabTerpenuhi ? 'Terpenuhi' : 'Tidak Terpenuhi'}
                                        </p>
                                        <p className="text-3xl font-bold text-purple-900 mt-2">Zakat Mal: {formatCurrency(zakatMalResult)}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Footer will be integrated into IslamicToolsPage */}
                    <footer className="mt-12 text-center text-gray-600 text-sm py-4 border-t border-gray-200 hidden">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Kalkulator Zakat by Akhtar</p>
                    </footer>
                </div>
            );
        };

        // --- Hijri Calendar Page Component ---
        const HijriCalendarPage = ({ setCurrentPage }) => {
            const [gregorianDate, setGregorianDate] = useState('');
            const [hijriDate, setHijriDate] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            // Important Islamic Dates (Static for simplicity, can be expanded)
            const importantDates = [
                { hijri: "1 Muharram 1446 H", event: "Tahun Baru Islam" },
                { hijri: "10 Muharram 1446 H", event: "Hari Asyura" },
                { hijri: "12 Rabiul Awal 1446 H", event: "Maulid Nabi Muhammad SAW" },
                { hijri: "27 Rajab 1446 H", event: "Isra' Mi'raj" },
                { hijri: "1 Ramadhan 1446 H", event: "Awal Puasa Ramadhan" },
                { hijri: "17 Ramadhan 1446 H", event: "Nuzulul Quran" },
                { hijri: "1 Syawal 1446 H", event: "Idul Fitri" },
                { hijri: "10 Dzulhijjah 1446 H", event: "Idul Adha" }
            ];

            // Fetch current date on component mount
            useEffect(() => {
                const today = new Date();
                const day = String(today.getDate()).padStart(2, '0');
                const month = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
                const year = today.getFullYear();
                const formattedDate = `${day}-${month}-${year}`;
                setGregorianDate(formattedDate);
                fetchHijriDate(formattedDate);
            }, []);

            const fetchHijriDate = async (date) => {
                setLoading(true);
                setError('');
                try {
                    // Using `fetch` for API call
                    const response = await fetch(`https://api.aladhan.com/v1/gToH?date=${date}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    if (data && data.data) {
                        const hijri = data.data.hijri;
                        setHijriDate(`${hijri.day} ${hijri.month.ar} ${hijri.year} H`); // Or use hijri.month.en for English month name
                    } else {
                        setError('Data Hijriah tidak ditemukan.');
                    }
                } catch (err) {
                    console.error("Error fetching Hijri date:", err);
                    setError('Gagal mengambil tanggal Hijriah. Coba lagi nanti.');
                } finally {
                    setLoading(false);
                }
            };

            const handleDateChange = (e) => {
                const newDate = e.target.value;
                setGregorianDate(newDate);
                // Re-fetch Hijri date if a valid date is entered
                if (newDate) {
                    const [year, month, day] = newDate.split('-');
                    fetchHijriDate(`${day}-${month}-${year}`);
                } else {
                    setHijriDate('');
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-teal-50">
                    {/* Header will be integrated into IslamicToolsPage */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-blue-100 sticky top-0 z-50 hidden">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-blue-600 hover:text-blue-700 font-medium px-4 py-2 rounded-md bg-blue-50 hover:bg-blue-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-blue-600 to-teal-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.CalendarAlt}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-600 to-teal-600 bg-clip-text text-transparent">
                                            Kalender Hijriah
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Lihat tanggal Islam dan hari-hari penting
                            </p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        <div className="bg-white rounded-lg shadow-lg border border-blue-100 p-6 mb-8 text-center">
                            <h2 className="text-2xl font-bold text-blue-700 mb-4">Tanggal Hari Ini</h2>
                            <p className="text-gray-700 text-lg mb-2">Gregorian: <span className="font-semibold">{gregorianDate}</span></p>
                            {loading ? (
                                <div className="loading mx-auto my-4"></div>
                            ) : error ? (
                                <p className="text-red-500 mt-4">{error}</p>
                            ) : (
                                <p className="text-blue-800 text-2xl font-bold">Hijriah: {hijriDate}</p>
                            )}
                            <div className="mt-4 max-w-xs mx-auto">
                                <label htmlFor="dateInput" className="block text-gray-700 font-medium mb-2">Cek Tanggal Lain:</label>
                                <input
                                    type="date"
                                    id="dateInput"
                                    value={gregorianDate.split('-').reverse().join('-')} // Format YYYY-MM-DD for input type="date"
                                    onChange={handleDateChange}
                                    className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"
                                />
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg border border-teal-100 p-6">
                            <h2 className="text-2xl font-bold text-teal-700 mb-6 flex items-center">
                                <i className={`${Icons.CalendarAlt} mr-3 text-teal-500`}></i>
                                Hari-hari Penting Islam (Tahun 1446 H / 2024-2025 M)
                            </h2>
                            <ul className="space-y-3">
                                {importantDates.map((date, index) => (
                                    <li key={index} className="flex items-start bg-teal-50 border border-teal-100 rounded-md p-4">
                                        <span className="text-teal-600 font-bold text-lg mr-4">{index + 1}.</span>
                                        <div>
                                            <p className="font-semibold text-gray-800 text-lg">{date.event}</p>
                                            <p className="text-gray-600 text-sm">{date.hijri}</p>
                                        </div>
                                    </li>
                                ))}
                            </ul>
                            <p className="text-sm text-gray-500 mt-4 italic">
                                *Tanggal-tanggal ini adalah perkiraan dan dapat bervariasi berdasarkan pengamatan hilal.
                            </p>
                        </div>
                    </div>

                    {/* Footer will be integrated into IslamicToolsPage */}
                    <footer className="mt-12 text-center text-gray-600 text-sm py-4 border-t border-gray-200 hidden">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Kalender Hijriah by Akhtar</p>
                    </footer>
                </div>
            );
        };

        // --- Prayer Times Page Component ---
        const PrayerTimesPage = ({ setCurrentPage }) => {
            const [city, setCity] = useState('');
            const [country, setCountry] = useState('');
            const [prayerTimes, setPrayerTimes] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [method, setMethod] = useState(2); // Default to ISNA method (2)
            const [displayDate, setDisplayDate] = useState(''); // To display date of the fetched prayer times

            // Prayer calculation methods from Aladhan API
            const methods = [
                { id: 0, name: "Shia Ithna-Ashari" },
                { id: 1, name: "University of Islamic Sciences, Karachi" },
                { id: 2, name: "Islamic Society of North America (ISNA)" },
                { id: 3, name: "Muslim World League" },
                { id: 4, name: "Umm Al-Qura University, Makkah" },
                { id: 5, name: "Egyptian General Authority of Survey" },
                { id: 7, name: "Institute of Geophysics, University of Tehran" },
                { id: 8, name: "Kuwait" },
                { id: 9, name: "Qatar" },
                { id: 10, name: "Majlis Ugama Islam Singapura (MUIS)" },
                { id: 11, name: "Union des Organisations Islamiques de France (UOIF)" },
                { id: 12, name: "Diyanet Ä°ÅŸleri BaÅŸkanlÄ±ÄŸÄ±, Turkey" },
                { id: 13, name: "Spiritual Administration of Muslims of Russia" },
                { id: 14, name: "Dubai" },
                { id: 15, name: "Moonsighting Committee" },
                { id: 16, name: "Jordan" },
                { id: 17, name: "Morocco" },
                { id: 18, name: "Tunisia" },
                { id: 19, name: "Algeria" },
                { id: 20, name: "Malaysia" },
                { id: 21, name: "Kemenag RI (Indonesia)" }
            ];

            const fetchPrayerTimes = async () => {
                if (!city || !country) {
                    setError('Harap masukkan kota dan negara.');
                    setPrayerTimes(null);
                    return;
                }

                setLoading(true);
                setError('');
                setPrayerTimes(null);

                try {
                    const response = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=${method}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    const data = await response.json();

                    if (data && data.data && data.data.timings) {
                        setPrayerTimes(data.data.timings);
                        setDisplayDate(data.data.date.readable); // Date in human-readable format
                    } else {
                        setError('Tidak dapat menemukan waktu sholat untuk lokasi ini. Harap periksa ejaan.');
                    }
                } catch (err) {
                    console.error("Error fetching prayer times:", err);
                    setError('Gagal mengambil waktu sholat. Periksa koneksi atau coba lagi nanti.');
                } finally {
                    setLoading(false);
                }
            };

            // Fetch prayer times for Jakarta, Indonesia on initial load
            useEffect(() => {
                setCity('Jakarta');
                setCountry('Indonesia');
                // Use a timeout to ensure state is set before fetch,
                // or call fetchPrayerTimes directly with initial values if preferred.
                // For simplicity, let's just make sure the state is set and then trigger fetch.
            }, []); // Empty dependency array means this runs once on mount

            // Trigger fetch when city, country, or method changes
            useEffect(() => {
                if (city && country) {
                    fetchPrayerTimes();
                }
            }, [city, country, method]);


            const prayerNames = {
                Fajr: "Subuh",
                Sunrise: "Terbit",
                Dhuhr: "Dzuhur",
                Asr: "Ashar",
                Sunset: "Matahari Terbenam",
                Maghrib: "Maghrib",
                Isha: "Isya",
                Imsak: "Imsak",
                Midnight: "Tengah Malam"
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50">
                    {/* Header will be integrated into IslamicToolsPage */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-purple-100 sticky top-0 z-50 hidden">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-purple-600 hover:text-purple-700 font-medium px-4 py-2 rounded-md bg-purple-50 hover:bg-purple-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.Clock}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                                            Jadwal Sholat
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Lihat waktu sholat harian untuk lokasi Anda
                            </p>
                        </div>
                    </header>

                    <div className="container mx-auto px-4 py-8">
                        <div className="bg-white rounded-lg shadow-lg border border-purple-100 p-6 mb-8">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label htmlFor="cityInput" className="block text-gray-700 font-medium mb-2">Kota:</label>
                                    <input
                                        type="text"
                                        id="cityInput"
                                        value={city}
                                        onChange={(e) => setCity(e.target.value)}
                                        placeholder="Contoh: Jakarta"
                                        className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                    />
                                </div>
                                <div>
                                    <label htmlFor="countryInput" className="block text-gray-700 font-medium mb-2">Negara:</label>
                                    <input
                                        type="text"
                                        id="countryInput"
                                        value={country}
                                        onChange={(e) => setCountry(e.target.value)}
                                        placeholder="Contoh: Indonesia"
                                        className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                    />
                                </div>
                            </div>
                            <div className="mb-4">
                                <label htmlFor="methodSelect" className="block text-gray-700 font-medium mb-2">Metode Kalkulasi:</label>
                                <select
                                    id="methodSelect"
                                    value={method}
                                    onChange={(e) => setMethod(parseInt(e.target.value))}
                                    className="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-400"
                                >
                                    {methods.map((m) => (
                                        <option key={m.id} value={m.id}>{m.name}</option>
                                    ))}
                                </select>
                            </div>
                            <button
                                onClick={fetchPrayerTimes}
                                className="w-full bg-purple-600 text-white font-bold py-2.5 px-4 rounded-md hover:bg-purple-700 transition-colors shadow-md flex items-center justify-center"
                                disabled={loading}
                            >
                                {loading ? (
                                    <>
                                        <div className="loading w-5 h-5 border-white border-t-purple-300 mr-3"></div>
                                        Memuat...
                                    </>
                                ) : (
                                    <>
                                        <i className={`${Icons.Search} mr-2`}></i>
                                        Cari Waktu Sholat
                                    </>
                                )}
                            </button>
                        </div>

                        {error && (
                            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-8" role="alert">
                                <strong className="font-bold">Error!</strong>
                                <span className="block sm:inline"> {error}</span>
                            </div>
                        )}

                        {prayerTimes && (
                            <div className="bg-white rounded-lg shadow-lg border border-purple-100 p-6">
                                <h2 className="text-2xl font-bold text-purple-700 mb-4 text-center">
                                    Waktu Sholat untuk {city}, {country}
                                </h2>
                                <p className="text-gray-600 text-center text-lg mb-6">Tanggal: <span className="font-semibold">{displayDate}</span></p>

                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {Object.keys(prayerTimes).map((key) => {
                                        // Filter out unwanted times like 'Fajr_Shafaa' or 'Lastthird' etc.
                                        if (['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Sunset', 'Maghrib', 'Isha', 'Imsak', 'Midnight'].includes(key)) {
                                            return (
                                                <div key={key} className="bg-purple-50 border border-purple-200 rounded-lg p-5 flex items-center justify-between shadow-sm">
                                                    <div className="flex items-center">
                                                        <i className={`${Icons.Clock} text-purple-600 text-2xl mr-4`}></i>
                                                        <div>
                                                            <p className="text-lg font-semibold text-gray-800">{prayerNames[key] || key}</p>
                                                            <p className="text-sm text-gray-600">({key})</p>
                                                        </div>
                                                    </div>
                                                    <span className="text-3xl font-bold text-purple-900">{prayerTimes[key]}</span>
                                                </div>
                                            );
                                        }
                                        return null;
                                    })}
                                </div>
                                <p className="text-sm text-gray-500 mt-6 text-center italic">
                                    *Waktu disesuaikan dengan zona waktu lokal Anda.
                                </p>
                            </div>
                        )}
                    </div>

                    {/* Footer will be integrated into IslamicToolsPage */}
                    <footer className="mt-12 text-center text-gray-600 text-sm py-4 border-t border-gray-200 hidden">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Jadwal Sholat by Akhtar</p>
                    </footer>
                </div>
            );
        };


        // --- New Combined Islamic Tools Page Component ---
        const IslamicToolsPage = ({ setCurrentPage }) => {
            const [activeTab, setActiveTab] = useState('prayerTimes'); // Default tab

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 flex flex-col">
                    {/* Header */}
                    <header className="bg-white/80 backdrop-blur-sm border-b border-gray-100 sticky top-0 z-50">
                        <div className="container mx-auto px-4 py-6">
                            <div className="flex items-center justify-between mb-4">
                                <button
                                    onClick={() => setCurrentPage('index')}
                                    className="flex items-center text-gray-600 hover:text-gray-700 font-medium px-4 py-2 rounded-md bg-gray-50 hover:bg-gray-100 transition-colors"
                                >
                                    <i className={`${Icons.ArrowLeft} mr-2`}></i>
                                    <span>Kembali ke Utama</span>
                                </button>
                                <div className="flex items-center space-x-3">
                                    <div className="w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-full flex items-center justify-center text-white text-xl">
                                        <i className={Icons.Tools}></i>
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                                            Alat Islam
                                        </h1>
                                        <p className="text-sm text-gray-600">by Akhtar</p>
                                    </div>
                                </div>
                            </div>
                            <p className="text-center text-gray-600 max-w-2xl mx-auto">
                                Akses Jadwal Sholat, Kalender Hijriah, Kalkulator Zakat, dan Asmaul Husna
                            </p>
                        </div>
                    </header>

                    <main className="container mx-auto px-4 py-8 flex-grow">
                        {/* Tabs for content selection */}
                        <div className="bg-white rounded-lg shadow-lg border border-gray-100 p-4 mb-8">
                            <div className="flex justify-center space-x-2 flex-wrap gap-2">
                                <button
                                    onClick={() => setActiveTab('prayerTimes')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'prayerTimes' ? 'bg-purple-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.Clock} mr-2`}></i> Jadwal Sholat
                                </button>
                                <button
                                    onClick={() => setActiveTab('hijriCalendar')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'hijriCalendar' ? 'bg-blue-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.CalendarAlt} mr-2`}></i> Kalender Hijriah
                                </button>
                                <button
                                    onClick={() => setActiveTab('zakatCalculator')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'zakatCalculator' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.Calculator} mr-2`}></i> Kalkulator Zakat
                                </button>
                                <button
                                    onClick={() => setActiveTab('asmaulHusna')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors flex items-center ${
                                        activeTab === 'asmaulHusna' ? 'bg-teal-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <i className={`${Icons.Palette} mr-2`}></i> Asmaul Husna
                                </button>
                            </div>
                        </div>

                        {/* Render content based on activeTab */}
                        {activeTab === 'prayerTimes' && <PrayerTimesPage />}
                        {activeTab === 'hijriCalendar' && <HijriCalendarPage />}
                        {activeTab === 'zakatCalculator' && <ZakatCalculatorPage />}
                        {activeTab === 'asmaulHusna' && <AsmaulHusnaPage />}
                    </main>

                    {/* Footer */}
                    <footer className="mt-auto text-center text-gray-600 text-sm py-8 border-t border-gray-100 bg-white/80 backdrop-blur-sm">
                        <div className="flex items-center justify-center mb-2">
                            <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                            <p>Dibuat dengan cinta untuk umat Islam</p>
                        </div>
                        <p>Â© 2024 Alat Islam by Akhtar</p>
                    </footer>
                </div>
            );
        };


        // --- Index Page Component ---
        const IndexPage = ({ setCurrentPage }) => (
            <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 flex flex-col">
                {/* Header */}
                <header className="bg-white/80 backdrop-blur-sm border-b border-gray-100 sticky top-0 z-50">
                    <div className="container mx-auto px-4 py-8">
                        <div className="flex flex-col items-center justify-center mb-4">
                            <div className="flex items-center space-x-4">
                                <div className="w-16 h-16 bg-gradient-to-r from-teal-600 to-green-600 rounded-full flex items-center justify-center text-white text-3xl shadow-lg">
                                    <i className={Icons.Quran}></i>
                                </div>
                                <div>
                                    <h1 className="text-4xl font-extrabold bg-gradient-to-r from-teal-600 to-green-600 bg-clip-text text-transparent">
                                        Al-Quran Digital
                                    </h1>
                                    <p className="text-md text-gray-600 text-center">by Akhtar</p>
                                </div>
                            </div>
                        </div>
                        <p className="text-center text-gray-700 max-w-2xl mx-auto mt-4 text-lg">
                            Pintu gerbang Anda untuk memahami dan mempelajari Al-Quran, kisah para nabi, dan ilmu tajwid
                        </p>
                    </div>
                </header>

                <main className="container mx-auto px-4 py-12 flex-grow">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl font-bold text-gray-800 mb-4">Selamat Datang di Al-Quran Digital</h2>
                        <p className="text-gray-600 text-lg">Pilih menu di bawah untuk memulai perjalanan spiritual Anda</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 max-w-6xl mx-auto">
                        <div className="bg-white p-8 rounded-xl shadow-xl border border-green-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                            <div className="text-5xl mb-5 text-green-600 bg-green-50 rounded-full p-4">
                                <i className={Icons.BookOpen}></i>
                            </div>
                            <h3 className="text-2xl font-semibold text-green-700 mb-3">Baca Al-Quran</h3>
                            <p className="text-gray-600 mb-6">Nikmati membaca Al-Quran lengkap dengan terjemahan dan audio murottal.</p>
                            <button
                                onClick={() => setCurrentPage('quranReader')}
                                className="mt-auto inline-flex items-center px-6 py-3 border border-green-300 text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors shadow-md"
                            >
                                <i className={`${Icons.BookOpen} mr-3`}></i>
                                Mulai Baca
                            </button>
                        </div>

                        <div className="bg-white p-8 rounded-xl shadow-xl border border-blue-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                            <div className="text-5xl mb-5 text-blue-600 bg-blue-50 rounded-full p-4">
                                <i className={Icons.Book}></i>
                            </div>
                            <h3 className="text-2xl font-semibold text-blue-700 mb-3">Pengetahuan Islam</h3>
                            <p className="text-gray-600 mb-6">Pelajari kisah nabi, ilmu tajwid, sejarah perang, Surga dan Neraka.</p>
                            <button
                                onClick={() => setCurrentPage('islamicKnowledge')}
                                className="mt-auto inline-flex items-center px-6 py-3 border border-blue-300 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-md"
                            >
                                <i className={`${Icons.Book} mr-3`}></i>
                                Jelajahi
                            </button>
                        </div>

                        {/* Combined Islamic Tools Card */}
                        <div className="bg-white p-8 rounded-xl shadow-xl border border-indigo-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                            <div className="text-5xl mb-5 text-indigo-600 bg-indigo-50 rounded-full p-4">
                                <i className={Icons.Tools}></i>
                            </div>
                            <h3 className="text-2xl font-semibold text-indigo-700 mb-3">Alat Islam</h3>
                            <p className="text-gray-600 mb-6">Akses Jadwal Sholat, Kalender Hijriah, Kalkulator Zakat, dan Asmaul Husna.</p>
                            <button
                                onClick={() => setCurrentPage('islamicTools')}
                                className="mt-auto inline-flex items-center px-6 py-3 border border-indigo-300 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors shadow-md"
                            >
                                <i className={`${Icons.Tools} mr-3`}></i>
                                Gunakan Alat
                            </button>
                        </div>

                        {/* Placeholder for old cards, now removed */}
                        <div className="hidden">
                            <div className="bg-white p-8 rounded-xl shadow-xl border border-teal-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                                <div className="text-5xl mb-5 text-teal-600 bg-teal-50 rounded-full p-4">
                                    <i className={Icons.Palette}></i>
                                </div>
                                <h3 className="text-2xl font-semibold text-teal-700 mb-3">Asmaul Husna</h3>
                                <p className="text-gray-600 mb-6">Jelajahi 99 Nama Allah yang Indah beserta artinya.</p>
                                <button
                                    onClick={() => setCurrentPage('asmaulHusna')}
                                    className="mt-auto inline-flex items-center px-6 py-3 border border-teal-300 text-white bg-teal-600 rounded-lg hover:bg-teal-700 transition-colors shadow-md"
                                >
                                    <i className={`${Icons.Palette} mr-3`}></i>
                                    Lihat Nama-Nama
                                </button>
                            </div>
                        </div>
                        <div className="hidden">
                            <div className="bg-white p-8 rounded-xl shadow-xl border border-indigo-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                                <div className="text-5xl mb-5 text-indigo-600 bg-indigo-50 rounded-full p-4">
                                    <i className={Icons.Calculator}></i>
                                </div>
                                <h3 className="text-2xl font-semibold text-indigo-700 mb-3">Kalkulator Zakat</h3>
                                <p className="text-gray-600 mb-6">Hitung kewajiban zakat fitrah dan zakat mal Anda.</p>
                                <button
                                    onClick={() => setCurrentPage('zakatCalculator')}
                                    className="mt-auto inline-flex items-center px-6 py-3 border border-indigo-300 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors shadow-md"
                                >
                                    <i className={`${Icons.Calculator} mr-3`}></i>
                                    Hitung Zakat
                                </button>
                            </div>
                        </div>
                        <div className="hidden">
                            <div className="bg-white p-8 rounded-xl shadow-xl border border-teal-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                                <div className="text-5xl mb-5 text-teal-600 bg-teal-50 rounded-full p-4">
                                    <i className={Icons.CalendarAlt}></i>
                                </div>
                                <h3 className="text-2xl font-semibold text-teal-700 mb-3">Kalender Hijriah</h3>
                                <p className="text-gray-600 mb-6">Lihat tanggal Islam dan hari-hari penting Islam.</p>
                                <button
                                    onClick={() => setCurrentPage('hijriCalendar')}
                                    className="mt-auto inline-flex items-center px-6 py-3 border border-teal-300 text-white bg-teal-600 rounded-lg hover:bg-teal-700 transition-colors shadow-md"
                                >
                                    <i className={`${Icons.CalendarAlt} mr-3`}></i>
                                    Lihat Kalender
                                </button>
                            </div>
                        </div>
                        <div className="hidden">
                            <div className="bg-white p-8 rounded-xl shadow-xl border border-purple-100 flex flex-col items-center text-center transform hover:scale-105 transition-transform duration-300">
                                <div className="text-5xl mb-5 text-purple-600 bg-purple-50 rounded-full p-4">
                                    <i className={Icons.Clock}></i>
                                </div>
                                <h3 className="text-2xl font-semibold text-purple-700 mb-3">Jadwal Sholat</h3>
                                <p className="text-gray-600 mb-6">Lihat waktu sholat harian berdasarkan lokasi Anda.</p>
                                <button
                                    onClick={() => setCurrentPage('prayerTimes')}
                                    className="mt-auto inline-flex items-center px-6 py-3 border border-purple-300 text-white bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors shadow-md"
                                >
                                    <i className={`${Icons.Clock} mr-3`}></i>
                                    Lihat Jadwal
                                </button>
                            </div>
                        </div>
                    </div>
                </main>

                {/* Footer */}
                <footer className="mt-auto text-center text-gray-600 text-sm py-8 border-t border-gray-100 bg-white/80 backdrop-blur-sm">
                    <div className="flex items-center justify-center mb-2">
                        <i className={`${Icons.Heart} text-red-500 mr-1`}></i>
                        <p>Dibuat dengan cinta untuk umat Islam</p>
                    </div>
                    <p>Â© 2024 Al-Quran Digital by Akhtar</p>
                </footer>
            </div>
        );


        // --- Main App Component ---
        const App = () => {
            // State to manage the current page
            const [currentPage, setCurrentPage] = useState('index');

            // Reset states when changing pages
            useEffect(() => {
                // Future: Could reset search terms, selected items, etc. here if passed down
                // For simplicity, current pages components manage their own states.
            }, [currentPage]);

            // Conditional rendering based on currentPage state
            switch (currentPage) {
                case 'index':
                    return <IndexPage setCurrentPage={setCurrentPage} />;
                case 'quranReader':
                    return <QuranReaderPage setCurrentPage={setCurrentPage} />;
                case 'islamicKnowledge': // Existing combined page
                    return <IslamicKnowledgePage setCurrentPage={setCurrentPage} />;
                case 'islamicTools': // New combined page for tools
                    return <IslamicToolsPage setCurrentPage={setCurrentPage} />;
                default:
                    return <IndexPage setCurrentPage={setCurrentPage} />; // Fallback
            }
        };

        // Render the main App component into the 'react-app' div
        ReactDOM.createRoot(document.getElementById('react-app')).render(<App />);
    </script><script>
document.addEventListener("DOMContentLoaded", function () {
    const observer = new MutationObserver(() => {
        const setting = [...document.querySelectorAll('.sidebar-setting')].find(s =>
            s.textContent.includes("Tampilkan Al-Qurâ€™an")
        );
        const value = setting?.querySelector(".status-text")?.textContent?.trim();
        const container = document.getElementById("alQuranContainer");
        if (container && value) {
            container.style.display = value === "Aktif" ? "block" : "none";
        }
    });

    const sidebar = document.querySelector('.sidebar');
    if (sidebar) {
        observer.observe(sidebar, { childList: true, subtree: true });
    }

    // Trigger immediately on load
    setTimeout(() => {
        const setting = [...document.querySelectorAll('.sidebar-setting')].find(s =>
            s.textContent.includes("Tampilkan Al-Qurâ€™an")
        );
        const value = setting?.querySelector(".status-text")?.textContent?.trim();
        const container = document.getElementById("alQuranContainer");
        if (container && value) {
            container.style.display = value === "Aktif" ? "block" : "none";
        }
    }, 1000);
});
</script></body>
</html>